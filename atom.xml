<?xml version="1.0" encoding="utf-8"?>
<feed xmlns="http://www.w3.org/2005/Atom">
  <title>Cara&#39;s Blog</title>
  
  <subtitle>Do what you like , Like what you do.</subtitle>
  <link href="/atom.xml" rel="self"/>
  
  <link href="https://yoursite.com/"/>
  <updated>2022-08-23T10:34:28.757Z</updated>
  <id>https://yoursite.com/</id>
  
  <author>
    <name>Cara</name>
    
  </author>
  
  <generator uri="http://hexo.io/">Hexo</generator>
  
  <entry>
    <title>Algebraic Effects &amp; React</title>
    <link href="https://yoursite.com/2022/08/23/Algebraic-Effects-React/"/>
    <id>https://yoursite.com/2022/08/23/Algebraic-Effects-React/</id>
    <published>2022-08-23T09:54:20.000Z</published>
    <updated>2022-08-23T10:34:28.757Z</updated>
    
    <content type="html"><![CDATA[<h2 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h2><p>è¿™å‡ å¹´ç½‘ä¸Šå·²ç»æœ‰éå¸¸çš„å¤šæ–‡ç« åœ¨æ¢è®¨ React è¿™æ¬¡çš„å¤§æ‰‹ç¬”, æ­£å¥½å€Ÿåœ¨ Bench è¿™æ®µæ—¶é—´é‡Œèƒ½é€šè¿‡ React18 çš„æºç çœ‹çœ‹åˆ°åº•åšäº†å“ªäº›æ”¹å˜, ä¸»è¦æ˜¯å¯¹æ—¶é—´åˆ‡ç‰‡å’Œè°ƒåº¦æ–¹é¢æ¯”è¾ƒæ„Ÿå…´è¶£</p><p>æ¥ç€å°±<code>git clone</code> -&gt; <code>setup æºç </code> -&gt; <code>æ·»åŠ beakPoint</code> ä¸€é¡¿æ“ä½œçŒ›å¦‚è™, ç„¶åå‘ç° emmmâ€¦ æ ¹æœ¬æ— ä»ä¸‹æ‰‹â€¦ </p><p>React çš„ä»£ç é‡æ—¢å¤š, è·³è½¬é€»è¾‘åˆå¾ˆå¤æ‚. æ‰€ä»¥æœæ–­æ¢æ€è·¯ä»è®¾è®¡æ€æƒ³å‡ºå‘, å†åˆ°å®ç°. èµ·ç ä½ å…ˆçŸ¥é“ React_ _æƒ³åšä»€ä¹ˆ, åœ¨çœ‹å’‹å®ç°çš„ä¸å®¹æ˜“å¤šäº†å—(æ˜¯å—?ğŸ˜’)</p><p>äºæ˜¯æ‰“å¼€æµè§ˆå™¨ Google: React çš„è®¾è®¡æ€æƒ³, ç¬¬ä¸€ä¸ªè¹¦å‡ºæ¥çš„å°±æ˜¯ä»Šå¤©çš„ä¸»è§’: <strong>ä»£æ•°æ•ˆåº”</strong><br>å¬ä¸Šå»æ˜¯ä¸ªå¾ˆå¯æ€•çš„åå­—â€¦</p><blockquote><p>å¼•ç”¨ä¸€ä½ React çš„æ ¸å¿ƒå¼€å‘è€… <a href="https://github.com/sebmarkbage/" target="_blank" rel="noopener">Sebastian MarkbÃ¥ge</a> çš„è¯<br>React æ‰€åšçš„äº‹å°±æ˜¯åœ¨è·µè¡Œä»£æ•°æ•ˆåº”</p></blockquote><p>ä¸ºäº†æ›´å¥½å¾—ç†è§£ä»£æ•°æ•ˆåº”, æˆ‘ä»¬å…ˆæ¥çœ‹çœ‹ä¸ä¹‹ç›¸å…³çš„ä¸€ä¸ªä¸œè¥¿: CPS </p><h2 id="Continuation-Passing-Style-CPS"><a href="#Continuation-Passing-Style-CPS" class="headerlink" title="Continuation Passing Style (CPS)"></a>Continuation Passing Style (CPS)</h2><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subtract = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> y - x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multiply = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a * b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result1 = add(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"><span class="keyword">const</span> result2 = subtract(result1, <span class="number">1</span>)</span><br><span class="line"><span class="keyword">const</span> result3 = multiply(result2, <span class="number">3</span>)</span><br><span class="line"><span class="built_in">console</span>.log(result3) <span class="comment">// 6</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">x, y, next</span>) =&gt;</span> &#123;</span><br><span class="line">  next(x + y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subtract = <span class="function">(<span class="params">x, y, next</span>) =&gt;</span> &#123;</span><br><span class="line">  next(y - x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multiply = <span class="function">(<span class="params">a, b, next</span>) =&gt;</span> &#123;</span><br><span class="line">  next(a * b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>, (result1) =&gt; &#123;</span><br><span class="line">  subtract(result1, <span class="number">1</span>, (result2) =&gt; &#123;</span><br><span class="line">    multiply(result2, <span class="number">3</span>, <span class="built_in">console</span>.log) <span class="comment">// 6</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>å¯¹æ¯”ä¹‹ä¸‹, æˆ‘ä»¬å¯ä»¥å‘ç°: å¥½å®¶ä¼™! CPS ä¸å°±æ˜¯æˆ‘ä»¬å—¤ä¹‹ä»¥é¼»çš„å›è°ƒåœ°ç‹±å—! è€Œä¸”å¯è¯»æ€§å¥‡å·®<br>æ—¢ç„¶è¿™æ ·é‚£æˆ‘ä»¬ä¸ºä»€ä¹ˆè¿˜è¦å†™ CPS å‘¢? ç­”æ¡ˆæ˜¯: ä¸ç”¨å†™, ä½†æ˜¯å¹¶ä¸ä»£è¡¨ CPS å°±æ˜¯ä¸€æ— æ˜¯å¤„çš„. </p><h3 id="æŠ›å¼ƒåˆšåˆšå¯¹-CPS-çš„æœ‰è‰²çœ¼é•œ-é‡æ–°è§‚å¯Ÿåˆ†æä¸€ä¸‹-CPS-åˆ°åº•æœ‰ä»€ä¹ˆä¼˜åŠ¿"><a href="#æŠ›å¼ƒåˆšåˆšå¯¹-CPS-çš„æœ‰è‰²çœ¼é•œ-é‡æ–°è§‚å¯Ÿåˆ†æä¸€ä¸‹-CPS-åˆ°åº•æœ‰ä»€ä¹ˆä¼˜åŠ¿" class="headerlink" title="æŠ›å¼ƒåˆšåˆšå¯¹ CPS çš„æœ‰è‰²çœ¼é•œ, é‡æ–°è§‚å¯Ÿåˆ†æä¸€ä¸‹ CPS åˆ°åº•æœ‰ä»€ä¹ˆä¼˜åŠ¿"></a>æŠ›å¼ƒåˆšåˆšå¯¹ CPS çš„æœ‰è‰²çœ¼é•œ, é‡æ–°è§‚å¯Ÿåˆ†æä¸€ä¸‹ CPS åˆ°åº•æœ‰ä»€ä¹ˆä¼˜åŠ¿</h3><h4 id="1-Continuation"><a href="#1-Continuation" class="headerlink" title="1. Continuation"></a>1. Continuation</h4><p>åœ¨ä¸Šé¢çš„ä¾‹å­ä¸­, æ¯ä¸ªå‡½æ•°éƒ½æ¥æ”¶ä¸€ä¸ª<code>next</code>å›è°ƒå‡½æ•°, è€Œä¸”æ¯ä¸ªå‡½æ•°çš„è®¡ç®—ç»“æœéƒ½æ˜¯é€šè¿‡<code>next</code><strong>å»¶ç»­</strong>(ç»†å“å»¶ç»­è¿™ä¸ªè¯)ç»™ä¸‹ä¸€ä¸ªå‡½æ•°.<br>é¡ºç€è¿™ä¸ªæ€è·¯å†æ¥çœ‹ä¸ CPS å¯¹æ¯”çš„ Direct Style, å®ƒå¯¹æµç¨‹çš„æ§åˆ¶å®Œå…¨å–å†³äºæˆ‘ä»¬è°ƒç”¨å•¥. æ‰€ä»¥å®ƒå¯¹å»¶ç»­æ€§(continuation)çš„æ§åˆ¶æ˜¯éšå¼çš„, ä¸åƒ CPS æˆ‘ä»¬ä¸€çœ‹åˆ°<code>next</code>å°±çŸ¥é“è¿™æ˜¯è¦æ§åˆ¶æµç¨‹ç»§ç»­å¾€ä¸‹å»¶ç»­äº†. <br>æ¢å¥è¯è¯´ CPS èƒ½æ§åˆ¶ç¨‹åºåç»­çš„æµç¨‹</p><h4 id="2-åŒæ—¶å…¼å®¹åŒæ­¥å’Œå¼‚æ­¥å¤„ç†"><a href="#2-åŒæ—¶å…¼å®¹åŒæ­¥å’Œå¼‚æ­¥å¤„ç†" class="headerlink" title="2. åŒæ—¶å…¼å®¹åŒæ­¥å’Œå¼‚æ­¥å¤„ç†"></a>2. åŒæ—¶å…¼å®¹åŒæ­¥å’Œå¼‚æ­¥å¤„ç†</h4><p>è¿˜æ˜¯åˆ©ç”¨ä¸Šé¢çš„ä¾‹å­, å‡å¦‚ç°åœ¨æ–°å¢ä¸€ä¸ªéœ€æ±‚ add åéœ€è¦ç­‰å¾… 2 ç§’å†æ‰§è¡Œ, å¯¹äº Direct Style æˆ‘ä»¬å¿…é¡»å¯¹ add åç»­çš„æ•´ä¸ªæµç¨‹è¿›è¡Œè°ƒæ•´<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> x + y</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subtract = <span class="function">(<span class="params">x, y</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> y - x</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multiply = <span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> a * b</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> result1 = add(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line"></span><br><span class="line">setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> result2 = subtract(result1, <span class="number">1</span>)</span><br><span class="line">  <span class="keyword">const</span> result3 = multiply(result2, <span class="number">3</span>)</span><br><span class="line">  <span class="built_in">console</span>.log(result3) <span class="comment">// 6</span></span><br><span class="line">&#125;, <span class="number">2000</span>)</span><br></pre></td></tr></table></figure></p><p>å¯¹äº CPS åˆ™åªéœ€è¦æ”¹å˜<code>next</code>çš„è°ƒç”¨æ—¶æœºå³å¯<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">x, y, next</span>) =&gt;</span> &#123;</span><br><span class="line">  next(x + y)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subtract = <span class="function">(<span class="params">x, y, next</span>) =&gt;</span> &#123;</span><br><span class="line">  setTimeout(next, <span class="number">2000</span>, y - x)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multiply = <span class="function">(<span class="params">a, b, next</span>) =&gt;</span> &#123;</span><br><span class="line">  next(a * b)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>, (result1) =&gt; &#123;</span><br><span class="line">  subtract(result1, <span class="number">1</span>, (result2) =&gt; &#123;</span><br><span class="line">    multiply(result2, <span class="number">3</span>, <span class="built_in">console</span>.log) <span class="comment">// 6</span></span><br><span class="line">  &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>å¯ä»¥çœ‹å‡ºè¿™æ ·çš„æ”¹åŠ¨å¯¹äº CPS æ¥è¯´, å¹¶ä¸éœ€è¦æ”¹åŠ¨åˆ°ä¸»æµç¨‹.</p><h4 id="3-Tail-Call"><a href="#3-Tail-Call" class="headerlink" title="3. Tail Call"></a>3. Tail Call</h4><p>CPS åŒæ—¶ä¹Ÿæ˜¯å°¾è°ƒç”¨, åªä¸è¿‡ JS å¼•æ“å¹¶ä¸æ”¯æŒè¿™ç§ä¼˜åŒ–, åœ¨æ­¤ä¹Ÿä¸å±•å¼€äº†</p><p>é‚£ä¹ˆ CPS å¯¹äºæµç¨‹æ§åˆ¶æœ‰è¿™ä¹ˆå¼ºå¤§çš„åŠ›é‡, ä½†æ˜¯åˆç¢äºå®ƒåäººç±»çš„ä¹¦å†™æ–¹å¼ä¸èƒ½ä½¿ç”¨. é‚£åœ¨ JS ä¸­æœ‰æ²¡æœ‰ä»€ä¹ˆåŠæ³•èƒ½è§£å†³è¿™ä¸ªä¹¦å†™çš„é—®é¢˜å‘¢?<br><strong>Promise</strong><br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> add = <span class="function">(<span class="params">x, y</span>) =&gt;</span> <span class="built_in">Promise</span>.resolve(x + y)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> subtract = <span class="function">(<span class="params">x, y</span>) =&gt;</span> delay(<span class="number">2000</span>).then(<span class="function"><span class="params">()</span> =&gt;</span> y - x)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> multiply = <span class="function">(<span class="params">a, b</span>) =&gt;</span> <span class="built_in">Promise</span>.resolve(a * b)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> delay = <span class="function">(<span class="params">milli</span>) =&gt;</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> setTimeout(resolve, milli))</span><br><span class="line"></span><br><span class="line">add(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">  .then(<span class="function"><span class="params">res</span> =&gt;</span> subtract(res, <span class="number">1</span>))</span><br><span class="line">  .then(<span class="built_in">console</span>.log)</span><br></pre></td></tr></table></figure></p><p>ä¹Ÿè®¸ä½ è¿˜æƒ³åˆ°äº† Generator, æ²¡é”™ Generator / Promise / async/await éƒ½æ˜¯ CPS çš„å˜å½¢. å¦‚æœä½ å†ç•™å¿ƒä¸€ç‚¹å°±ä¼šå‘ç° Promise.resolve / Generator.next å…¶å®éƒ½æ˜¯ CPS ä¸­çš„ next</p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä¸€å¥è¯ CPS å¯¹æµç¨‹æ§åˆ¶éå¸¸ç‰›é€¼, ä¸è®ºæ˜¯åŒæ­¥ä»»åŠ¡è¿˜æ˜¯å¼‚æ­¥ä»»åŠ¡éƒ½æ‹¿æçš„æ­»æ­»çš„</p><h2 id="Algebraic-Effect"><a href="#Algebraic-Effect" class="headerlink" title="Algebraic Effect"></a>Algebraic Effect</h2><p>å‰é¢æˆ‘ä»¬ä»‹ç»äº†åœ¨ JS ä¸­åº”ç”¨ CPS çš„å§¿åŠ¿, ä½†å³ä½¿è¿™æ ·, æˆ‘ä»¬åœ¨ JS ä¸­ä½¿ç”¨ CPS ä¾ç„¶å¾ˆç¹ç. </p><blockquote><p>å¦‚æœä½ ç”¨äº† Promise é‚£ä¹ˆä½ çš„æ§åˆ¶æµéƒ½å¾—æ˜¯ Promise; å¦‚æœç”¨Generator éƒ½è¦åŒ…è£¹åœ¨ Generator ä¸­; async/await ä¹Ÿæ˜¯ä¸€æ ·. å°±åƒå¾ˆå¤šæ–‡ç« ä¸­æåˆ°çš„ä¸€æ ·, è¿™äº›æ–¹å¼éƒ½å…·æœ‰â€ä¼ æŸ“æ€§â€, å®ƒä»¬ä¼šç”±å†…åˆ°å¤–çš„å±‚å±‚æ±¡æŸ“, é‚£ä¹ˆå¿…ç„¶å°±ä¼šç»™å¼€å‘è€…å¸¦æ¥å¤§é‡çš„å¿ƒæ™ºè´Ÿæ‹…</p></blockquote><p>é‚£æœ‰æ²¡æœ‰æ›´ä¾¿æ·çš„æ–¹å¼æ¥å®ç°å‘¢, æƒ³æƒ³åœ¨JS ç¯å¢ƒä¸‹æœ‰å“ªäº›èƒ½å¤Ÿæ§åˆ¶æµç¨‹çš„æ–¹å¼å‘¢?<br><code>if</code>/<code>else</code>/ <code>break</code>/<code>throw</code>/<code>switch</code>â€¦ å—¯? <code>throw</code>ğŸ¤” å¥½åƒè·Ÿå…¶ä»–æ§åˆ¶æœ‰äº›ä¸ä¸€æ ·, å®ƒå¯ä»¥è·³è¿‡åç»­æµç¨‹(ç©¿é€è°ƒç”¨æ ˆ)! è¿™ä¼¼ä¹æœ‰ç‚¹åŠ å¼º CPS é‚£å‘³å„¿äº†</p><p>å›å¿†ä¸€ä¸‹: ä½¿ç”¨ <code>throw</code>æ—¶ä¼šåœ¨è°ƒç”¨å¤„ä¸­æ–­, å°† <code>throw</code>åé¢çš„è¯­å¥ç©¿é€åˆ°æœ€è¿‘çš„ <code>try/catch</code>ä¸­ä»è€Œè¢«æ•è·.</p><blockquote><p> PS: è™½ç„¶è§„èŒƒå‘Šè¯‰æˆ‘ä»¬ <code>throw</code>å‡ºæ¥çš„å¿…é¡»æ˜¯ä¸ª <code>Error</code>å¯¹è±¡, ä½†å®é™… <code>throw</code>å¯ä»¥æŠ›å‡ºä»»æ„æ•°æ®ç±»å‹</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">taskA</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">throw</span> <span class="string">'throw from taskA'</span></span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'never arrive'</span>)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">main</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'I am main'</span>)</span><br><span class="line">  taskA()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">try</span> &#123;</span><br><span class="line">  main()</span><br><span class="line">&#125; <span class="keyword">catch</span> (err) &#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'catch: '</span>,err)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æ¢å¥è¯è¯´, é€šè¿‡<code>throw</code>å°†æ‰§è¡Œæµç¨‹è½¬ç§»è‡³<code>catch</code>ä»£ç å—, è¿™å°±æ˜¯æ‰€è°“çš„<strong> Control Transfer æ§åˆ¶è½¬ç§»</strong></p><p>å¦‚æœæˆ‘ä»¬æŠŠä¸¤è€…ç»“åˆä¸€ä¸‹, è¯•æƒ³å°† CPS çš„<code>next</code>é€šè¿‡<code>throw</code>æ“ä½œç¬¦å°†æ§åˆ¶æµè½¬ç§»è‡³ <code>catch</code>ä¸­. è¿™æ ·æ—¢è§£å†³äº† CPS å¯è¯»æ€§çš„é—®é¢˜, åŒæ—¶ä¹Ÿå¯ä»¥é¿å… â€œä¼ æŸ“â€; é™¤æ­¤ä¹‹å¤–, è¿˜éš”ç¦»äº†å‡½æ•°ä¸­çš„å‰¯ä½œç”¨. å®é™…ä¸Šè¿™â€åŸºæœ¬ä¸Šâ€å°±æ˜¯ä»£æ•°æ•ˆåº”æ‰€è•´å«çš„æ€æƒ³äº†<br><br>ä¸ºä»€ä¹ˆè¦è¯´æ˜¯â€åŸºæœ¬ä¸Šå‘¢â€? å› ä¸ºè¿™é‡Œè¿˜æœ‰ä¸ªé—®é¢˜, é‚£å°±æ˜¯åœ¨ JS ä¸­<code>throw</code>åå°±ä¸­æ–­äº†, ä¸èƒ½<strong>å»¶ç»­(æˆ–è€…æ¢å¤)å½“å‰æ§åˆ¶æµ</strong>(ä¹Ÿå°±æ˜¯ CPS ä¸­çš„ Continuation). æ‰€ä»¥å¾ˆå¤šå…¶ä»–æ–‡ç« ä¸­éƒ½å¤©é©¬è¡Œç©ºåœ°é€ äº†ä¸€äº›ç‰¹æ®Šçš„å…³é”®å­—æ¥å°è¯•è§£é‡Šä»£æ•°æ•ˆåº”, è¿™é‡Œæˆ‘ä¹Ÿä½¿ç”¨ <a href="https://overreacted.io/zh-hans/algebraic-effects-for-the-rest-of-us/" target="_blank" rel="noopener">Dan Abramov</a> åœ¨æ–‡ç« çš„ç¤ºä¾‹ç¨ä½œä¿®æ”¹æ¥å®Œæ•´çš„å±•ç¤ºä¸€ä¸‹ç†æƒ³ä¸­çš„ä»£æ•°æ•ˆåº”</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Component</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">let</span> friendship = <span class="literal">null</span></span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">getName</span>(<span class="params">user</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> name = user.name;</span><br><span class="line">    <span class="keyword">if</span> (name === <span class="literal">null</span>) &#123;</span><br><span class="line">      name = perform <span class="string">'ask_name'</span>;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> name;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">makeFriends</span>(<span class="params">user1, user2</span>) </span>&#123;</span><br><span class="line">    user1.friendNames = getName(user2);</span><br><span class="line">    user2.friendNames = getName(user1);</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">      user1,</span><br><span class="line">      user2</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">const</span> arya = &#123; <span class="attr">name</span>: <span class="literal">null</span> &#125;;</span><br><span class="line">  <span class="keyword">const</span> gendry = &#123; <span class="attr">name</span>: <span class="string">'Gendry'</span> &#125;;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">try</span> &#123;</span><br><span class="line">    friendship = makeFriends(arya, gendry);</span><br><span class="line">  &#125; handle (effect) &#123;</span><br><span class="line">    <span class="keyword">if</span> (!user1.friendNames || !user2.friendNames) &#123;</span><br><span class="line">      <span class="keyword">if</span> (effect === <span class="string">'ask_name'</span>) &#123;</span><br><span class="line">        resume <span class="keyword">with</span> <span class="string">'Arya Stark'</span>;</span><br><span class="line">      &#125;</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> <span class="string">`friendship: user1: <span class="subst">$&#123;user1.friendNames&#125;</span>; user2: <span class="subst">$&#123;user2.friendNames&#125;</span>`</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>ä¼ªé€  <code>perform</code>å…³é”®å­—æ›¿ä»£ <code>throw</code>, ç›¸å½“äº CPS ä¸­ next å˜å½¢(ç±»ä¼¼äº await), è€Œ perform åçš„è¯­å¥å¯ä»¥åƒ<code>throw</code>ä¸€æ ·è¢«æŠ›å‡º</li><li><code>handle</code>æ›¿ä»£<code>catch</code>, å½¢å‚<code>effect</code>æ¥æ”¶<code>perform</code>å…³é”®å­—ä¼ é€’çš„å®å‚</li><li>ä¼ªé€ çš„<code>resume`</code>with`å…³é”®å­—ç”¨äºæ¢å¤å½“å‰æ§åˆ¶æµ(getName ä¸­ç¬¬ 4 è¡Œ), å¹¶å›ä¼  â€˜Arya Starkâ€™</li><li>æ¢å¤åæ§åˆ¶æµä¸­ name çš„å€¼å°±å˜æˆäº† â€˜Arya Starkâ€™</li></ul><p>æ‰€ä»¥è¿™æ®µè™šæ„çš„ä»£ç è¦è¡¨è¾¾çš„å°±æ˜¯: å¯¹ <code>makeFriends</code>äº§ç”Ÿçš„ Effect, é€šè¿‡ <code>perform</code>ç”±<code>handler</code>å¤„ç†, å†ç”¨<code>resume</code>å°†ç»“æœæ¢å¤åˆ°å‡½æ•°æ‰§è¡Œä¸­, å¾—åˆ°æ–°çš„ç»“æœ.</p><blockquote><p>ä¹‹æ‰€ä»¥è¦æŠŠ CPS çš„ next ç§°ä½œ Continuation, æ˜¯å¸Œæœ›é€šè¿‡ throw å¯ä»¥ç©¿é€è°ƒç”¨æ ˆçš„ç‰¹ç‚¹æ¥è·å–å½“å‰æ§åˆ¶æµ, æ‰€ä»¥ç©¿é€è°ƒç”¨æ ˆ(æˆ–è€…è¯´è·¨è°ƒç”¨æ ˆ)å¹¶ä¸æ˜¯ç›®çš„. è€Œè¦åœ¨ JS ä¸­çœŸæ­£å®ç°è·å–<strong>å½“å‰ Continuation </strong>ä¹Ÿå°±æ˜¯æ‰€è°“çš„ <a href="https://en.wikipedia.org/wiki/Call-with-current-continuation" target="_blank" rel="noopener">callcc</a> ä¹Ÿæ˜¯å¯ä»¥çš„, å¤§è‡´æ˜¯ç”¨ CPS + Generator å®ç°çš„, é‚£ä¹ˆå°±ä¸å¾—ä¸æŠŠæ‰€æœ‰ä¸œè¥¿éƒ½å˜æˆ generator äº†,åœ¨è¿™å„¿å°±ä¸å±•å¼€äº†æœ‰å…´è¶£å¯ä»¥çœ‹çœ‹è¿™ç¯‡æ–‡ç« <a href="https://dev.to/yelouafi/algebraic-effects-in-javascript-part-2---capturing-continuations-with-generators-13da" target="_blank" rel="noopener">capturing-continuations-with-generators</a>.</p></blockquote><h3 id="æ€»ç»“-1"><a href="#æ€»ç»“-1" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>ä»£æ•°æ•ˆåº”å°±æ˜¯: åˆ©ç”¨ CPS çš„<strong>æµç¨‹æ§åˆ¶</strong>èƒ½åŠ›å®ç°å¯¹åç»­æµç¨‹çš„æ§åˆ¶(perform + resume)ç»“åˆæ§åˆ¶è½¬ç§»èƒ½åŠ›å®ç°è·¨è°ƒç”¨æ ˆæ•è·<strong>å½“å‰æ§åˆ¶æµ</strong>(try/handle), æ”¹å˜å½“å‰æ§åˆ¶æµä¸­çš„ Effect</p><p>åœ¨æç‚¼ä¸€ä¸‹ä»£æ•°æ•ˆåº”çš„å…³é”®ç‚¹:</p><ul><li>Effect: ä»£æ•°æ‰€äº§ç”Ÿçš„çš„æ•ˆåº”</li><li>Handler: å¤„ç†æ•ˆåº”çš„é€»è¾‘</li><li>Continuation: å»¶ç»­æµç¨‹çš„æ§åˆ¶</li><li>Resume: æ¢å¤ + ä¸ä¹‹å¯¹åº”çš„æš‚åœ</li></ul><h2 id="React-amp-Algebraic-Effect"><a href="#React-amp-Algebraic-Effect" class="headerlink" title="React &amp; Algebraic Effect"></a>React &amp; Algebraic Effect</h2><p>å‰é¢é“ºå«äº†é‚£ä¹ˆå¤šä»£æ•°æ•ˆåº”çš„çŸ¥è¯†, ç°åœ¨æˆ‘ä»¬å°±è¯•ç€çœ‹çœ‹ä»£æ•°æ•ˆåº”åœ¨ React ä¸­æ˜¯å¦‚ä½•åº”ç”¨çš„</p><h3 id="Hooks"><a href="#Hooks" class="headerlink" title="Hooks"></a>Hooks</h3><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Component</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [friendship, makeFriends] = useState(&#123;</span><br><span class="line">    arya: &#123; <span class="attr">name</span>: <span class="literal">null</span> &#125;,</span><br><span class="line">    gendry: &#123; <span class="attr">name</span>: <span class="string">'Gendry'</span> &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"></span><br><span class="line">  useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> arya = friendship.arya</span><br><span class="line">    <span class="keyword">const</span> gendry = friendship.gendry</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">if</span> (!arya.friendNames || !gendry.friendNames) &#123;</span><br><span class="line">      <span class="keyword">const</span> gendryName = getName(gendry)</span><br><span class="line">    <span class="keyword">const</span> aryaName = getName(arya)</span><br><span class="line">      makeFriends(<span class="function">(<span class="params">preUsers</span>) =&gt;</span> (&#123;</span><br><span class="line">        arya: &#123;</span><br><span class="line">          ...preUsers.arya,</span><br><span class="line">          friendNames: gendryName</span><br><span class="line">        &#125;,</span><br><span class="line">        gendry: &#123;</span><br><span class="line">          ...preUsers.gendry,</span><br><span class="line">          friendNames: aryaName</span><br><span class="line">        &#125;</span><br><span class="line">      &#125;))</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;, [friendship])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      friendship:</span><br><span class="line">      user1: &#123;friendship.arya.friendNames&#125;</span><br><span class="line">      user2: &#123;friendship.gendry.friendNames&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure><p>å¯ä»¥çœ‹åˆ°æˆ‘ä»¬åªæ˜¯ä»¥ React çš„æ–¹å¼æ”¹å†™äº†ä¸Šé¢çš„ç¤ºä¾‹, æ¥ç€å†çœ‹çœ‹æ”¹å†™åæ˜¯å¦è¿˜æ»¡è¶³ä»£æ•°æ•ˆåº”çš„å››è¦ç´ .</p><ul><li>é¦–å…ˆ<code>friendship</code>çš„åˆå§‹å€¼è¢«<code>useState</code>å®šä¹‰, ç„¶åæ ¹æ®<code>getName</code>çš„è¿”å›è€Œè¢«<code>makeFriends</code>ä¿®æ”¹, é‚£ä¹ˆæˆ‘ä»¬å°±å¯ä»¥è®¤ä¸º<code>makeFriends</code>æ˜¯<code>friendship</code>äº§ç”Ÿ Effect çš„ä¸€ä¸ªå› ç´ </li><li>è€Œæˆ‘ä»¬é€‰æ‹© <code>useEffect</code>å¯¹äº§ç”Ÿçš„æ•ˆåº”è¿›è¡Œå¤„ç†, å¹¶å°†<code>friendship</code>ä½œä¸ºè¯¥ hook çš„ä¾èµ–, å› æ­¤å¯ä»¥è®¤ä¸º <code>useEffect</code>å°±æ˜¯<code>friendship</code>çš„å¤„ç†å™¨äº†</li></ul><p>æ¥ç€æˆ‘ä»¬è¿˜å¯ä»¥è¿›ä¸€æ­¥çš„å°è£…<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">useFriends</span>(<span class="params">defaultValue</span>) </span>&#123;</span><br><span class="line">   <span class="keyword">const</span> [friendship, makeFriends] = useState(defaultValue)</span><br><span class="line">   </span><br><span class="line">   useEffect(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">     <span class="built_in">Object</span>.keys()</span><br><span class="line">       .forEach(<span class="function">(<span class="params">key, index, array</span>) =&gt;</span> &#123;</span><br><span class="line">         <span class="keyword">if</span> (!friendship[key].friendNames) &#123;</span><br><span class="line">           <span class="keyword">const</span> name = getName(friendship[key])</span><br><span class="line">           <span class="keyword">const</span> userKey = index % <span class="number">2</span> === <span class="number">0</span> ? array[index + <span class="number">1</span>] : array[index - <span class="number">1</span>]</span><br><span class="line">           </span><br><span class="line">           makeFriends(<span class="function">(<span class="params">preUsers</span>) =&gt;</span> (&#123;</span><br><span class="line">             ...preUsers,</span><br><span class="line">             [userKey]: &#123;...preUsers[name], <span class="attr">friendNames</span>: name&#125;</span><br><span class="line">            &#125;))</span><br><span class="line">         &#125;</span><br><span class="line">       &#125;)</span><br><span class="line">   &#125;, [friendship])</span><br><span class="line">  </span><br><span class="line">  <span class="keyword">return</span> [friendship]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Component</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">const</span> [friendship, makeFriends] = useFriends(&#123;</span><br><span class="line">    arya: &#123; <span class="attr">name</span>: <span class="literal">null</span> &#125;,</span><br><span class="line">    gendry: &#123; <span class="attr">name</span>: <span class="string">'Gendry'</span> &#125;</span><br><span class="line">  &#125;)</span><br><span class="line"> </span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;div&gt;</span><br><span class="line">      friendship:</span><br><span class="line">      user1: &#123;friendship.arya.friendNames&#125;</span><br><span class="line">      user2: &#123;friendship.gendry.friendNames&#125;</span><br><span class="line">    &lt;<span class="regexp">/div&gt;</span></span><br><span class="line"><span class="regexp">  )</span></span><br><span class="line"><span class="regexp">&#125;</span></span><br></pre></td></tr></table></figure></p><p>è¿™æ ·ä¸€æ¥æˆ‘ä»¬çš„<code>useFriends</code>ä½œä¸ºä¸€ä¸ªå…·æœ‰ Effect ä»¥åŠå¤„ç†å™¨çš„ä»£æ•°, å°±å¯ä»¥ä¸ºä»»ä½•ç»„ä»¶æœåŠ¡äº†. ä¸è¿‡å¤§å®¶å¯èƒ½æ³¨æ„åˆ°äº†ä»£æ•°æ•ˆåº”æœ€é…·çš„<code>resume</code>ç‰¹æ€§æˆ‘ä»¬å¹¶æ²¡æœ‰çœ‹åˆ°, è¿™è¦å¦‚ä½•ä½¿ç”¨å‘¢?</p><h3 id="Fiber"><a href="#Fiber" class="headerlink" title="Fiber"></a>Fiber</h3><p>è¿™å°±å¾—ä» Fiber è¯´èµ·äº†, æˆ‘ä»¬éƒ½çŸ¥é“React ä» v16 å¼€å§‹å°±æ˜¯ Fiber æ¶æ„äº†. è€Œ Fiber æ¶æ„çš„æœ¬è´¨å°±æ˜¯åˆ©ç”¨æµè§ˆå™¨ç©ºé—²æ—¶é—´, æ ¹æ®ä»»åŠ¡çš„ä¼˜å…ˆçº§åˆ†ç‰‡æ‰§è¡Œ, æ›´æ–°è¿‡ç¨‹ä¸­å¯ä»¥éšæ—¶æš‚åœå’Œæ¢å¤ä»»åŠ¡.</p><p>ç”¨ä¸‹å›¾æ¥æ¦‚æ‹¬äº†React ä¸­çš„è°ƒåº¦æµç¨‹(æ•´ä¸ªæµç¨‹éƒ½ä»¥å¼€å¯ Concurrent æ¨¡å¼ä¸ºä¾‹)<br><img src="/img/schedule_flow.png" alt="schedule_flow.png"></p><ul><li>æ›´æ–°ä»»åŠ¡ä¼šæŒ‰ç…§è¿‡æœŸæ—¶é—´æ’åºæ³¨å†Œåœ¨<code>taskQueue</code>é˜Ÿåˆ—ä¸­(PS:<code>timerQueue</code>ä¿å­˜å»¶æ—¶ä»»åŠ¡, ç­‰æ—¶é—´åˆ°äº†ä¼šæ”¾å…¥<code>taskQueue</code>)</li><li>ç„¶åé€šè¿‡<code>performWorkUntilDeadline</code>è°ƒç”¨<code>flushWork</code>æ‰§è¡Œ<code>workLoop</code>æ¥æ‰§è¡Œé˜Ÿåˆ—ä¸­çš„ä»»åŠ¡<ul><li>æ‰§è¡Œ<code>currentTask.callback</code>(ä¹Ÿå°±æ˜¯ <code>performConcurrentWorkOnRoot</code>), <strong>å¦‚æœæ›´æ–°è¿‡ç¨‹ä¸­ </strong><code>**shouldYield**</code><strong>ä¸º true æš‚åœæ›´æ–°</strong></li><li>é‚£ä¹ˆè¿”å›çš„<code>exitState === RootInProgress</code>ä¸ºtrue, å¯¼è‡´<code>currentTask.callback</code><strong>è¿”å› </strong><code>**performConcurrentWorkOnRoot**</code><strong>è‡ªèº«</strong></li><li>å†å›åˆ°<code>workLoop</code>æ‹¿åˆ°<code>currentTask.callback</code>çš„æ‰§è¡Œç»“æœ<code>continuationCallback</code>ä¹Ÿå°±æ˜¯<code>performConcurrentWorkOnRoot</code>, æ‰€ä»¥<code>if (typeof continuationCallback === &#39;function&#39;)</code>æˆç«‹. å³ä¿å­˜<code>continuationCallback</code>åˆ°<code>currentTask.callback</code>,<strong> ä¸ä»</strong><code>**taskQueue**</code><strong>ç§»é™¤å½“å‰ä»»åŠ¡, ä¸‹ä¸ªæ—¶é—´åˆ‡ç‰‡é‡æ–°æ‰§è¡Œ</strong></li></ul></li><li>é‡å¤è¿™ä¸ªè¿‡ç¨‹, ç›´åˆ°é˜Ÿåˆ—ä¸­çš„ä»»åŠ¡æ‰§è¡Œå®Œæ¯•</li></ul><p>å¤§å®¶å¯èƒ½ä¼šè¯´, å†…éƒ¨çš„è°ƒåº¦å¥½åƒä¹Ÿåªçœ‹åˆ°äº†æš‚åœ, æ²¡æœ‰æ¢å¤å•Š. å®é™…ä¸Š JS æœ‰ä¸ªğŸ”¨çš„<code>resume</code>, æ‰€ä»¥ React ç›´æ¥é‡æ–°æ‰§è¡Œä¸€éå‡½æ•°ä¹Ÿå°±æ˜¯ä¸Šé¢çš„<code>performConcurrentWorkOnRoot</code>, è™½ç„¶ä¸æ˜¯çœŸæ­£æ„ä¹‰ä¸Šçš„<code>resume</code>ä½†ä»æ•ˆæœä¸Šæ¥è¯´ä¹Ÿè¾¾åˆ°äº†æ¢å¤çš„ç›®çš„, å®ç°ç±»ä»£æ•°æ•ˆåº”.</p><blockquote><p>é‡æ–°æ‰§è¡Œ performConcurrentWorkOnRoot å‡½æ•° React åŒæ—¶ä¹Ÿåšäº†ä¸€äº›ä¼˜åŒ–, å¦‚æœä½ çœ‹è¿‡ Fiber èŠ‚ç‚¹ä¸­çš„ç»“æ„, ä¼šå‘ç°å†…éƒ¨æœ‰ä¸€ä¸ª memorizedProps(æ›´æ–°ç»“æŸæˆ–æš‚å®šæ—¶å®šä¹‰) å’Œ pendingProps(æ›´æ–°å¼€å§‹æ—¶å®šä¹‰) å±æ€§. åœ¨å‡½æ•°æ‰§è¡Œè¿‡ç¨‹ä¸­ä¼šå¯¹æ¯”è¿™ä¸¤ä¸ªå±æ€§, å¦‚æœä¸¤ä¸ªå±æ€§ç›¸ç­‰å°±å¤ç”¨ä¸Šä¸€æ¬¡çš„æ›´æ–°ç»“æœ, è¿™å°±æ˜¯ React æ‰€è¯´çš„å¤ç”¨å·²å®Œæˆçš„ä»»åŠ¡ç»“æœ.</p></blockquote><h4 id="æ€»ç»“-2"><a href="#æ€»ç»“-2" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>å…¶å®ä»ä½¿ç”¨ React hooks æ¥è¯´, æˆ‘ä»¬ä¸ç”¨å…³å¿ƒå¦‚ä½•ä½¿ç”¨ä»£æ•°æ•ˆåº”. React å†…éƒ¨å·²ç»å¸®æˆ‘ä»¬å¤„ç†äº† <code>continuation</code>å’Œ <code>resume</code>ç”šè‡³<code>effect</code>, è€Œæˆ‘ä»¬åªéœ€è¦ä¸“æ³¨äº<code>handle</code>ä¸šåŠ¡é€»è¾‘</p><p>ä»¥ useState ä¸ºä¾‹:<code>const [count, setCount] = useState()</code></p><ul><li>å°±å¯ä»¥çœ‹åš<code>perform state()</code>è¯·æ±‚ count çš„ <code>effect</code></li><li>ç”± React ä¸­<code>shouldYield</code>æš‚åœ Fiber æ›´æ–°, ç­‰ä»·äºæš‚åœå½“å‰å‡½æ•°</li><li>é‡æ–°æ‰§è¡Œ <code>continuationCallback</code>ç­‰ä»·äº <code>resume</code>æ¢å¤æ‰§è¡Œ</li><li>æˆ‘ä»¬éœ€è¦çš„ä¸šåŠ¡é€»è¾‘<code>handle</code>effect</li></ul><h3 id="Suspense"><a href="#Suspense" class="headerlink" title="Suspense"></a>Suspense</h3><p>React ä¸­çš„ Suspense æ˜¯ä¸ªæ›´å…¸å‹çš„ä¾‹å­, æˆ‘ä»¬å…ˆç”¨å®˜æ–¹çš„ä¾‹å­çœ‹çœ‹ Suspense æ˜¯å¦‚ä½•ä½¿ç”¨çš„<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œå†…éƒ¨ throw äº†ä¸€ä¸ª Promise</span></span><br><span class="line"><span class="keyword">const</span> resource = fetchProfileData();</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ProfilePage</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;Suspense fallback=&#123;&lt;h1&gt;Loading profile...&lt;<span class="regexp">/h1&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">      &lt;ProfileDetails /</span>&gt;</span><br><span class="line">      &lt;Suspense fallback=&#123;&lt;h1&gt;Loading posts...&lt;<span class="regexp">/h1&gt;&#125;&gt;</span></span><br><span class="line"><span class="regexp">        &lt;ProfileTimeline /</span>&gt;</span><br><span class="line">      &lt;<span class="regexp">/Suspense&gt;</span></span><br><span class="line"><span class="regexp">    &lt;/</span>Suspense&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ProfileDetails</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Try to read user info, although it might not have loaded yet</span></span><br><span class="line">  <span class="keyword">const</span> user = resource.user.read();</span><br><span class="line">  <span class="keyword">return</span> &lt;h1&gt;&#123;user.name&#125;&lt;/h1&gt;;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">ProfileTimeline</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="comment">// Try to read posts, although they might not have loaded yet</span></span><br><span class="line">  <span class="keyword">const</span> posts = resource.posts.read();</span><br><span class="line">  <span class="keyword">return</span> (</span><br><span class="line">    &lt;ul&gt;</span><br><span class="line">      &#123;posts.map(<span class="function"><span class="params">post</span> =&gt;</span> (</span><br><span class="line">        &lt;li key=&#123;post.id&#125;&gt;&#123;post.text&#125;&lt;<span class="regexp">/li&gt;</span></span><br><span class="line"><span class="regexp">      ))&#125;</span></span><br><span class="line"><span class="regexp">    &lt;/u</span>l&gt;</span><br><span class="line">  );</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li>å­ç»„ä»¶å¼‚æ­¥è¯»å–æ•°æ®, å°†æ•°æ®æ¸²æŸ“åœ¨ç»„ä»¶ä¸­</li><li>å¦‚æœæ•°æ®æœªåŠ è½½å®Œæ¯•, React ä¼šæš‚åœæ¸²æŸ“è¯¥ç»„ä»¶, è½¬è€Œæ¸²æŸ“ <code>fallback</code>ç»„ä»¶</li><li>ç­‰åˆ°æ•°æ®å°±ç»ª, ä»æš‚åœä½ç½®ç»§ç»­æ¸²æŸ“å­ç»„ä»¶</li></ul><p>ä»¥ä»£æ•°æ•ˆåº”æ¥è§£è¯»</p><ul><li><code>resource.user.read()</code>å†…éƒ¨<code>throw promise</code>ç­‰ä»·äº <code>perform resource.user.read()</code></li><li>react å†…éƒ¨<code>catch</code>åˆ°<code>thenable</code>çš„å‡½æ•°æ”¾è¿›<code>updateQueue</code>æ›´æ–°é˜Ÿåˆ—ä¸­,  å¯¹åº”ç»„ä»¶ä¼šè¢«æ ‡è®°ä¸º<code>mode: &#39;hidden&#39;</code>. ç›¸å½“äºæš‚åœäº†å½“å‰å‡½æ•°çš„æ‰§è¡Œ(PS: å…¶å®è¿™ä¸ªæ—¶å€™å­ç»„ä»¶çš„å¯¹åº” Fiber å’Œå¯¹åº”å…³ç³»å·²ç»åˆ›å»ºå¥½, åªæ˜¯æ”¾åœ¨ç¼“å­˜æ± äº†)</li><li>åœ¨<code>promise</code>å®Œæˆå, React ä¼šåœ¨ commit é˜¶æ®µé‡æ–°è°ƒåº¦æ¸²æŸ“å­ç»„ä»¶, å…¶å®å°±æ˜¯æ¢å¤æ‰§è¡Œäº†.  </li></ul><blockquote><p>è™½ç„¶æœ¬è´¨ä¸Šä¹Ÿä¸æ˜¯æ¢å¤äº†å‡½æ•°, ä¸è¿‡åœ¨ React çœ‹æ¥è¿™é‡Œé‡æ–°æ¸²æŸ“ç»„ä»¶å’Œæ¢å¤æ‰§è¡Œæ²¡ä»€ä¹ˆåŒºåˆ«. å› ä¸ºåœ¨ Suspense å†…éƒ¨ä¸ç®¡æ˜¯ fallback è¿˜æ˜¯å­ç»„ä»¶éƒ½åªä¼šåˆ›å»ºä¸€æ¬¡åŒæ—¶ä¼šå»ºç«‹å¥½èŠ‚ç‚¹ä¹‹é—´çš„å¯¹åº”å…³ç³», åç»­ rerender çš„æ—¶å€™åªæ˜¯æ”¹å˜äº† child çš„æŒ‡é’ˆç½¢äº†</p></blockquote><h2 id="æ€»ç»“-3"><a href="#æ€»ç»“-3" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h2><p>ä»£æ•°æ•ˆåº”æœ¬è´¨ä¸Šå°±æ˜¯æŠŠâ€åšä»€ä¹ˆâ€å’Œâ€å¦‚ä½•åšâ€è¿™ä¸¤ä»¶äº‹å„¿åˆ†ç¦»äº†, åŒæ—¶æä¾›äº†å¯¹æµç¨‹æ§åˆ¶çš„èƒ½åŠ›. React ä¹Ÿæ˜¯ç»“åˆäº†è¿™äº›ç‰¹å¾, ä»åŸæ¥ä¾èµ– JS  åŸç”Ÿè°ƒç”¨æ ˆåŒæ­¥æ›´æ–°æ–¹å¼é‡æ„ä¸ºäº†ç°åœ¨ Fiber Reconciler è‡ªå·±æ¨¡æ‹Ÿäº†ä¸€å¥—ç»„ä»¶è°ƒç”¨æ ˆ/Hooks/Suspense ä¸€ç³»åˆ—çš„æ–°ç‰¹æ€§. ä¹Ÿå°è¯äº† React Hooks ä½œè€…çš„é‚£ä¸€å¥è¯<code>æˆ‘ä»¬åœ¨ React ä¸­æ‰€åšçš„äº‹å°±æ˜¯åœ¨è·µè¡Œä»£æ•°æ•ˆåº”</code></p><blockquote><p>å…¶å®å‡ºäº† React ä»¥å¤–è¿˜æœ‰å…¶ä»–åº“ä¹Ÿä½¿ç”¨äº†ä»£æ•°æ•ˆåº”ä½œä¸ºå¿ƒæ™ºæ¨¡å‹, å¯ä»¥æ€è€ƒçœ‹çœ‹â€¦ æˆ–è®¸â€¦ä¹Ÿå¯ä»¥è‡ªå·±é€ ä¸ªè½®å­?</p></blockquote><h3 id="Referer"><a href="#Referer" class="headerlink" title="Referer"></a>Referer</h3><ul><li><a href="https://dev.to/yelouafi/algebraic-effects-in-javascript-part-1---continuations-and-control-transfer-3g88" target="_blank" rel="noopener">continuations-and-control-transfer</a></li><li><a href="https://zhuanlan.zhihu.com/p/380855727" target="_blank" rel="noopener">å¹²è´§ï½œè¯¦è§£Algebraic Effectsä»£æ•°æ•ˆåº”</a></li><li><a href="https://overreacted.io/zh-hans/algebraic-effects-for-the-rest-of-us/" target="_blank" rel="noopener">Algebraic Effects for the Rest of Us</a></li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;h2 id=&quot;å‰è¨€&quot;&gt;&lt;a href=&quot;#å‰è¨€&quot; class=&quot;headerlink&quot; title=&quot;å‰è¨€&quot;&gt;&lt;/a&gt;å‰è¨€&lt;/h2&gt;&lt;p&gt;è¿™å‡ å¹´ç½‘ä¸Šå·²ç»æœ‰éå¸¸çš„å¤šæ–‡ç« åœ¨æ¢è®¨ React è¿™æ¬¡çš„å¤§æ‰‹ç¬”, æ­£å¥½å€Ÿåœ¨ Bench è¿™æ®µæ—¶é—´é‡Œèƒ½é€šè¿‡ React18 çš„æºç çœ‹çœ‹åˆ°åº•åšäº†å“ª
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="React" scheme="https://yoursite.com/tags/React/"/>
    
  </entry>
  
  <entry>
    <title>ç»†è¯´HTTPå˜åŒ–å²</title>
    <link href="https://yoursite.com/2022/03/25/%E7%BB%86%E8%AF%B4HTTP%E5%8F%98%E5%8C%96%E5%8F%B2/"/>
    <id>https://yoursite.com/2022/03/25/ç»†è¯´HTTPå˜åŒ–å²/</id>
    <published>2022-03-25T03:53:08.000Z</published>
    <updated>2022-08-23T09:37:40.693Z</updated>
    
    <content type="html"><![CDATA[<p>HTTP å‘å±•è‡³ä»Šå·²ç»å‘ç”Ÿäº†å¤ªå¤šçš„å˜åŒ–, å¹³å¸¸å·¥ä½œä¸­å…¶å®å¹¶ä¸ä¼šæ³¨æ„è¿™äº›å˜åŒ–, ç”šè‡³è¯´æ ¹æœ¬ä¸å…³å¿ƒâ€¦ ä½†åœ¨å‰ç«¯çš„å·¥ä½œä¸­å´ä¸å®ƒå¯†åˆ‡ç›¸å…³,ä»é€šä¿¡åˆ°æ€§èƒ½ä¼˜åŒ–ç­‰ç­‰. ä¸‹é¢å°±æ¥èŠèŠ HTTP</p><h4 id="HTTP"><a href="#HTTP" class="headerlink" title="HTTP"></a>HTTP</h4><p>ä¸»è§’ HTTP(è¶…æ–‡æœ¬ä¼ è¾“åè®®), å®ƒçš„ä½œç”¨å°±æ˜¯åˆ©ç”¨ç½‘ç»œå°†æœåŠ¡ç«¯çš„è¶…æ–‡æœ¬ä¿¡æ¯ä¼ è¾“ç»™å®¢æˆ·ç«¯çš„ä¸€ç§åè®®. å»ºç«‹åœ¨ TCP ä¹‹ä¸Š, æ‰€ä»¥ HTTP çš„ä¼˜åŒ–åŠç“¶é¢ˆéƒ½æ˜¯åŸºäº TCP çš„ç‰¹æ€§</p><p>ä¸»è¦çš„ç‰¹ç‚¹:</p><ul><li>ç®€å•å¿«é€Ÿ: å®¢æˆ·ç«¯æƒ³æœåŠ¡å™¨è¯·æ±‚æ—¶, åªéœ€è¦å‘é€è¯·æ±‚æ–¹æ³•å’Œè·¯å¾„å³å¯</li><li>çµæ´»: æ”¯æŒå¤šç§ä¼ è¾“æ ¼å¼, ç”± Content-Type æ§åˆ¶</li><li>æ— è¿æ¥: æ¯æ¬¡è¿æ¥åªå¤„ç†ä¸€ä¸ªè¯·æ±‚-å“åº”, ç„¶åæ–­å¼€è¿æ¥</li><li>æ— çŠ¶æ€: æ¯ä¸ª HTTP ä¹‹é—´éƒ½æ˜¯ç‹¬ç«‹/æ— å…³çš„, ä¸éœ€è¦ä¿ç•™çŠ¶æ€ä¿¡æ¯</li></ul><h4 id="HTTP1-x"><a href="#HTTP1-x" class="headerlink" title="HTTP1.x"></a>HTTP1.x</h4><p>HTTP1.x ä¸»è¦ç»å†ä¸¤ä¸ªç‰ˆæœ¬åˆ†åˆ«æ˜¯ HTTP1.0 å’Œ HTTP1.1, è€Œ HTTP1.1 çš„å‡ºç°å¼¥è¡¥å¤šäº†å¾ˆå¤š 1.0 æ—¶æœŸçš„é—®é¢˜.</p><p><strong>å¤šä¸ª TCP è¿æ¥</strong><br>1.0 æ—¶æœŸæ¯å‘é€ä¸€ä¸ªè¯·æ±‚-å“åº”, éƒ½éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥, å“åº”å®Œå†å…³é—­, ä¸‹ä¸ªè¯·æ±‚åˆè¦å»ºç«‹å†å…³é—­, æ‰€ä»¥è¿™æ˜¯ä¸€ä¸ªéå¸¸æ¶ˆè€—æ€§èƒ½çš„è¿‡ç¨‹. è¿™å°±ä¼šå¸¦æ¥ä¸¤ä¸ªé—®é¢˜:</p><ol><li>æ¯ä¸ªè¯·æ±‚éƒ½éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥</li><li>å¿…é¡»ç­‰å¾…å‰ä¸€ä¸ªè¯·æ±‚å“åº”äº†, åä¸€ä¸ªè¯·æ±‚æ‰èƒ½å‘é€, ä¹Ÿå°±æ˜¯ç†Ÿç§°çš„<code>é˜Ÿå¤´é˜»å¡</code></li></ol><p>äºæ˜¯åœ¨ 1.1 ä¸­é€šè¿‡ <code>keep-alive</code> æ¥é¿å…å»ºç«‹å¤šæ¬¡ TCP è¿æ¥çš„é—®é¢˜, åœ¨ä¸€å®šæ—¶é—´å†…å¤ç”¨å·²ç»å»ºç«‹çš„ TCP è¿æ¥, è¿™æ ·åœ¨ TCP è¿æ¥ä¸­å¯ä»¥å‘é€å¤šæ¬¡è¯·æ±‚-å“åº”. </p><p><code>keep-alive</code> å­˜åœ¨çš„é—®é¢˜: </p><ol><li>æ¯æ¡ TCP è¿æ¥ä¸­çš„è¯·æ±‚è¿˜æ˜¯é˜»å¡çš„(ä¾ç„¶æ˜¯ä¸²è¡Œæ–‡ä»¶ä¼ è¾“)</li><li>è™½ç„¶å¤ç”¨äº† TCP è¿æ¥, ä½†æµè§ˆå™¨å¯¹è¯·æ±‚çš„å¹¶å‘æ•°æœ‰ 6 ~ 8 æ¡çš„é™åˆ¶</li></ol><p>ä¸ºäº†è§£å†³ä¸²è¡Œæ–‡ä»¶ä¼ è¾“çš„é—®é¢˜, äºæ˜¯åˆæœ‰äº†<code>ç®¡çº¿åŒ–(pipeline)</code>.<br>ç®¡çº¿åŒ–æ˜¯åŸºäº <code>keep-alive</code> é€šè¿‡ä¸€ä¸ªè¿æ¥æŠŠæ‰€æœ‰è¯·æ±‚æ‰“åŒ…ä¸€æ¬¡æ€§å‘ç»™æœåŠ¡ç«¯, ä½†å“åº”æ—¶è¿˜æ˜¯éœ€è¦æŒ‰è¯·æ±‚é¡ºåºè¿”å›. ä¹Ÿå°±æ˜¯è¯´å¦‚æœå®¢æˆ·ç«¯å‘é€äº†è¯·æ±‚ 123, æœåŠ¡ç«¯å¤„ç†æ—¶è¯·æ±‚ 23 å…ˆå¤„ç†å®Œäº†, ä¹Ÿå¿…é¡»ç­‰åˆ°è¯·æ±‚ 1 å¤„ç†å®Œæ‰èƒ½æŒ‰é¡ºåºåº”ç­”å“åº” 123, æ‰€ä»¥å…¶å®ä¹Ÿæ²¡å®Œå…¨è§£å†³é—®é¢˜. </p><blockquote><p>ç®¡çº¿åŒ–ä½¿ç”¨é˜Ÿåˆ—çš„æ–¹å¼å®ç°çš„å¯¹æ€§èƒ½æ¶ˆè€—å¾ˆå¤§, å› æ­¤ä¹Ÿæ˜¯ç®¡çº¿åŒ–æ²¡æœ‰è¢«å¹¿æ³›ä½¿ç”¨çš„åŸå› </p></blockquote><p>å°ç»“: HTTP1.x æäº†è¿™ä¹ˆå¤šè¿˜æ˜¯æ²¡è§£å†³çš„<code>é˜Ÿå¤´é˜»å¡</code>çš„é—®é¢˜, é™¤äº†é˜Ÿå¤´é˜»å¡ä¹‹å¤–, å…¶å®è¿˜æœ‰<code>æ˜æ–‡ä¼ è¾“</code>å¸¦æ¥çš„å®‰å…¨é—®é¢˜/ å»ºç«‹ TCP å¸¦æ¥çš„<code>è¿æ¥å»¶æ—¶</code> / æ ‡è¯†é“¾æ¥çš„äº”å…ƒç»„åœ¨ç½‘ç»œåˆ‡æ¢æ—¶å¸¦æ¥çš„<code>é“¾æ¥è¿ç§»</code>é—®é¢˜</p><h4 id="HTTP2-0"><a href="#HTTP2-0" class="headerlink" title="HTTP2.0"></a>HTTP2.0</h4><p>HTTP2.0 åœ¨ 1.x çš„åŸºç¡€ä¸Šåˆåšäº†è¯¸å¤šä¼˜åŒ–, ç‰¹åˆ«åœ¨é’ˆå¯¹ <code>é˜Ÿå¤´é˜»å¡</code> çš„é—®é¢˜ä¸Š. ä¸‹é¢å°±åˆ†åˆ«è¯´è¯´ HTTP2.0 åšäº†äº›ä»€ä¹ˆ</p><p><strong>å¤šè·¯å¤ç”¨</strong><br>ä¸»è¦å°±æ˜¯è§£å†³ <code>é˜Ÿå¤´é˜»å¡</code> çš„é—®é¢˜, åœ¨ 2.0 ä¸­å¼•è¿›äº†<code>å¸§(frame)</code> å’Œ <code>æµ(stream)</code> ä¸¤ä¸ªé‡è¦çš„æ¦‚å¿µ.</p><ul><li>å¸§(frame): ä»£è¡¨äº†æœ€å°æ•°æ®çš„å•ä½, å¤§ä½“åˆ†ä¸º: header frame(å¤´éƒ¨å¸§) å’Œ data frame(æ•°æ®å¸§)</li><li>æµ(stream): æ˜¯è¿æ¥ä¸­çš„è™šæ‹Ÿé€šé“, å¯ä»¥æ‰¿è½½åŒå‘æ•°æ®æµ, ä¹Ÿå°±æ˜¯è¯´åŒä¸€ä¸ªæµä¸­å¯ä»¥åŒæ—¶æ¥æ”¶å’Œå‘é€æ•°æ®, æ¯ä¸ªæµä¼šæœ‰ä¸€ä¸ªå”¯ä¸€çš„ ID. åŒæ—¶æµä¸­çš„äºŒè¿›åˆ¶å¸§éƒ½æ˜¯å¹¶è¡Œä¼ è¾“, æ— éœ€æŒ‰é¡ºåºç­‰å¾…</li></ul><p>å¤šè·¯å¤ç”¨è®©æ‰€æœ‰è¯·æ±‚éƒ½åœ¨ä¸€ä¸ª TCP ä¸­å¹¶å‘å®Œæˆ, TCP ä¸­å¯ä»¥æ‰¿è½½ä¸é™æ•°é‡çš„æµ, è¯·æ±‚åˆæ˜¯åŸºäºæµçš„, æµä¸­çš„æ¶ˆæ¯åˆç”±äºŒè¿›åˆ¶å¸§ç»„æˆ, å¸§ä¼šæ ‡è¯†å±äºå“ªä¸ªæµ, å› æ­¤å¯ä»¥åšåˆ°ä¹±åºä¼ è¾“</p><p><strong>å¤´éƒ¨å‹ç¼©</strong><br>ä¹‹å‰æåˆ° 1.x åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­æ˜¯é€šè¿‡æ–‡æœ¬ä¼ è¾“çš„, åœ¨æ¯æ¬¡ä¼ è¾“è¿‡ç¨‹ä¸­çš„å¾ˆå¤šå¤´éƒ¨ä¿¡æ¯éƒ½æ˜¯ä¸€æ ·çš„, å¦‚æœå†åŠ ä¸Šä¸€äº› cookie ç­‰ä¿å­˜çŠ¶æ€çš„ä¿¡æ¯, å°±ä¼šå¯¼è‡´å¤´éƒ¨ä¿¡æ¯çš„ä½“ç§¯è¾ƒå¤§, å¸¦æ¥æ€§èƒ½ä¸Šçš„æµªè´¹.</p><p>åœ¨ 2.x ä¸­ä¼šç”¨ä¸¤ç§æ–¹æ¡ˆæ¥è§£å†³:</p><ol><li>ç”¨ä¸€ä¸ªå« <code>HPACK</code> çš„ç®—æ³•æ¥å‹ç¼©å¤´éƒ¨å­—æ®µçš„ä½“ç§¯</li><li>å‘é€æ–¹å’Œæ¥æ”¶æ–¹ä¼šå…±åŒç»´æŠ¤ä¸€ä¸ª<code>å¤´éƒ¨è¡¨</code>, æ¥é˜²æ­¢æ¯æ¬¡ä¼ è¾“ç›¸åŒå¤´éƒ¨å­—æ®µ. å¯¹é‡å¤çš„å¤´éƒ¨å­—æ®µä¸å†æ¯æ¬¡å‘é€, å½“ä¿®æ”¹æˆ–è€…æ–°å¢å­—æ®µå†æ›´æ–°è¿™ä¸ªå¤´éƒ¨è¡¨</li></ol><p><strong>æœåŠ¡ç«¯æ¨é€</strong><br>1.x ä¸­ä¸€ä¸ªè¯·æ±‚åªèƒ½å¯¹åº”ä¸€ä¸ªå“åº”, åœ¨ 2.x ä¸­å¯ä»¥å¯¹ä¸€ä¸ªè¯·æ±‚å“åº”å¤šä¸ªç»“æœ. æ¯”å¦‚: è¯·æ±‚ HTML æ–‡ä»¶æ—¶, æœåŠ¡ç«¯å¯ä»¥å°† HTML ä¸­ç”¨åˆ°çš„èµ„æºä¸€å¹¶å‘é€å›æ¥</p><p>å½“ç„¶ HTTP2.x ä¹Ÿä¸æ˜¯æ²¡æœ‰<strong>ç¼ºç‚¹</strong>:</p><ul><li>åŸºäº TCP çš„ HTTP åœ¨<strong>å»ºç«‹è¿æ¥ä¾ç„¶è€—æ—¶</strong>, è‡³å°‘éƒ½è¦ç»å†ä¸‰æ¬¡æ¡æ‰‹, å¦‚æœæœ‰ TLS æ—¶é—´æ›´é•¿</li><li>å¤šè·¯å¤ç”¨åªè§£å†³äº† HTTP å±‚é¢ä¸Šçš„é˜Ÿå¤´é˜»å¡, è€Œåœ¨ <strong>TCP å±‚é¢ä¸Šçš„é˜Ÿå¤´é˜»å¡ä¾ç„¶æ²¡æœ‰è§£å†³</strong>. æ˜¯å› ä¸º TCP ä¸ºäº†ä¿è¯æ•°æ®çš„æœ‰åºæ€§, è¦ç­‰å¾…æ‰€æœ‰æ•°æ®åˆ°è¾¾åæ’åºæ•´åˆ, æ‰€ä»¥ä¸€æ—¦å‘ç”Ÿä¸¢åŒ…å°±å¿…é¡»ç­‰å¾…é‡ä¼ , ä»è€Œé˜»å¡ TCP ä¸Šçš„æ‰€æœ‰è¯·æ±‚</li><li>ç”±äºå¤šè·¯å¤ç”¨ä¸é™åˆ¶æµæ•°é‡, å¯¼è‡´<strong>æœåŠ¡å™¨å‹åŠ›å¯èƒ½ä¼šçªç„¶æš´å¢</strong>, åŒæ—¶<strong>è¶…æ—¶</strong>çš„å‡ ç‡ä¹Ÿæ›´å¤§</li><li>ç½‘ç»œåˆ‡æ¢æ—¶ä¹Ÿ<strong>æ— æ³•ä¿æŒè¿æ¥</strong></li></ul><h4 id="HTTP3-0"><a href="#HTTP3-0" class="headerlink" title="HTTP3.0"></a>HTTP3.0</h4><p>åŸºäº HTTP2.x ç¼ºç‚¹å¤§å¤šéƒ½æ˜¯ TCP å±‚é¢ä¸Šçš„ç‰¹æ€§, ä½†æ˜¯å¦‚æœè¦æ”¹é€  TCP æˆæœ¬å’Œéš¾åº¦éƒ½ä¼šéå¸¸é«˜, ç›®å‰å·²ç»æœ‰éå¸¸å¤šçš„åº”ç”¨æ˜¯åŸºäº TCP çš„, å…¼å®¹ä¹Ÿæ˜¯ä¸€ä¸ªæ¯”è¾ƒå¤§çš„é—®é¢˜. æ‰€ä»¥åœ¨ HTTP3.0 ä¸­å°±å¹²è„†æŠ›å¼ƒäº† TCP æ”¹ç”¨ UDP.</p><p>é‚£æˆ‘ä»¬å¤ä¹ ä¸€ä¸‹ UDP çš„ç‰¹æ€§:</p><ul><li>é¢å‘æ— è¿æ¥, æ²¡æœ‰å»ºç«‹è¿æ¥çš„è¿‡ç¨‹</li><li>é¢å‘æŠ¥æ–‡</li><li>ä¸ä¼šä¿è¯åŒ…é¡ºåºæˆ–åŒ…æ˜¯å¦ä¸¢å¤±</li><li>å¯ä¸€å¯¹å¤š/å¤šå¯¹å¤šç­‰äº¤äº’é€šä¿¡</li></ul><p>å¯ä»¥çœ‹åˆ°å¯¹ TCP è€—æ—¶çš„å»ºè¿å’Œé˜Ÿå¤´é˜»å¡ UDP å¤©ç„¶å°±èƒ½è§£å†³, æ”¹é€ çš„è´Ÿæ‹…ç›¸å¯¹ä¹Ÿè¾ƒå°, é‚£ä¹ˆè°·æ­Œå°±åœ¨ UDP çš„åŸºç¡€ä¸Šæ”¹é€ å‡ºäº†ä¸€ä¸ªå…·å¤‡ TCP æœ‰ç‚¹çš„ <code>QUIC</code> åè®®. <code>QUIC</code> åè®®æ˜¯æ€ä¹ˆåšåˆ°è®© UDP â€œå¯é â€çš„å‘¢</p><p><strong>ä½å»¶è¿Ÿç­‰å¾…</strong><br>æ˜¯ä¸ºäº†è§£å†³ TCP å»ºç«‹è¿æ¥è‡³å°‘è¦ 1RTT (ä¸‰æ¬¡æ¡æ‰‹: ä¸€æ¥ä¸€å›, å†ä¸€åº”ç­”), å¦‚æœæ˜¯ HTTPS çš„è¯é‚£å°±æ˜¯ 3RTT, å¦‚ä¸‹å›¾æ‰€ç¤º:</p><p><img src="https://img-blog.csdnimg.cn/28c3bd933e574b649bad46d6c26a0b4c.png?x-oss-process=image/watermark,type_ZmFuZ3poZW5naGVpdGk,shadow_10,text_aHR0cHM6Ly9ibG9nLmNzZG4ubmV0L3FxXzM1NDIzMTU0,size_16,color_FFFFFF,t_70" alt="HTTPS å»ºè¿è¿‡ç¨‹"></p><blockquote><p>RTT æ˜¯ Round Trip Time çš„ç¼©å†™ï¼Œé€šä¿—åœ°è¯´ï¼Œå°±æ˜¯é€šä¿¡ä¸€æ¥ä¸€å›çš„æ—¶é—´</p></blockquote><p>è€Œ <code>QUIC</code> å¯ä»¥è¾¾æˆ0RTTå»ºç«‹è¿æ¥ï¼Œç¬¬ä¸€ä¸ªæ•°æ®åŒ…å°±å¯ä»¥ä¼ è¾“æ•°æ®. ä½†æ˜¯ QUIC çš„ 0RTT ä¸æ˜¯æ²¡æœ‰æ¡ä»¶çš„, å¯¹äºé¦–æ¬¡è¿æ¥è¿˜æ˜¯éœ€è¦ 1RTT æ¥è¿›è¡Œå¯†é’¥åå•†. å› æ­¤å»ºè¿ä¸»è¦åˆ†ä¸ºä¸¤ä¸ªéƒ¨åˆ† <code>é¦–æ¬¡è¿æ¥</code> å’Œ <code>éé¦–æ¬¡è¿æ¥</code></p><p>é¦–æ¬¡è¿æ¥ä½¿ç”¨ <code>DH</code> ç®—æ³•äº¤æ¢å¯†é’¥, è¿‡ç¨‹å¦‚ä¸‹:</p><ol><li>å®¢æˆ·ç«¯å¯¹äºé¦–æ¬¡è¿æ¥çš„æœåŠ¡ç«¯å…ˆå‘é€client helloè¯·æ±‚</li><li>æœåŠ¡ç«¯ç”Ÿæˆä¸€ä¸ªç´ æ•°på’Œä¸€ä¸ªæ•´æ•°gï¼ŒåŒæ—¶ç”Ÿæˆä¸€ä¸ªéšæœºæ•°ä¸ºç§é’¥ï¼Œç„¶åè®¡ç®—å‡ºå…¬é’¥ã€‚æœåŠ¡ç«¯å°†å…¬é’¥ï¼Œpï¼Œgä¸‰ä¸ªå…ƒç´ æ‰“åŒ…æˆä¸º <code>config</code> ï¼Œåç»­å‘é€ç»™å®¢æˆ·ç«¯</li><li>å®¢æˆ·ç«¯éšæœºç”Ÿæˆä¸€ä¸ªè‡ªå·±çš„ç§é’¥ï¼Œå†<strong>æ ¹æ® config è®¡ç®—å‡ºè‡ªå·±çš„å…¬é’¥</strong></li><li>å®¢æˆ·ç«¯ä½¿ç”¨è‡ªå·±çš„<code>ç§é’¥</code>å’Œ config ä¸­è¯»å–çš„<code>æœåŠ¡ç«¯å…¬é’¥</code>ï¼Œç”Ÿæˆåç»­æ•°æ®åŠ å¯†ç”¨çš„ <code>å¯†é’¥K</code></li><li>å®¢æˆ·ç«¯ä½¿ç”¨ <code>å¯†é’¥K</code> åŠ å¯†ä¸šåŠ¡æ•°æ®ï¼Œå¹¶è¿½åŠ è‡ªå·±çš„ <code>å…¬é’¥</code>ï¼Œéƒ½ä¼ é€’ç»™æœåŠ¡ç«¯</li><li>æœåŠ¡ç«¯æ ¹æ®è‡ªå·±çš„ <code>ç§é’¥</code> å’Œ <code>å®¢æˆ·ç«¯å…¬é’¥</code> è®¡ç®—å‡ºå®¢æˆ·ç«¯åŠ å¯†ç”¨çš„<code>å¯†é’¥K</code>, è§£å¯†æ•°æ®</li><li>ä¸ºäº†ä¿è¯æ•°æ®å®‰å…¨ï¼Œä¸Šè¿°ç”Ÿæˆçš„ <strong>å¯†é’¥K åªä¼šç”Ÿæˆä½¿ç”¨1æ¬¡</strong>ï¼Œåç»­æœåŠ¡ç«¯ä¼šæŒ‰ç…§ç›¸åŒçš„è§„åˆ™ç”Ÿæˆä¸€å¥—å…¨æ–°çš„å…¬é’¥å’Œç§é’¥ï¼Œå¹¶ä½¿ç”¨è¿™ç»„å…¬ç§é’¥ç”Ÿæˆæ–°çš„å¯†é’¥M</li><li>æœåŠ¡ç«¯å°†æ–°å…¬é’¥å’Œæ–°å¯†é’¥MåŠ å¯†çš„æ•°æ®å‘ç»™å®¢æˆ·ç«¯ï¼Œå®¢æˆ·ç«¯æ ¹æ®æ–°çš„æœåŠ¡ç«¯å…¬é’¥å’Œè‡ªå·±åŸæ¥çš„ç§é’¥è®¡ç®—å‡ºæœ¬æ¬¡çš„å¯†é’¥Mï¼Œè¿›è¡Œè§£å¯†</li><li>ä¹‹åçš„å®¢æˆ·ç«¯å’ŒæœåŠ¡ç«¯æ•°æ®äº¤äº’éƒ½ä½¿ç”¨å¯†é’¥Mæ¥å®Œæˆï¼Œå¯†é’¥Kåªä½¿ç”¨1æ¬¡</li></ol><p>éé¦–æ¬¡è¿æ¥<br>å› ä¸ºé¦–æ¬¡è¿æ¥æ—¶, å®¢æˆ·ç«¯å‚¨å­˜äº†æœåŠ¡ç«¯çš„ config(æœåŠ¡å™¨å…¬é’¥/p/g), å› æ­¤åç»­çš„è¿æ¥å¯ä»¥ç›´æ¥ç”¨ config è®¡ç®—é€šä¿¡çš„ç§˜é’¥. ä»è€Œè·³è¿‡ç§˜é’¥åå•†å®ç° 0RTT. <em>æ³¨: config æœ‰æ—¶é—´é™åˆ¶, å¦‚æœè¿‡æœŸä»ç„¶éœ€è¦é¦–æ¬¡è¿æ¥çš„å¯†é’¥äº¤æ¢</em></p><p><strong>å¤šè·¯å¤ç”¨</strong><br>3.0 çš„å¤šè·¯å¤ç”¨å®Œç¾è§£å†³äº†é˜Ÿå¤´é˜»å¡çš„é—®é¢˜, å®ƒè·Ÿ 2.0 çš„å¤šè·¯å¤ç”¨ä¸€æ ·åœ¨åŒä¸€ä¸ªè¿æ¥ä¸Šå¯ä»¥åˆ›å»ºå¤šä¸ªæµ. ä¸åŒçš„æ˜¯ <code>QUIC</code> åè®®æ˜¯åŸºäº UDP çš„, æ‰€ä»¥ <code>æ¯ä¸ªæµä¹‹é—´æ²¡æœ‰ä¾èµ–</code>.</p><blockquote><p>ä¹Ÿå°±æ˜¯è¯´å°±ç®—ä¸€ä¸ª stream1 ä¸­å‘ç”Ÿäº†ä¸¢åŒ…,  è™½ç„¶ stream1 ä¸¢å¤±çš„åŒ…ä¾ç„¶éœ€è¦ç­‰å¾…é‡ä¼ , ä½†æ˜¯ä¸å½±å“å…¶ä»– stream çš„æ•°æ®å‘é€</p></blockquote><p><strong>å‰å‘å®‰å…¨</strong><br>æ˜¯æŒ‡å¯†é’¥æ³„éœ²ä¹Ÿä¸ä¼šè®©ä¹‹å‰çš„æ•°æ®è¢«æ³„éœ², åªå½±å“å½“å‰. æ‰€ä»¥æ¯æ¬¡é€šè®¯çš„ <code>å¯†é’¥åªä¼šä½¿ç”¨ä¸€æ¬¡</code>, äº¤äº’å®Œä¹‹åå°†å…¶é”€æ¯, å†é‡æ–°ç”Ÿæˆ. è¿™æ ·å³ä½¿å¯†é’¥æ³„éœ², å¯¹æ–¹ä¹Ÿåªèƒ½è·å–å¯¹åº”é‚£æ¡å¯†é’¥çš„æ¶ˆæ¯</p><p><strong>å‰å‘çº é”™</strong><br>TCP æ˜¯æ¯æ¬¡ä¸¢åŒ…é‡ä¼ , QUIC æ˜¯å°†æ¯ç»„æ•°æ®åŒ…è¿›è¡Œè¿ç®—, å°†ç»“æœä½œä¸ºä¸€ä¸ª <code>æ ¡éªŒ</code> å’Œ<code>æ•°æ®åŒ…</code>å‘é€. å¦‚æœè¿™ç»„æ•°æ®ä¸¢åŒ…, å°±å¯ä»¥é€šè¿‡æ ¡éªŒä¸å…¶ä»–åŒ…æ¥è¿˜åŸä¸¢åŒ…æ•°æ®</p><p><strong>è¿æ¥è¿ç§»</strong><br>TCP äº”å…ƒç»„ï¼ˆæºIPï¼Œæºç«¯å£ï¼Œç›®çš„IPï¼Œç›®çš„ç«¯å£ï¼Œä¼ è¾“å±‚åè®®ï¼‰æ¥å”¯ä¸€è¡¨ç¤ºä¸€æ¡è¿æ¥. QUIC åˆ™æ˜¯ç”Ÿæˆä¸€ä¸ª <code>64 ä½éšæœºæ•°ä½œä¸ºè¿æ¥å”¯ä¸€æ ‡è¯†</code> , è¿™æ ·å°±ç®—åˆ‡æ¢ç½‘ç»œäº”å…ƒç»„å˜åŒ–è¿™ä¸ªæ ‡è¯†ä¹Ÿä¸ä¼šå˜, å°±å¯ä»¥å¿«é€Ÿé‡è¿</p><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>HTTP æ˜¯ä¸€ç§è¶…æ–‡æœ¬åè®®, ç”¨äºåœ¨ç½‘ç»œä¸­å°†å‘é€æ–¹çš„è¶…æ–‡æœ¬ä¿¡æ¯ä¼ è¾“ç»™æ¥æ”¶ç«¯<br>HTTP1.0:</p><ul><li>æ¯æ¬¡è¯·æ±‚éƒ½éœ€è¦é‡æ–°å»ºç«‹ TCP è¿æ¥, å¸¦æ¥ <code>é‡å¤å»ºç«‹ TCP è¿æ¥</code> çš„æ€§èƒ½æ¶ˆè€—å’Œ <code>é˜Ÿå¤´é˜»å¡</code> çš„é—®é¢˜</li></ul><p>HTTP1.1: </p><ul><li>ä½¿ç”¨ <code>Keep-Alive</code> æ¥å¤ç”¨ TCP è¿æ¥å‘é€å¤šæ¬¡è¯·æ±‚. åº”ç”¨ä¸­å¯ä»¥é€šè¿‡ä¸åŒåŸŸåæ¥æé«˜å¹¶å‘é‡, ä½†æµè§ˆå™¨æœ‰é™åˆ¶ 6 ~ 8 ä¸ªå¹¶å‘è¯·æ±‚æ•°é‡çš„æ¡ä»¶. è€ŒåŒä¸€æ¡ TCP ä¸­çš„è¯·æ±‚-å“åº”ä¾ç„¶æ˜¯é˜»å¡çš„</li><li><code>ç®¡çº¿åŒ–</code> åŸºäº Keep-Alive å°†æ‰€æœ‰è¯·æ±‚æ‰“åŒ…ä¸€æ¬¡æ€§å‘é€åˆ°æœåŠ¡ç«¯, è§£å†³è¯·æ±‚é˜»å¡çš„é—®é¢˜. ä½†æœåŠ¡ç«¯å“åº”æ—¶è¿˜æ˜¯å¿…é¡»æŒ‰è¯·æ±‚é¡ºåºä¾æ¬¡è¿”å›, ç”±äºæ€§èƒ½é—®é¢˜ç®¡çº¿åŒ–ä¹Ÿæ²¡æœ‰è¢«å¹¿æ³›ä½¿ç”¨</li></ul><p>HTTP2.0: </p><ul><li><code>å¤šè·¯å¤ç”¨</code>å¼•å…¥ <code>å¸§</code> å’Œ <code>æµ</code> çš„æ¦‚å¿µ. åœ¨åŒä¸€ä¸ª TCP è¿æ¥ä¸­, æ‰€æœ‰è¯·æ±‚éƒ½åŸºäºæµå¹¶å¯ä»¥æ‰¿è½½ä¸é™æ•°é‡çš„æµ, æµä¸­çš„ä¿¡æ¯ç”±äºŒè¿›åˆ¶å¸§ç»„æˆ, å¸§ä¸­ä¼šæ ‡è¯†æ‰€å±æµ, ä»è€Œå®ç°ä¹±åºå‘é€. ä½† TCP å±‚é¢çš„é˜Ÿå¤´é˜»å¡ä»ç„¶å­˜åœ¨, ä¸€ä¸ªæµä¸­å‘ç”Ÿä¸¢åŒ…, å¯èƒ½é˜»å¡æ•´æ¡ TCP ä¸­çš„æµ</li><li>é€šè¿‡ HPACK ç®—æ³•è¿›è¡Œ <code>å¤´éƒ¨å‹ç¼©</code>, åŒæ—¶å‘é€å’Œæ¥æ”¶ç«¯å…±åŒç»´æŠ¤å¤´éƒ¨è¡¨, é¿å…æ¯æ¬¡ä¼ é€’ç›¸åŒå¤´éƒ¨å­—æ®µ</li><li>åˆ©ç”¨ <code>æœåŠ¡ç«¯æ¨é€</code> å®ç°ä¸€ä¸ªè¯·æ±‚æœåŠ¡ç«¯èƒ½å¤Ÿåº”ç­”å¤šä¸ªå“åº”</li></ul><p>HTTP3.0: åŸºäº UDP å®ç°æ‹¥æœ‰ TCP ä¼˜ç‚¹çš„ <code>QUIC</code> åè®®.</p><ul><li>åˆ©ç”¨ UDP é¢å‘æ— è¿æ¥çš„ç‰¹æ€§, é…åˆé¦–æ¬¡è¿æ¥ 1RTT å®ç° <code>ä½å»¶è¿Ÿç­‰å¾…</code></li><li>è·Ÿ HTTP2.0 ä¸€æ ·ä½¿ç”¨ <code>å¤šè·¯å¤ç”¨</code> å®Œç¾è§£å†³é˜Ÿå¤´é˜»å¡. å› ä¸º UDP ä¸­æµä¹‹é—´ä¸ä¼šç›¸äº’ä¾èµ–, ä¸€ä¸ªæµä¸­ä¸¢åŒ…å®Œå…¨ä¸å½±å“å…¶ä»–æµå‘é€æ•°æ®</li><li>é€šä¿¡è¿‡ç¨‹ä¸­ä½¿ç”¨ä¸€æ¬¡æ€§ç§˜é’¥æ¥ä¿è¯ <code>å‘å‰å®‰å…¨</code>, å°±ç®—å½“å‰é€šè®¯ä¸­å¯†é’¥è¢«åŠ«æŒ, ä¹Ÿä¸ç”¨æ‹…å¿ƒä¹‹å‰çš„æ•°æ®ä¹Ÿä¼šè¢«çªƒå–äº†</li><li>é€šè¿‡ <code>å‘å‰çº é”™</code> å°†æ•°æ®åŒ…åˆ†ä¸ºæ ¡éªŒåŒ…å’Œæ•°æ®ä¸¤éƒ¨åˆ†, æ•°æ®ä¸¢åŒ…æ—¶å¯ä»¥é€šè¿‡å…¶ä»–æ•°æ®åŒ…æ¥è¿˜åŸ(ä¸¢å¤ªå¤šè¿˜æ˜¯è¦é‡ä¼ ).</li><li>ç®—æ³•ç”Ÿæˆä¸€ä¸ª 64 ä¸ºéšæœºæ•°ä½œä¸ºè¿æ¥æ ‡è¯†ç¬¦, æ›¿ä»£ TCP ä¸­äº”å…ƒç»„ä½œä¸ºæ ‡è¯†ç¬¦, ä¿è¯ <code>è¿æ¥è¿ç§»</code> æ—¶èƒ½å¿«é€Ÿé‡è¿</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;HTTP å‘å±•è‡³ä»Šå·²ç»å‘ç”Ÿäº†å¤ªå¤šçš„å˜åŒ–, å¹³å¸¸å·¥ä½œä¸­å…¶å®å¹¶ä¸ä¼šæ³¨æ„è¿™äº›å˜åŒ–, ç”šè‡³è¯´æ ¹æœ¬ä¸å…³å¿ƒâ€¦ ä½†åœ¨å‰ç«¯çš„å·¥ä½œä¸­å´ä¸å®ƒå¯†åˆ‡ç›¸å…³,ä»é€šä¿¡åˆ°æ€§èƒ½ä¼˜åŒ–ç­‰ç­‰. ä¸‹é¢å°±æ¥èŠèŠ HTTP&lt;/p&gt;
&lt;h4 id=&quot;HTTP&quot;&gt;&lt;a href=&quot;#HTTP&quot; class=&quot;headerl
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="ç½‘ç»œ" scheme="https://yoursite.com/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>å¯é çš„TCPä¼ è¾“åè®®</title>
    <link href="https://yoursite.com/2022/03/24/%E5%8F%AF%E9%9D%A0%E7%9A%84TCP%E4%BC%A0%E8%BE%93%E5%8D%8F%E8%AE%AE/"/>
    <id>https://yoursite.com/2022/03/24/å¯é çš„TCPä¼ è¾“åè®®/</id>
    <published>2022-03-24T12:00:53.000Z</published>
    <updated>2022-08-23T09:37:40.692Z</updated>
    
    <content type="html"><![CDATA[<p>æåˆ° <code>TCP</code> åè®®å¤§å®¶å°è±¡æœ€æ·±åˆ»çš„åº”è¯¥å°±æ˜¯â€å¯é æ€§â€è¿™ä¸‰ä¸ªå­—äº†, å› æ­¤ä¸ºäº†ä¿è¯â€å¯é æ€§â€çœŸçš„æ˜¯ç”¨äº†å¥½å¤šæœºåˆ¶æ¥ä¿è¯ğŸ˜‚ . <em>ä¸çŸ¥é“å½“åˆè®¾è®¡ TCP çš„å¤§ä½¬ä»¬çœ‹åˆ°ç°åœ¨çš„ <code>QUIC</code> åè®®ä¼šä¸ä¼šè§‰å¾—å¥½æ°”</em></p><p>é‚£ä¹ˆä¸ºäº†å®ç°å¯é æ€§, TCP åˆ°åº•åšäº†å“ªäº›äº‹å‘¢? ä¸»è¦è¦æ˜¯é€šè¿‡ <code>æ•°æ®åºåˆ—å·</code> / <code>ç¡®è®¤åº”ç­”</code> / <code>æµé‡æ§åˆ¶</code> / <code>æ‹¥å¡æ§åˆ¶</code> / <code>é‡å‘æœºåˆ¶</code> è¿™å‡ ä¸ªæœºåˆ¶æ¥å®ç°çš„, ä¸‹é¢å°±ä¸€æ¬¡èŠèŠè¿™äº›æœºåˆ¶åˆ°åº•åœ¨åšäº›ä»€ä¹ˆ.</p><h4 id="æ•°æ®åºåˆ—å·å’Œç¡®è®¤åº”ç­”"><a href="#æ•°æ®åºåˆ—å·å’Œç¡®è®¤åº”ç­”" class="headerlink" title="æ•°æ®åºåˆ—å·å’Œç¡®è®¤åº”ç­”"></a>æ•°æ®åºåˆ—å·å’Œç¡®è®¤åº”ç­”</h4><p>é¦–å…ˆ TCP åè®®æ˜¯é¢å‘å­—èŠ‚æµçš„, è€Œç»è¿‡ TCP åè®®çš„æ•°æ®ä¼šè¢«æ‹†åˆ†åˆ°å¤šä¸ªæ•°æ®æ®µä¸­, æ¯ä¸ªæ•°æ®æ®µä¸­éƒ½ä¼šåŒ…å«ä¸€ä¸ªåºåˆ—å·çš„åè®®å¤´, è¿™ä¸ªåºåˆ—å·å°±æ˜¯æˆ‘ä»¬æ‰€è¯´çš„æ•°æ®åºåˆ—å·äº†.</p><p>é‚£ç¡®è®¤åº”ç­”æ˜¯å•¥å‘¢? åœ¨ TCP ä¸­, å½“å‘é€ç«¯å‘é€çš„æ•°æ®åˆ°è¾¾æ¥æ”¶ç«¯æ—¶, æ¥æ”¶ç«¯ä¼šå›å¤ä¸€ä¸ªç¡®è®¤åº”ç­”çš„æ¶ˆæ¯, è¡¨ç¤ºå·²æ”¶åˆ°æ¶ˆæ¯. è€Œè¿™ä¸ªåº”ç­”æ¶ˆæ¯ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¸¸è¯´çš„ ACK(Acknowledge characterï¼‰æŠ¥æ–‡æ®µ</p><blockquote><p>ACK æ˜¯æŒ‡ TCP çš„æŠ¥æ–‡åˆ°è¾¾ç¡®è®¤, ç¡®è®¤æ¥æ”¶åˆ°çš„æ•°æ®çš„æœ€é«˜åºåˆ—å·ï¼ŒåŒæ—¶å‘å‘é€ç«¯è¿”å›ä¸€ä¸ªä¸‹æ¬¡æ¥æ”¶æ—¶æœŸæœ›çš„ TCP æ•°æ®åŒ…çš„åºåˆ—å·(ä¹Ÿå°±æ˜¯ ACK çš„å€¼)</p></blockquote><p>é‚£ä¹ˆåœ¨ç½‘ç»œè¿‡ç¨‹ä¸­, æ•°æ®çš„ä¼ è¾“è¿‡ç¨‹ä¸­å¤§æ¦‚ä¼šæ˜¯è¿™æ ·:<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ä¸»æœº A                                      ä¸»æœº B</span><br><span class="line">      ----    æ•°æ® 1 ~ 100   ------&gt;</span><br><span class="line">      &lt;--- ç¡®è®¤åº”ç­”(ä¸‹ä¸€ä¸ª101) ------</span><br><span class="line">      ---- æ•°æ® 101 ~ 200    ------&gt;</span><br><span class="line">      &lt;--- ç¡®è®¤åº”ç­”(ä¸‹ä¸€ä¸ª201) ------</span><br></pre></td></tr></table></figure></p><p>ä½†å…¶å®åœ¨ç½‘ç»œ, å¹¶ä¸ä¼šä¸Šè¿°çš„è¿‡ç¨‹ä¸­é‚£ä¹ˆé¡ºåˆ©, é‚£ä¹ˆå½“æ•°æ®åœ¨ä¼ è¾“è¿‡ç¨‹ä¸­ä¸¢å¤±äº†æ€ä¹ˆåŠ? æ‰€ä»¥æœ‰äº†<code>é‡ä¼ æœºåˆ¶</code></p><h4 id="é‡ä¼ æœºåˆ¶"><a href="#é‡ä¼ æœºåˆ¶" class="headerlink" title="é‡ä¼ æœºåˆ¶"></a>é‡ä¼ æœºåˆ¶</h4><p>é‡ä¼ æœºåˆ¶ä¸»è¦æœ‰å››ç§æ–¹å¼: <code>è®¡æ—¶é‡ä¼ </code> / <code>å¿«é€Ÿé‡ä¼ </code> / <code>å¸¦ç¡®è®¤é‡ä¼ (SACK)</code> / <code>D-SACK</code></p><p><strong>è®¡æ—¶é‡ä¼ </strong><br>è®¡æ—¶é‡ä¼ æ˜¯æŒ‡åœ¨å‘é€æ•°æ®æ—¶, å¯åŠ¨ä¸€ä¸ªè®¡æ—¶å™¨, å½“è¶…è¿‡æŒ‡å®šæ—¶é—´åæ²¡æœ‰æ”¶åˆ°å¯¹æ–¹çš„ <code>ACK</code> ç¡®è®¤åº”ç­”æŠ¥æ–‡, é‚£ä¹ˆå°±ä¼šé‡æ–°å‘é€æ•°æ®åŒæ—¶é™ä½å‘é€é€Ÿç‡. </p><blockquote><p>ä¸¾ä¾‹æ¥è¯´:<br>å‡å¦‚ä¼ è¾“çš„æ•°æ® 12345, 1 ä¸¢æ‰äº†, 2345 è¢«æ¥æ”¶åˆ°äº†, å› ä¸ºä¸¢æ‰äº†æ•°æ®åŒ… 1 æ‰€ä»¥æ¥æ”¶æ–¹æ²¡æ³•å‘é€ ACK æŠ¥æ–‡. é‚£ä¹ˆå‘é€æ–¹ä¹Ÿå°±åªèƒ½ç­‰ç€æ¥æ”¶æ–¹å‘ ACK, åŒæ–¹å°±åªèƒ½æ­»ç­‰æ•°æ®æ®µ 1, ä»è€Œé€ æˆè¶…æ—¶. è€Œè¶…æ—¶ä¹‹åå‘é€æ–¹å¹¶ä¸çŸ¥é“ä¸¢äº†é‚£äº›æ•°æ®æ®µ, å°±åªèƒ½æ‚²è§‚çš„è®¤ä¸ºæ•°æ® 1 ä¹‹åçš„æ•°æ®ä¹Ÿéƒ½ä¸¢äº†, é‚£ä¹ˆå°±è¦é‡ä¼ æ‰€æœ‰æ•°æ®æ®µ.</p></blockquote><p>ä»ä¸Šé¢çš„è¿‡ç¨‹ä¸­, æˆ‘ä»¬å¯ä»¥å‘ç°è®¡æ—¶é‡ä¼ ä¼šæœ‰ä¸¤ä¸ªé—®é¢˜:</p><ol><li>åªæœ‰ç­‰è¶…æ—¶åæ‰èƒ½é‡ä¼ </li><li>ä¸çŸ¥é“é‡ä¼ æ•°æ®èŒƒå›´</li></ol><p><strong>å¿«é€Ÿé‡ä¼ </strong><br>å¿«é€Ÿé‡ä¼ æ˜¯åŸºäºè®¡æ—¶é‡ä¼ , ä¸»è¦è§£å†³äº†è¦ç­‰å¾…è¶…æ—¶æ‰èƒ½é‡ä¼ çš„é—®é¢˜. æ‰€ä»¥å¿«é€Ÿé‡ä¼ çš„åšæ³•æ˜¯: å½“æ¥æ”¶æ–¹æ”¶åˆ°ä¹±åºåŒ…æ—¶, ç«‹å³å‘é€ ACK è¡¨æ˜ä¸‹ä¸ªæœŸæœ›æ¥æ”¶çš„æ•°æ®(å…¶å®å°±æ˜¯ä¸¢å¤±çš„é‚£ä¸ªæ•°æ®). è€Œå‘é€æ–¹è¿ç»­æ”¶åˆ°ä¸‰æ¬¡ç›¸åŒçš„ ACK å°±ä¼šé‡ä¼ , ä¸éœ€è¦ç­‰åˆ°æ˜¯è®¡æ—¶å™¨è¶…æ—¶.</p><p><strong>å¸¦ç¡®è®¤é‡ä¼ (SACK)</strong><br>ä¸Šé¢çš„å¿«é€Ÿé‡ä¼ è§£å†³äº†è¶…æ—¶çš„é—®é¢˜, é‚£ä¹ˆå‰©åº”è¯¥é‡ä¼ æ•°æ®èŒƒå›´çš„é—®é¢˜. é‚£ä¹ˆ SACK å°±æ˜¯åœ¨å¿«é€Ÿé‡ä¼ çš„åŸºç¡€ä¸Š, å¢åŠ ä¸€ä¸ª <code>SACK</code> çš„å¤´, å°†å·²æ”¶åˆ°çš„æ•°æ®æŠ¥æ–‡æ®µçš„åºåˆ—å·èŒƒå›´å‘Šè¯‰å‘é€æ–¹, è¿™æ ·å‘é€æ–¹å°±å¯ä»¥åªé‡ä¼ ä¸¢å¤±çš„æ•°æ®</p><p><img src="https://pic1.zhimg.com/80/v2-f65effd9010fbfe7f0ad0d3b256854e8_720w.jpg" alt="å¸¦ç¡®è®¤é‡ä¼ è¿‡ç¨‹"></p><p><strong>D-SACK</strong><br>D-SACK ä¸»è¦æ˜¯ä¸ºäº†å‘Šè¯‰å‘é€æ–¹å“ªäº›æ•°æ®é‡å¤æ¥æ”¶äº†. ä¸Šé¢ä¸æ˜¯å·²ç»æœ‰ SACK å‘Šè¯‰å‘é€æ–¹å“ªäº›æ•°æ®æŠ¥æ–‡æ®µæ˜¯å·²æ¥æ”¶äº†çš„å—, ä¸ºå•¥è¿˜éœ€è¦ D-SACK? å› ä¸ºåœ¨ç½‘ç»œä¸­æˆ‘ä»¬çš„ ACK æŠ¥æ–‡å’Œæ•°æ®æ®µæŠ¥æ–‡éƒ½å¯èƒ½ä¼šä¸¢å¤±å‘€! æ¯”å¦‚ä»¥ä¸‹ä¸¤ç§æƒ…å†µ:</p><ol><li><p>ACK åº”ç­”æŠ¥æ–‡ä¸¢å¤±: </p><ul><li>å½“æ¥æ”¶æ–¹åˆ†åˆ«æ”¶åˆ°æ•°æ® 1 å’Œ 2, å¹¶å›å¤ ACK = 2 å’Œ ACK = 3</li><li>ACK ä¸¢å¤±äº†å‘é€æ–¹ä¸€ç›´æ”¶ä¸åˆ° ACK è‡ªç„¶æ— æ³•è§¦å‘å¿«é€Ÿé‡ä¼ </li><li>äºæ˜¯è§¦å‘è¶…æ—¶é‡ä¼ , è¶…æ—¶é‡ä¼ åªå¥½å†é‡å‘ä¸€æ¬¡æ•°æ® 1. (é€ æˆé‡å¤æ•°æ®)</li><li>æ¥æ”¶æ–¹å†æ¬¡æ”¶åˆ°é‡å‘çš„æ•°æ®, å“åº” ACK = 3 å’Œ SACK = 1 ~ 2</li></ul><p>æ­¤æ—¶çš„ SACK å°±ä¼šå˜æˆè¡¨ç¤ºé‡å¤æ”¶åˆ°çš„æ•°æ®åŒ…èŒƒå›´, è¿™æ ·å‘é€æ–¹å°±çŸ¥é“äº†åŸæ¥æ˜¯æ¥æ”¶æ–¹çš„ ACK æŠ¥æ–‡ä¸¢å¤±äº†</p></li><li><p>ç½‘ç»œå»¶è¿Ÿ: </p><ul><li>å‘é€æ–¹æ³•é€äº†æ•°æ® 1234, </li><li>æ•°æ® 2 å»¶è¿Ÿäº†ä¸€ç›´æ²¡æœ‰åˆ°è¾¾æ¥æ”¶æ–¹</li><li>æ•°æ® 134 é¡ºåˆ©è¾¾åˆ°äºæ˜¯æ¥æ”¶æ–¹ä¼šåˆ†åˆ«å›å¤ä¸‰æ¬¡ ACK = 2, SACK = 3 å’Œ SACK = 3 ~ 4 è§¦å‘åˆ°äº†å¿«é€Ÿé‡ä¼ </li><li>åœ¨å¿«é€Ÿé‡ä¼ çš„æ•°æ® 2 è¾¾åˆ°ä¹‹å‰, å…ˆæ”¶åˆ°äº†ä¹‹å‰å»¶è¿Ÿçš„æ•°æ® 2, åœ¨æ”¶åˆ°é‡å‘çš„æ•°æ® 2 (é€ æˆé‡å¤æ•°æ®)</li><li>æ¥æ”¶æ–¹å›å¤ ACK = 5 å’Œ SACK = 2</li></ul><p>æ­¤æ—¶ ACKå·²ç»åˆ°äº† 5, SACK è¿˜æ˜¯ 2 è¯´æ˜è¿™ä¸ªæ˜¯é‡å¤æ•°æ®. åŒæ—¶å‘é€æ–¹ä¹ŸçŸ¥é“äº†ä¸æ˜¯å‘å‡ºå»çš„åŒ…ä¸¢å¤±äº†, ä¹Ÿä¸æ˜¯ ACK æŠ¥æ–‡ä¸¢äº†, è€Œæ˜¯ç½‘ç»œå»¶è¿Ÿäº†</p></li></ol><h4 id="æµé‡æ§åˆ¶"><a href="#æµé‡æ§åˆ¶" class="headerlink" title="æµé‡æ§åˆ¶"></a>æµé‡æ§åˆ¶</h4><p>æµé‡æ§åˆ¶æ˜¯ä¸ºäº†é˜²æ­¢å‘é€æ–¹å‘é€çš„é€Ÿç‡å¤ªå¿«, å¯¼è‡´æ¥æ”¶æ–¹çš„ç¼“å­˜åŒºæº¢å‡º. åŸºæœ¬åŸç†å°±æ˜¯è®©å‘é€æ–¹çŸ¥é“æ¥æ”¶æ–¹çš„ç¼“å­˜åŒºå¤§å°, ä»¥è°ƒæ•´å‘é€é€Ÿç‡.</p><p>è¿™ä¸€åŸç†é€šè¿‡æ»‘åŠ¨çª—å£æ¥å®ç°çš„, å…¶ä¸­æ¥æ”¶æ–¹çš„ç¼“å­˜åŒºå¤§å°å«åš<code>æ¥æ”¶çª—å£(rwnd)</code>å¤§å°, å‘é€æ–¹çš„å‘é€é€Ÿç‡ç”±<code>å‘é€çª—å£(swnd)</code>å¤§å°å†³å®š. å‘é€çª—å£çš„å¤§å°ä¸èƒ½å¤§äºæ¥æ”¶çª—å£çš„å¤§å°, å¦åˆ™æ¥æ”¶æ–¹å°±å¤„ç†ä¸è¿‡æ¥äº†</p><blockquote><p>å¼•å…¥çª—å£çš„åŸå› : ä»ä¸Šé¢ä¼ è¾“æ•°æ®çš„è¿‡ç¨‹, æˆ‘ä»¬çŸ¥é“ä¼ è¾“è¿‡ç¨‹éƒ½æ˜¯ä¸€æ¥ä¸€å›çš„, æ‰€ä»¥æ•°æ®çš„å¾€è¿”æ—¶é—´è¶Šé•¿, é€šè®¯æ•ˆç‡å°±è¶Šå·®. è€Œçª—å£å¤§å°å°±æ˜¯æŒ‡æ— éœ€ç­‰å¾…ç¡®è®¤åº”ç­”ï¼Œè€Œå¯ä»¥ç»§ç»­å‘é€æ•°æ®çš„æœ€å¤§å€¼. </p></blockquote><p>ä»¥å‘é€æ–¹çš„çª—å£ä¸ºä¾‹: çª—å£ç›¸å½“äºå¼€è¾Ÿä¸€ä¸ªç¼“å­˜åŒºåŸŸ, å°†ä»¥å‘é€çš„æ•°æ®ä¿å­˜åœ¨ç¼“å­˜åŒºä¸­, åœ¨æ”¶åˆ° ACK åº”ç­”ä¹‹å‰å¿…é¡»ä¸€ç›´ä¿å­˜, ç›´åˆ°æ”¶åˆ°åº”ç­”æ‰æ¸…é™¤ç¼“å­˜, ç„¶åæŒ‰æ”¶åˆ°åº”ç­”çš„æ•°æ®å­—èŠ‚å‘å³æ»‘åŠ¨. <em>æ³¨: ä¸¤ä¸ªçª—å£çš„å¤§å°éƒ½æ˜¯æ”¾åœ¨æ“ä½œç³»ç»Ÿå†…å­˜ç¼“å†²åŒºä¸­çš„ï¼Œè€Œæ“ä½œç³»ç»Ÿçš„ç¼“å†²åŒºä¼šè¢«æ“ä½œç³»ç»Ÿè°ƒæ•´</em></p><p><code>çª—å£å…³é—­(æ­»é”)</code><br>  å½“çª—å£ä¸ä¸º 0 çš„åº”ç­”ä¸¢å¤±æ—¶ï¼Œå‘é€æ–¹ä¼šä¸€ç›´ç­‰å¾…ï¼Œè€Œæ¥æ”¶æ–¹ä»¥ä¸ºå‘é€æ–¹æ”¶åˆ°äº†åˆ™ä¸€ç›´ç­‰å¾…æ–°æ•°æ®ï¼Œè¿™æ ·ç›¸äº’ç­‰å¾…çš„è¿‡ç¨‹å°±é€ æˆäº†æ­»é”</p><p>è§£å†³æ–¹æ¡ˆ:<br>  ç”¨æŒç»­è®¡æ—¶å™¨æ¥è§£å†³ï¼Œæ¯å½“æ”¶åˆ°æ¥æ”¶æ–¹çª—å£ä¸º 0 æ—¶ï¼Œéƒ½å¯åŠ¨ä¸€ä¸ªè®¡æ—¶å™¨æ—¶é—´ä¸€åˆ°å‘é€æ–¹å°±ä¸»åŠ¨è¯¢é—®æ¥æ”¶æ–¹çª—å£å¤§å°ã€‚å¦‚æœè¿˜æ˜¯ 0 å°±é‡ç½®è®¡æ—¶å™¨ï¼›ä¸ä¸º 0 åˆ™è¡¨ç¤ºä¹‹å‰çš„æŠ¥æ–‡ä¸¢å¤±äº†ï¼Œé‡ç½®çª—å£ï¼Œå†é‡æ–°å¼€å§‹å‘é€</p><p><code>ç³Šæ¶‚çª—å£</code><br>å¦‚æœæ¥æ”¶æ–¹å¤ªå¿™äº†ï¼Œæ¥ä¸åŠå–èµ°æ¥æ”¶çª—å£é‡Œçš„æ•°æ®ï¼Œé‚£ä¹ˆå°±ä¼šå¯¼è‡´å‘é€æ–¹çš„å‘é€çª—å£è¶Šæ¥è¶Šå°. åˆ°æœ€åæ¥æ”¶æ–¹çª—å£å¤§å°åªæœ‰å‡ ä¸ªå­—èŠ‚äº†, å‘é€æ–¹è¿˜æ˜¯ä¹‰æ— åé¡¾çš„å‘é€å‡ ä¸ªå­—èŠ‚çš„æ•°æ®. è¿™å°±æ˜¯ç³Šæ¶‚çª—å£</p><p>äºæ˜¯ï¼Œè¦è§£å†³ç³Šæ¶‚çª—å£ç»¼åˆç—‡ï¼Œæœ‰ä¸‹é¢ä¸¤ä¸ªåŠæ³•:</p><ul><li>è®©æ¥æ”¶æ–¹ä¸é€šå‘Šå°çª—å£ç»™å‘é€æ–¹<ul><li>å½“çª—å£å¤§å° &lt; Math.min(æœ€å¤§æ•°æ®æ®µæ•°é‡MSSï¼Œç¼“å­˜ç©ºé—´/2 ), ç›´æ¥å‘Šè¯‰å‘é€æ–¹çª—å£ä¸º 0</li></ul></li><li>è®©å‘é€æ–¹é¿å…å‘é€å°æ•°æ®<ul><li>è¦ç­‰åˆ°æ¥æ”¶çª—å£å¤§å° &gt;= MSS</li><li>æ”¶åˆ°ä¹‹å‰å‘é€æ•°æ®çš„ ACK å›åŒ…</li></ul></li></ul><h4 id="æ‹¥å¡æ§åˆ¶"><a href="#æ‹¥å¡æ§åˆ¶" class="headerlink" title="æ‹¥å¡æ§åˆ¶"></a>æ‹¥å¡æ§åˆ¶</h4><p>è·Ÿæµé‡æ§åˆ¶çš„åŒºåˆ«åœ¨äº, æ‹¥å¡æ§åˆ¶ä½œç”¨äºç½‘ç»œ. æ ¹æ®ä¸¢åŒ…æƒ…å†µå’Œç½‘ç»œå¸¦å®½é˜²æ­¢è¿‡å¤šæ•°æ®æ³¨å…¥ç½‘ç»œï¼Œé€ æˆç½‘ç»œè´Ÿè½½è¿‡å¤§.</p><p>è¯•æƒ³åœ¨ç½‘ç»œå‡ºç°æ‹¥å µæ—¶ï¼Œå¦‚æœç»§ç»­å‘é€å¤§é‡æ•°æ®åŒ…ï¼Œå¯èƒ½ä¼šå¯¼è‡´æ•°æ®åŒ…æ—¶å»¶ã€ä¸¢å¤±ç­‰ï¼Œè¿™æ—¶ TCP å°±ä¼šé‡ä¼ æ•°æ®ï¼Œä½†æ˜¯ä¸€é‡ä¼ å°±ä¼šå¯¼è‡´ç½‘ç»œçš„è´Ÿæ‹…æ›´é‡ï¼Œäºæ˜¯ä¼šå¯¼è‡´æ›´å¤§çš„å»¶è¿Ÿä»¥åŠæ›´å¤šçš„ä¸¢åŒ…ï¼Œç„¶åè¿›å…¥æ¶æ€§å¾ªç¯, äºæ˜¯æœ‰äº†æ‹¥å¡æ§åˆ¶.</p><p>æ‹¥å¡æ§åˆ¶ä¸­, ä¼šåœ¨å‘é€æ–¹æ–°å¢ä¸€ä¸ª<code>æ‹¥å¡çª—å£(cwnd)</code>çš„å˜é‡, å®ƒéšç€ç½‘ç»œæ‹¥å¡ç¨‹åº¦åŠ¨æ€å˜åŒ–. <em>æ³¨: åŠ å…¥äº†æ‹¥å¡çª—å£å, å‘é€çª—å£çš„å€¼swnd = min(cwnd, rwnd)ï¼Œä¹Ÿå°±æ˜¯æ‹¥å¡çª—å£å’Œæ¥æ”¶çª—å£ä¸­çš„æœ€å°å€¼</em></p><p>æ‹¥å¡çª—å£ cwnd å˜åŒ–çš„è§„åˆ™ï¼š</p><ul><li>åªè¦ç½‘ç»œä¸­æ²¡æœ‰å‡ºç°æ‹¥å¡ï¼Œcwnd å°±ä¼šå¢å¤§</li><li>ä½†ç½‘ç»œä¸­å‡ºç°äº†æ‹¥å¡ï¼Œcwnd å°±å‡å°‘</li></ul><p>é‚£æ€ä¹ˆåˆ¤æ–­ç½‘ç»œå‡ºç°æ‹¥å¡äº†å‘¢?<br>ç»“åˆä¹‹å‰èŠåˆ°çš„æ•°æ®ä¼ é€’è¿‡ç¨‹, å¯ä»¥æ¨æ–­å‡ºå½“å‘é€æ–¹æ²¡æœ‰åŠæ—¶æ”¶åˆ° ACK å“åº”, å°±å¯ä»¥è®¤ä¸ºæ˜¯ç½‘ç»œæ‹¥å¡äº†</p><p>æ‹¥å¡æ§åˆ¶åˆæ§åˆ¶äº›å•¥, ä¸»è¦æ§åˆ¶äº†å››ä¸ªç®—æ³•: <code>æ…¢å¯åŠ¨</code> / <code>æ‹¥å¡é¿å…</code> / <code>å¿«é€Ÿé‡ä¼ </code> / <code>å¿«é€Ÿæ¢å¤</code>, </p><ul><li><p>æ…¢å¯åŠ¨<br>æ˜¯æŒ‡ä¸€ç‚¹ä¸€ç‚¹æé«˜å‘é€æ•°æ®åŒ…çš„æ•°é‡ï¼Œå‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªæ¥æ”¶æ–¹çš„ ACK å“åº”,  æ‹¥å¡çª—å£å¤§å°å°±åŠ å€ï¼Œå‘ˆæŒ‡æ•°çº§å¢é•¿.åŒæ—¶è¿˜ä¼šç»´æŠ¤ä¸€ä¸ªæ…¢å¯åŠ¨é˜ˆå€¼(ssthresh)</p></li><li><p>æ‹¥å¡é¿å…<br>å‘é€æ–¹æ¯æ”¶åˆ°ä¸€ä¸ªæ¥æ”¶æ–¹çš„ ACK å“åº”,  æ‹¥å¡çª—å£å¤§å°å°± + 1ï¼Œè¶çº¿æ€§å¢é•¿ï¼Œå‡ç¼“æ‹¥å¡çª—å£å¢é•¿é€Ÿåº¦</p><p>æ…¢å¯åŠ¨é˜ˆå€¼ä¼šå†³å®šä½¿ç”¨æ…¢å¯åŠ¨è¿˜æ˜¯æ‹¥å¡é¿å…:</p><ul><li>å½“æ‹¥å¡çª—å£å¤§å° &lt; æ…¢å¯åŠ¨é˜ˆå€¼, ä½¿ç”¨æ…¢å¯åŠ¨</li><li>æ‹¥å¡çª—å£å¤§å° &gt;= æ…¢å¯åŠ¨é˜ˆå€¼, ä½¿ç”¨æ‹¥å¡é¿å…</li></ul></li><li><p>å¿«é€Ÿé‡ä¼ <br>å½“ç½‘ç»œå‘ç”Ÿæ‹¥å¡ï¼Œæ¥æ”¶æ–¹æ”¶åˆ°äº†ä¸‰æ¬¡é‡å¤ ACKï¼Œè§¦å‘å¿«é€Ÿé‡ä¼ æœºåˆ¶.<br>TCP ä¼šè®¤ä¸ºè¿™ç§æƒ…å†µæ²¡æœ‰å¾ˆä¸¥é‡, åˆ™è°ƒæ•´æ‹¥å¡çª—å£å’Œæ…¢å¯åŠ¨é˜ˆå€¼:</p><ul><li>æ‹¥å¡çª—å£å¤§å° = æ‹¥å¡çª—å£å¤§å° / 2</li><li>æ…¢å¯åŠ¨é˜ˆå€¼ = æ‹¥å¡çª—å£å¤§å°</li></ul><p>æ¥ç€è¿›å…¥å¿«é€Ÿæ¢å¤</p></li><li><p>å¿«é€Ÿæ¢å¤<br>åœ¨åŸºäºå¿«é€Ÿé‡ä¼ å°†æ‹¥å¡çª—å£å¤§å° + 3ï¼ˆå› ä¸ºæ”¶åˆ°äº†ä¸‰ä¸ªæ•°æ®åŒ…ï¼‰ï¼Œé‡ä¼ ä¸¢å¤±çš„æ•°æ®åŒ…ï¼Œæ”¶åˆ° ACK æ¢å¤äº†å°±è¿›å…¥æ‹¥å¡é¿å…ç®—æ³•ï¼Œå†æ¬¡å°è¯•è®©æ‹¥å¡çª—å£å¢å¤§</p></li></ul><p>å¦‚æœç½‘ç»œæ‹¥å¡åˆ°è§¦å‘äº†è®¡æ—¶é‡ä¼ , é‚£å°±ä¸€æ£’å›åˆ°è§£æ”¾å‰, é‡æ–°å¼€å§‹æ…¢å¯åŠ¨æ¥å¤§å¹…å‡å°‘æ•°æ®æµ.åŒæ—¶æ…¢å¯åŠ¨é˜ˆå€¼å’Œæ‹¥å¡çª—å£å¤§å°ä¹Ÿä¼šå‘ç”Ÿå˜åŒ–ï¼š</p><ul><li>æ…¢å¯åŠ¨é˜ˆå€¼ è®¾ä¸º æ‹¥å¡çª—å£å¤§å°/2</li><li>æ‹¥å¡çª—å£å¤§å° é‡ç½®ä¸º 1</li></ul><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>TCP çš„å¯é æ€§æ˜¯ç”±:</p><ul><li><code>åºåˆ—å·</code>å’Œ<code>ç¡®è®¤åº”ç­”</code>æ¥ä¿è¯æ•°æ®åˆ°è¾¾æ¥æ”¶æ–¹</li><li><code>æµé‡æ§åˆ¶</code>ç”¨æ»‘åŠ¨çª—å£æ¥é˜²æ­¢å‘é€æ–¹å‘é€é€Ÿç‡è¿‡å¿«å¯¼è‡´æ¥æ”¶æ–¹å¤„ç†ä¸è¿‡æ¥</li><li><code>æ‹¥å¡æ§åˆ¶</code>ç”¨æ…¢å¯åŠ¨ / æ‹¥å¡é¿å… / å¿«é€Ÿé‡ä¼  / å¿«é€Ÿæ¢å¤æ¥é˜²æ­¢å¤§é‡æ•°æ®åœ¨ç½‘ç»œä¸­é€ æˆæ‹¥å µ, ä»è€Œé€ æˆæ›´å¤šæ•°æ®å»¶è¿Ÿ/ä¸¢åŒ…å¸¦æ¥æ¶æ€§å¾ªç¯</li></ul>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;æåˆ° &lt;code&gt;TCP&lt;/code&gt; åè®®å¤§å®¶å°è±¡æœ€æ·±åˆ»çš„åº”è¯¥å°±æ˜¯â€å¯é æ€§â€è¿™ä¸‰ä¸ªå­—äº†, å› æ­¤ä¸ºäº†ä¿è¯â€å¯é æ€§â€çœŸçš„æ˜¯ç”¨äº†å¥½å¤šæœºåˆ¶æ¥ä¿è¯ğŸ˜‚ . &lt;em&gt;ä¸çŸ¥é“å½“åˆè®¾è®¡ TCP çš„å¤§ä½¬ä»¬çœ‹åˆ°ç°åœ¨çš„ &lt;code&gt;QUIC&lt;/code&gt; åè®®ä¼šä¸ä¼šè§‰å¾—å¥½æ°”&lt;/em&gt;&lt;/p&gt;

      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="ç½‘ç»œ" scheme="https://yoursite.com/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>å‚»å‚»åˆ†ä¸æ¸…ä¹‹ä½œç”¨åŸŸ/æ‰§è¡Œä¸Šä¸‹æ–‡</title>
    <link href="https://yoursite.com/2022/03/21/%E5%82%BB%E5%82%BB%E5%88%86%E4%B8%8D%E6%B8%85%E4%B9%8B%E4%BD%9C%E7%94%A8%E5%9F%9F-%E6%89%A7%E8%A1%8C%E4%B8%8A%E4%B8%8B%E6%96%87/"/>
    <id>https://yoursite.com/2022/03/21/å‚»å‚»åˆ†ä¸æ¸…ä¹‹ä½œç”¨åŸŸ-æ‰§è¡Œä¸Šä¸‹æ–‡/</id>
    <published>2022-03-21T03:43:02.000Z</published>
    <updated>2022-08-23T09:37:40.692Z</updated>
    
    <content type="html"><![CDATA[<p>å·¥ä½œä¸¤ä¸‰å¹´ä¸­, å¶ç„¶å¬åŒäº‹ä»¬åœ¨è®¨è®ºä½œç”¨åŸŸ balabala.. ä»”ç»†å›æƒ³ä¸€ä¸‹å¥½åƒè‡ªå·±ä¹Ÿä¸å¤ªèƒ½è¯´æ¸…ä»–ä¿©çš„åŒºåˆ«åˆ°åº•æ˜¯å•¥, äºæ˜¯è¿›è¡Œäº†ä¸€æ³¢å›ç‚‰é‡é€ </p><h3 id="ä»ä¸‡ç‰©ä¹‹æºç¼–è¯‘-JSå¼€å§‹"><a href="#ä»ä¸‡ç‰©ä¹‹æºç¼–è¯‘-JSå¼€å§‹" class="headerlink" title="ä»ä¸‡ç‰©ä¹‹æºç¼–è¯‘ JSå¼€å§‹"></a>ä»ä¸‡ç‰©ä¹‹æºç¼–è¯‘ JSå¼€å§‹</h3><p>JS ç¼–è¯‘ä¸€å…±ä¼šç»å†å››ä¸ªé˜¶æ®µ: è¯æ³•åˆ†æ/è¯­æ³•åˆ†æ/é¢„ç¼–è¯‘/ä»£ç æ‰§è¡Œ, å¤§è‡´æè¿°ä¸€ä¸‹è¿™å››ä¸ªé˜¶æ®µåœ¨åšä»€ä¹ˆ:</p><ul><li><p>è¯æ³•åˆ†æ: å°†ç¬¦å·æµè½¬ä¸ºè®°å·æµ, å°†ä»£ç åˆ†è§£æˆæœ€å°è¯æ³•å•å…ƒ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// JS æºä»£ç </span></span><br><span class="line"><span class="keyword">var</span> AST = <span class="string">'tree'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†è§£ä¸ºè¯æ³•å•å…ƒï¼Œè½¬åŒ–ä¸ºè¿™æ ·ğŸ‘‡ğŸ»</span></span><br><span class="line">[</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"Keyword"</span>,</span><br><span class="line">    <span class="string">"value"</span>: <span class="string">"var"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"Identifier"</span>,</span><br><span class="line">    <span class="string">"value"</span>: <span class="string">"AST"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"Punctuator"</span>,</span><br><span class="line">    <span class="string">"value"</span>: <span class="string">"="</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"String"</span>,</span><br><span class="line">    <span class="string">"value"</span>: <span class="string">"'tree'"</span></span><br><span class="line">  &#125;,</span><br><span class="line">  &#123;</span><br><span class="line">    <span class="string">"type"</span>: <span class="string">"Punctuator"</span>,</span><br><span class="line">    <span class="string">"value"</span>: <span class="string">";"</span></span><br><span class="line">  &#125;</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>è¯­æ³•åˆ†æ: å†å°†è®°å·æµç”Ÿæˆä¸ºæŠ½è±¡è¯­æ³•æ ‘(AST)</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="string">"type"</span>: <span class="string">"Program"</span>,</span><br><span class="line">  <span class="string">"body"</span>: [</span><br><span class="line">    &#123;</span><br><span class="line">      <span class="string">"type"</span>: <span class="string">"VariableDeclaration"</span>,</span><br><span class="line">      <span class="string">"declarations"</span>: [</span><br><span class="line">        &#123;</span><br><span class="line">          <span class="string">"type"</span>: <span class="string">"VariableDeclarator"</span>,</span><br><span class="line">          <span class="string">"id"</span>: &#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"Identifier"</span>,</span><br><span class="line">            <span class="string">"name"</span>: <span class="string">"AST"</span></span><br><span class="line">          &#125;,</span><br><span class="line">          <span class="string">"init"</span>: &#123;</span><br><span class="line">            <span class="string">"type"</span>: <span class="string">"Literal"</span>,</span><br><span class="line">            <span class="string">"value"</span>: <span class="string">"tree"</span>,</span><br><span class="line">            <span class="string">"raw"</span>: <span class="string">"'tree'"</span></span><br><span class="line">          &#125;</span><br><span class="line">        &#125;</span><br><span class="line">      ],</span><br><span class="line">      <span class="string">"kind"</span>: <span class="string">"var"</span></span><br><span class="line">    &#125;</span><br><span class="line">  ],</span><br><span class="line">  <span class="string">"sourceType"</span>: <span class="string">"script"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>é¢„ç¼–è¯‘</p><ul><li>åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡</li><li>ç¡®å®šå˜é‡å¯¹è±¡ã€ä½œç”¨åŸŸé“¾ã€thisæŒ‡å‘</li><li>å˜é‡å¯¹è±¡å¡«å……é¡ºåºï¼šå‡½æ•°å½¢å‚ã€å‡½æ•°å£°æ˜ã€å˜é‡å£°æ˜</li></ul></li><li><p>ä»£ç æ‰§è¡Œ</p></li></ul><h3 id="ä½œç”¨åŸŸ"><a href="#ä½œç”¨åŸŸ" class="headerlink" title="ä½œç”¨åŸŸ"></a>ä½œç”¨åŸŸ</h3><p>ä¼—æ‰€å‘¨çŸ¥ JS æ˜¯è¯æ³•ä½œç”¨åŸŸ, è€Œè¯æ³•ä½œç”¨åŸŸåˆ™å†³å®šäº†ä»£ç <strong>åœ¨ä¹¦å†™çš„æ—¶å€™å°±ä¼šç¡®å®šå¦‚ä½•æŸ¥æ‰¾å˜é‡</strong>. é‚£ä¹ˆå†å›åˆ° JS çš„ç¼–è¯‘è¿‡ç¨‹ä¸­, <strong>ä½œç”¨åŸŸæ˜¯åœ¨è¯æ³•åˆ†æé˜¶æ®µç¡®å®š</strong>, æ¢è€Œè¨€ä¹‹: ä½ å¦‚ä½•ä¹¦å†™ä»£ç å°±å†³å®šäº†å½“å‰ä»£ç å—å¯¹å˜é‡æˆ–å…¶ä»–èµ„æºçš„è®¿é—®æƒé™, è€ŒæŸ¥æ‰¾å˜é‡ä¹Ÿæ˜¯æ ¹æ®å®šä¹‰çš„ä½ç½®å‘ä¸ŠæŸ¥æ‰¾.</p><p>ä¸¾ä¸ªğŸŒ°<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// è¿™é‡Œæ˜¯çˆ¶çº§ window</span></span><br><span class="line"><span class="keyword">var</span> a = <span class="number">2</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> foo = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œæ˜¯å­çº§ 1</span></span><br><span class="line">  <span class="built_in">console</span>.log(a)</span><br><span class="line">&#125; </span><br><span class="line"><span class="keyword">const</span> bar = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="comment">// è¿™é‡Œæ˜¯å­çº§ 2</span></span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">3</span></span><br><span class="line">  foo()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">bar() <span class="comment">// è¾“å‡º 2</span></span><br></pre></td></tr></table></figure></p><p>ä»è¾“å‡ºç»“æœæ¥çœ‹æ‰“å°çš„æ˜¯ 2 è€Œä¸æ˜¯ 3. æˆ‘ä»¬ç»“åˆè¯æ³•ä½œç”¨åŸŸæ¥åˆ†æ, <code>foo</code> æ–¹æ³•çš„çˆ¶çº§æ˜¯ <code>window</code> è€Œä¸æ˜¯ <code>bar</code>. æ‰€ä»¥å½“æˆ‘ä»¬åœ¨ <code>foo</code> æ–¹æ³•ä¸­æŸ¥æ‰¾ a å˜é‡æ—¶, åœ¨å½“å‰ä½œç”¨åŸŸä¸­æ²¡æ‰¾åˆ°, å°±ä¼šç»§ç»­å‘ä¸ŠæŸ¥æ‰¾ä»è€Œåœ¨çˆ¶çº§ <code>window</code> ä¸­æ‰¾åˆ°äº† <code>var a = 2</code>. ç”±æ­¤å¯ä»¥çœ‹å‡ºæˆ‘ä»¬æŸ¥æ‰¾å˜é‡æ—¶, ä¸å‡½æ•°åœ¨ä½•å¤„è°ƒç”¨çš„æ— å…³, è€Œæ˜¯è·Ÿå®šä¹‰ä½ç½®æœ‰å…³</p><p>åŒæ—¶ä½œç”¨åŸŸä¹Ÿæ˜¯ä¸€ä¸ªåˆ†å±‚å’Œç‹¬ç«‹çš„åŒºåŸŸ, åˆ†å±‚è¡¨ç¤º: å†…éƒ¨ä½œç”¨åŸŸå¯ä»¥è®¿é—®å¤–éƒ¨ä½œç”¨åŸŸçš„å˜é‡; ç‹¬ç«‹è¡¨ç¤º: å¯ä»¥ä¿è¯å˜é‡ä¸å¯¹å¤–æš´éœ². åŒæ ·ä¹Ÿä¸¾ä¸ªğŸŒ°æ¥è¯´:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">var</span> a = <span class="number">3</span></span><br><span class="line">  <span class="keyword">const</span> inner = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// å†…éƒ¨ä½œç”¨åŸŸ inner å¯ä»¥è®¿é—®åˆ°çˆ¶çº§ wrapper çš„å˜é‡ a</span></span><br><span class="line">    <span class="built_in">console</span>.log(a)</span><br><span class="line">  &#125;</span><br><span class="line"></span><br><span class="line">  inner() <span class="comment">// è¾“å‡º: 3</span></span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…¨å±€ä½œç”¨åŸŸåˆ™è®¿é—®ä¸åˆ°å†…éƒ¨ä½œç”¨åŸŸ wrapper ä¸­çš„å˜é‡</span></span><br><span class="line"><span class="built_in">console</span>.log(a) <span class="comment">// Error: a is not defined</span></span><br></pre></td></tr></table></figure><h3 id="ä½œç”¨åŸŸé“¾"><a href="#ä½œç”¨åŸŸé“¾" class="headerlink" title="ä½œç”¨åŸŸé“¾"></a>ä½œç”¨åŸŸé“¾</h3><p>åˆšåˆšæåˆ°äº†å½“æˆ‘ä»¬åœ¨æŸ¥æ‰¾å˜é‡æ—¶, å¦‚æœåœ¨å½“å‰ä½œç”¨åŸŸä¸­æ²¡æœ‰æ‰¾åˆ°, ä¼šç»§ç»­å‘ä¸Šåœ¨çˆ¶çº§ä½œç”¨åŸŸä¸­å»æ‰¾. é‚£ä¹ˆå½“å‰ä½œç”¨åŸŸæ€ä¹ˆçŸ¥é“æˆ‘æœ‰å“ªäº›çˆ¶çº§ä½œç”¨åŸŸå‘¢?</p><p>è¿™æ˜¯å› ä¸ºå‡½æ•°ä¸­æœ‰ä¸€ä¸ªç§æœ‰å±æ€§<code>[[scope]]</code>, å½“å‡½æ•°åœ¨åˆ›å»ºçš„æ—¶å€™(é¢„è§£æé˜¶æ®µ), ä¼šä¿å­˜çˆ¶çº§çš„æ‰€æœ‰å˜é‡å¯¹è±¡æŒ‡é’ˆåˆ°<code>[[scope]]</code> å±æ€§ä¸­<em>æ³¨: å‡½æ•°çš„ <code>[[scope]]</code> å±æ€§å¹¶ä¸æ˜¯ä½œç”¨åŸŸé“¾</em>, be like:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> wrapper = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">  <span class="keyword">const</span> inner = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// ...</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å½“å‡½æ•°åˆ›å»ºæ—¶:</span></span><br><span class="line">wrapper.[[scope]] = [</span><br><span class="line">  gobalContext.VO</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line">inner.[[scope]] = [</span><br><span class="line">  wrapperContext.AO</span><br><span class="line">  gobalContext.VO</span><br><span class="line">]</span><br></pre></td></tr></table></figure><p>åç»­æ‰§è¡Œ wrapper å‡½æ•°åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡æ—¶(é¢„ç¼–è¯‘é˜¶æ®µ), è¿›å…¥å‡½æ•°ä¸Šä¸‹æ–‡å¹¶åˆ›å»º VO/AO, å°±ä¼šå°†æ´»åŠ¨å¯¹è±¡æ·»åŠ åˆ°ä½œç”¨åŸŸé¡¶ç«¯<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">wrapperContext = &#123;</span><br><span class="line">  AO: &#123;&#125;, <span class="comment">// æ´»åŠ¨å¯¹è±¡: wrapper å‡½æ•°çš„å‚æ•°ä»¥åŠå˜é‡</span></span><br><span class="line">  Scope: [AO, wrapper.[[scope]]] <span class="comment">// !!! è¿™æ‰æ˜¯ä½œç”¨åŸŸé“¾</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><blockquote><p>å…³äº <code>[[scope]]</code> å’Œæ‰§è¡Œä¸Šä¸‹æ–‡ä¸­ <code>Scope</code> çš„ç†è§£:<br>å½“ä½ å®šä¹‰(ä¹¦å†™)ä¸€ä¸ªå‡½æ•°æ—¶, JS å¼•æ“å¯ä»¥æ ¹æ®ä½ ä¹¦å†™çš„ä½ç½®: å‡½æ•°åµŒå¥—çš„ä½ç½®, ç”Ÿæˆä¸€ä¸ª[[scope]] å±æ€§, è¿™ä¸ªå±æ€§æ˜¯å±äºå‡½æ•°çš„(å³ä½¿å‡½æ•°ä¸è°ƒç”¨), æ‰€ä»¥è¯´åŸºäºè¯æ³•ä½œç”¨åŸŸ(é™æ€çš„)<br>è€Œ Scope å±æ€§æ˜¯åœ¨å‡½æ•°æ‰§è¡Œæ—¶, ç”Ÿæˆæ‰§è¡Œä¸Šä¸‹æ–‡(VO/Scope/this), è¿™ä¸ªæ˜¯æ—¶å€™çš„ Scope å’Œ [[scope]] ä¸æ˜¯åŒä¸€ä¸ªä¸œè¥¿. Scope æ˜¯åœ¨ [[scope]] çš„åŸºç¡€ä¸Šæ–°å¢äº†å½“å‰çš„ AO å¯¹è±¡æ¥æ„æˆ<br>æ‰€ä»¥å‡½æ•°å®šä¹‰æ—¶çš„[[scope]]æ˜¯å‡½æ•°çš„å±æ€§, å‡½æ•°æ‰§è¡Œæ—¶çš„ Scope æ˜¯æ‰§è¡Œä¸Šä¸‹æ–‡çš„å±æ€§</p></blockquote><h3 id="æ‰§è¡Œä¸Šä¸‹æ–‡"><a href="#æ‰§è¡Œä¸Šä¸‹æ–‡" class="headerlink" title="æ‰§è¡Œä¸Šä¸‹æ–‡"></a>æ‰§è¡Œä¸Šä¸‹æ–‡</h3><p>å‰é¢æˆ‘ä»¬æåˆ° VO/AO è¿™ä¸¤ä¸ªä¸œè¥¿, ä¹‹å‰æˆ‘ä»¬ä¸€ç›´åœ¨è¯´ä½œç”¨åŸŸå’Œä½œç”¨åŸŸé“¾æ˜¯æ€ä¹ˆæ¥çš„, ä½†è¿˜æ²¡æåˆ°é‡Œé¢çš„å˜é‡æ˜¯å¦‚ä½•å¡«å……è¿›å»ä¾›è®¿é—®æ—¶ä½¿ç”¨çš„. ä¸‹é¢æˆ‘ä»¬å°±æ¥èŠèŠå˜é‡æ˜¯å¦‚ä½•ä¿å­˜å’Œå¡«å……çš„</p><p>åœ¨ JS ç¼–è¯‘è¿‡ç¨‹ä¸­æœ‰æåˆ°ä¸€ä¸ªå«é¢„ç¼–è¯‘çš„é˜¶æ®µ, åœ¨è¿™ä¸ªé˜¶æ®µä¸­ JS ä¼šå¯¹å¯æ‰§è¡Œä»£ç è¿›è¡Œä¸€ä¸ª â€œå‡†å¤‡å·¥ä½œâ€ ä¹Ÿå°±æ˜¯<code>æ‰§è¡Œä¸Šä¸‹æ–‡</code>, ä¹‹åè¿è¡Œçš„ä»£ç éƒ½æ˜¯åœ¨æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­è¿è¡Œ. å®ƒä¸€å…±æœ‰ä¸‰ç§ç±»å‹: å…¨å±€ä¸Šä¸‹æ–‡/å‡½æ•°ä¸Šä¸‹æ–‡/eval ä¸Šä¸‹æ–‡</p><p>å¯¹äºæ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡, éƒ½æœ‰ä¸‰ä¸ªé‡è¦çš„å±æ€§:</p><ul><li>å˜é‡å¯¹è±¡(VO): å‚¨å­˜ä¸Šä¸‹æ–‡ä¸­å®šä¹‰çš„å˜é‡å’Œå‡½æ•°å£°æ˜</li><li>ä½œç”¨åŸŸé“¾</li><li>this</li></ul><p><strong>å˜é‡å¯¹è±¡/æ´»åŠ¨å¯¹è±¡</strong></p><ul><li><p>å…¨å±€ä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å¯¹è±¡(VO)å…¶å®å°±æ˜¯å…¨å±€å¯¹è±¡</p></li><li><p>å¯¹äºå‡½æ•°ä¸Šä¸‹æ–‡æ¥è¯´, æˆ‘ä»¬ç”¨æ´»åŠ¨å¯¹è±¡(AO: activation object)æ¥è¡¨ç¤ºå˜é‡å¯¹è±¡</p></li></ul><p>å°æ€»ç»“ä¸€ä¸‹: æ´»åŠ¨å¯¹è±¡å’Œå˜é‡å¯¹è±¡å…¶å®æ˜¯ä¸€ä¸ªä¸œè¥¿, åªæ˜¯å˜é‡å¯¹è±¡æ˜¯åœ¨å¼•æ“ä¸Šå®ç°çš„ä¸å¯ä»¥åœ¨ JS ç¯å¢ƒä¸­è¢«è®¿é—®. åªæœ‰å½“è¿›å…¥ä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡æ—¶, è¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡æ‰ä¼šè¢«æ¿€æ´», è€Œåªæœ‰è¢«æ¿€æ´»çš„å˜é‡å¯¹è±¡æ—¶, ä¹Ÿå°±æ˜¯æ´»åŠ¨å¯¹è±¡ä¸Šçš„å±æ€§æ‰èƒ½è¢«æˆ‘ä»¬è®¿é—®</p><p><strong>å¡«å……è¿‡ç¨‹</strong><br>æ‰§è¡Œä¸Šä¸‹æ–‡ä¼šè¢«åˆ†ä¸ºä¸¤ä¸ªé˜¶æ®µå¤„ç†:</p><ol><li>åˆ›å»ºæ‰§è¡Œä¸Šä¸‹æ–‡:<br>æ­¤æ—¶å˜é‡å¯¹è±¡ä¼šåŒ…æ‹¬<ol><li>å‡½æ•°å½¢å‚(å¦‚æœæ˜¯å‡½æ•°ä¸Šä¸‹æ–‡çš„è¯)<ul><li>key: å½¢å‚åç§°</li><li>value: å®å‚çš„å€¼(æ²¡æœ‰å°±æ˜¯ undefined)</li></ul></li><li>å‡½æ•°å£°æ˜<ul><li>key: å‡½æ•°åç§° (ä¼šè¦†ç›–åŒåçš„å‡½æ•°å£°æ˜)</li><li>value: å‡½æ•°å¯¹è±¡</li></ul></li><li>å˜é‡å£°æ˜ (ä¼šè¦†ç›–åŒåçš„å‡½æ•°å£°æ˜æˆ–å‚æ•°ä¼šå¿½ç•¥)<ul><li>key: å˜é‡åç§°</li><li>value: undefined<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">a</span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> b = <span class="number">2</span>;</span><br><span class="line">  <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">  <span class="keyword">var</span> d = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;&#125;;</span><br><span class="line"></span><br><span class="line">  b = <span class="number">3</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">foo(<span class="number">1</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ­¤æ—¶ AO ä¸º</span></span><br><span class="line">AO = &#123;</span><br><span class="line">  <span class="built_in">arguments</span>: &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="number">1</span>,</span><br><span class="line">    length: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="literal">undefined</span>,</span><br><span class="line">  c: reference to <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">  d: <span class="literal">undefined</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol></li></ol><blockquote><p>åˆ›å»ºå®Œå˜é‡å¯¹è±¡å, å°±ä¼šåˆ›å»ºä½œç”¨åŸŸé“¾æŠŠ AO æ·»åŠ åˆ°ä½œç”¨åŸŸé“¾å‰ç«¯. åŒæ—¶ This çš„æ‰§è¡Œä¹Ÿä¼šåœ¨åˆ›å»ºé˜¶æ®µç¡®å®š</p></blockquote><ol start="2"><li>æ‰§è¡Œé˜¶æ®µ: æ ¹æ®ä»£ç ä¿®æ”¹å˜é‡å¯¹è±¡ä¸­çš„å€¼<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ­¤æ—¶ AO æ›´æ–°ä¸º</span></span><br><span class="line">AO = &#123;</span><br><span class="line">  <span class="built_in">arguments</span>: &#123;</span><br><span class="line">    <span class="number">0</span>: <span class="number">1</span>,</span><br><span class="line">    length: <span class="number">1</span></span><br><span class="line">  &#125;,</span><br><span class="line">  a: <span class="number">1</span>,</span><br><span class="line">  b: <span class="number">3</span>,</span><br><span class="line">  c: reference to <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span>&#123;&#125;,</span><br><span class="line">  d: reference to FunctionExpression <span class="string">"d"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol><p>è€Œæˆ‘ä»¬ç†ŸçŸ¥çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆå°±æ˜¯ç”¨æ¥ç®¡ç†å¤šä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡çš„, å½“ JS å¼€å§‹è¦æ‰§è¡Œä»£ç æ—¶, é¦–å…ˆé‡åˆ°çš„å°±æ˜¯å…¨å±€ä»£ç , æ‰€ä»¥åˆå§‹åŒ–çš„æ—¶å€™ä¼šå…ˆå‘æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆä¸­å‹å…¥ä¸€ä¸ªå…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡, ç›´åˆ°æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œä¹‹å‰æ ˆåº•å§‹ç»ˆéƒ½ä¼šæœ‰ä¸€ä¸ª<code>globalContext</code>. æˆ‘ä»¬æ¥æ¨¡æ‹Ÿä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡æ ˆçš„è¡Œä¸ºå¢å¼ºç†è§£:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å§‹æ‰§è¡Œ</span></span><br><span class="line">ECStack = [</span><br><span class="line">  globalContext</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// é‡åˆ°è¿™æ®µä»£ç </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun3</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="built_in">console</span>.log(<span class="string">'fun3'</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun2</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fun3();</span><br><span class="line">&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">fun1</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">  fun2();</span><br><span class="line">&#125;</span><br><span class="line">fun1();</span><br><span class="line"></span><br><span class="line"><span class="comment">// é¦–å…ˆæ‰§è¡Œ fun1</span></span><br><span class="line">ECStack.push(fun1) <span class="comment">// fucntionContext</span></span><br><span class="line"><span class="comment">// fun1 ä¸­è°ƒç”¨äº† fun2, åˆ›å»º func2 çš„æ‰§è¡Œä¸Šä¸‹æ–‡</span></span><br><span class="line">ECStack.push(fun2) <span class="comment">// fucntionContext</span></span><br><span class="line"><span class="comment">// fun2 ä¸­è°ƒç”¨äº† fun3, åˆ›å»º func3 çš„æ‰§è¡Œä¸Šä¸‹æ–‡</span></span><br><span class="line">ECStack.push(fun3) <span class="comment">// fucntionContext</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// fun3æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">ECStack.pop()</span><br><span class="line"><span class="comment">// fun2æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">ECStack.pop()</span><br><span class="line"><span class="comment">// fun3æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">ECStack.pop()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰€æœ‰ä»£ç æ‰§è¡Œå®Œæ¯•</span></span><br><span class="line">ECStack.pop() <span class="comment">// å¼¹å‡º globalContext</span></span><br></pre></td></tr></table></figure><h3 id="æœ‰ç‚¹æ‡µé€¼-æ‹ä¸€æ‹-ç”¨-ES3"><a href="#æœ‰ç‚¹æ‡µé€¼-æ‹ä¸€æ‹-ç”¨-ES3" class="headerlink" title="æœ‰ç‚¹æ‡µé€¼, æ‹ä¸€æ‹(ç”¨ ES3)"></a>æœ‰ç‚¹æ‡µé€¼, æ‹ä¸€æ‹(ç”¨ ES3)</h3><p>ä»¥ä¸‹é¢çš„ä¾‹å­ä¸ºä¾‹, ä»åˆ›å»ºå‡½æ•°ä½œç”¨åŸŸåˆ°å˜é‡å¯¹è±¡å¡«å……çš„å…¨è¿‡ç¨‹</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> global = <span class="string">'global scope'</span></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">localfunction</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">  <span class="keyword">var</span> local = <span class="string">'local scope'</span></span><br><span class="line">  <span class="keyword">return</span> local</span><br><span class="line">&#125;</span><br><span class="line">localfunction()</span><br></pre></td></tr></table></figure><ol><li><p>è¯æ³•åˆ†æé˜¶æ®µ: åˆ›å»ºå‡½æ•°ä½œç”¨åŸŸ, æ³¨æ„åˆ›å»ºå‡½æ•°ä½œç”¨åŸŸæ—¶, æ˜¯è¯æ³•ä½œç”¨åŸŸ!!!</p></li><li><p>åˆ›å»ºå‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆå§‹åŒ– globalContext çš„æ—¶å€™å°±ä¼šåˆ›å»ºå‡½æ•°</span></span><br><span class="line"><span class="comment">// ä¿å­˜çˆ¶çº§å˜é‡å¯¹è±¡çš„å¼•ç”¨åˆ°, å‡½æ•°çš„ [[scope]] å±æ€§</span></span><br><span class="line">localfunction.[[scope]] = [</span><br><span class="line">  globalContext.VO</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li><li><p>é¢„ç¼–è¯‘é˜¶æ®µ: åˆ›å»ºå‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶å‹å…¥æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ›å»ºçš„ lcoalContext å‹å…¥ local æ‰§è¡Œä¸Šä¸‹æ–‡</span></span><br><span class="line">ECStack = [</span><br><span class="line">  lcoalContext,</span><br><span class="line">  globalContext</span><br><span class="line">]</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤åˆ¶[[scope]] åˆå§‹åŒ–ä½œç”¨åŸŸé“¾</span></span><br><span class="line">lcoalContext = &#123;</span><br><span class="line">  Scope: localfunction.[[scope]]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ›å»ºæ´»åŠ¨å¯¹è±¡, åˆå§‹åŒ– Arguments å¯¹è±¡</span></span><br><span class="line">lcoalContext = &#123;</span><br><span class="line">  AO: &#123;</span><br><span class="line">    <span class="built_in">arguments</span>: &#123;</span><br><span class="line">      length: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    local: <span class="literal">undefined</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  Scope: localfunction.[[scope]]</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å°†æ´»åŠ¨å¯¹è±¡å‹å…¥ lcoal ä½œç”¨åŸŸé“¾é¡¶ç«¯</span></span><br><span class="line">lcoalContext = &#123;</span><br><span class="line">  AO: &#123;</span><br><span class="line">    <span class="built_in">arguments</span>: &#123;</span><br><span class="line">      length: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    local: <span class="literal">undefined</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  Scope: [AO, localfunction.[[scope]]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>å‡†å¤‡å·¥ä½œå®Œæˆ, æ‰§è¡Œä»£ç </p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼€å§‹æ‰§è¡Œå‡½æ•°, ä¿®æ”¹ AO å±æ€§å€¼</span></span><br><span class="line">lcoalContext = &#123;</span><br><span class="line">  AO: &#123;</span><br><span class="line">    <span class="built_in">arguments</span>: &#123;</span><br><span class="line">      length: <span class="number">0</span></span><br><span class="line">    &#125;,</span><br><span class="line">    local: <span class="string">'local scope'</span>,</span><br><span class="line">  &#125;,</span><br><span class="line">  Scope: [AO, localfunction.[[scope]]]</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>ä»£ç æ‰§è¡Œå®Œæ¯•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¼¹å‡º localContext</span></span><br><span class="line">ECStack.pop()</span><br><span class="line"></span><br><span class="line">ECStack = [</span><br><span class="line">  globalContext</span><br><span class="line">]</span><br></pre></td></tr></table></figure></li></ol><h4 id="ES6-æ‰§è¡Œä¸Šä¸‹æ–‡-è¡¥å……"><a href="#ES6-æ‰§è¡Œä¸Šä¸‹æ–‡-è¡¥å……" class="headerlink" title="ES6 æ‰§è¡Œä¸Šä¸‹æ–‡(è¡¥å……)"></a>ES6 æ‰§è¡Œä¸Šä¸‹æ–‡(è¡¥å……)</h4><p>åœ¨ ES6 è§„èŒƒä¸­å»é™¤äº†, ä¸Šé¢ ES3 ç‰ˆæœ¬ä¸­çš„å˜é‡å¯¹è±¡/æ´»åŠ¨å¯¹è±¡, æ¢æˆäº†<code>è¯æ³•ç¯å¢ƒç»„ä»¶</code>(LexicalEnvironment component)å’Œ<code>å˜é‡ç¯å¢ƒç»„ä»¶</code>(VariableEnvironment component)æ›¿ä»£</p><p>åŒæ ·åˆ†ä¸¤ä¸ªé˜¶æ®µ:</p><ul><li><p>åˆ›å»ºé˜¶æ®µ</p><ol><li>ç¡®å®š this çš„å€¼, ä¹Ÿå°±æ˜¯ This Binding(å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡æŒ‡å‘å…¨å±€å¯¹è±¡; å‡½æ•°ä¸Šä¸‹æ–‡å–å†³äºå‡½æ•°å¦‚ä½•è¢«è°ƒç”¨)</li><li><p>åˆ›å»º<code>è¯æ³•ç¯å¢ƒç»„ä»¶</code>, æœ‰ä¸¤ç§ç±»å‹: <code>å…¨å±€ç¯å¢ƒ</code>/<code>å‡½æ•°ç¯å¢ƒ</code>. è¯æ³•ç¯å¢ƒå†…éƒ¨æœ‰ä¸¤ä¸ªç»„ä»¶: <code>ç¯å¢ƒè®°å½•å™¨</code>å’Œ<code>å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨</code>. å…¶ä¸­ç¯å¢ƒè®°å½•å™¨ä¹Ÿæœ‰ä¸¤ç§ç±»å‹: <code>å¯¹è±¡ç¯å¢ƒè®°å½•å™¨</code>ç”¨æ¥å®šä¹‰å…¨å±€ç¯å¢ƒä¸­çš„å˜é‡å’Œå‡½æ•°; <code>å£°æ˜å¼ç¯å¢ƒè®°å½•å™¨</code>ç”¨æ¥å‚¨å­˜å‡½æ•°ç¯å¢ƒä¸­çš„å˜é‡ã€å‡½æ•°å’Œå‚æ•°</p><ul><li>å…¨å±€ç¯å¢ƒ: å¯¹è±¡ç¯å¢ƒè®°å½•å™¨ä¸­åŒ…å«æ‰€æœ‰å…¨å±€å¯¹è±¡, å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨ä¸º null</li><li>å‡½æ•°ç¯å¢ƒ: å£°æ˜å¼ç¯å¢ƒè®°å½•å™¨å‚¨å­˜æœ¬åœ°å˜é‡ã€å‡½æ•°å’Œå‚æ•°, å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨åŒ…å«çˆ¶çº§è¯æ³•ç¯å¢ƒ(ç±»ä¼¼ ES3 çš„ä½œç”¨åŸŸé“¾)<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">//Â å…¨å±€æ‰§è¡Œä¸Šä¸‹æ–‡</span></span><br><span class="line">GlobalExectionContext = &#123;</span><br><span class="line">  <span class="comment">//Â è¯æ³•ç¯å¢ƒ</span></span><br><span class="line">  LexicalEnvironment: &#123;</span><br><span class="line">    <span class="comment">//ç¯å¢ƒè®°å½•å™¨</span></span><br><span class="line">    EnvironmentRecord: &#123;</span><br><span class="line">      Type: <span class="string">'Object'</span>, <span class="comment">// å¯¹è±¡ç¯å¢ƒè®°å½•å™¨</span></span><br><span class="line">      <span class="comment">//Â å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨</span></span><br><span class="line">      outer: <span class="string">'&lt;null&gt;'</span> <span class="comment">// è¿™é‡Œå¹¶ä¸æ˜¯å­—ç¬¦ä¸², åªæ˜¯ä¸ºäº†è®©ä»£ç è¯†åˆ«ğŸ˜‚</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">//Â å‡½æ•°æ‰§è¡Œä¸Šä¸‹æ–‡</span></span><br><span class="line">FunctionExectionContextÂ  = &#123;</span><br><span class="line">  <span class="comment">//Â è¯æ³•ç¯å¢ƒ</span></span><br><span class="line">  LexicalEnvironment: &#123;</span><br><span class="line">    <span class="comment">//ç¯å¢ƒè®°å½•å™¨</span></span><br><span class="line">    EnvironmentRecord: &#123;</span><br><span class="line">      Type: <span class="string">'Declarative'</span>, <span class="comment">// å£°æ˜å¼ç¯å¢ƒè®°å½•å™¨</span></span><br><span class="line">      <span class="comment">//Â å¯¹å¤–éƒ¨ç¯å¢ƒçš„å¼•ç”¨</span></span><br><span class="line">      outer: <span class="string">'&lt;GlobalÂ orÂ outerÂ functionÂ environmentÂ reference&gt;'</span></span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li><li><p>åˆ›å»º<code>å˜é‡ç¯å¢ƒç»„ä»¶</code>: å…¶å®ä¹Ÿæ˜¯ä¸€ç§è¯æ³•ç¯å¢ƒ, æ‰€ä»¥å®ƒä¹Ÿæ‹¥æœ‰è¯æ³•ç¯å¢ƒçš„æ‰€æœ‰å±æ€§. è¯æ³•ç¯å¢ƒå’Œå˜é‡ç¯å¢ƒçš„åŒºåˆ«: </p><ul><li>è¯æ³•ç¯å¢ƒ: å‚¨å­˜å‡½æ•°å£°æ˜å’Œ <code>let</code>/<code>const</code> å…³é”®å­—å£°æ˜çš„å˜é‡, åœ¨å‡½æ•°çº§ä½œç”¨åŸŸçš„åŸºç¡€ä¸Šå®ç°äº†å—çº§ä½œç”¨åŸŸ</li><li>å˜é‡ç¯å¢ƒ: å‚¨å­˜ <code>var</code> å…³é”®å­—å£°æ˜çš„å˜é‡, å®ç°äº†å‡½æ•°çº§ä½œç”¨åŸŸ<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šè¿‡ä¾‹å­æ¥çœ‹</span></span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span></span><br><span class="line"><span class="keyword">const</span> b = <span class="number">2</span></span><br><span class="line"><span class="keyword">var</span> c</span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span>(<span class="params">e, f</span>) </span>&#123;  </span><br><span class="line">  <span class="keyword">var</span> g = <span class="number">3</span>;  </span><br><span class="line">  <span class="keyword">return</span> e + f + g;  </span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">c = foo(<span class="number">3</span>, <span class="number">4</span>);</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ‰§è¡Œä¸Šä¸‹æ–‡çš„ä¼ªä»£ç :</span></span><br><span class="line">GlobalExectionContext = &#123;</span><br><span class="line">  ThisBinding: <span class="string">'&lt;Global Object&gt;'</span>,</span><br><span class="line">  LexicalEnvironment: &#123; <span class="comment">// å‚¨å­˜å‡½æ•°å£°æ˜å’Œ let/const çš„å˜é‡</span></span><br><span class="line">    EnvironmentRecord: &#123;</span><br><span class="line">      Type: <span class="string">'Object'</span>, <span class="comment">// å¯¹è±¡ç¯å¢ƒè®°å½•å™¨</span></span><br><span class="line">      a: <span class="string">'&lt; uninitialized &gt;'</span>, <span class="comment">// æ³¨æ„âš ï¸: è¿™é‡Œå¹¶æ²¡æœ‰åƒ ES3 ä¸€æ ·åˆå§‹åŒ–æˆ undefined</span></span><br><span class="line">      b: <span class="string">'&lt; uninitialized &gt;'</span>,</span><br><span class="line">      foo: <span class="string">'&lt; func &gt;'</span></span><br><span class="line">    &#125;</span><br><span class="line">    outer: <span class="string">'&lt;null&gt;'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">  VariableEnvironment: &#123; <span class="comment">// var çš„å˜é‡</span></span><br><span class="line">    EnvironmentRecord: &#123;</span><br><span class="line">      Type: <span class="string">'Object'</span>,</span><br><span class="line">      c: <span class="literal">undefined</span>, <span class="comment">// åˆå§‹åŒ–æˆäº† undefined</span></span><br><span class="line">    &#125;</span><br><span class="line">    outer: <span class="string">'&lt;null&gt;'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">FunctionExectionContext = &#123;</span><br><span class="line">  ThisBinding: <span class="string">'&lt;Global Object&gt;'</span>,</span><br><span class="line"></span><br><span class="line">  LexicalEnvironment: &#123;</span><br><span class="line">    EnvironmentRecord: &#123;</span><br><span class="line">      Type: <span class="string">'Declarative'</span>, <span class="comment">// å£°æ˜å¼ç¯å¢ƒè®°å½•å™¨</span></span><br><span class="line">      Arguments: &#123;<span class="number">0</span>: <span class="number">3</span>, <span class="number">1</span>: <span class="number">4</span>, <span class="attr">length</span>: <span class="number">2</span>&#125;,</span><br><span class="line">    &#125;,</span><br><span class="line">    outer: <span class="string">'&lt;GlobalLexicalEnvironment&gt;'</span></span><br><span class="line">  &#125;,</span><br><span class="line"></span><br><span class="line">VariableEnvironment: &#123;</span><br><span class="line">    EnvironmentRecord: &#123;</span><br><span class="line">      Type: <span class="string">'Declarative'</span>,</span><br><span class="line">      g: <span class="literal">undefined</span></span><br><span class="line">    &#125;,</span><br><span class="line">    outer: <span class="string">'&lt;GlobalLexicalEnvironment&gt;'</span></span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul></li></ol></li></ul><blockquote><p>å¯ä»¥çœ‹å‡º ES6 ä¸­, var å’Œ let/const èƒ½å¤Ÿå…±å­˜ä¹Ÿæ˜¯å› ä¸ºè¯æ³•ç¯å¢ƒå’Œå˜é‡ç¯å¢ƒçš„åŒºåˆ†. å‘ç”Ÿå˜é‡æå‡ä¹Ÿæ˜¯å› ä¸ºå˜é‡ç¯å¢ƒä¸­åˆå§‹åŒ–å˜é‡èµ‹å€¼æˆäº† undefined, è€Œè¯æ³•ç¯å¢ƒä¸­çš„å˜é‡åˆ™ä¿æŒäº†æœªåˆå§‹åŒ–.</p></blockquote><ul><li>æ‰§è¡Œé˜¶æ®µ: ä»£ç æ‰§è¡Œ, let/const å£°æ˜çš„å˜é‡æ²¡æœ‰æ‰¾åˆ°å€¼çš„è¯æ‰ä¼šèµ‹å€¼ä¸º undefined</li></ul><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><ul><li>ä½œç”¨åŸŸ: å†³å®šäº†ä»£ç å—ä¸­å¦‚ä½•è®¿é—®å˜é‡æˆ–å…¶ä»–èµ„æº, åœ¨åœ¨è¯æ³•åˆ†ææ—¶å°±ç¡®å®šäº†</li><li>æ‰§è¡Œä¸Šä¸‹æ–‡: ç”¨æ¥è¯„ä¼°ä»£ç ç¯å¢ƒ, åŒ…æ‹¬ä¸‰ä¸ªé‡è¦å±æ€§: å˜é‡å¯¹è±¡/ä½œç”¨åŸŸé“¾/this. ä»£ç æ‰§è¡Œæ—¶æ‰èƒ½ç¡®å®šå…·ä½“å€¼, éšæ—¶å¯èƒ½ä¼šæ”¹å˜</li><li>ä½œç”¨åŸŸé“¾: å†³å®šå¦‚ä½•æŸ¥æ‰¾å˜é‡æˆ–å…¶ä»–èµ„æº, ä¼šå…ˆä»å½“å‰ä½œç”¨åŸŸä¸‹æ‰§è¡Œä¸Šä¸‹æ–‡ä¸­çš„å˜é‡å¯¹è±¡ä¸­æŸ¥æ‰¾å˜é‡, å¦‚æœæ²¡æœ‰æ‰¾åˆ°ä¼šæ²¿ç€<strong>è¯æ³•ä½œç”¨åŸŸçš„çˆ¶çº§</strong>å‘ä¸ŠæŸ¥æ‰¾çˆ¶çº§ä½œç”¨åŸŸä¸‹æ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡ä¸­æŸ¥æ‰¾, ç›´åˆ°å…¨å±€ä½œç”¨åŸŸ. è¿™æ ·ç”±å¤šä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡çš„å˜é‡å¯¹è±¡æ„æˆ</li><li>æ‰§è¡Œä¸Šä¸‹æ–‡æ ˆ: ç”¨æ¥ç®¡ç†å¤šä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡, æ¯å½“é‡åˆ°ä¸€ä¸ªå‡½æ•°è°ƒç”¨éƒ½ä¼šä¸ºå…¶åˆ›å»ºä¸€ä¸ªæ–°çš„æ‰§è¡Œä¸Šä¸‹æ–‡å¹¶å‹å…¥æ ˆä¸­, å‡½æ•°æ‰§è¡Œå®Œæ¯•åå¼¹å‡º</li></ul><h4 id="å‚è€ƒæ–‡ç« "><a href="#å‚è€ƒæ–‡ç« " class="headerlink" title="å‚è€ƒæ–‡ç« "></a>å‚è€ƒæ–‡ç« </h4><p><a href="https://github.com/mqyqingfeng/Blog/issues/6" target="_blank" rel="noopener">JavaScriptæ·±å…¥ä¹‹ä½œç”¨åŸŸé“¾</a></p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å·¥ä½œä¸¤ä¸‰å¹´ä¸­, å¶ç„¶å¬åŒäº‹ä»¬åœ¨è®¨è®ºä½œç”¨åŸŸ balabala.. ä»”ç»†å›æƒ³ä¸€ä¸‹å¥½åƒè‡ªå·±ä¹Ÿä¸å¤ªèƒ½è¯´æ¸…ä»–ä¿©çš„åŒºåˆ«åˆ°åº•æ˜¯å•¥, äºæ˜¯è¿›è¡Œäº†ä¸€æ³¢å›ç‚‰é‡é€ &lt;/p&gt;
&lt;h3 id=&quot;ä»ä¸‡ç‰©ä¹‹æºç¼–è¯‘-JSå¼€å§‹&quot;&gt;&lt;a href=&quot;#ä»ä¸‡ç‰©ä¹‹æºç¼–è¯‘-JSå¼€å§‹&quot; class=&quot;headerlin
      
    
    </summary>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç½‘ç»œæ‘„åƒæœºç›´æ’­</title>
    <link href="https://yoursite.com/2018/05/06/%E7%BD%91%E7%BB%9C%E6%91%84%E5%83%8F%E6%9C%BA%E7%9B%B4%E6%92%AD/"/>
    <id>https://yoursite.com/2018/05/06/ç½‘ç»œæ‘„åƒæœºç›´æ’­/</id>
    <published>2018-05-06T06:49:04.000Z</published>
    <updated>2022-08-23T09:37:40.693Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äºç½‘ç»œæ‘„åƒæœºåšè§†é¢‘é¢„è§ˆè¿™å—, æœ¬èº«å…¶å®æ˜¯éå¸¸é™Œç”Ÿçš„, å½“æ—¶æ¥åˆ°è¿™ä¸ªéœ€æ±‚ä¹Ÿæ˜¯ç›¸å½“çš„å¤´ç–¼(å¯¹äºå½“æ—¶ä¸€å¹´ç»éªŒä¸åˆ°çš„æˆ‘æ¥è¯´).å½“æ—¶æˆ‘ä»¬çš„åº”ç”¨åœºæ™¯æ˜¯: å¤šè·¯ç½‘ç»œæ‘„åƒæœºé€šè¿‡å±€åŸŸç½‘è¿æ¥, PC ç«¯èƒ½å¤Ÿå®æ—¶é¢„è§ˆç›‘æ§ç”»é¢å¹¶ä¸”ç”»è´¨è¾¾åˆ°720p, å»¶è¿Ÿä¸èƒ½è¶…è¿‡10ç§’, å¤šä¸ªæ‘„åƒæœºèƒ½å¤Ÿåˆ‡æ¢æŸ¥çœ‹. ç”±äºåç«¯åªæä¾›ä¸€ä¸ª RTSP çš„ç›´æ’­åè®®, æ‰€ä»¥æ‰€æœ‰çš„æ–¹æ¡ˆéƒ½æ˜¯å›´ç»•ç€ RTSP è¿™ä¸ªå…³é”®è¯.</p><blockquote><p> å½“æ—¶æ—¶é—´å¾ˆèµ¶æ‰€ä»¥è¦è‡ªå·±æ…¢æ…¢ç ”ç©¶æ˜¯ä¸å¯èƒ½äº†, åªèƒ½å»æ‰¾ç°æˆçš„åº“. ç°ç›®å‰ç”¨è¿‡ä¸‰ç§æ–¹æ¡ˆ, éƒ½ä¸å®Œç¾.</p></blockquote><h3 id="æ•´ä½“æ€è·¯"><a href="#æ•´ä½“æ€è·¯" class="headerlink" title="æ•´ä½“æ€è·¯"></a>æ•´ä½“æ€è·¯</h3><p>ç»è¿‡ä¸€æ³¢è°ƒç ”(google)ä¹‹å, çŸ¥é“æµè§ˆå™¨å¯¹ RTSP åè®®å¹¶ä¸å‹å¥½, ä¹Ÿå°±æ˜¯è¯´æˆ‘ä»¬å¿…é¡»è¦è‡ªå·±è½¬ç å†æä¾›ç»™æµè§ˆå™¨ä½¿ç”¨, æ‰¾åˆ°çš„è§£å†³æ€è·¯å¤§æ¦‚æ˜¯:</p><ol><li>è½¬ç : <a href="https://www.ffmpeg.org/" target="_blank" rel="noopener">FFmpeg</a> æ˜¯ä¸€ä¸ªè€ç‰Œçš„è½¬ç å·¥å…·, éå¸¸å¼ºå¤§</li><li>Node.js ç”¨ä½œä¸­è½¬ç«™æ¥æ”¶å®¢æˆ·ç«¯å‘æ¥çš„æ‘„åƒæœºä¿¡æ¯åŠæ§åˆ¶ FFmpeg æ¨æµ</li><li>æœ€ç»ˆå®¢æˆ·ç«¯æ¥æ”¶è§†é¢‘æµ</li></ol><p>ä¸‹é¢æˆ‘è¯•è¿‡çš„ä¸‰ç§æ–¹æ¡ˆ, åŸºæœ¬ç»“æ„éƒ½å¦‚æ­¤åªæ˜¯æ¨æµçš„æ–¹å¼å’Œå®¢æˆ·ç«¯çš„æ¥æ”¶æ–¹å¼æœ‰æ‰€ä¸åŒ.</p><h3 id="å‡†å¤‡"><a href="#å‡†å¤‡" class="headerlink" title="å‡†å¤‡"></a>å‡†å¤‡</h3><p><strong>å®‰è£… FFmpeg è½¬ç å·¥å…·</strong></p><ul><li>window å¹³å°</li></ul><ol><li><a href="http://ffmpeg.zeranoe.com/builds/" target="_blank" rel="noopener">ä¸‹è½½ FFmpeg</a> è§£å‹ååº”è¯¥æ˜¯å·²ç»ç¼–è¯‘å¥½çš„æ–‡ä»¶</li><li>å°†è§£å‹å¥½çš„æ–‡ä»¶æ”¾å…¥ C ç›˜æ ¹ç›®å½•(ä¹Ÿå¯ä»¥è‡ªè¡Œæ”¾å…¥å…¶ä»–ç›˜ç¬¦)ä¸‹é‡å‘½åä¸º ffmpeg(æ–¹ä¾¿ä»¥åæ‰¾)</li><li>è®¾ç½®ç¯å¢ƒå˜é‡, æˆ‘çš„ç”µè„‘ -&gt; å±æ€§ -&gt; é«˜çº§ç³»ç»Ÿè®¾ç½® -&gt; ç¯å¢ƒå˜é‡ -&gt; ç³»ç»Ÿå˜é‡ -&gt; æ–°å¢, è·¯å¾„é€‰æ‹©åˆšåˆš C ç›˜ä¸‹çš„ ffmpegæ–‡ä»¶å¤¹ä¸­çš„ bin æ–‡ä»¶å¤¹</li><li>æ³¨é”€æˆ–é‡å¯ç”µè„‘è®©ç¯å¢ƒå˜é‡ç”Ÿæ•ˆ</li><li>æµ‹è¯•, åœ¨ cmd ä¸­è¾“å…¥ <code>ffmpeg -version</code>,  å¦‚æœå‡ºç°ç‰ˆæœ¬å·ä¹‹ç±»çš„ä¸œè¥¿åˆ™æˆåŠŸ.</li></ol><ul><li>Mac å¹³å°<br>Mac ä¸‹å¯ä»¥ç›´æ¥é€šè¿‡ <code>Homebrew</code> å®‰è£…æœ€ä¸ºç®€å•.</li></ul><ol><li>å®‰è£… <code>Homebrew</code>, åœ¨ç»ˆç«¯ä¸­è¾“å…¥ <code>ruby -e &quot;$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/master/install)&quot;</code></li><li>å®‰è£… FFmpeg, ç›´æ¥åœ¨ç»ˆç«¯ä¸­è¾“å…¥ <code>brew install ffmpeg</code> å³å¯</li><li>æµ‹è¯•, åŒæ ·åœ¨ç»ˆç«¯ä¸­è¾“å…¥ <code>ffmpeg -version</code> æŸ¥çœ‹ç‰ˆæœ¬å·</li></ol><p><strong>å®‰è£… Node.js</strong><br>è¿™ä¸ªå°±ä¸å±•å¼€è¯¦ç»†è¯´äº†, æ¯ä¸ªå‰ç«¯éƒ½æœ‰å§â€¦</p><h3 id="æ–¹æ¡ˆä¸€-img-æ ‡ç­¾"><a href="#æ–¹æ¡ˆä¸€-img-æ ‡ç­¾" class="headerlink" title="æ–¹æ¡ˆä¸€: img æ ‡ç­¾"></a>æ–¹æ¡ˆä¸€: img æ ‡ç­¾</h3><p>å½“æ—¶æƒ³åˆ°çš„ç¬¬ä¸€ç§æ–¹æ¡ˆä¹Ÿæ˜¯æœ€ç®€å•çš„æ–¹æ¡ˆ, æ˜¯å°†è§†é¢‘æµçš„æ¯ä¸€å¸§è½¬åŒ–ä¸º base64 å†é€šè¿‡åŠ¨æ€æ›¿æ¢ <code>&lt;img&gt;</code> çš„ src å±æ€§æ¥è¾¾åˆ°é¢„è§ˆçš„æ•ˆæœ.ä¸­é—´ç”¨åˆ°äº†<a href="https://github.com/agsh/rtsp-ffmpeg" target="_blank" rel="noopener">rtsp-ffmpeg</a>, è¿™ä¸ªåº“çš„æ€è·¯æ˜¯é€šè¿‡ websocket å‘é€æ¯ä¸€å¸§è§†é¢‘çš„ bytes åˆ°å®¢æˆ·ç«¯, å®¢æˆ·ç«¯å¯ä»¥é€šè¿‡ <code>&lt;img&gt;</code> æ ‡ç­¾æ¥å±•ç¤º.</p><p><strong>ç¤ºä¾‹:</strong></p><p>node ç«¯<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)()</span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app)</span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(server)</span><br><span class="line"><span class="keyword">const</span> rtsp = <span class="built_in">require</span>(<span class="string">'rtsp-ffmpeg'</span>)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8081</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'server listening on 8081'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// uri ä»¥æµ·åº·æ‘„åƒæœºçš„ rtsp åè®®ä¸ºä¾‹</span></span><br><span class="line"><span class="keyword">let</span> uri = <span class="string">'rtps://admin:password@ip:port/h264/ch1/sub/av_stream'</span></span><br><span class="line"><span class="keyword">let</span> stream = <span class="keyword">new</span> rtsp.FFMpeg(&#123;</span><br><span class="line">    input: uri,</span><br><span class="line">    resolution: <span class="string">'1080x720'</span>,</span><br><span class="line">    quality: <span class="number">3</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">stream.on(<span class="string">'start'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'stream'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">stream.on(<span class="string">'stop'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'stream stopped'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> pipeStream = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        socket.emit(<span class="string">'data'</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line">    stream.on(<span class="string">'data'</span>, pipeStream)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ‡æ¢æ‘„åƒæœº</span></span><br><span class="line">    socket.on(<span class="string">'URI'</span>, data =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        uri = <span class="string">`rtsp://<span class="subst">$&#123;data.userName&#125;</span>:<span class="subst">$&#123;data.passWord&#125;</span>@<span class="subst">$&#123;data.ip&#125;</span>:<span class="subst">$&#123;data.port&#125;</span>/h264/ch1/sub/av_stream`</span></span><br><span class="line">        stream.input = uri</span><br><span class="line"></span><br><span class="line">        <span class="comment">// é‡å¯</span></span><br><span class="line">        stream.restart()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span> () =&gt; &#123;</span><br><span class="line">        stream.removeListener(<span class="string">'data'</span>, pipeStream)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>å®¢æˆ·ç«¯<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">img</span> <span class="attr">id</span>=<span class="string">'img'</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'/socket.io/socket.io.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> io = io();</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> img = <span class="built_in">document</span>.querySelector(<span class="string">'#img'</span>)</span></span><br><span class="line"><span class="javascript">io.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> bytes = <span class="keyword">new</span> Unit8Array(data)</span></span><br><span class="line"><span class="javascript">        img.src = <span class="string">'data:image/jpeg;base64,'</span> + base64ArrayBuffer(bytes)</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="undefined">&#125;)</span></span><br><span class="line"><span class="javascript">    <span class="comment">// byte æ•°ç»„è½¬ base64 (è¿™æ®µæ˜¯åœ¨å…¶ä»–åœ°æ–¹æŠ„çš„)</span></span></span><br><span class="line"><span class="javascript"><span class="function"><span class="keyword">function</span> <span class="title">base64ArrayBuffer</span>(<span class="params">arrayBuffer</span>) </span>&#123;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> base64    = <span class="string">''</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> encodings = <span class="string">'ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/'</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> bytes         = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(arrayBuffer);</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> byteLength    = bytes.byteLength;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> byteRemainder = byteLength % <span class="number">3</span>;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> mainLength    = byteLength - byteRemainder;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> a, b, c, d;</span></span><br><span class="line"><span class="javascript"><span class="keyword">var</span> chunk;</span></span><br><span class="line"><span class="javascript"><span class="comment">// Main loop deals with bytes in chunks of 3</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">for</span> (<span class="keyword">var</span> i = <span class="number">0</span>; i &lt; mainLength; i = i + <span class="number">3</span>) &#123;</span></span><br><span class="line"><span class="javascript"><span class="comment">// Combine the three bytes into a single integer</span></span></span><br><span class="line"><span class="undefined">chunk = (bytes[i] &lt;&lt; 16) | (bytes[i + 1] &lt;&lt; 8) | bytes[i + 2];</span></span><br><span class="line"><span class="javascript"><span class="comment">// Use bitmasks to extract 6-bit segments from the triplet</span></span></span><br><span class="line"><span class="javascript">a = (chunk &amp; <span class="number">16515072</span>) &gt;&gt; <span class="number">18</span>; <span class="comment">// 16515072 = (2^6 - 1) &lt;&lt; 18</span></span></span><br><span class="line"><span class="javascript">b = (chunk &amp; <span class="number">258048</span>)   &gt;&gt; <span class="number">12</span>; <span class="comment">// 258048   = (2^6 - 1) &lt;&lt; 12</span></span></span><br><span class="line"><span class="javascript">c = (chunk &amp; <span class="number">4032</span>)     &gt;&gt;  <span class="number">6</span>; <span class="comment">// 4032     = (2^6 - 1) &lt;&lt; 6</span></span></span><br><span class="line"><span class="javascript">d = chunk &amp; <span class="number">63</span>;               <span class="comment">// 63       = 2^6 - 1</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// Convert the raw binary segments to the appropriate ASCII encoding</span></span></span><br><span class="line"><span class="undefined">base64 += encodings[a] + encodings[b] + encodings[c] + encodings[d];</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="comment">// Deal with the remaining bytes and padding</span></span></span><br><span class="line"><span class="javascript"><span class="keyword">if</span> (byteRemainder == <span class="number">1</span>) &#123;</span></span><br><span class="line"><span class="undefined">chunk = bytes[mainLength];</span></span><br><span class="line"><span class="javascript">a = (chunk &amp; <span class="number">252</span>) &gt;&gt; <span class="number">2</span>; <span class="comment">// 252 = (2^6 - 1) &lt;&lt; 2</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// Set the 4 least significant bits to zero</span></span></span><br><span class="line"><span class="javascript">b = (chunk &amp; <span class="number">3</span>)   &lt;&lt; <span class="number">4</span>; <span class="comment">// 3   = 2^2 - 1</span></span></span><br><span class="line"><span class="javascript">base64 += encodings[a] + encodings[b] + <span class="string">'=='</span>;</span></span><br><span class="line"><span class="javascript">&#125; <span class="keyword">else</span> <span class="keyword">if</span> (byteRemainder == <span class="number">2</span>) &#123;</span></span><br><span class="line"><span class="undefined">chunk = (bytes[mainLength] &lt;&lt; 8) | bytes[mainLength + 1];</span></span><br><span class="line"><span class="javascript">a = (chunk &amp; <span class="number">64512</span>) &gt;&gt; <span class="number">10</span>; <span class="comment">// 64512 = (2^6 - 1) &lt;&lt; 10</span></span></span><br><span class="line"><span class="javascript">b = (chunk &amp; <span class="number">1008</span>)  &gt;&gt;  <span class="number">4</span>; <span class="comment">// 1008  = (2^6 - 1) &lt;&lt; 4</span></span></span><br><span class="line"><span class="javascript"><span class="comment">// Set the 2 least significant bits to zero</span></span></span><br><span class="line"><span class="javascript">c = (chunk &amp; <span class="number">15</span>)    &lt;&lt;  <span class="number">2</span>; <span class="comment">// 15    = 2^4 - 1</span></span></span><br><span class="line"><span class="javascript">base64 += encodings[a] + encodings[b] + encodings[c] + <span class="string">'='</span>;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="javascript"><span class="keyword">return</span> base64;</span></span><br><span class="line"><span class="undefined">&#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>è¿™ç§é€šè¿‡ img çš„æ–¹å¼æš´éœ²å‡ºçš„é—®é¢˜æ˜¯éœ€è¦åœ¨å‰ç«¯è§£ç , å¯¼è‡´ä¸‹ä¸€å¸§åˆ°æ¥æ—¶ä¸Šä¸€å¸§çš„ç”»é¢è¿˜æ²¡è§£ç å®Œæˆ. å°±ä¼šæœ‰èŠ±å±ç”šè‡³ç”»é¢åªæ˜¾ç¤ºä¸€åŠçš„é—®é¢˜å’Œå»¶è¿Ÿè¾ƒå¤§ä¸”å»¶è¿Ÿä¼šç´¯ç§¯, åœ¨æ§åˆ¶å°ä¸­ä½ ä¼šçœ‹åˆ°ç–¯ç‹‚åˆ·ä»å†…å­˜æ¥çš„è¯·æ±‚, å¦‚æœä½ æƒ³çœ‹çœ‹ http è¯·æ±‚å¯èƒ½ä¼šç–¯. æ‰€ä»¥è¿™ç§æ–¹å¼è‚¯å®šä¸è¡Œ</p><p>è¿™ä¸ª <code>rtsp-ffmpeg</code> è¿˜æä¾›ä¸€ç§ canvas çš„æ–¹å¼, åªæ˜¯åœ¨å®¢æˆ·ç«¯åšä¸€äº›ä¿®æ”¹:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> io = io();</span><br><span class="line"><span class="comment">// æŠŠä¹‹å‰çš„ img æ ‡ç­¾æ¢æˆ canvas</span></span><br><span class="line"><span class="keyword">let</span> canvas = <span class="built_in">document</span>.querySelector(<span class="string">'#canvas'</span>)</span><br><span class="line">io.on(<span class="string">'data'</span>, data =&gt; &#123;</span><br><span class="line">    <span class="keyword">var</span> bytes = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(data)</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> blob = <span class="keyword">new</span> Blob([bytes], &#123;<span class="attr">type</span>: <span class="string">'application/octet-binary'</span>&#125;)</span><br><span class="line">                    </span><br><span class="line">    <span class="keyword">var</span> url = URL.createObjectURL(blob)</span><br><span class="line">                    </span><br><span class="line">    <span class="keyword">var</span> img = <span class="keyword">new</span> Image</span><br><span class="line">                    </span><br><span class="line">    <span class="keyword">var</span> ctx = canvas.getContext(<span class="string">"2d"</span>)</span><br><span class="line">        img.width = img.width * <span class="number">0.5</span></span><br><span class="line">        img.height = img.height * <span class="number">0.5</span></span><br><span class="line">        img.onload = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            URL.revokeObjectURL(url)</span><br><span class="line">            ctx.drawImage(img, <span class="number">0</span>, <span class="number">0</span>, <span class="number">1080</span>, <span class="number">720</span>)</span><br><span class="line">        &#125;;    </span><br><span class="line">    img.src = url</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>ç”¨ canvas çš„æ–¹æ³•è™½ç„¶æ¯” img çš„æ•ˆæœå¥½ä¸€ç‚¹, ä½†æ˜¯æœ€ç»ˆæ•ˆæœä»ç„¶æ˜¯ä¸å°½äººæ„. å›¾åƒå¾ˆä¸ç¨³å®š, è¡¨ç°ä¸ºä¸€åŠç”»é¢ä¸€åŠç»¿å±, å¦‚æœè§†é¢‘ä¸­å›¾åƒå˜æ¢å‰§çƒˆçš„è¯è¡¨ç°ä¼šæ›´å·®, æ‰€ä»¥è¿™ç§æ–¹æ³•ä¹Ÿä¸å¤ªè¡Œ. å…¶å®åœ¨è¿™ä¸­é—´æˆ‘å¹¶æ²¡æœ‰åšä»€ä¹ˆæ“ä½œåªæ˜¯å°†è¿™ä¸ª demo é›†æˆåœ¨äº† vue ä¸­, å†åŠ ä¸Šå¤šæ‘„åƒæœºçš„åˆ‡æ¢å’Œä¸»æµæ‘„åƒæœºå‚å•†çš„æ”¯æŒ(å› ä¸ºæ¯ä¸ªæ‘„åƒæœºå‚å•†çš„ rtsp åè®®çš„ç»“æ„ä¸ä¸€æ ·)è€Œå·², æ‰€ä»¥ç¬¬ä¸€æƒ³æ³•æ˜¯èƒ½ä¸èƒ½åœ¨è§£ç è¿™å—æ‰¾åˆ°æ›´å¥½è§£å†³åŠæ³•, äºæ˜¯åˆæ‰¾åˆ°äº†å¦ä¸€ä¸ªåº“ <a href="https://github.com/phoboslab/jsmpeg" target="_blank" rel="noopener">jsmpeg</a> æ–¹æ¡ˆäºŒå°±æ¥äº†.</p><h3 id="æ–¹æ¡ˆäºŒ-jsmpeg"><a href="#æ–¹æ¡ˆäºŒ-jsmpeg" class="headerlink" title="æ–¹æ¡ˆäºŒ: jsmpeg"></a>æ–¹æ¡ˆäºŒ: jsmpeg</h3><p>è¿™ä¸ªåº“è¿˜ç®—æ¯”è¾ƒä¸é”™çš„äº†, ä¹Ÿæ˜¯é€šè¿‡ websocket æ¥è½¬å‘, çœ‹å®˜æ–¹çš„ä¾‹å­æ˜¯åœ¨ç»ˆç«¯ä¸­å¯åŠ¨ ffmpeg -&gt; websocket -&gt; å®¢æˆ·ç«¯é€šè¿‡ <code>jsmpeg.min.js</code> è§£ç åœ¨ canvas ä¸­æ’­æ”¾. å› ä¸ºè¿™é‡Œåªæ˜¯å®ç°äº†æ’­æ”¾, åœ¨è¿™ä¸ªåŸºç¡€ä¸Šæˆ‘ä»¬è¿˜éœ€è¦åœ¨è„šæœ¬ä¸­è‡ªå¯ ffmpeg / åˆ‡æ¢/ é‡å¯, ç„¶ååˆå»æ‰¾äº†ä¸€ä¸ªåŸºäº <code>jsmpeg</code> çš„åº“ <a href="https://github.com/kyriesent/node-rtsp-stream" target="_blank" rel="noopener">node-rtsp-stream</a>. è¿™ä¸ªåº“åªæ˜¯åšäº†ä¸€äº›å°è£…è®©æˆ‘ä»¬ä¸ç”¨è‡ªå·±åœ¨ç»ˆç«¯ä¸­æ‰‹åŠ¨å¯ç”¨ ffmpeg, åœ¨æ­¤ä¹‹ä¸Šæˆ‘å†åŠ ä¸Šé‡å¯å°±èƒ½æ»¡è¶³ç°åœ¨çš„éœ€æ±‚.</p><p><strong>ç¤ºä¾‹:</strong></p><ol><li>æ”¹é€  <code>node-rtsp-stream</code></li></ol><p>node-rtsp-stream/videoStream.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Mpeg1Muxer, STREAM_MAGIC_BYTES, VideoStream, events, util, ws;</span><br><span class="line"></span><br><span class="line">    ws = <span class="built_in">require</span>(<span class="string">'ws'</span>);</span><br><span class="line"></span><br><span class="line">    util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"></span><br><span class="line">    events = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"></span><br><span class="line">    Mpeg1Muxer = <span class="built_in">require</span>(<span class="string">'./mpeg1muxer'</span>);</span><br><span class="line"></span><br><span class="line">    STREAM_MAGIC_BYTES = <span class="string">"jsmp"</span>;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">var</span> child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line">    VideoStream = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">this</span>.name = options.name;</span><br><span class="line">        <span class="keyword">this</span>.streamUrl = options.streamUrl;</span><br><span class="line">        <span class="keyword">this</span>.width = options.width;</span><br><span class="line">        <span class="keyword">this</span>.height = options.height;</span><br><span class="line">        <span class="keyword">this</span>.wsPort = options.wsPort;</span><br><span class="line">        <span class="keyword">this</span>.inputStreamStarted = <span class="literal">false</span>;</span><br><span class="line">        <span class="keyword">this</span>.stream = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">        <span class="keyword">this</span>.startMpeg1Stream();</span><br><span class="line">        <span class="keyword">this</span>.pipeStreamToSocketServer();</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    util.inherits(VideoStream, events.EventEmitter);</span><br><span class="line">    <span class="comment">// åœæ­¢è§†é¢‘æµ</span></span><br><span class="line">    VideoStream.prototype.stop = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.mpeg1Muxer) &#123;</span><br><span class="line">            <span class="keyword">this</span>.mpeg1Muxer.stream.stop()</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// é‡å¯è§†é¢‘æµ</span></span><br><span class="line">    VideoStream.prototype.restart = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">this</span>.mpeg1Muxer) &#123;</span><br><span class="line">            <span class="keyword">this</span>.mpeg1Muxer.stream.stop()</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'ffmpeg is restart'</span>)</span><br><span class="line">            <span class="keyword">this</span>.inputStreamStarted = <span class="literal">false</span>;</span><br><span class="line">            <span class="keyword">this</span>.stream = <span class="keyword">void</span> <span class="number">0</span>;</span><br><span class="line">            <span class="keyword">this</span>.startMpeg1Stream();</span><br><span class="line">            <span class="comment">// ç›‘å¬ ffmpeg è¿›ç¨‹æ˜¯å¦å…³é—­</span></span><br><span class="line">            <span class="keyword">this</span>.mpeg1Muxer.on(<span class="string">'ffmpegClose'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">                <span class="built_in">console</span>.log(<span class="string">'ffmpeg closed on '</span> + code)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    VideoStream.prototype.startMpeg1Stream = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// çœç•¥æ‰“å¼€æµçš„æ–¹æ³•, è¿™éƒ¨åˆ†æ²¡æœ‰åšæ”¹åŠ¨</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    VideoStream.prototype.pipeStreamToSocketServer = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="comment">// å°†æµå¡ç»™ socket, åŒæ ·ä¹Ÿæ²¡æ”¹</span></span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    VideoStream.prototype.onSocketConnect = <span class="function"><span class="keyword">function</span>(<span class="params">socket</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self, streamHeader;</span><br><span class="line">        self = <span class="keyword">this</span>;</span><br><span class="line">        streamHeader = <span class="keyword">new</span> Buffer(<span class="number">8</span>);</span><br><span class="line">        streamHeader.write(STREAM_MAGIC_BYTES);</span><br><span class="line">        streamHeader.writeUInt16BE(<span class="keyword">this</span>.width, <span class="number">4</span>);</span><br><span class="line">        streamHeader.writeUInt16BE(<span class="keyword">this</span>.height, <span class="number">6</span>);</span><br><span class="line">        socket.send(streamHeader, &#123;</span><br><span class="line">            binary: <span class="literal">true</span></span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="built_in">console</span>.log((<span class="string">""</span> + <span class="keyword">this</span>.name + <span class="string">": New WebSocket Connection ("</span>) + <span class="keyword">this</span>.wsServer.clients.length + <span class="string">" total)"</span>);</span><br><span class="line">        <span class="keyword">return</span> socket.on(<span class="string">"close"</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code, message</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> <span class="built_in">console</span>.log((<span class="string">""</span> + <span class="keyword">this</span>.name + <span class="string">": Disconnected WebSocket ("</span>) + self.wsServer.clients.length + <span class="string">" total)"</span>);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>.exports = VideoStream;</span><br><span class="line"></span><br><span class="line">&#125;).call(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p><p>node-rtsp-stream/videoStream.js<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> Mpeg1Muxer, child_process, events, util;</span><br><span class="line"></span><br><span class="line">    child_process = <span class="built_in">require</span>(<span class="string">'child_process'</span>);</span><br><span class="line"></span><br><span class="line">    util = <span class="built_in">require</span>(<span class="string">'util'</span>);</span><br><span class="line"></span><br><span class="line">    events = <span class="built_in">require</span>(<span class="string">'events'</span>);</span><br><span class="line"></span><br><span class="line">    Mpeg1Muxer = <span class="function"><span class="keyword">function</span>(<span class="params">options</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">var</span> self;</span><br><span class="line">        self = <span class="keyword">this</span>;</span><br><span class="line">        <span class="keyword">this</span>.url = options.url;</span><br><span class="line">        <span class="keyword">this</span>.stream = child_process.spawn(<span class="string">"ffmpeg"</span>, </span><br><span class="line">            [</span><br><span class="line">                <span class="string">"-rtsp_transport"</span>,</span><br><span class="line">                <span class="string">"tcp"</span>,</span><br><span class="line">                <span class="string">"-i"</span>,</span><br><span class="line">                <span class="keyword">this</span>.url,</span><br><span class="line">                <span class="string">'-s'</span>, </span><br><span class="line">                <span class="comment">// å›¾åƒå®½é«˜</span></span><br><span class="line">                <span class="string">`<span class="subst">$&#123;options.width&#125;</span>x<span class="subst">$&#123;options.height&#125;</span>`</span>, </span><br><span class="line">                <span class="string">'-f'</span>, </span><br><span class="line">                <span class="string">'mpeg1video'</span>, </span><br><span class="line">                <span class="string">'-b:v'</span>, </span><br><span class="line">                <span class="string">'800k'</span>, </span><br><span class="line">                <span class="string">'-r'</span>, </span><br><span class="line">                <span class="string">'30'</span>, </span><br><span class="line">                <span class="string">'-'</span></span><br><span class="line">            ], </span><br><span class="line">            &#123;</span><br><span class="line">                detached: <span class="literal">false</span></span><br><span class="line">            &#125;</span><br><span class="line">        );</span><br><span class="line">        <span class="keyword">this</span>.inputStreamStarted = <span class="literal">true</span>;</span><br><span class="line">        <span class="keyword">this</span>.stream.stdout.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> self.emit(<span class="string">'mpeg1data'</span>, data);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="keyword">this</span>.stream.stderr.on(<span class="string">'data'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">data</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> self.emit(<span class="string">'ffmpegError'</span>, data);</span><br><span class="line">        &#125;);</span><br><span class="line">        <span class="comment">// kill ffmpeg</span></span><br><span class="line">        <span class="keyword">this</span>.stream.stop = <span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="comment">// console.log(self.stream.pid)</span></span><br><span class="line">            self.stream.stdin.pause();</span><br><span class="line">            self.stream.kill()</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="string">'ffmpeg is be kill'</span>)</span><br><span class="line">        &#125;;</span><br><span class="line">        <span class="comment">// ç›‘å¬ ffmpeg é€€å‡º</span></span><br><span class="line">        <span class="keyword">this</span>.stream.on(<span class="string">'exit'</span>, <span class="function"><span class="keyword">function</span>(<span class="params">code</span>) </span>&#123;</span><br><span class="line">            <span class="keyword">return</span> self.emit(<span class="string">'ffmpegClose'</span>, code)</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>;</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    util.inherits(Mpeg1Muxer, events.EventEmitter);</span><br><span class="line"></span><br><span class="line">    <span class="built_in">module</span>.exports = Mpeg1Muxer;</span><br><span class="line"></span><br><span class="line">&#125;).call(<span class="keyword">this</span>);</span><br></pre></td></tr></table></figure></p><ol start="2"><li>node ç«¯ä½¿ç”¨</li></ol><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> app = <span class="built_in">require</span>(<span class="string">'express'</span>)()</span><br><span class="line"><span class="keyword">const</span> server = <span class="built_in">require</span>(<span class="string">'http'</span>).Server(app)</span><br><span class="line"><span class="keyword">const</span> io = <span class="built_in">require</span>(<span class="string">'socket.io'</span>)(server)</span><br><span class="line"><span class="comment">// å¼•å…¥æ”¹é€ åçš„ node-rtsp-stream</span></span><br><span class="line"><span class="keyword">const</span> Rtsp = <span class="built_in">require</span>(<span class="string">'./node-rtsp-stream'</span>)</span><br><span class="line"></span><br><span class="line">server.listen(<span class="number">8081</span>, () =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'server listening on 8081'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// uri ä»¥æµ·åº·æ‘„åƒæœºçš„ rtsp åè®®ä¸ºä¾‹</span></span><br><span class="line"><span class="keyword">let</span> uri = <span class="string">'rtps://admin:password@ip:port/h264/ch1/sub/av_stream'</span></span><br><span class="line"><span class="keyword">let</span> stream = <span class="keyword">new</span> Rtsp(&#123;</span><br><span class="line">    name: <span class="string">'rtsp_stream'</span>,</span><br><span class="line">    streamUrl: uri,</span><br><span class="line">    wsPort: <span class="number">11111</span>,</span><br><span class="line">    width: <span class="number">720</span>,</span><br><span class="line">    height: <span class="number">405</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">stream.on(<span class="string">'start'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'stream'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">stream.on(<span class="string">'stop'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'stream stopped'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">    <span class="keyword">const</span> pipeStream = <span class="function"><span class="params">data</span> =&gt;</span> &#123;</span><br><span class="line">        socket.emit(<span class="string">'data'</span>, data)</span><br><span class="line">    &#125;</span><br><span class="line">    stream.on(<span class="string">'data'</span>, pipeStream)</span><br><span class="line"></span><br><span class="line">    <span class="comment">// åˆ‡æ¢æ‘„åƒæœº</span></span><br><span class="line">    socket.on(<span class="string">'URI'</span>, data =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(data)</span><br><span class="line">        uri = <span class="string">`rtsp://<span class="subst">$&#123;data.userName&#125;</span>:<span class="subst">$&#123;data.passWord&#125;</span>@<span class="subst">$&#123;data.ip&#125;</span>:<span class="subst">$&#123;data.port&#125;</span>/h264/ch1/sub/av_stream`</span></span><br><span class="line">        stream.streamUrl = uri;</span><br><span class="line">        <span class="comment">// é‡å¯</span></span><br><span class="line">        stream.restart()</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span> () =&gt; &#123;</span><br><span class="line">        stream.removeListener(<span class="string">'data'</span>, pipeStream)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><ol start="3"><li>å®¢æˆ·ç«¯</li></ol><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">canvas</span> <span class="attr">id</span>=<span class="string">'can'</span>&gt;</span><span class="tag">&lt;/<span class="name">canvas</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">'jsmpeg.min.js'</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> canvas = <span class="built_in">document</span>.querySelector(<span class="string">'#can'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> ws = <span class="keyword">new</span> WebSocket(<span class="string">'ws://127.0.0.1:11111'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> player = <span class="keyword">new</span> jsmpeg(ws, &#123;</span></span><br><span class="line"><span class="undefined">        canvas: canvas,</span></span><br><span class="line"><span class="javascript">        autoplay: <span class="literal">true</span></span></span><br><span class="line"><span class="undefined">    &#125;)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><p>è¿™ä¸ªæ–¹æ¡ˆå…¶å®ä½¿ç”¨äº†å¾ˆä¹…ä¸€ç›´éƒ½æ²¡å‘ç°é—®é¢˜, ä¹Ÿæ²¡æœ‰å‡ºç°è¿‡èŠ±å±å»¶è¿Ÿç´¯è®¡çš„æƒ…å†µ. ä½†æ˜¯åœ¨ä¸€è·¯æ‘„åƒæœºå®‰ç½®åœ¨å¤©æ¡¥é™„è¿‘äººæµé‡å‰§å¢, ä¸è¿™ä¸ªè§†é¢‘é¢„è§ˆåŒä¸€é¡µé¢è¿˜æœ‰ä¸€ä¸ªäººè„¸å®æ—¶æŠ“æ‹çš„å³æ—¶æ¶ˆæ¯æ¨é€çš„åŠŸèƒ½, å¯¼è‡´åœ¨20 - 30åˆ†é’Ÿæµè§ˆå™¨ç›´æ¥å‡æ­»æˆ–è€…å´©æºƒ.(ç„¶åè¿™ä¸ªæ–¹æ¡ˆåˆå‡‰äº†ğŸ˜‚)</p><h3 id="æ–¹æ¡ˆä¸‰-FFmpeg-Nginx-video-js"><a href="#æ–¹æ¡ˆä¸‰-FFmpeg-Nginx-video-js" class="headerlink" title="æ–¹æ¡ˆä¸‰: FFmpeg + Nginx + video.js"></a>æ–¹æ¡ˆä¸‰: FFmpeg + Nginx + video.js</h3><p>åœ¨ç»è¿‡ä¸¤æ¬¡å®éªŒ + å¤±è´¥ä¹‹åæ‰¾åˆ°ä¸€ä¸ªè¾ƒä¸ºå¤§ä¼—çš„è§£å†³æ–¹å¼, å‰ä¸¤ç§æ–¹æ¡ˆéƒ½æ˜¯é€šè¿‡åº“ç›´æ¥ä½¿ç”¨ rtsp è½¬æˆ bytes æä¾›ç»™å¤–éƒ¨ä½¿ç”¨, è€Œæ–¹æ¡ˆä¸‰çš„æµç¨‹å¦‚ä¸‹:</p><ul><li>Node ä½¿ç”¨ <a href="https://github.com/fluent-ffmpeg/node-fluent-ffmpeg" target="_blank" rel="noopener">fluent-ffmpeg</a> è°ƒæ•´å‚æ•°å¯åŠ¨ FFmpeg</li><li>FFmpeg è´Ÿè´£ç¼–ç å†è§£ç åè½¬ä¸º RTMP åè®®</li><li>Node å°†æµæ¨åˆ° Nginx (nginx éœ€è¦å®‰è£… <a href="https://github.com/arut/nginx-rtmp-module#example-nginxconf" target="_blank" rel="noopener">nginx-rtmp-modules</a> æ’ä»¶)</li><li>å®¢æˆ·ç«¯ä½¿ç”¨ Video.js è®¿é—® Nginx é…ç½®çš„è¿æ¥å¹¶æ’­æ”¾è§†é¢‘</li></ul><p>åœ¨è¿™ä¸ªé˜¶æ®µåˆé‡åˆ°äº†ä¸åŒå‚å•†çš„æ‘„åƒæœº, åœ¨åŒä¸€åè®®ä¸‹ä¸èƒ½æ­£å¸¸è¿ä½œ, åœ¨æ­¤ä¹Ÿè®°å½•ä¸€ä¸‹å„å‚å•†çš„ rtsp åè®®</p><ul><li>æµ·åº·å¨è§†: rtps://admin:password@ip:port/h264/ch1/sub/av_stream</li><li>å¤§å: rtps://admin:password@ip:port/cam/realmonitor?channel=1&amp;subtype=0</li><li>å¤©åœ°ä¼Ÿä¸š: rtps://admin:password@ip:port/1/1</li><li>ç§‘è¾¾: rtps://admin:password@ip:port/id=1</li><li>åæ˜“æ˜æ–°: rtps://admin:password@ip:port/ch3</li></ul><p><strong>ç¤ºä¾‹:</strong></p><p>node ç«¯<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> uri = <span class="string">'rtps://admin:password@ip:port/h264/ch1/sub/av_stream'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// FFMpeg å‘½ä»¤å‚æ•°è®¾ç½®</span></span><br><span class="line"><span class="comment">// ffmpeg - i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -fflags nobuffer -vcodec libx264 </span></span><br><span class="line"><span class="comment">// -preset superfast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span></span><br><span class="line"><span class="keyword">let</span> ffmpeg = <span class="built_in">require</span>(<span class="string">'fluent-ffmpeg'</span>)</span><br><span class="line"><span class="keyword">let</span> running = <span class="literal">false</span></span><br><span class="line"><span class="keyword">var</span> command = ffmpeg(uri)</span><br><span class="line">    .outputOptions([</span><br><span class="line">        <span class="string">'-fflags'</span>,</span><br><span class="line">        <span class="string">'nobuffer'</span>,</span><br><span class="line">        <span class="string">'-vcodec'</span>,</span><br><span class="line">        <span class="string">'libx264'</span>,</span><br><span class="line">        <span class="string">'-preset'</span>,</span><br><span class="line">        <span class="string">'superfast'</span>,</span><br><span class="line">        <span class="comment">// '-rtsp_transport',</span></span><br><span class="line">        <span class="comment">// 'tcp',</span></span><br><span class="line">        <span class="comment">// '-threads',</span></span><br><span class="line">        <span class="comment">// '4',</span></span><br><span class="line">        <span class="string">'-f'</span>,</span><br><span class="line">        <span class="string">'flv'</span>,</span><br><span class="line">        <span class="string">'-r'</span>,</span><br><span class="line">        <span class="string">'15'</span>,</span><br><span class="line">        <span class="string">'-s'</span>,</span><br><span class="line">        <span class="string">'1280x720'</span>,</span><br><span class="line">        <span class="string">'-an'</span></span><br><span class="line">    ])</span><br><span class="line">    <span class="comment">// æ­¤å¤„çš„ /live/camera, cameraç±»ä¼¼äºä¸€ä¸ªæˆ¿é—´çš„æ¦‚å¿µ, ä½ å¯ä»¥è®¾ç½®ä¸ºä½ æƒ³è¦çš„åå­—</span></span><br><span class="line">    .save(<span class="string">`rtmp://<span class="subst">$&#123; nginxHost &#125;</span>:<span class="subst">$&#123; nginxPort &#125;</span>/live/camera`</span>)</span><br><span class="line">    .on(<span class="string">'start'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">        running = <span class="literal">true</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'stream is start: '</span> + e)</span><br><span class="line">    &#125;)</span><br><span class="line">    .on(<span class="string">'end'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        running = <span class="literal">false</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'ffmpeg is end'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    .on(<span class="string">'error'</span>, <span class="function"><span class="keyword">function</span> (<span class="params">err</span>) </span>&#123;</span><br><span class="line">        running = <span class="literal">false</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'ffmpeg is error! '</span>+ err)</span><br><span class="line">        reloadStream(uri)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> reloadStream = <span class="function">(<span class="params">uri, userAgents</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (!uri) <span class="keyword">return</span></span><br><span class="line">    <span class="keyword">let</span> userAgent = userAgents</span><br><span class="line">    <span class="keyword">if</span> (running) &#123;</span><br><span class="line">        command.kill()</span><br><span class="line">    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (command._inputs[<span class="number">0</span>]) &#123;</span><br><span class="line">            command._inputs[<span class="number">0</span>].source = uri</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            command.input(uri)</span><br><span class="line">        &#125;</span><br><span class="line">        command.run()</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> camFactory = &#123;</span><br><span class="line">    <span class="comment">// æµ·åº·</span></span><br><span class="line">    <span class="string">'0'</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'h264/ch1/sub/av_stream'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å¤§å</span></span><br><span class="line">    <span class="string">'1'</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'cam/realmonitor?channel=1&amp;subtype=0'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// å¤©åœ°ä¼Ÿä¸š</span></span><br><span class="line">    <span class="string">'2'</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'1/1'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// ç§‘è¾¾</span></span><br><span class="line">    <span class="string">'3'</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'id=1'</span></span><br><span class="line">    &#125;,</span><br><span class="line">    <span class="comment">// åæ˜“æ˜æ–°</span></span><br><span class="line">    <span class="string">'4'</span> () &#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="string">'ch3'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">io.on(<span class="string">'connection'</span>, socket =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'connection'</span>)</span><br><span class="line">    <span class="keyword">let</span> cameraInfo = &#123;&#125;</span><br><span class="line">    <span class="keyword">if</span> (cameraInfo.cameraName) &#123;</span><br><span class="line">        socket.emit(<span class="string">'CameraInfo'</span>, cameraInfo)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// è·å–ç½‘ç»œæ‘„åƒå¤´ä¿¡æ¯</span></span><br><span class="line">    socket.on(<span class="string">'URI'</span>, data =&gt; &#123;</span><br><span class="line">        <span class="keyword">if</span> (cameraInfo.cameraName === data.cameraName || cameraInfo.ip === data.ip) <span class="keyword">return</span></span><br><span class="line">        cameraInfo = data</span><br><span class="line">        cameraInfo.factory = data.factory || <span class="string">'0'</span></span><br><span class="line">        uri = <span class="string">`rtsp://<span class="subst">$&#123;data.userName&#125;</span>:<span class="subst">$&#123;data.passWord&#125;</span>@<span class="subst">$&#123;data.ip&#125;</span>:<span class="subst">$&#123;data.RTSP&#125;</span>/<span class="subst">$&#123;camFactory[cameraInfo.factory]()&#125;</span>`</span></span><br><span class="line">        reloadStream(uri, data.userAgent)</span><br><span class="line">        socket.emit(<span class="string">'CameraInfo'</span>, cameraInfo)</span><br><span class="line">    &#125;)</span><br><span class="line"></span><br><span class="line">    socket.on(<span class="string">'disconnect'</span>, _ =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'disconnect'</span>)</span><br><span class="line">    &#125;);</span><br><span class="line">    socket.on(<span class="string">'end'</span>, _ =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'socket-io end'</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">    socket.on(<span class="string">'err'</span>, err =&gt; &#123;</span><br><span class="line">        <span class="built_in">console</span>.log(err)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>FFmpeg çš„å‚æ•°å¯¹è§†é¢‘æ¨æµçš„ç”»é¢è´¨é‡å’Œå»¶è¿Ÿæœ‰è¾ƒå¤§å½±å“, ä»¥ä¸‹å¯¹æˆ‘ç”¨è¿‡çš„ FFmpeg å‚æ•°ä½œä¸€äº›è¯´æ˜.å¦‚æœä½¿ç”¨æµ·åº·æ‘„åƒæœº rtsp è½¬ rtmp æ˜¯å¯ä»¥ç›´æ¥ä½¿ç”¨ <code>copy</code> å‚æ•°æ€§èƒ½ä¼šæé«˜å¾ˆå¤š, å‰©å»äº† FFmpeg ç¼–ç è§£ç çš„è¿‡ç¨‹. ä¸‹é¢çš„ä¾‹å­æ˜¯å½“æ—¶çš„é¡¹ç›®è¦å…¼å®¹çš„åæ˜“æ˜æ–°çš„æ‘„åƒæœº, æ‰€ä»¥æ²¡æœ‰ä½¿ç”¨ <code>copy</code> å‚æ•°</p><p><strong>å»¶è¿Ÿå½±å“ç›¸å…³å‚æ•°(ä»¥ä¸‹æµ‹è¯•éƒ½åœ¨æµ·åº·å¨è§†å’Œåæ˜“æ˜æ–°æ‘„åƒæœºæµ‹è¯•):</strong></p><ol><li><p>fast å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -vcodec libx264</span><br><span class="line"> -preset fast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span><br></pre></td></tr></table></figure><p> fast å‚æ•°å»¶è¿Ÿè¡¨ç°è¾ƒä¸ºä¸æ˜æ˜¾</p></li><li><p>superfast å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -vcodec libx264</span><br><span class="line"> -preset  superfast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span><br></pre></td></tr></table></figure><p> superfast å‚æ•°è¡¨ç°ä¸º 2-3 ç§’å»¶è¿Ÿ, ä½†æ˜¯ç”»è´¨ä¼šä¸‹é™ä¸€ç‚¹</p></li><li><p>ultrafast å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -vcodec libx264</span><br><span class="line"> -preset  ultrafast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span><br></pre></td></tr></table></figure><p> ultrafast å‚æ•°åœ¨æˆ‘å®éªŒä¸­è¡¨ç°è·Ÿ superfast çš„å»¶è¿Ÿå·®è·ä¸æ˜¯ç‰¹åˆ«å¤§, å¤§æ¦‚åœ¨ 1-2 ç§’å·¦å³, ç”»è´¨ä¼šä¸‹é™çš„æ¯”è¾ƒæ˜æ˜¾</p></li><li><p>zerolatency å’Œ ultrafast å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -tune zerolatency </span><br><span class="line">-vcodec libx264 -preset  ultrafast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span><br></pre></td></tr></table></figure><p> è®²é“ç†ç¬¬ä¸€ä¸ªå‚æ•°æ˜¯é›¶å»¶è¿Ÿ, ä½†æ˜¯æ·»åŠ è¿™ä¸ªå‚æ•°ä¹‹ååœ¨å¤©æ¡¥éƒ¨ç½²çš„æ‘„åƒæœºèŠ±å±ä¼šéå¸¸ä¸¥é‡</p></li><li><p>nobuffer å’Œ superfast å‚æ•°</p><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -i rtsp://admin:hk123456@192.168.0.64:554/h264/ch1/sub/av_stream -fflags nobuffer</span><br><span class="line"> -vcodec libx264 -preset  superfast -f flv -r 15 -s 1280x720 -an rtmp://127.0.0.1:1935/live/camera</span><br></pre></td></tr></table></figure><p> nobuffer å‚æ•°è¡¨ç¤ºä¸ä½¿ç”¨ç¼“å­˜, åœ¨ä»¥ä¸Šå®éªŒä¸­åæ˜“æ˜æ–°æ‘„åƒæœºåœ¨è§£ç ä¸­ä¸¢åŒ…éå¸¸ä¸¥é‡, nobuffer å‚æ•°åœ¨è§£ç è·Ÿä¸ä¸Šå‘é€æ—¶æ”¾å¼ƒç¼“å­˜, æ‰€ä»¥æœ€ç»ˆé€‰ç”¨ nobuffer + superfast å‚æ•°è¾¾åˆ°ä¸€ä¸ªå¹³è¡¡çš„çŠ¶æ€. </p></li></ol><p><strong>å…¶ä»–å‚æ•°</strong></p><ul><li><p>rtsp_transport å‚æ•°: ä¼ è¾“æ–¹å¼, tcp/udp ä¸¤ç§, é»˜è®¤ä¸º udp.</p><p>  æœ¬æ¥ udp çš„ä¼ è¾“æ–¹å¼æ›´å¿«æ¶ˆè€—çš„èµ„æºä¹Ÿæ›´å°‘, ä½†æ˜¯é¡¹ç›®ä¸­åè€Œæ”¹æˆ tcp çš„æ–¹å¼æ•ˆæœæ›´å¥½</p></li><li><p>threads å‚æ•°</p><p>  threads ä¹Ÿæ˜¯è®²é“ç†åº”è¯¥æ˜¯è§£ç çº¿ç¨‹æ•°å¤šä¸€ç‚¹æ•ˆæœå¥½, åè€Œé¡¹ç›®ä¸­å°†çº¿ç¨‹æ•°å‡å°‘æ•ˆæœæ›´ä½³</p></li></ul><p>ä»¥ä¸Šä¸¤ä¸ªå‚æ•°æ˜¯æˆ‘æ²¡ç†è§£çš„éƒ¨åˆ†, å½“ç„¶ä¹Ÿå¯èƒ½æ˜¯å½“æ—¶é¡¹ç›®çš„ç¯å¢ƒæœ‰æ‰€å½±å“. è¿™ä¸ªé¡¹ç›®ä¹Ÿæœ‰ä¸€ç‚¹å¥‡æ€ªçš„åœ°æ–¹åœ¨è¿™å„¿ä¸€èµ·è¯´, åœ¨å¯åŠ¨ FFmpeg è½¬ç æ—¶ç”µè„‘ä¼šè“å±. æœ€ç»ˆæ’æŸ¥åˆ°çš„é—®é¢˜æ˜¯: 1. CPU å¯ç”¨æ¶¡è½®åŠ é€Ÿ 2. flash å¼€å¯ç¡¬ä»¶åŠ é€Ÿ 3. ffmpeg ç‰ˆæœ¬ 4. åæ˜“æ˜æ–°æ‘„åƒæœº</p><p>è§£å†³æ–¹æ³•: </p><ol><li>CPU æ¶¡è½®åŠ é€Ÿå…³é—­</li><li>flash å…³é—­ç¡¬ä»¶åŠ é€Ÿ (æ®è¯´æ˜¯ flash æœ¬èº«å®ç°ç¡¬ä»¶åŠ é€Ÿä¸å¥½) </li><li>å°† FFmpeg ç‰ˆæœ¬æ¢è‡³æœ€æ–°</li><li>æ›´æ–°æ‘„åƒæœºç¡¬ä»¶åŒ…</li></ol><p>è“å±çš„è¿™ä¸ªé—®é¢˜åªåœ¨ä¸€å°ç”µè„‘ä¸Šé‡è§è¿‡ç‰¹æ®Šæ€§æ¯”è¾ƒé«˜, ä»…ä¾›å‚è€ƒ.</p><p>nginx é…ç½®<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">rtmp &#123;</span><br><span class="line">    server &#123;</span><br><span class="line">        # æœåŠ¡ç«¯å£(é»˜è®¤ç«¯å£)</span><br><span class="line">        listen 1935;</span><br><span class="line">        # ç›´æ’­</span><br><span class="line">        application live &#123;</span><br><span class="line">            live on;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å®¢æˆ·ç«¯<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">&lt;!DOCTYPE html&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">html</span> <span class="attr">lang</span>=<span class="string">"en"</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">head</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">charset</span>=<span class="string">"UTF-8"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">name</span>=<span class="string">"viewport"</span> <span class="attr">content</span>=<span class="string">"width=device-width, initial-scale=1.0"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">meta</span> <span class="attr">http-equiv</span>=<span class="string">"X-UA-Compatible"</span> <span class="attr">content</span>=<span class="string">"ie=edge"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">title</span>&gt;</span>Document<span class="tag">&lt;/<span class="name">title</span>&gt;</span></span><br><span class="line">  </span><br><span class="line">  <span class="comment">&lt;!-- Old version compatible with flash --&gt;</span></span><br><span class="line">  <span class="comment">&lt;!-- &lt;link href="//vjs.zencdn.net/5.19/video-js.min.css" rel="stylesheet"&gt;</span></span><br><span class="line"><span class="comment">  &lt;script src="//vjs.zencdn.net/5.19/video.min.js"&gt;&lt;/script&gt;   --&gt;</span></span><br><span class="line"></span><br><span class="line">  <span class="comment">&lt;!-- New version uncompatible with flash --&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">link</span> <span class="attr">href</span>=<span class="string">"http://vjs.zencdn.net/6.2.4/video-js.css"</span> <span class="attr">rel</span>=<span class="string">"stylesheet"</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"http://vjs.zencdn.net/6.2.4/video.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span> </span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span> <span class="attr">src</span>=<span class="string">"./videojs-flash.min.js"</span>&gt;</span><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="javascript"> videojs.options.flash.swf = <span class="string">'./video-js.swf'</span>; </span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">head</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">body</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">video</span> <span class="attr">id</span>=<span class="string">"my-player"</span> <span class="attr">class</span>=<span class="string">"video-js"</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">source</span> <span class="attr">src</span>=<span class="string">"rtmp://127.0.0.1:1935/live/camera"</span> <span class="attr">type</span>=<span class="string">"rtmp/mp4"</span>&gt;</span><span class="tag">&lt;/<span class="name">source</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;/<span class="name">video</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">body</span>&gt;</span></span><br><span class="line"></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">  videojs(<span class="string">'my-player'</span>, &#123;</span></span><br><span class="line"><span class="javascript">    controls: <span class="literal">true</span>,</span></span><br><span class="line"><span class="javascript">    autoplay: <span class="literal">true</span>,</span></span><br><span class="line"><span class="undefined">    flash: &#123;</span></span><br><span class="line"><span class="javascript">      swf: <span class="string">'./video-js.swf'</span></span></span><br><span class="line"><span class="undefined">    &#125;,</span></span><br><span class="line"><span class="undefined">    height: 300,</span></span><br><span class="line"><span class="undefined">    width: 300</span></span><br><span class="line"><span class="undefined">  &#125;);</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">html</span>&gt;</span></span><br></pre></td></tr></table></figure></p><p>è¡¥å……ä¸€å¥åœ¨ vue ä¸­ä½¿ç”¨å¯ä»¥è¯•è¯• <a href="https://github.com/surmon-china/vue-video-player" target="_blank" rel="noopener">vue-video-player</a></p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>è¿™ä¸€æ³¢ç½‘ç»œæ‘„åƒæœºçš„ç›´æ’­è¿˜æ˜¯æ¶¨äº†å¾ˆå¤šå§¿åŠ¿, è¾¾æˆ FFmpeg è°ƒå‚å‘˜. ä¸è¿‡åœ¨æˆ‘ç¦»èŒä¹‹å‰è¿˜æœ‰ä¸€ä¸ªé—®é¢˜ä¸€ç›´æ²¡æœ‰è§£å†³, å®¢æˆ·ç«¯åœ¨è¿è¡Œ 3-4 å°æ—¶ä¹‹åå°±ä¼šé»‘å±, åœ¨åˆ·æ–°é¡µé¢ååˆæ¢å¤. æˆ‘å°è¯•è¿‡æ”¹ chrome ä¸­ flash çš„è®¾ç½®è¿˜æ˜¯ä¸è¡Œ, è‹Ÿä¸”äº†ä¸€ç‚¹å®šæ—¶åˆ·æ–°æš‚æ—¶è§£å†³. æœ€ç»ˆè¿˜æ˜¯ flash è¿™ä¸ªé—®é¢˜æ²¡æ³•ä»æ ¹æœ¬ä¸Šè§£å†³.</p><p>Created on 2017/7/26 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¯¹äºç½‘ç»œæ‘„åƒæœºåšè§†é¢‘é¢„è§ˆè¿™å—, æœ¬èº«å…¶å®æ˜¯éå¸¸é™Œç”Ÿçš„, å½“æ—¶æ¥åˆ°è¿™ä¸ªéœ€æ±‚ä¹Ÿæ˜¯ç›¸å½“çš„å¤´ç–¼(å¯¹äºå½“æ—¶ä¸€å¹´ç»éªŒä¸åˆ°çš„æˆ‘æ¥è¯´).å½“æ—¶æˆ‘ä»¬çš„åº”ç”¨åœºæ™¯æ˜¯: å¤šè·¯ç½‘ç»œæ‘„åƒæœºé€šè¿‡å±€åŸŸç½‘è¿æ¥, PC ç«¯èƒ½å¤Ÿå®æ—¶é¢„è§ˆç›‘æ§ç”»é¢å¹¶ä¸”ç”»è´¨è¾¾åˆ°720p, å»¶è¿Ÿä¸èƒ½è¶…è¿‡10ç§’, å¤šä¸ªæ‘„åƒæœºèƒ½å¤Ÿåˆ‡æ¢æŸ¥çœ‹.
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
      <category term="Node.js" scheme="https://yoursite.com/tags/Node-js/"/>
    
      <category term="FFmpeg" scheme="https://yoursite.com/tags/FFmpeg/"/>
    
  </entry>
  
  <entry>
    <title>Babelç”Ÿæ€</title>
    <link href="https://yoursite.com/2018/04/09/Babel/"/>
    <id>https://yoursite.com/2018/04/09/Babel/</id>
    <published>2018-04-09T09:55:20.000Z</published>
    <updated>2022-08-23T09:37:40.688Z</updated>
    
    <content type="html"><![CDATA[<p>å¯¹äº babel çš„ä½¿ç”¨, ä¸€ç›´åœç•™åœ¨ä¸ webpack ç»“åˆä½¿ç”¨, ä»¥åŠåœ¨ Vue å¼€å‘ç¯å¢ƒä¸‹è„šæ‰‹æ¶åˆæ˜¯å¼€ç®±å³ç”¨. å¯¼è‡´å¾ˆå¤š babel çš„åŒ…, æˆ‘éƒ½ä¸æ¸…æ¥šä»–ä»¬æ˜¯å¹²ä»€ä¹ˆçš„. æ¯”å¦‚ babel-register/ babel-runtime/ helpers/ å„ç§ presets ä»¥åŠ transform-runtime å’Œ babel-polyfill çš„åŒºåˆ«, æ‰€ä»¥æ€»ç»“ä¸€ä¸‹.</p><h3 id="babel-cli"><a href="#babel-cli" class="headerlink" title="babel-cli"></a>babel-cli</h3><p>æˆ‘ç†è§£ä¸º babel çš„ command å…¨å®¶æ¡¶, ç”¨äºåœ¨å‘½ä»¤è¡Œæ“ä½œçš„. é‡Œé¢åŒ…å«äº† <code>babel</code>/ <code>babel-external-helpers</code>/ <code>babel-node</code> 3ä¸ªå‘½ä»¤</p><ul><li>babel: ç”¨äºç¼–è¯‘ä»£ç </li><li>babel-external-helpers: ç”¨äºç”Ÿæˆä¸€äº› halper å‡½æ•°, åŒ…å« babel æ‰€æœ‰çš„ hepler å‡½æ•° (å¦‚: toArray å‡½æ•°, jsx è½¬åŒ–å‡½æ•°). è¿™äº›å‡½æ•°å®åœ¨ babel transform çš„æ—¶å€™ç”¨, éƒ½æ”¾åœ¨ <code>babel-helpers</code> è¿™ä¸ªåŒ…ä¸­, å½“è¿™äº› helpers è¢«ç”¨åˆ°å°±ä¼šè¢«æ”¾ç½®åœ¨ç”Ÿæˆä»£ç çš„é¡¶éƒ¨. ä½†æ˜¯å½“å¤šä¸ªæ–‡ä»¶éƒ½ç”¨åˆ°äº† helpers å‡½æ•°å°±ä¼šäº§ç”Ÿå†—ä½™ä»£ç , æ‰€ä»¥ babel æä¾›è¿™ä¸ªå‘½ä»¤ç”Ÿæˆä¸€ä¸ªåŒ…å«æ‰€æœ‰ helpers çš„ js æ–‡ä»¶ç”¨äºç›´æ¥å¼•ç”¨.(ç„¶åå¯ä»¥é€šè¿‡ plugin å»æ£€æŸ¥å…¨å±€æ—¶å€™å­˜åœ¨è¿™ä¸ªæ¨¡å—, å­˜åœ¨å°±ä¸å®šä¹‰)</li><li>babel-node: ä¸»è¦æ˜¯å®ç°åœ¨ node ä¸­å†™ä»£ç å’Œæ‰§è¡Œè„šæœ¬çš„èƒ½åŠ›, å¯ä»¥ç›´æ¥è¿è¡Œ ES6ä»£ç . æ¯”å¦‚ç›´æ¥åœ¨ node ä¸­å†™ jsx, é€šè¿‡è¿™ä¸ªå°±å¯ä»¥æ‰§è¡Œ. ä½†æ˜¯è¦æŠŠå®ƒç¼–è¯‘æˆå¯æ‰§è¡Œçš„è„šæœ¬è¿˜éœ€è¦ <code>babel-register</code></li></ul><p>å®‰è£…<br><code>npm install --global babel-cli</code></p><p>ç”¨æ³•<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line">babel example.js</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> è½¬ç ç»“æœå†™å…¥æ–‡ä»¶</span><br><span class="line">babel example.js -o result.js</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> æ•´ä¸ªç›®å½•è½¬ç </span><br><span class="line">babel src -d lib</span><br><span class="line"></span><br><span class="line"><span class="meta">#</span> ç”Ÿæˆ source map æ–‡ä»¶</span><br><span class="line">babel src -d lib -s</span><br></pre></td></tr></table></figure></p><p>å…¨å±€ç¯å¢ƒä¸‹ babel æ— æ³•æ”¯æŒä¸åŒç‰ˆæœ¬çš„ babel, æ‰€ä»¥å®‰å…¨çš„åšæ³•è¿˜æ˜¯æŠŠ babel è£…åœ¨é¡¹ç›®ä¸­<br><figure class="highlight shell"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-cli</span><br></pre></td></tr></table></figure></p><p>package.json æ”¹æˆ:<br><figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"script"</span>: <span class="string">"babel src -d lib"</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>babel-register</strong><br>å®ƒçš„ç‰¹ç‚¹å°±æ˜¯å®æ—¶ç¼–è¯‘, ä¸ä¼šè¾“å‡ºæ–‡ä»¶, ç”¨æ¥æ”¹å†™ <code>require</code> å‘½ä»¤ä¸ºå®ƒåŠ ä¸Šé’©å­. <code>require</code> è¿›æ¥çš„æ–‡ä»¶å°±ä¼šè¢«è½¬ç , ä½†æ˜¯å®ƒä¸ä¼šè½¬ç å½“å‰æ–‡ä»¶ä¸­çš„ä»£ç .</p><p>å®‰è£…<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">npm install --save-dev babel-register</span><br></pre></td></tr></table></figure></p><p>ä½¿ç”¨<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// å¿…é¡»å…ˆåŠ è½½ register</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'babel-register'</span>)</span><br><span class="line"><span class="comment">// ç„¶å register å°±ä¼šå¯¹ test.js æ–‡ä»¶è½¬ç </span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'test.js'</span>)</span><br></pre></td></tr></table></figure></p><blockquote><p>ç”±äº <code>babel-register</code> æ˜¯å³æ—¶è½¬ç , æ‰€ä»¥åªé€‚ç”¨äºå¼€å‘ç¯å¢ƒä½¿ç”¨.</p></blockquote><h3 id="babel-core"><a href="#babel-core" class="headerlink" title="babel-core"></a>babel-core</h3><p><code>babel-core</code> å¯ä»¥è¯´æ˜¯ babel æœ€ä¸ºæ ¸å¿ƒçš„ä¸€ä¸ªåŒ…, å¯ä»¥æŠŠå®ƒçœ‹æˆä¸€ä¸ªç¼–è¯‘å™¨, babel æ ¸å¿ƒçš„ API éƒ½åœ¨é‡Œé¢. æ¯”å¦‚: transform å¤„ç†è½¬ç , å› ä¸º ES6 çš„è¯­æ³•è·Ÿè€è¯­æ³•ä¸åŒ, æ‰€ä»¥å…ˆå°†æˆ‘ä»¬çš„ä»£ç è½¬æ¢ä¸º AST(æŠ½è±¡è¯­æ³•æ ‘), ç„¶ååˆ†åˆ«åšå¤„ç†è½¬åŒ–ä¸º ES5. webpack çš„ babel-loader å°±æ˜¯è°ƒç”¨è¿™äº› API å®Œæˆè½¬è¯‘çš„. <a href="https://babeljs.cn/docs/usage/api/" target="_blank" rel="noopener">è¿™é‡Œæ˜¯è¯¦ç»†çš„ API</a></p><blockquote><p>è¿™é‡Œéœ€è¦æ³¨æ„çš„æ˜¯: <code>babel-core</code> ä»…å…³æ³¨ code transform, ä¹Ÿå°±æ˜¯è¯´å®ƒåªåšè¯­æ³•ä¸Šçš„è½¬æ¢, æ¯”å¦‚ç®­å¤´å‡½æ•°. æ‰€ä»¥å¹¶ä¸æ˜¯ä»€ä¹ˆéƒ½èƒ½ç”¨ babel æ¥è½¬æ¢çš„, å¦‚æœæ¶‰åŠåˆ°æ–°çš„ API å°±éœ€è¦ä½ ç”¨ polyfill æ¥è½¬è¯‘, æ¯”å¦‚ <code>Promise</code>.</p></blockquote><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æ•´å—å¼•å…¥</span></span><br><span class="line"><span class="keyword">var</span> babel = <span class="built_in">require</span>(<span class="string">'babel-core'</span>)</span><br><span class="line"><span class="comment">// ä¹Ÿå¯ä»¥é€‰æ‹©æŸä¸ª API å•ç‹¬ä½¿ç”¨</span></span><br><span class="line"><span class="keyword">import</span> &#123; transform &#125; <span class="keyword">from</span> <span class="string">'babel-core'</span></span><br></pre></td></tr></table></figure><p>ä¸»è¦çš„ API:</p><p><strong>babel.transform(code: string, options?: Object)</strong><br>å°†ä¼ å…¥çš„ code åšè½¬æ¢, è¿”å›å€¼ä¸ºä¸€ä¸ªå¯¹è±¡, å‚æ•°ä¸º: ç”Ÿæˆçš„å¯¹è±¡, source map å’Œ AST</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> result = babel.transform(<span class="string">"code();"</span>, options);</span><br><span class="line">result.code</span><br><span class="line">result.map</span><br><span class="line">result.ast</span><br></pre></td></tr></table></figure><p><strong>babel.transformFile(filename: string, options?: Object, callback: Function)</strong><br>å¼‚æ­¥è½¬è¯‘æ–‡ä»¶ä¸­çš„æ‰€æœ‰å†…å®¹</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">babel.transformFile(<span class="string">'filename.js'</span>, options, <span class="function"><span class="keyword">function</span> (<span class="params">err, result</span>) </span>&#123;</span><br><span class="line">  result <span class="comment">// &#123; code, map, ast &#125;</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p><strong>babel.transformFileSync(filename: string, options?: Object)</strong><br><code>babel.transformFile</code> çš„åŒæ­¥ç‰ˆæœ¬, è¿”å›å€¼ä¸º <code>filename</code> æ–‡ä»¶ä¸­è½¬è¯‘åçš„ä»£ç </p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">babel.transformFileSync(filename, options) <span class="comment">// &#123; code, map, ast &#125;</span></span><br></pre></td></tr></table></figure><p><strong>babel.transformFromAst(ast: Object, code?: string, options?: Object)</strong><br>åè½¬è¯‘, ç»™ä¸€ä¸ª AST è½¬ä¸º code</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> code = <span class="string">'if (true) return'</span></span><br><span class="line"><span class="keyword">const</span> ast = babylon.parse(code, &#123; <span class="attr">allowReturnOutsideFunction</span>: <span class="literal">true</span> &#125;)</span><br><span class="line"><span class="keyword">const</span> &#123; code, map, ast &#125; = babel.transformFormAst(ast, code, options)</span><br></pre></td></tr></table></figure><h3 id="babel-runtime"><a href="#babel-runtime" class="headerlink" title="babel-runtime"></a>babel-runtime</h3><p><a href="https://babeljs.cn/docs/plugins/transform-runtime/" target="_blank" rel="noopener"><code>babel-runtime</code></a> è¿™ä¸ªåŒ…å…¶å®å°±æ˜¯æŠŠ core-js å’Œ regenerator ç»„åˆèµ·æ¥ä¾›ä½¿ç”¨, å®ƒå’Œ <code>babel-polyfill</code> çš„éƒ½æ˜¯ä¸ºäº†æ¨¡æ‹Ÿ ES6 ç¯å¢ƒ. ä¹‹å‰æåˆ°çš„ <code>babel-core</code> åªå¯¹è¯­æ³•è¿›è¡Œè½¬æ¢, ä½†ä¸æ”¯æŒ Promise, Set, Map, array.reduce, Array.form, genertor, async è¿™äº›æ–° API çš„ç¼–è¯‘, æ‰€ä»¥æ‰ä¼šç”¨åˆ°è¿™ä¸¤ä¸ªä¸œè¥¿.</p><p><strong>core-js</strong>: ä¸»è¦å®ç°äº† Promise, Symbols, ES7ææ¡ˆç­‰ç­‰çš„ polyfill, åŒ…å«äº†å¤§éƒ¨åˆ†çš„ JavaScript æœ€æ–°æ ‡å‡†çš„å«ç‰‡.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// éœ€è¦å•ä¸ªå¼•ç”¨åå†ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">require</span>(<span class="string">'core-js/array/reduce'</span>)</span><br></pre></td></tr></table></figure></p><p><strong>regenerator</strong>: ä¸»è¦å®ç° generator/yeild, async/await (ä¸çŸ¥é“ä¸ºå•¥ core-js ä¸æŠŠè¿™ä¸¤ä¸ªä¸€èµ·å®ç°äº†â€¦)</p><p><strong>helpers</strong>: <code>babel-runtime</code> é‡Œä¹Ÿæœ‰ helpers, å®ƒé‡Œé¢çš„ helpers ç›¸å½“äºä¹‹å‰æåˆ°çš„ <code>babel-external-helpers</code> ç”Ÿæˆçš„ helpers.js, åªä¸è¿‡æŠŠæ¯ä¸ª helpers å‡½æ•°éƒ½å•ç‹¬æ”¾åˆ°ä¸€ä¸ªæ–‡ä»¶å¤¹é‡Œè€Œå·². è¿™æ ·é…åˆ transform çš„æ—¶å€™, éœ€è¦ç”¨åˆ° helpers å‡½æ•°å°±å¯ä»¥ç›´æ¥ä» <code>babel-runtime</code> ä¸­å¼•ç”¨äº†.<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> _asyncToGenerator2 = <span class="built_in">require</span>(<span class="string">'babel-runtime/helpers/asyncToGenerator'</span>)</span><br></pre></td></tr></table></figure></p><p>åŒºåˆ«: </p><ul><li><a href="https://babeljs.cn/docs/usage/polyfill" target="_blank" rel="noopener">babel-polyfill</a>: æ˜¯é€šè¿‡å…¨å±€å¯¹è±¡å’Œå†…ç½®å¯¹è±¡çš„ prototype ä¸Šæ·»åŠ æ–¹æ³•æ¥è¾¾åˆ°ç›®çš„, æ‰€ä»¥ä¸€æ—¦å¼•å…¥ <code>babel-polyfill</code> å°±ä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒ.</li><li>babel-runtime: <code>babel-runtime</code> æ˜¯ä¸€ä¸ªæ¨¡å—, æ‰€ä»¥å®ƒä¸ä¼šæ±¡æŸ“å…¨å±€ç¯å¢ƒå’Œå†…ç½®å¯¹è±¡çš„åŸå‹. å®ƒçš„åšæ³•å¼•å…¥éœ€è¦çš„ helper å‡½æ•°(ç±»ä¼¼: <code>const Promise = require(&#39;babel-runtime/core-js/promise&#39;)</code> æ¥å¼•å…¥ Promise).</li></ul><p>ä¼˜ç¼ºç‚¹:</p><ul><li>babel-poly-fill: å¼•å…¥ä¸€åŠ³æ°¸é€¸, ä½†æ˜¯æ±¡æŸ“ç¯å¢ƒ.</li><li>babel-runtime: <ol><li>æ‰‹åŠ¨å¼•å…¥ä¸æ–¹ä¾¿</li><li>ç›´æ¥åœ¨ä»£ç ä¸­å¼•å…¥ helper å‡½æ•°æ„å‘³ç€ä¸èƒ½å…±äº«, æœ€ç»ˆæ‰“åŒ…å‡ºæ¥ä¼šæœ‰å¾ˆå¤šå†—ä½™ä»£ç (å¼•å…¥çš„éƒ½æ˜¯å…¨é‡çš„ polyfill). </li></ol></li></ul><p>æ‰€ä»¥è¦é…åˆ <code>babel-plugin-transform-runtime</code> (å¾ˆå¤šåœ°æ–¹éƒ½æ˜¯æŠŠ <code>babel-runtime</code> å’Œ <code>babel-plugin-transform-runtime</code> ç»Ÿç§°ä¸º transform-runtime, å› ä¸ºå®ƒä¿©å¾—åˆåœ¨ä¸€èµ·æ‰å¥½ç”¨) æ¥è¾¾åˆ°æŒ‰éœ€å¼•å…¥ helper é¿å…é‡å¤æ‰“åŒ…å’Œæ‰‹åŠ¨å¼•å…¥çš„ç—›è‹¦, å®ƒä¸»è¦æ˜¯åšä¸€å±‚æ˜ å°„: å°† <code>babel-runtime</code> å†…å¼•ç”¨åˆ°çš„ core-js æˆ– regenerator.js æ˜ å°„åˆ°å…·ä½“å¯¹åº”çš„ helper. </p><blockquote><p>æ³¨æ„: <code>babel-runtime</code> æ— æ³•è½¬ç å®ä¾‹æ–¹æ³•, å³å†…ç½®å¯¹è±¡åŸå‹ä¸Šçš„æ–¹æ³•, åªèƒ½é€šè¿‡ <code>babel-polyfill</code> æ¥è½¬ç . æ¯”å¦‚:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">Array</span>.prototype.find()</span><br><span class="line"><span class="string">'hello'</span>.includes(<span class="string">'h'</span>)</span><br></pre></td></tr></table></figure></p></blockquote><p>å¦å¤–, å…³äºä¸ºä»€ä¹ˆ <code>babel-runtime</code> æ˜¯ dependencies ä¾èµ–, å› ä¸ºä»–åªæ˜¯é›†åˆäº† polyfill çš„ä¸€ä¸ª library, å¯¹åº”éœ€è¦çš„ polyfill éƒ½æ˜¯è¦å¼•å…¥é¡¹ç›®ä¸­, å¹¶è·Ÿé¡¹ç›®ä»£ç ä¸€èµ·æ‰“åŒ…çš„.</p><h3 id="babel-preset-env"><a href="#babel-preset-env" class="headerlink" title="babel-preset-env"></a>babel-preset-env</h3><p>å®ƒèƒ½æ ¹æ®å½“å‰çš„è¿è¡Œç¯å¢ƒ, è‡ªåŠ¨ç¡®å®šä½ éœ€è¦çš„ plugins å’Œ polyfills, babel çš„é…ç½®å®˜æ–¹æ¨èæ˜¯å†™åˆ° <code>.babelrc</code> æ–‡ä»¶ä¸­, ä»¥ <code>Vue-cli</code> çš„ babel é…ç½®ä¸ºä¾‹.<a href="https://babeljs.cn/docs/plugins/preset-env/" target="_blank" rel="noopener">è¯¦ç»†å‚æ•°è®¾ç½®åŠè¯´æ˜</a></p><figure class="highlight"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line">&#123;</span><br><span class="line">  <span class="attr">"presets"</span>: [</span><br><span class="line">    [<span class="string">"env"</span>, </span><br><span class="line">      &#123; </span><br><span class="line">        "modules": false // è®¾ç½® ES6 æ¨¡å—è½¬è¯‘çš„æ¨¡å¼, é»˜è®¤æ˜¯ commonjs</span><br><span class="line">      &#125;</span><br><span class="line">    ],</span><br><span class="line">    // éœ€è¦æ”¯æŒåˆ°å“ªä¸ªé˜¶æ®µçš„ JavaScript ç‰ˆæœ¬</span><br><span class="line">    <span class="string">"stage-2"</span></span><br><span class="line">  ],</span><br><span class="line">  // éœ€è¦çš„æ’ä»¶</span><br><span class="line">  "plugins": [</span><br><span class="line">    "transform-runtime", // è™½ç„¶è¿™é‡Œæ²¡æœ‰å†™ babel-runtime, ä½†æ˜¯ transform-runtime ä¾èµ–äºå®ƒ, æ‰€ä»¥è¿˜æ˜¯è¦å®‰è£…</span><br><span class="line">    <span class="string">"transform-vue-jsx"</span></span><br><span class="line">  ],</span><br><span class="line">  // ç¼–è¯‘è¿‡ç¨‹æ˜¯å¦ä¿ç•™æ³¨é‡Š</span><br><span class="line">  "comments": false,</span><br><span class="line">  "env": &#123;</span><br><span class="line">    "test": &#123;</span><br><span class="line">      "presets": ["env", "stage-2"],</span><br><span class="line">      "plugins": [ "istanbul"]</span><br><span class="line">    &#125;</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>æœ¬æ¥ <code>babel-preset-env</code> ä¸­æœ‰ä¸€ä¸ª useBuiltIns é€‰é¡¹(é»˜è®¤å€¼æ˜¯ false), å°±æ˜¯å®ƒå®ç°çš„æ ¹æ®è¿è¡Œç¯å¢ƒå¹¶åˆ¤æ–­éœ€è¦ä»€ä¹ˆ polyfill, è¾¾åˆ°æŒ‰éœ€å¼•å…¥è€Œä¸æ˜¯æ•´ä¸ªå¼•å…¥, å¯¹äº <code>import &#39;babel-polyfill&#39;</code> å°±å¾ˆæ£’äº†. ä½†æ˜¯å¯ä»¥çœ‹åˆ° vue-template å¹¶æ²¡æœ‰ä½¿ç”¨è¿™ä¸ªé€‰é¡¹, è¿™æ˜¯å› ä¸º   <a href="javascript:" title="æˆ‘æ¶ˆä¸æ‰è¿™ä¸ªè¶…é“¾æ¥ğŸ˜‘" target="_blank" rel="noopener">babel-preset-env@1.x</a> çš„ç‰ˆæœ¬æ²¡æœ‰åŠæ³•å¾ˆå¥½æ¶ˆé™¤æœªä½¿ç”¨çš„ polyfill, åœ¨2.x ç‰ˆæœ¬ä¸‹å¯ä»¥ç”¨ <code>usebuiltIns: &#39;usage&#39;</code>è¾¾åˆ°ç›®çš„.</p><h3 id="å…¶ä»–"><a href="#å…¶ä»–" class="headerlink" title="å…¶ä»–"></a>å…¶ä»–</h3><p>babel è¿˜æœ‰å¾ˆå¤šç›¸å…³çš„ä¸œè¥¿æ²¡è¯´åˆ°, åªæŒ‘äº†å‡ ä¸ªæœ€é‡è¦çš„æ¥è¯´, å…·ä½“çš„ helpers/ plugins éƒ½å¯ä»¥åˆ°<a href="https://github.com/babel/babel/tree/master/packages" target="_blank" rel="noopener">å®˜æ–¹ä»“åº“</a>æŸ¥çœ‹</p><ul><li><a href="https://github.com/babel/babel/tree/master/packages/babylon" target="_blank" rel="noopener">badylon</a>: è¯æ³•è§£æå™¨</li><li><a href="https://github.com/babel/babel/tree/master/packages/babel-traverse" target="_blank" rel="noopener">babel-traverse</a>: ç”¨äºéå†, ç»´æŠ¤æ•´ä¸ª AST çš„çŠ¶æ€</li><li><a href="https://github.com/babel/babel/tree/master/packages/babel-generator" target="_blank" rel="noopener">babel-generator</a>: æ ¹æ® AST ç”Ÿæˆä»£ç </li></ul><h4 id="babel-çš„å·¥ä½œæµç¨‹"><a href="#babel-çš„å·¥ä½œæµç¨‹" class="headerlink" title="babel çš„å·¥ä½œæµç¨‹"></a>babel çš„å·¥ä½œæµç¨‹</h4><p>è¾“å…¥éœ€è¦è½¬ç çš„ä»£ç  -&gt; badylon è§£æ -&gt; å¾—åˆ° AST -&gt;<br>babel-traverse éå†è½¬è¯‘ -&gt; å¾—åˆ°æ–°çš„ AST -&gt;<br>æœ€å babel-generator æ ¹æ®æ–°çš„ AST ç”Ÿæˆä»£ç </p><h3 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h3><p>æ•´ä¸ªæ¥è¯´æˆ‘è§‰å¾—è¿˜æ˜¯ <code>babel-runtime</code> å’Œ <code>babel-polyfill</code> æ¯”è¾ƒéš¾åŒºåˆ†, å…¶å®ä¸¤è€…çš„æ ¸å¿ƒéƒ½åœ¨äº <a href="https://github.com/zloirock/core-js#basic" target="_blank" rel="noopener">core-js</a> åªæ˜¯å„æœ‰ä¼˜ç¼ºç‚¹è€Œå·², ä¸‹é¢ä¼šå†ç®€è¦æ€»ç»“ä¸€ä¸‹åŒºåˆ«. å…¶ä»–çš„è¯åªéœ€è¦çŸ¥é“æ¯ä¸ªä¸œè¥¿æ˜¯å¹²å•¥çš„å°±è¡Œäº†.</p><ul><li>babel-polyfill: æ±¡æŸ“ç¯å¢ƒ, æ”¯æŒå®ä¾‹æ–¹æ³•(å¦‚æœåªæƒ³å¼•å…¥ä¸€äº›ç‰¹å®šçš„polyfill, é‚£å°±å» <a href="https://github.com/zloirock/core-js#basic" target="_blank" rel="noopener">core-js</a> ä¸­æ‰¾ç›¸åº”çš„æ–¹æ³•è‡ªå·±æ‰‹åŠ¨ require è¿›æ¥); </li><li>runtime: æŒ‰éœ€å¼•ç”¨,ä¸æ”¯æŒå®ä¾‹æ–¹æ³•.</li></ul><p>Created on 2018-4-11 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¯¹äº babel çš„ä½¿ç”¨, ä¸€ç›´åœç•™åœ¨ä¸ webpack ç»“åˆä½¿ç”¨, ä»¥åŠåœ¨ Vue å¼€å‘ç¯å¢ƒä¸‹è„šæ‰‹æ¶åˆæ˜¯å¼€ç®±å³ç”¨. å¯¼è‡´å¾ˆå¤š babel çš„åŒ…, æˆ‘éƒ½ä¸æ¸…æ¥šä»–ä»¬æ˜¯å¹²ä»€ä¹ˆçš„. æ¯”å¦‚ babel-register/ babel-runtime/ helpers/ å„ç§ pre
      
    
    </summary>
    
    
      <category term="Babel" scheme="https://yoursite.com/tags/Babel/"/>
    
  </entry>
  
  <entry>
    <title>è·¨åŸŸ</title>
    <link href="https://yoursite.com/2018/04/02/%E8%B7%A8%E5%9F%9F/"/>
    <id>https://yoursite.com/2018/04/02/è·¨åŸŸ/</id>
    <published>2018-04-02T09:01:24.000Z</published>
    <updated>2022-08-23T09:37:40.693Z</updated>
    
    <content type="html"><![CDATA[<p>è·¨åŸŸè¿™å—æ˜¯å‰åç«¯åˆ†ç¦»å¿…ç»çš„ä¸€æ¡è·¯, è¿™æ¬¡å¥½å¥½æ•´ç†ä¸€ä¸‹å…³äºè·¨åŸŸæ–¹é¢çŸ¥è¯†.</p><h3 id="ä»€ä¹ˆæ˜¯è·¨åŸŸ"><a href="#ä»€ä¹ˆæ˜¯è·¨åŸŸ" class="headerlink" title="ä»€ä¹ˆæ˜¯è·¨åŸŸ?"></a>ä»€ä¹ˆæ˜¯è·¨åŸŸ?</h3><p>è·¨åŸŸæ˜¯å—åŒæºç­–ç•¥çš„å½±å“è€Œå¯¼è‡´çš„, æŒ‡ä¸€ä¸ªæºä¸‹çš„èµ„æºè¯•å›¾æ“ä½œå¦ä¸€ä¸ªæºä¸‹çš„èµ„æº.</p><blockquote><p>é‚£ä¹ˆ, ä»€ä¹ˆåˆæ˜¯åŒæºç­–ç•¥å‘¢?<br>å°±æ˜¯é™åˆ¶ä»ä¸€ä¸ªæºçš„èµ„æºå¦‚ä½•ä¸å¦ä¸€ä¸ªæºçš„èµ„æºäº¤äº’, ç”¨äºéš”ç¦»æ½œåœ¨çš„æ¶æ„æ–‡ä»¶, ä¿è¯æ–‡ä»¶çš„å®‰å…¨æ€§. æ‰€è°“çš„åŒæºæ˜¯æŒ‡: åè®®/åŸŸå/ç«¯å£ ä¸‰è€…ç›¸åŒ, å³ä½¿ä¸¤ä¸ªä¸åŒçš„åŸŸåæŒ‡å‘åŒä¸€ä¸ª IP åœ°å€, ä¹ŸéåŒæº. å¦‚æœæ²¡æœ‰åŒæºç­–ç•¥, æµè§ˆå™¨å¾ˆå®¹æ˜“å—åˆ° XSS/CSRF ç­‰çš„æ”»å‡»(XSS: è·¨ç«™è„šæœ¬æ”»å‡»;CSRF: è·¨ç«™è¯·æ±‚ä¼ªé€ ).</p></blockquote><p>åŒæºç­–ç•¥å°†é™åˆ¶ä»¥ä¸‹è¡Œä¸º:</p><ul><li>Cookie/LocalStorage/IndexDB</li><li>DOM æ— æ³•è·å¾—</li><li>Ajax è¯·æ±‚æ— æ³•å‘é€</li></ul><h3 id="è·¨åŸŸè§£å†³æ–¹æ¡ˆ"><a href="#è·¨åŸŸè§£å†³æ–¹æ¡ˆ" class="headerlink" title="è·¨åŸŸè§£å†³æ–¹æ¡ˆ"></a>è·¨åŸŸè§£å†³æ–¹æ¡ˆ</h3><h4 id="1-JSONP"><a href="#1-JSONP" class="headerlink" title="1. JSONP"></a>1. JSONP</h4><p>å®ƒçš„ç‰¹æ€§æ˜¯ç®€å•/ å…¼å®¹æ€§å¥½/ æ”¹é€ å°, ä½†æ˜¯ä¸æ”¯æŒ POST è¯·æ±‚. åŸç†æ˜¯é€šè¿‡ <code>script</code> æ ‡ç­¾æ”¾å…¥å›è°ƒå‡½æ•°, æœåŠ¡ç«¯å°†è¿”å›æ•°æ®å¡å…¥å›è°ƒå‡½æ•°å³å¯.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> createScript = <span class="function"><span class="params">url</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> script = <span class="built_in">document</span>.createElement(<span class="string">'script'</span>)</span><br><span class="line">    script.type = <span class="string">'text/javascript'</span></span><br><span class="line">    script.src = url</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(script)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥è¯·æ±‚åœ°å€</span></span><br><span class="line">createScript(<span class="string">'http://www.example.com/api?callback=foo'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// å›è°ƒå‡½æ•°</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æœåŠ¡ç«¯è¿”å›æ•°æ®</span></span><br><span class="line">    <span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="2-document-domain"><a href="#2-document-domain" class="headerlink" title="2. document.domain"></a>2. document.domain</h4><p>é€šè¿‡è®¾ç½®åŸŸåæ¥è®¿é—® <code>Cookie</code> å’Œ æ“ä½œ <code>iframe</code> çª—å£, æ­¤æ–¹æ¡ˆåªé€‚ç”¨äºä¸»åŸŸç›¸åŒ, å­åŸŸä¸åŒçš„åœºæ™¯.</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line">// çˆ¶çª—å£ (http://www.main.com/a.html)</span><br><span class="line"><span class="tag">&lt;<span class="name">iframe</span> <span class="attr">id</span>=<span class="string">'iframe'</span> <span class="attr">src</span>=<span class="string">'http://www.child.main.com/b.html'</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.domain = <span class="string">'main.com'</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.cookie = <span class="string">'test=hi'</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">var</span> user = <span class="string">'admin'</span></span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">// å­çª—å£ (http://www.child.main.com/b.html)</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">document</span>.domain = <span class="string">'example.com'</span></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> parentMessage = <span class="built_in">document</span>.cookie</span></span><br><span class="line"><span class="javascript">    <span class="built_in">console</span>.log(<span class="built_in">window</span>.parent.user)</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="3-window-location-hash"><a href="#3-window-location-hash" class="headerlink" title="3. window.location.hash"></a>3. window.location.hash</h4><p>é€šè¿‡ä¿®æ”¹ hash å€¼æ¥ä¼ é€’å‚æ•°, ä¿®æ”¹ hash å€¼å¹¶ä¸ä¼šåˆ·æ–°é¡µé¢ä½†å­—èŠ‚æ•°æœ‰é™åˆ¶.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çˆ¶çª—å£å‘å­çª—å£å†™å…¥ hash</span></span><br><span class="line"><span class="keyword">let</span> src = <span class="string">`<span class="subst">$&#123;childUrl&#125;</span>#test=hi`</span></span><br><span class="line"><span class="built_in">document</span>.querySelector(<span class="string">'#iframe'</span>).src = src</span><br><span class="line"></span><br><span class="line"><span class="comment">// å­çª—å£</span></span><br><span class="line"><span class="comment">// æ¥æ”¶æ¶ˆæ¯</span></span><br><span class="line"><span class="built_in">window</span>.onhashchange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> meg = <span class="built_in">window</span>.location.hash</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å­çª—å£å‘çˆ¶çª—å£å†™å…¥ hash</span></span><br><span class="line"><span class="built_in">window</span>.parent.href = <span class="string">`<span class="subst">$&#123;<span class="built_in">window</span>.parent.href&#125;</span>#world`</span></span><br></pre></td></tr></table></figure><h4 id="4-window-name"><a href="#4-window-name" class="headerlink" title="4. window.name"></a>4. window.name</h4><p>window.name åªè¦åœ¨åŒä¸€ä¸ªçª—å£, æ— è®ºæ˜¯å¦åŒæºå‰ä¸€ä¸ªé¡µé¢è®¾ç½®äº†è¿™ä¸ªå±æ€§, åä¸€ä¸ªé¡µé¢å°±èƒ½è¯»å–. å®ƒå¯ä»¥æ”¯æŒ2M å¤§å°çš„å€¼ä½†æ˜¯å˜åŒ–éœ€è¦è‡ªå·±ç›‘å¬.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// çˆ¶çª—å£ (http://www.main.com/a.html)</span></span><br><span class="line"><span class="keyword">const</span> proxy = <span class="function">(<span class="params">url, callback</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">const</span> iframe = <span class="built_in">document</span>.createElement(<span class="string">'iframe'</span>)</span><br><span class="line">    <span class="keyword">let</span> state = <span class="number">0</span></span><br><span class="line"></span><br><span class="line">    <span class="comment">// è·³è½¬åˆ°è·¨åŸŸé¡µé¢</span></span><br><span class="line">    iframe.src = url</span><br><span class="line"></span><br><span class="line">    iframe.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (state === <span class="number">1</span>) &#123;</span><br><span class="line">            <span class="comment">// ç¬¬äºŒæ¬¡ä»£ç†ä¹ŸåŠ è½½æˆåŠŸä¹‹å, è¯»å– name å±æ€§</span></span><br><span class="line">            callback(<span class="built_in">window</span>.name)</span><br><span class="line">            <span class="built_in">document</span>.body.removeChild(iframe);</span><br><span class="line">        &#125; <span class="keyword">else</span> <span class="keyword">if</span> (state === <span class="number">0</span>) &#123;</span><br><span class="line">            <span class="comment">//  ç¬¬ä¸€æ¬¡è·³è½¬åˆ°ä»£ç†é¡µé¢</span></span><br><span class="line">            iframe.src = <span class="string">'http://www.main.com/proxy.html'</span></span><br><span class="line">            state = <span class="number">1</span></span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(iframe)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥è·¨åŸŸé¡µé¢ URL</span></span><br><span class="line">proxy(<span class="string">'http://www.child.com/b.html'</span>, (name) =&gt; &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(name) <span class="comment">// 'This message from b.html'</span></span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line"><span class="comment">// è·¨åŸŸå­çª—å£ (http://www.child.com/b.html) </span></span><br><span class="line"><span class="comment">// è®¾ç½® name å±æ€§</span></span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'This message from b.html'</span></span><br></pre></td></tr></table></figure><h4 id="5-postMessage"><a href="#5-postMessage" class="headerlink" title="5. postMessage"></a>5. postMessage</h4><p>postMessage(è·¨æ–‡æ¡£é€šä¿¡) æ˜¯ HTML5 ä¸­ä¸ºäº†è§£å†³è·¨åŸŸå‡ºçš„ API, å¯ä»¥è§£å†³ä»¥ä¸‹å‡ ç§é—®é¢˜:</p><ol><li>é¡µé¢å’Œå…¶æ‰“å¼€çš„æ–°çª—å£çš„æ•°æ®ä¼ é€’</li><li>å¤šçª—å£ä¹‹é—´æ¶ˆæ¯ä¼ é€’</li><li>é¡µé¢ä¸åµŒå¥—çš„iframeæ¶ˆæ¯ä¼ é€’</li><li>ä¸Šé¢ä¸‰ä¸ªåœºæ™¯çš„è·¨åŸŸæ•°æ®ä¼ é€’</li></ol><p>å‘é€æ¶ˆæ¯é€šè¿‡ <code>postMessage(data, origin)</code> æ–¹æ³•, è¯¥æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°: </p><ul><li>data: éœ€è¦ä¼ é€’çš„å‚æ•°, ç”±äºéƒ¨åˆ†æµè§ˆå™¨åªæ”¯æŒå­—ç¬¦ä¸², æ‰€ä»¥ä¼ é€’ä¹‹å‰æœ€å¥½å…ˆ <code>JSON.stringify()</code> åºåˆ—åŒ–</li><li>origin: æ˜¯æ¥æ”¶æ–¹çš„ åè®® + ä¸»æœº + ç«¯å£, å¯ä»¥æ˜¯è®¾ç½®ä¸º <code>*</code>, æŒ‡å®šä¸å½“å‰çª—å£åŒæºçš„è¯è®¾ç½®ä¸º <code>/</code>.</li></ul><p>æ¥æ”¶æ¶ˆæ¯é€šè¿‡ <code>message</code> äº‹ä»¶ç›‘å¬, è¯¥äº‹ä»¶æœ‰ä¸€ä¸ª <code>event</code> å‚æ•°æä¾›ä¸‰ä¸ªå±æ€§:</p><ul><li>event.origin: æ¶ˆæ¯æ¥æ”¶æ–¹</li><li>event.source: æ¶ˆæ¯æ¥æº</li><li>event.data: æ¶ˆæ¯ä½“</li></ul><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><span class="line">// çˆ¶çª—å£ (http://www.main.com/a.html)</span><br><span class="line"><span class="tag">&lt;<span class="name">firame</span> <span class="attr">id</span>=<span class="string">'iframe'</span> <span class="attr">src</span>=<span class="string">'http://www.child.com/b.html'</span>&gt;</span><span class="tag">&lt;/<span class="name">iframe</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> iframe = <span class="built_in">document</span>.querySelector(<span class="string">'#iframe'</span>)</span></span><br><span class="line"><span class="javascript">    <span class="keyword">let</span> url = iframe.src</span></span><br><span class="line"><span class="javascript">    iframe.onload = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> data = &#123;</span></span><br><span class="line"><span class="javascript">            name: <span class="string">'parent'</span>,</span></span><br><span class="line"><span class="javascript">            message: <span class="string">'This message from parent'</span></span></span><br><span class="line"><span class="undefined">        &#125;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// è·¨åŸŸå‘å­çª—å£å‘é€æ¶ˆæ¯</span></span></span><br><span class="line"><span class="javascript">        iframe.contentWindow.postMessage(<span class="built_in">JSON</span>.stringify(data), url)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="comment">// çˆ¶çª—å£ç›‘å¬å­çª—å£å‘é€çš„æ¶ˆæ¯</span></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onmessage = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="comment">// è¿‡æ»¤ä¸å±äºè‡ªå·±çš„æ¶ˆæ¯</span></span></span><br><span class="line"><span class="javascript">        <span class="keyword">if</span> (data.origin !== <span class="string">'http://www.main.com/a.html'</span>) <span class="keyword">return</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'data from child: '</span> + event.data)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br><span class="line"></span><br><span class="line">// å­çª—å£ (http://www.child.com/b.html)</span><br><span class="line"><span class="tag">&lt;<span class="name">script</span>&gt;</span><span class="undefined"></span></span><br><span class="line"><span class="javascript">    <span class="built_in">window</span>.onmessage = <span class="function">(<span class="params">event</span>) =&gt;</span> &#123;</span></span><br><span class="line"><span class="javascript">        <span class="built_in">console</span>.log(<span class="string">'data from main: '</span> + event.data)</span></span><br><span class="line"><span class="javascript">        <span class="keyword">let</span> data = <span class="built_in">JSON</span>.parse(event.data)</span></span><br><span class="line"><span class="javascript">        data.name = <span class="string">'child'</span></span></span><br><span class="line"><span class="undefined"></span></span><br><span class="line"><span class="javascript">        <span class="comment">// æ”¶åˆ°æ¶ˆæ¯åå¤„ç†å†å‘é€ç»™çˆ¶çª—å£</span></span></span><br><span class="line"><span class="javascript">        <span class="built_in">window</span>.parent.postMessage(<span class="built_in">JSON</span>.stringify(data), <span class="string">'http://www.main.com/a.html'</span>)</span></span><br><span class="line"><span class="undefined">    &#125;</span></span><br><span class="line"><span class="undefined"></span><span class="tag">&lt;/<span class="name">script</span>&gt;</span></span><br></pre></td></tr></table></figure><h4 id="5-CORS"><a href="#5-CORS" class="headerlink" title="5. CORS"></a>5. CORS</h4><p>è·¨åŸŸèµ„æºå…±äº«(Cross-origin-resource-sharing), å®ƒå…è®¸æµè§ˆå™¨å‘è·¨æºæœåŠ¡å™¨å‘å‡º <code>XMLHttpRequest</code> è¯·æ±‚. CORS ç°åœ¨ä¹Ÿæ˜¯ä¸»æµçš„è·¨åŸŸè§£å†³æ–¹æ¡ˆ, è¿™ç§æ–¹å¼åªéœ€è¦åç«¯åšå¤„ç†, å¦‚æœè¦å¸¦ä¸Š cookie é‚£ä¹ˆå‰åç«¯éƒ½è¦è®¾ç½®.</p><p>å¸¦ cookie ä¼ è¾“:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">xhr.withCredentials = <span class="literal">true</span></span><br></pre></td></tr></table></figure></p><p>è¯·æ±‚å®ä¾‹:<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> XMLRequest = <span class="function">(<span class="params">method = <span class="string">'GET'</span>, url = <span class="string">''</span>, data = <span class="literal">null</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> xhr = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.XMLHttpRequest) &#123;</span><br><span class="line">        xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line">    &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">        xhr = <span class="keyword">new</span> ActiveXObject(<span class="string">'Microsoft.XMLHTTP'</span>)</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    xhr.open(method, url, <span class="literal">true</span>)</span><br><span class="line">    xhr.setRequestHeader(<span class="string">'Content-Type'</span>, <span class="string">'application/x-www-form-urlencoded'</span>)</span><br><span class="line">    xhr.send(data)</span><br><span class="line"></span><br><span class="line">    xhr.onreadystatechange = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (xhr.readyState === <span class="number">4</span> &amp;&amp; xhr.status === <span class="number">200</span>) &#123;</span><br><span class="line">            <span class="built_in">console</span>.log(xhr.responseText)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">XMLRequest(<span class="string">'POST'</span>, <span class="string">'http://www.example.com/api'</span>, &#123;</span><br><span class="line">    name: <span class="string">'cara'</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>å…¶ä¸­ <code>readyState</code> æœ‰äº”ç§çŠ¶æ€:<br>0: ä¸ºåˆå§‹åŒ–<br>1: æœåŠ¡å™¨è¿æ¥å»ºç«‹<br>2: è¯·æ±‚å·²æ¥æ”¶<br>3: è¯·æ±‚å¤„ç†ä¸­<br>4: è¯·æ±‚å·²å®Œæˆ</p><h4 id="6-ä»£ç†æœåŠ¡å™¨"><a href="#6-ä»£ç†æœåŠ¡å™¨" class="headerlink" title="6. ä»£ç†æœåŠ¡å™¨"></a>6. ä»£ç†æœåŠ¡å™¨</h4><p>å…¶å®å°±æ˜¯é€šè¿‡é…ç½® nginx å®ç°ä¸€ä¸ªä¸­é—´æœåŠ¡å™¨ä½œè·³æ¿, ä»£ç†åˆ°ç›®æ ‡æœåŠ¡å™¨.</p><p>é™æ€èµ„æºä»£ç†<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">location / &#123;</span><br><span class="line">    add_header Access-Control-Allow-Origin *;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>å…·ä½“ä»£ç†é…ç½®<br><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line">server &#123;</span><br><span class="line">    listen 81;</span><br><span class="line">    server_name www.example.com;</span><br><span class="line"></span><br><span class="line">    lication / &#123;</span><br><span class="line">        # åå‘ä»£ç†</span><br><span class="line">        proxy_pass http://www.example2.com:8080;</span><br><span class="line">        # ä¿®æ”¹ cookie åŸŸå</span><br><span class="line">        proxy_cookie_domain www.example2.com www.example.com;</span><br><span class="line">        index index.html index.htm;</span><br><span class="line"></span><br><span class="line">        # ä¸å¸¦ cookie æ—¶æ‰èƒ½è®¾ç½®ä¸º *</span><br><span class="line">        add_header Access-Control-Allow-Origin http://www.example.com;</span><br><span class="line">        add_header Access-Control-Allow-Credentials true;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>è°ƒç”¨ç¤ºä¾‹<br><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> xhr = <span class="keyword">new</span> XMLHttpRequest()</span><br><span class="line"></span><br><span class="line">xhr.withCredentials = <span class="literal">true</span></span><br><span class="line">xhr.open(<span class="string">'GET'</span>, <span class="string">'htt://www.example.com:81/?user=admin'</span>, <span class="literal">true</span>)</span><br><span class="line">xhr.send(<span class="literal">null</span>)</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Š, å°±æ˜¯è·¨åŸŸå¯¼è‡´çš„åŸå› ä»¥åŠè§£å†³æ–¹æ¡ˆçš„å¤§è‡´æ€»ç»“.</p><p>Created on 2018-4-2 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è·¨åŸŸè¿™å—æ˜¯å‰åç«¯åˆ†ç¦»å¿…ç»çš„ä¸€æ¡è·¯, è¿™æ¬¡å¥½å¥½æ•´ç†ä¸€ä¸‹å…³äºè·¨åŸŸæ–¹é¢çŸ¥è¯†.&lt;/p&gt;
&lt;h3 id=&quot;ä»€ä¹ˆæ˜¯è·¨åŸŸ&quot;&gt;&lt;a href=&quot;#ä»€ä¹ˆæ˜¯è·¨åŸŸ&quot; class=&quot;headerlink&quot; title=&quot;ä»€ä¹ˆæ˜¯è·¨åŸŸ?&quot;&gt;&lt;/a&gt;ä»€ä¹ˆæ˜¯è·¨åŸŸ?&lt;/h3&gt;&lt;p&gt;è·¨åŸŸæ˜¯å—åŒæºç­–ç•¥çš„å½±å“è€Œå¯¼
      
    
    </summary>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Promise åˆ†æåŠå®ç°</title>
    <link href="https://yoursite.com/2018/01/04/Promise-%E5%88%86%E6%9E%90%E5%8F%8A%E5%AE%9E%E7%8E%B0/"/>
    <id>https://yoursite.com/2018/01/04/Promise-åˆ†æåŠå®ç°/</id>
    <published>2018-01-04T11:07:22.000Z</published>
    <updated>2022-08-23T09:37:40.690Z</updated>
    
    <content type="html"><![CDATA[<p>Promise æ˜¯ ES6ä¸­ä¸­æ”¶å½•çš„å¼‚æ­¥æ“ä½œå°è£…, é€šå¸¸åœ¨å›è°ƒ/ äº‹ä»¶/ æ¶ˆæ¯ç­‰å¼‚æ­¥æ“ä½œä¸­æœ‰æ˜¾è‘—çš„ä¼˜åŠ¿, è®©æˆ‘ä»¬åœ¨æ›´æ–¹ä¾¿çš„æ“ä½œå¼‚æ­¥ä¹Ÿè®©ä»£ç æ›´åŠ æ¸…æ™°.åŒ…æ‹¬ ES7ä¸­çš„ Async/Await ä¹Ÿæ˜¯å¯¹å¼‚æ­¥æ“ä½œçš„å°è£…, ä¸è¿‡ Async æ›´åƒæ˜¯ Generator çš„è¯­æ³•ç³–.</p><h3 id="åŸºç¡€å®ç°"><a href="#åŸºç¡€å®ç°" class="headerlink" title="åŸºç¡€å®ç°"></a>åŸºç¡€å®ç°</h3><p>å­¦ä¹ <a href="https://tech.meituan.com/promise-insight.html" target="_blank" rel="noopener">å‰–æ Promise ä¹‹åŸºç¡€ç¯‡</a>ç”¨ä¸€ä¸ªæœ€å¸¸è§çš„åº”ç”¨æ¥å‰–æ <code>Promise</code>, é€šè¿‡å¼‚æ­¥è·å–ç”¨æˆ· Id, ç„¶åä½œä¸€äº›å¤„ç†. å¹³å¸¸æˆ‘ä»¬æœ€å¸¸ç”¨çš„æ˜¯å›è°ƒçš„æ–¹å¼æ¥å¤„ç†, ä¸‹é¢ç”¨ <code>Promise</code> çš„æ–¹å¼æ¥å¤„ç†.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> getUserId = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function">(<span class="params">resolve, reject</span>) =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">'http://example.com/api'</span>, <span class="attr">params</span>: param).then(<span class="function"><span class="params">res</span> =&gt;</span> &#123;</span><br><span class="line">            resolve(<span class="built_in">JSON</span>.parse(res).id)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">getUserId().then(<span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(id)</span><br><span class="line">    <span class="comment">// do something...</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><p>getUserId å‡½æ•°è¿”å›ä¸€ä¸ª <code>Promise</code>, åœ¨ä»–çš„ <code>then</code> æ–¹æ³•ä¸­æ”¾å…¥å¼‚æ­¥æ“ä½œæˆåŠŸä¹‹åçš„å›è°ƒå‡½æ•°. è¿™ç§æ–¹å¼æ˜æ˜¾æ¯”æˆ‘ä»¬ä¹‹å‰å¸¸ç”¨çš„å›è°ƒå‡½æ•°æ›´åŠ æ–¹ä¾¿è€Œä¸”æ˜“è¯», ä¹Ÿæ›´åŠ å®¹æ˜“é¿å… callback hell.</p><p>é‚£ä¹ˆæ»¡è¶³è¿™æ ·çš„åœºæ™¯çš„<code>Promise</code>æ˜¯æ€æ ·å®ç°çš„å‘¢, ä¸‹é¢æˆ‘ä»¬å¯ä»¥ç®€å•çš„å®ç°ä¸€ä¸‹æœ€åŸºç¡€çš„<code>Promise</code>:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> deferreds = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 4. å­˜å…¥å¼‚æ­¥æˆåŠŸéœ€è¦çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶æŒ‡å‘ä¸¤ä¸ªå›è°ƒå‡½æ•° id =&gt; &#123;&#125;</span></span><br><span class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</span><br><span class="line">        deferreds.push(onFulfilled)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 3. æ‰§è¡Œ deferreds é˜Ÿåˆ—ä¸­çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    <span class="comment">// æ­¤æ—¶ value ä¸º123</span></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">        deferreds.map(<span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">            deferred(value)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// 1. æ‰§è¡Œåˆ›å»º Promise å®ä¾‹æ—¶ä¼ å…¥çš„å‡½æ•°</span></span><br><span class="line">    <span class="comment">// å¹¶ä¼ å…¥ resolve ä¾›åœ¨é€‚å½“æ—¶è§¦å‘å›è°ƒ</span></span><br><span class="line">    fn(resolve)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">const</span> getUserId = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// 2. æ‰§è¡Œ resolve</span></span><br><span class="line">        resolve(<span class="number">123</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line">getUserId().then( <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'this is callback!'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(id) <span class="comment">// 123</span></span><br><span class="line">&#125;).then(<span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'this is second callback!'</span>)</span><br><span class="line">    <span class="built_in">console</span>.log(id) <span class="comment">// 123</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></p><ul><li>è°ƒç”¨ <code>then</code> æ–¹æ³•å°†å›è°ƒå‡½æ•°å­˜å…¥ deferreds é˜Ÿåˆ—.</li><li>åˆ›å»º <code>Promise</code> å®ä¾‹æ—¶ä¼ å…¥å‡½æ•°å’Œ <code>resolve</code>, <code>resolve</code> ç”¨äºåœ¨é€‚å½“çš„æ—¶é—´è§¦å‘å›è°ƒå‡½æ•°.</li><li>çœŸæ­£æ‰§è¡Œå›è°ƒå‡½æ•°çš„æ˜¯ <code>deferreds</code> é˜Ÿåˆ—ä¸­çš„å…ƒç´ .</li><li><code>resolve</code> å‡½æ•°æ¥å—ä¸€ä¸ªå‚æ•°, ç”¨äºå›è°ƒå‡½æ•°ä½¿ç”¨, å³å¼‚æ­¥æ“ä½œçš„è¿”å›ç»“æœ.</li></ul><p>å¯èƒ½å¤§å®¶å·²ç»å‘ç°, ä»¥ä¸Šä»£ç å¹¶ä¸èƒ½çœŸæ­£æ‰§è¡Œåˆ°å›è°ƒå‡½æ•°.æ ¹æ®ä¸Šé¢æ ‡æ³¨çš„åºå·å°±æ˜¯ä»£ç çš„æ‰§è¡Œé¡ºåº, è¿™æ˜¯å› ä¸ºç°åœ¨è¿˜æ˜¯åŒæ­¥å‡½æ•°, <code>Promise</code> å‡½æ•°ä¸­çš„ <code>resolve</code> å‡½æ•°ä¼šå…ˆäº <code>this.then</code> å‡½æ•°æ‰§è¡Œ,æ­¤æ—¶ <code>deferreds</code> é˜Ÿåˆ—ä¸­è¿˜æ˜¯ç©ºçš„, ä»¥è‡³äºåé¢çš„å›è°ƒå‡½æ•°ä¹Ÿæ— æ³•æ‰§è¡Œ. æ‰€ä»¥æˆ‘ä»¬è¦ä¿è¯å›è°ƒä»¥å¼‚æ­¥çš„æ–¹å¼æ‰§è¡Œ, ä»¥ä¿è¯æ‰§è¡Œé¡ºåº. å¯ä»¥é€šè¿‡ <code>setTimeout</code> å°† <code>resolve</code> ä¸­çš„å›è°ƒå‡½æ•°æ”¾åœ¨æ‰§è¡Œæ ˆçš„æœ«å°¾.<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å°†æ‰§è¡Œçš„å›è°ƒçš„é€»è¾‘æ”¾å…¥æ‰§è¡Œæ ˆæœ«å°¾</span></span><br><span class="line">    setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        deferreds.map(<span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">            deferred(value)</span><br><span class="line">        &#125;)    </span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨å°±å¯ä»¥çœ‹åˆ°, then ä¸­çš„å›è°ƒå‡½æ•°èƒ½å¤Ÿæ­£å¸¸æ‰§è¡Œäº†.</p><h4 id="å¼•å…¥çŠ¶æ€"><a href="#å¼•å…¥çŠ¶æ€" class="headerlink" title="å¼•å…¥çŠ¶æ€"></a>å¼•å…¥çŠ¶æ€</h4><p>ç°åœ¨æˆ‘ä»¬å¼•å…¥è§„èŒƒ <code>Promises/A+</code> ä¸­æ‰€è¯´çš„ States, å®ƒæœ‰ä¸‰ä¸ªäº’æ–¥çš„çŠ¶æ€: pending/ fulfilled/ rejected.</p><p>ç°åœ¨æˆ‘ä»¬æ¥æ”¹è¿›ä¸‹ä»£ç :<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> deferreds = []</span><br><span class="line">    <span class="keyword">let</span> state = <span class="string">'pending'</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">            deferreds.push(onFulfilled)</span><br><span class="line">            <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">        &#125;</span><br><span class="line">        onFulfilled(value)</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span></span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span> (<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        value = newValue</span><br><span class="line">        state = <span class="string">'fulfilled'</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">            deferreds.map(<span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">                deferred(value)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    fn(resolve)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h3 id="ä¸²è¡Œ-Promise"><a href="#ä¸²è¡Œ-Promise" class="headerlink" title="ä¸²è¡Œ Promise"></a>ä¸²è¡Œ Promise</h3><p>ä¸²è¡Œ <code>Promise</code> æ˜¯æŒ‡å½“ promise è¾¾åˆ° fuifilled çŠ¶æ€ä¹‹å, å†è¿›è¡Œä¸‹ä¸€ä¸ª promise. æ¯”å¦‚ä¸Šä¾‹ä¸­çš„æˆ‘ä»¬æ‹¿åˆ° userId ä¹‹åè¿˜éœ€è¦ç”¨è¿™ä¸ª userId å»è·å–ç”¨æˆ·çš„åç§°/ ä½å€/ æ‰‹æœºå·ç­‰å…¶ä»–ä¿¡æ¯.</p><p>ä½¿ç”¨çš„ä¼ªä»£ç ç±»ä¼¼è¿™æ ·:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">getUserId()</span><br><span class="line">    .then(getUserInfoById)</span><br><span class="line">    .then(<span class="function"><span class="params">userInfo</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">    &#125;)</span><br><span class="line">    </span><br><span class="line"><span class="keyword">const</span> getUserInfoById = <span class="function"><span class="params">id</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        axios.get(<span class="string">'http://example.com/api'</span>, <span class="attr">params</span>: &#123;</span><br><span class="line">            id: <span class="number">123</span></span><br><span class="line">        &#125;).then(<span class="function"><span class="params">response</span> =&gt;</span> &#123;</span><br><span class="line">            resolve(<span class="built_in">JSON</span>.parse(response).info)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">const</span> getUserId = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        resolve(<span class="number">123</span>)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä¸²è¡Œçš„å›°éš¾åœ¨äºå¦‚ä½•å°†å‰åçš„ <code>Promise</code> è¡”æ¥èµ·æ¥, é¦–å…ˆå¯¹ <code>then</code> æ–¹æ³•æ”¹é€ :<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// bridge promise</span></span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">        handle(&#123;</span><br><span class="line">            onFulfilled: onFulfilled || <span class="literal">null</span>,</span><br><span class="line">            resolve: resolve</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> handle = <span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">        deferreds.push(deferred)</span><br><span class="line">        <span class="keyword">return</span></span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">let</span> ret = deferred.onFulfilled(value)</span><br><span class="line">    deferred.resolve(ret)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><ul><li><code>then</code> æ–¹æ³•ä¸­è¿”å›ä¸€ä¸ªæ–°åˆ›å»ºçš„ Promise å®ä¾‹ä½œä¸ºè¿”å›å€¼, è¿™æ˜¯ä¸²è¡Œçš„åŸºç¡€, ç”±äºè¿”å›ç±»å‹ä¸€æ ·æ‰€ä»¥ä¾ç„¶æ”¯æŒé“¾å¼.</li><li><code>then</code> æ–¹æ³•ä¸­çš„å½¢å‚ <code>onFulfilled</code> å’Œæ–°åˆ›å»ºçš„ Promise å®ä¾‹ä¸­çš„ <code>resolve</code> å‡æ”¾å…¥å½“å‰ promise çš„ deferreds é˜Ÿåˆ—ä¸­.</li><li><code>handle</code> æ–¹æ³•ä½œä¸ºå½“å‰ promise çš„å†…éƒ¨æ–¹æ³•, è¾ƒä¹‹å‰çš„ <code>then</code> æ–¹æ³•åªå¢åŠ äº†ä¸€è¡Œ<code>deferred.resolve(ret)</code>.</li></ul><p>åœ¨å½“å‰ promise çš„å¼‚æ­¥æˆåŠŸä¹‹åæ‰§è¡Œ <code>handle</code> æ–¹æ³•æ—¶, å…ˆæ‰§è¡Œ <code>onFulfilled</code> æ–¹æ³•, ç„¶åå°†å…¶è¿”å›å€¼ä½œä¸º <code>resolve</code> æ–¹æ³•çš„å®å‚ä¼ å…¥.</p><p>å†æ”¹é€  <code>resolve</code> æ–¹æ³•, æŠŠä»£ç æ•´ç†ä¸€ä¸‹:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> value = <span class="literal">null</span></span><br><span class="line">    <span class="keyword">let</span> deferreds = []</span><br><span class="line">    <span class="keyword">let</span> state = <span class="string">'pending'</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// åˆ›å»ºä¸€ä¸ªæ–°çš„ Promiseä½œä¸ºè¿”å›å€¼</span></span><br><span class="line">        <span class="comment">// å°†å½“å‰ promise çš„å›è°ƒå‡½æ•°å’Œæ–°åˆ›å»ºçš„ resolve</span></span><br><span class="line">        <span class="comment">// æ”¾å…¥ deferreds é˜Ÿåˆ—</span></span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span> (<span class="function"><span class="params">resolve</span> =&gt;</span> &#123;</span><br><span class="line">            handle(&#123;</span><br><span class="line">                onFulfilled: onFulfilled || <span class="literal">null</span></span><br><span class="line">                resolve: resolve</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">const</span> handle = <span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// åˆå§‹åŒ–çŠ¶æ€æ—¶, å¾€ deferreds é˜Ÿåˆ—æ·»åŠ </span></span><br><span class="line">        <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">            deferreds.push(deferred)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å½“å‰ promise è¾¾åˆ° 'fulfilled' çŠ¶æ€ä¹‹å</span></span><br><span class="line">        <span class="comment">// å…ˆæ‰§è¡Œå›è°ƒå‡½æ•°, å†å°†å›è°ƒå‡½æ•°çš„è¿”å›å€¼(ret)</span></span><br><span class="line">        <span class="comment">// ä¼ é€’ç»™ resolve å‡½æ•°</span></span><br><span class="line">        <span class="keyword">let</span> ret = deferred.onFulfilled(value)</span><br><span class="line">        deferred.resolve(ret)</span><br><span class="line">    &#125;</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">const</span> resolve = <span class="function"><span class="params">newValue</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue &amp;&amp; (<span class="keyword">typeof</span> newValue === <span class="string">'object'</span> || <span class="keyword">typeof</span> newValue === <span class="string">'function'</span>)) &#123;</span><br><span class="line">            <span class="keyword">let</span> then = newValue.then</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">                then.call(newValue, resolve)</span><br><span class="line">                <span class="keyword">return</span></span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        value = newValue</span><br><span class="line">        state = <span class="string">'fulfilled'</span></span><br><span class="line">        setTimeout(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">            deferreds.map(<span class="function"><span class="params">deferred</span> =&gt;</span> &#123;</span><br><span class="line">                handle(deferred)</span><br><span class="line">            &#125;)</span><br><span class="line">        &#125;, <span class="number">0</span>)</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="comment">// æ‰§è¡Œ promise å®ä¾‹ä¸­çš„å›è°ƒå‡½æ•°</span></span><br><span class="line">    fn(resolve)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line">getUserId()</span><br><span class="line">    .then(getUserInfoById)</span><br><span class="line">    .then(<span class="function"><span class="params">userInfo</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// do something</span></span><br><span class="line">        <span class="built_in">console</span>.log(<span class="string">'this is second callback'</span>)</span><br><span class="line">    &#125;)</span><br></pre></td></tr></table></figure></p><p>ç°åœ¨ <code>resolve</code> æ”¯æŒä¼ å…¥ä¸€ä¸ª promise å®ä¾‹çš„å‚æ•°äº†, æ‰§è¡Œé¡ºåºå¦‚ä¸‹:</p><ol><li><code>getUserId</code> ç”Ÿæˆçš„ promise1, è¿›å…¥ Promise å‡½æ•°æ‰§è¡Œ <code>fn(resolve)</code> ç”±äº<code>getUserId</code> çš„å†…éƒ¨æ˜¯ä¸€ä¸ªå¼‚æ­¥æ“ä½œ, ä¸‹ä¸€æ­¥ä¼šç›´æ¥æ‰§è¡Œ <code>this.then(onFulfilled)</code>.</li><li><code>this.then()</code> è¿”å›ä¸€ä¸ªæ–°çš„ promise2 å‡½æ•°( å³: bridge promise)ä½œä¸ºé“¾å¼è°ƒç”¨, promise2 é‡æ–°å®ä¾‹åŒ–å†æ‰§è¡Œ <code>fn(resolve)</code>, åˆ™è¿›å…¥<code>handle({...})</code> æ­¤æ—¶ handle çš„å‚æ•°ä¸º getUserInfoById å’Œ resolve2, æ¥ç€è¢« push åˆ° <code>deferreds1</code> é˜Ÿåˆ—ä¸­; å†æ¥ç€æ‰§è¡Œä¸‹ä¸€ä¸ª<code>this.then()</code> ç”Ÿæˆ promise3, <code>deferreds2</code> é˜Ÿåˆ—ä¸­ push è¿›ç¬¬äºŒä¸ª then çš„åŒ¿åå‡½æ•°(userInfo =&gt; {â€¦}) å’Œ resolve3.</li><li>æ‰§è¡Œ<code>resolve(123)</code>, è¿›å…¥ <code>resolve(newValue)</code> æ‰§è¡Œ<code>handle(deferred)</code> æ­¤æ—¶ deferred ä¸º getUserInfoById å’Œ resolve2, æ‰§è¡Œ handle å†…éƒ¨çš„ <code>deferred.onFulfilled(value)</code> ä¹Ÿå°±æ˜¯ getUserInfoById æ–¹æ³•ä»è€Œç”Ÿæˆ promise4, å†åˆ° <code>deferred.resolve(ret)</code> è¿™ä¸ªæ—¶å€™ ret å°±ä¸º promise4, ä¼ å…¥ <code>resolve(newValue)</code> æ‰§è¡Œ <code>then.call(promise4, resolve2)</code>.</li><li>æ¥ç€ä¸Šä¸€æ­¥è¿›å…¥ <code>this.then()</code> ç”Ÿæˆ promise5(bridge promise), deferred4 å‹å…¥ resolve2 å’Œ resolve5; åœ¨æ‰§è¡Œ getUserInfoById ä¸­çš„ <code>resolve({name: &#39;cara&#39;...})</code>, è¿›å…¥ setTimeout ä¸­çš„ <code>handle(deferred)</code>, åˆ° handle å‡½æ•°å†…éƒ¨ <code>deferred.onFulfilled(value)</code> å…¶å®æ‰§è¡Œçš„æ˜¯ <code>resolve2({...})</code> resolve2ä¸­çš„ <code>deferred</code> ä¿å­˜çš„æ˜¯çš„ <code>uerInfo =&gt; {}</code> åŒ¿åå‡½æ•°å’Œ <code>resolve3</code>; <code>deferred.resolve</code> å…¶å®æ‰§è¡Œçš„æ˜¯ <code>resolve5</code>, ç”±äº resolve3 å’Œ resolve5 ä¸­çš„ <code>deferred</code> éƒ½æ˜¯ç©ºçš„äºæ˜¯å®Œæˆæ•´ä¸ªæµç¨‹.</li></ol><p>æ¥ä¸‹æ¥å†åŠ å…¥é”™è¯¯å¤„ç†å’Œå¼‚å¸¸åˆ¤æ–­:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span>(<span class="params">fn</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">var</span> state = <span class="string">'pending'</span>,</span><br><span class="line">        value = <span class="literal">null</span>,</span><br><span class="line">        deferreds = [];</span><br><span class="line"></span><br><span class="line">    <span class="keyword">this</span>.then = <span class="function"><span class="keyword">function</span> (<span class="params">onFulfilled, onRejected</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="keyword">function</span> (<span class="params">resolve, reject</span>) </span>&#123;</span><br><span class="line">            handle(&#123;</span><br><span class="line">                onFulfilled: onFulfilled || <span class="literal">null</span>,</span><br><span class="line">                onRejected: onRejected || <span class="literal">null</span>,</span><br><span class="line">                resolve: resolve,</span><br><span class="line">                reject: reject</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;);</span><br><span class="line">    &#125;;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">handle</span>(<span class="params">deferred</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (state === <span class="string">'pending'</span>) &#123;</span><br><span class="line">            deferreds.push(deferred);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">var</span> cb = state === <span class="string">'fulfilled'</span> </span><br><span class="line">            ? deferred.onFulfilled </span><br><span class="line">            : deferred.onRejected,</span><br><span class="line">                ret;</span><br><span class="line">        <span class="keyword">if</span> (cb === <span class="literal">null</span>) &#123;</span><br><span class="line">            cb = state === <span class="string">'fulfilled'</span> </span><br><span class="line">                ? deferred.resolve </span><br><span class="line">                : deferred.reject;</span><br><span class="line">            cb(value);</span><br><span class="line">            <span class="keyword">return</span>;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">try</span> &#123;</span><br><span class="line">            ret = cb(value);</span><br><span class="line">            deferred.resolve(ret);</span><br><span class="line">        &#125; <span class="keyword">catch</span> (e) &#123;</span><br><span class="line">            deferred.reject(e);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">resolve</span>(<span class="params">newValue</span>) </span>&#123;</span><br><span class="line">        <span class="keyword">if</span> (newValue &amp;&amp; (<span class="keyword">typeof</span> newValue === <span class="string">'object'</span> || <span class="keyword">typeof</span> newValue === <span class="string">'function'</span>)) &#123;</span><br><span class="line">            <span class="keyword">var</span> then = newValue.then;</span><br><span class="line">            <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">                then.call(newValue, resolve, reject);</span><br><span class="line">                <span class="keyword">return</span>;</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        state = <span class="string">'fulfilled'</span>;</span><br><span class="line">        value = newValue;</span><br><span class="line">        finale();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">reject</span>(<span class="params">reason</span>) </span>&#123;</span><br><span class="line">        state = <span class="string">'rejected'</span>;</span><br><span class="line">        value = reason;</span><br><span class="line">        finale();</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">function</span> <span class="title">finale</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line">        setTimeout(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            deferreds.forEach(<span class="function"><span class="keyword">function</span> (<span class="params">deferred</span>) </span>&#123;</span><br><span class="line">                handle(deferred);</span><br><span class="line">            &#125;);</span><br><span class="line">        &#125;, <span class="number">0</span>);</span><br><span class="line">    &#125;</span><br><span class="line"></span><br><span class="line">    fn(resolve, reject);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p><strong>ä¹‹å‰çš„æ–‡å­—æè¿°ä¸å¥½ç†è§£, æ‰€ä»¥è¿˜æ˜¯ç”»äº†ä¸€ä¸ªæ‰§è¡Œæµç¨‹å›¾</strong><br><img src="/img/Promiseæ‰§è¡Œè¿‡ç¨‹.png" alt="promiseæ‰§è¡Œè¿‡ç¨‹"></p><p>æ²¡æœ‰ç”» <code>reject</code> çš„æƒ…å†µ, å› ä¸º<code>reject</code> è·Ÿ <code>resolve</code> çš„æµç¨‹æ˜¯ä¸€æ ·çš„, ä¸¤ä¸ªä¸€èµ·ç”»æ˜¾å¾—æ›´ä¹±å°±å•ç‹¬æŠŠ <code>resolve</code> æ‹å‡ºæ¥. åœ¨åŠ å…¥ <code>handle</code> å’Œ <code>resolve</code> åœ¨ promise å‡½æ•°ä¸­ä½œä¸ºå†…éƒ¨æ–¹æ³•åå®åœ¨ä¸æ˜“ç†è§£. ä¸»è¦å°±æ˜¯é€šè¿‡é—­åŒ…æ¥ä¿å­˜ promise å¯¹è±¡çš„å˜é‡å¼•ç”¨, å°†å›è°ƒå‡½æ•°å’Œ resolve å‡½æ•°ä¿å­˜åœ¨ç¼“å­˜é˜Ÿåˆ—ä¸­, åœ¨é€šè¿‡ resolve å®Œæˆé“¾å¼è°ƒç”¨.</p><h2 id="å…¶ä»–å®ç°"><a href="#å…¶ä»–å®ç°" class="headerlink" title="å…¶ä»–å®ç°"></a>å…¶ä»–å®ç°</h2><p>çœ‹å®Œä¹‹å‰çš„é‚£ç¯‡æ–‡ç« å®åœ¨è§‰å¾—æœ‰ç‚¹éš¾ç†è§£, äºæ˜¯åˆæ‰¾äº†å…¶ä»–çš„å®ç°æ–¹å¼<a href="http://bruce-xu.github.io/blogs/js/promise" target="_blank" rel="noopener">JS Promiseçš„å®ç°åŸç†</a>æ¯”ä¹‹å‰é‚£ç¯‡æ›´å¥½ç†è§£ä¸€äº›, æ‰€ä»¥è¿˜æ˜¯è®°å½•ä¸€ä¸‹å¥½äº†.</p><blockquote><p>è¿™ç¯‡æ–‡ç« ä½œè€…è¯´åˆ°çš„ <code>Promise</code> é‡ç‚¹:</p><ol><li><code>Promise</code> æ˜¯ä¸€ä¸ªæ‰¿è¯º, æ‰€ä»¥ä¸ç®¡æˆåŠŸä¸å¦éƒ½è¦æœ‰ä¸€ä¸ªæ‰§è¡Œç»“æœ, å› æ­¤ Promise æ„é€ å‡½æ•°æœ‰ä¸€ä¸ªå‡½æ•°ç±»å‹çš„å‚æ•° <code>resolver</code> æ¥ä½œä¸ºä¸è¯¥ promise å¯¹è±¡å…³è”çš„ä»»åŠ¡.</li><li>ä¸‰ç§çŠ¶æ€ä¸å¯é€†è½¬.</li><li><code>resolver</code> å‡½æ•°å°è£…äº†éœ€è¦æ‰§è¡Œçš„å¼‚æ­¥æ“ä½œ, å†…éƒ¨: <code>resolve</code> å’Œ <code>reject</code> ä¸¤ä¸ªå‚æ•°; åˆ†åˆ«ä»£è¡¨æ‰§è¡ŒæˆåŠŸå’Œæ‰§è¡Œå¤±è´¥éœ€è¦æ‰§è¡Œçš„æ“ä½œ.</li><li><code>then</code> æä¾›æˆåŠŸæˆ–å¤±è´¥çš„å“åº”å¤„ç†, äºæ˜¯æœ‰äº†<code>onResolve</code> å’Œ <code>onReject</code>.</li><li><code>then</code> æ–¹æ³•è¿”å›ä¸€ä¸ªæ–°çš„ promise(bridge promise), æä¾›é“¾å¼æ“ä½œåŠä¸²è¡Œ, å¦‚æœç›´æ¥è¿”å› this é‚£ä¹ˆå°±æ˜¯å¹¶è¡Œæ˜¾ç„¶ä¸ç¬¦åˆæˆ‘ä»¬çš„éœ€æ±‚. å‰ä¸€ä¸ª promise éœ€è¦çŸ¥é“ä¸‹ä¸€ä¸ª promise å¯¹è±¡æ˜¯è°åŠå…¶ä»»åŠ¡å¼•ç”¨, è€Œåä¸€ä¸ª promise è¦æä¾›ä¸€ä¸ªç»™å‰ä¸€ä¸ª promise æˆåŠŸæˆ–å¤±è´¥æ—¶éœ€è¦æ‰§è¡Œçš„ä»»åŠ¡, å› æ­¤æ·»åŠ ä¸€ä¸ªé—­åŒ…</li><li><code>makeCallback</code> è°ƒç”¨å°† promise åŠå…¶å…³è”ä»»åŠ¡ä¼ é€’è¿›å», è¿”å›ä¸€ä¸ªæ–°å‡½æ•°, å‰ä¸€ä¸ª promise å¯¹è±¡å°±å°†æŒæœ‰è¿”å›å‡½æ•°çš„å¼•ç”¨, è°ƒç”¨è¿”å›å‡½æ•°æ—¶å°±èƒ½è®¿é—®åˆ° promise å¯¹è±¡å’Œå…³è”ä»»åŠ¡.</li><li><code>resolve</code> å’Œ <code>reject</code> å‡½æ•°åœ¨å¼‚æ­¥æˆåŠŸæˆ–å¤±è´¥çš„æ—¶å€™è°ƒç”¨, å¹¶ä¼ é€’æˆåŠŸçš„æ•°æ®å’Œå¤±è´¥çš„åŸå› .</li><li><code>run</code> å‡½æ•°æ‰§è¡Œå¼‚æ­¥ç›¸å…³çš„å›è°ƒå‡½æ•°.</li></ol></blockquote><h3 id="ä»£ç ç»“æ„"><a href="#ä»£ç ç»“æ„" class="headerlink" title="ä»£ç ç»“æ„"></a>ä»£ç ç»“æ„</h3><ul><li>æ„é€ å‡½æ•°</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">Promise</span> (<span class="params">resolver</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// çŠ¶æ€</span></span><br><span class="line">    <span class="keyword">this</span>._status = <span class="string">'pending'</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æˆåŠŸé˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">this</span>._doneCallbacks = []</span><br><span class="line">    <span class="comment">// å¤±è´¥é˜Ÿåˆ—</span></span><br><span class="line">    <span class="keyword">this</span>._failCallbacks = []</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¼ é€’å…³è”ä»»åŠ¡</span></span><br><span class="line">    resolver(resolve, reject)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>then</code> æ–¹æ³•</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">this</span>.prototype.then = <span class="function"><span class="keyword">function</span> (<span class="params">onResolve, onReject</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// æ·»åŠ é—­åŒ…è°ƒç”¨</span></span><br><span class="line">    <span class="keyword">let</span> promise = <span class="keyword">new</span> <span class="built_in">Promise</span>(<span class="function"><span class="params">_</span> =&gt;</span> &#123;&#125;)</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿å­˜å¯¹ä¸Šä¸€ä¸ª promise çš„å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">this</span>._doneCallbacks.push(makeCallback(promise, onResolve, <span class="string">'reslove'</span>))</span><br><span class="line">    <span class="keyword">this</span>._failCallbacks.push(makeCallback(promise, onReject, <span class="string">'reject'</span>))</span><br><span class="line">    </span><br><span class="line">    <span class="keyword">return</span> promise</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>makeCallback</code> å‡½æ•°</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// promise å¯¹è±¡/ å›è°ƒå‡½æ•°(å…³è”ä»»åŠ¡)/ ç±»å‹</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeCallback</span> (<span class="params">promise, callback, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">promiseCallback</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">    </span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>resolve</code> å‡½æ•°å’Œ <code>reject</code> å‡½æ•°<br>è¿™ä¸¤ä¸ªå‡½æ•°éƒ½éœ€è¦ä¸€ä¸ªå‚æ•°æ¥æ¥æ”¶ç»“æœ, ç”±äºçŠ¶æ€åªèƒ½è½¬æ¢ä¸€æ¬¡æ‰€ä»¥ä¸¤ä¸ªå‡½æ•°éƒ½éœ€è¦åˆ¤æ–­çŠ¶æ€.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// æˆåŠŸ</span></span><br><span class="line"><span class="comment">// promise: å±äºå“ªä¸ª promise å¯¹è±¡</span></span><br><span class="line"><span class="comment">// data: å¼‚æ­¥æ“ä½œçš„ç»“æœ</span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">resolve</span> (<span class="params">promise, data</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// å·²ç»è¢« resolve è¿‡çš„è¯ç›´æ¥è¿”å›</span></span><br><span class="line">    <span class="keyword">if</span> (promise._status !== <span class="string">'pending'</span>) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="comment">// ä¿®æ”¹ promise çŠ¶æ€</span></span><br><span class="line">    promise._status = <span class="string">'fulfilled'</span></span><br><span class="line">    <span class="comment">// ä¿å­˜å¼‚æ­¥æ“ä½œçš„å€¼</span></span><br><span class="line">    promise._value = data</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// æ‰§è¡Œç›¸å…³å›è°ƒå‡½æ•°</span></span><br><span class="line">    run(promise)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å¤±è´¥</span></span><br><span class="line"><span class="comment">// promise: å±äºå“ªä¸ª promise å¯¹è±¡</span></span><br><span class="line"><span class="comment">// reason: å¤±è´¥åŸå› </span></span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">reject</span> (<span class="params">promise, reason</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">if</span> (promise._status !== <span class="string">'pending'</span>) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    promise._status = <span class="string">'rejected'</span></span><br><span class="line">    promise._value = reason</span><br><span class="line">    </span><br><span class="line">    run(promise)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><code>run</code> å‡½æ•°<br>ç”¨æ¥æ‰§è¡Œå¼‚æ­¥ç›¸å…³çš„å›è°ƒå‡½æ•°.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">run</span> (<span class="params">promise</span>) </span>&#123;</span><br><span class="line">    <span class="comment">// then æ–¹æ³•ä¸­ä¹Ÿä¼šè°ƒç”¨, æ­¤å¤„å†åšä¸€æ¬¡åˆ¤æ–­</span></span><br><span class="line">    <span class="keyword">if</span> (promise._status === <span class="string">'pending'</span>) <span class="keyword">return</span></span><br><span class="line">    </span><br><span class="line">    <span class="keyword">let</span> value = promise._value</span><br><span class="line">    <span class="comment">// æ˜¯å¦æˆåŠŸ</span></span><br><span class="line">    <span class="keyword">let</span> callbacks = promise._status === <span class="string">'fulfilled'</span></span><br><span class="line">        ? promise._doneCallbacks</span><br><span class="line">        : promise._failCallbacks</span><br><span class="line">    </span><br><span class="line">    <span class="comment">// è¿™é‡Œéœ€è¦å¼‚æ­¥</span></span><br><span class="line">    setTimeout(<span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="comment">// æ‰§è¡Œå›è°ƒå‡½æ•°</span></span><br><span class="line">        callbacks.map(<span class="function"><span class="params">cb</span> =&gt;</span> cb(value))</span><br><span class="line">    &#125;, <span class="number">0</span>)</span><br><span class="line">    </span><br><span class="line">    promise._doneCallbacks = []</span><br><span class="line">    promise._failCallbacks = []</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p><strong><code>run</code> å‡½æ•°ä¸­çš„ callbacks å°±æ˜¯ <code>makeCallback</code> æ‰€è¿”å›çš„å‡½æ•°</strong></p><ul><li>å®Œå–„ <code>makeCallback</code> å‡½æ•°</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">makeCallback</span> (<span class="params">promise, callback, action</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> <span class="title">promiseCallback</span> (<span class="params">value</span>) </span>&#123;</span><br><span class="line">        <span class="comment">// å¦‚æœ callback æ˜¯ä¸ªå‡½æ•°, ä½¿ç”¨å‰ä¸€ä¸ª promise</span></span><br><span class="line">        <span class="comment">// ä¼ é€’çš„å€¼ä½œä¸º callback çš„å‚æ•°</span></span><br><span class="line">        <span class="keyword">if</span> (<span class="keyword">typeof</span> callback === <span class="string">'function'</span>) &#123;</span><br><span class="line">            <span class="keyword">let</span> x</span><br><span class="line">            <span class="keyword">try</span> &#123;</span><br><span class="line">                x = callback(value)</span><br><span class="line">            &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                <span class="comment">// å¼‚å¸¸æ—¶, ç”¨å½“å‰ promise çš„ reject</span></span><br><span class="line">                reject(promise, e)</span><br><span class="line">            &#125;</span><br><span class="line">            </span><br><span class="line">            <span class="comment">// å¦‚æœ callback è¿”å›çš„æ˜¯å½“å‰çš„ promise</span></span><br><span class="line">            <span class="comment">// è¦æŠ›å‡ºå¼‚å¸¸</span></span><br><span class="line">            <span class="keyword">if</span> (x === promise) &#123;</span><br><span class="line">                <span class="keyword">let</span> reason = <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Error: return value could not be same with the promise'</span>)</span><br><span class="line">                reject(promise, reason)</span><br><span class="line">            &#125;</span><br><span class="line">            <span class="comment">// å¦‚æœè¿”å›å€¼æ˜¯ä¸€ä¸ª promise å¯¹è±¡</span></span><br><span class="line">            <span class="comment">// åˆ™å½“è¿”å› promise å¯¹è±¡è¢« reoslve/ rejectå</span></span><br><span class="line">            <span class="comment">// å†æ‰§è¡Œå½“å‰çš„ promise çš„ resolve/ reject</span></span><br><span class="line">            <span class="keyword">else</span> <span class="keyword">if</span> (x <span class="keyword">instanceof</span> <span class="built_in">Promise</span>) &#123;</span><br><span class="line">                x.then(</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">                        resolve(promise, data)</span><br><span class="line">                    &#125;,</span><br><span class="line">                    <span class="function"><span class="keyword">function</span> (<span class="params">reason</span>) </span>&#123;</span><br><span class="line">                        reject(promise, reason)</span><br><span class="line">                    &#125;</span><br><span class="line">                )</span><br><span class="line">            &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                <span class="keyword">let</span> then</span><br><span class="line">                (<span class="function"><span class="keyword">function</span> <span class="title">resolveThenable</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line">                    <span class="comment">// å¦‚æœè¿”å›çš„æ˜¯ä¸€ä¸ª Thenable å¯¹è±¡</span></span><br><span class="line">                    <span class="keyword">if</span> (x &amp;&amp; (<span class="keyword">typeof</span> x === <span class="string">'object'</span> || <span class="keyword">typeof</span> x === <span class="string">'function'</span>)) &#123;</span><br><span class="line">                        <span class="keyword">try</span> &#123;</span><br><span class="line">                            then = x.then</span><br><span class="line">                        &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                            reject(promise, e)</span><br><span class="line">                            <span class="keyword">return</span></span><br><span class="line">                        &#125;</span><br><span class="line">                        </span><br><span class="line">                        <span class="keyword">if</span> (<span class="keyword">typeof</span> then === <span class="string">'function'</span>) &#123;</span><br><span class="line">                            <span class="comment">// è°ƒç”¨ Thenable å¯¹è±¡çš„ thenæ–¹æ³•</span></span><br><span class="line">                            <span class="comment">// ä¼ é€’è¿›å»çš„ resolvePromise å’Œ rejectPromise ä»¥åŠä¸‹é¢ä¸¤ä¸ªåŒ¿åå‡½æ•°</span></span><br><span class="line">                            <span class="comment">// å¯èƒ½ä¼šé‡å¤è°ƒç”¨, ä½†æ˜¯è§„èŒƒåªèƒ½æœ‰å…¶ä¸­ä¸€ä¸ªè¢«è°ƒç”¨ä¸€æ¬¡, å…¶ä»–è¦è¢«å¿½ç•¥</span></span><br><span class="line">                            <span class="keyword">let</span> invoked = <span class="literal">false</span></span><br><span class="line">                            <span class="keyword">try</span> &#123;</span><br><span class="line">                                then.call(x,</span><br><span class="line">                                    <span class="function"><span class="keyword">function</span> (<span class="params">y</span>) </span>&#123;</span><br><span class="line">                                        <span class="keyword">if</span> (invoked) <span class="keyword">return</span></span><br><span class="line">                                        invoked = <span class="literal">true</span></span><br><span class="line">                                        </span><br><span class="line">                                        <span class="comment">// é¿å…ä¸¤ä¸ª promise æ’ç­‰</span></span><br><span class="line">                                        <span class="keyword">if</span> (y === x) &#123;</span><br><span class="line">                                            <span class="keyword">throw</span> <span class="keyword">new</span> <span class="built_in">Error</span>(<span class="string">'Error: return value could not be same with the promise'</span>)</span><br><span class="line">                                        &#125;</span><br><span class="line">                                        </span><br><span class="line">                                    <span class="comment">// y æœ‰å¯èƒ½è¿˜æ˜¯ thenable å¯¹è±¡    </span></span><br><span class="line">                                    resolveThenable(y)</span><br><span class="line">                                    &#125;,</span><br><span class="line">                                    <span class="function"><span class="keyword">function</span> (<span class="params">e</span>) </span>&#123;</span><br><span class="line">                                        <span class="keyword">if</span> (invoked) <span class="keyword">return</span></span><br><span class="line">                                        invoked = <span class="literal">true</span></span><br><span class="line">                                        </span><br><span class="line">                                        reject(promise, e)</span><br><span class="line">                                    &#125;</span><br><span class="line">                                )</span><br><span class="line">                            &#125;<span class="keyword">catch</span> (e) &#123;</span><br><span class="line">                                    <span class="comment">// å¦‚æœ`resolvePromise`å’Œ`rejectPromise`æ–¹æ³•è¢«è°ƒç”¨åï¼Œå†æŠ›å‡ºå¼‚å¸¸ï¼Œåˆ™å¿½ç•¥å¼‚å¸¸</span></span><br><span class="line">                                    <span class="comment">// å¦åˆ™ç”¨å¼‚å¸¸å¯¹è±¡rejectæ­¤Promiseå¯¹è±¡</span></span><br><span class="line">                                <span class="keyword">if</span> (!invoked) &#123;</span><br><span class="line">                                    reject(promise, e)</span><br><span class="line">                                &#125;</span><br><span class="line">                            &#125;</span><br><span class="line">                        &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                            resolve(promise, x)</span><br><span class="line">                        &#125;</span><br><span class="line">                    &#125;<span class="keyword">else</span> &#123;</span><br><span class="line">                        resolve(promise, x)</span><br><span class="line">                    &#125;</span><br><span class="line">                &#125;(x))</span><br><span class="line">            &#125;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="comment">// å¦‚æœæ²¡æœ‰ä¼  callbackç›´æ¥ä½¿ç”¨å‰ä¸€ä¸ª promise</span></span><br><span class="line">        <span class="comment">// ä¼ è¿‡æ¥çš„å€¼ resolve/reject å½“å‰ promise å¯¹è±¡</span></span><br><span class="line">        <span class="keyword">else</span> &#123;</span><br><span class="line">            action === <span class="string">'resolve'</span></span><br><span class="line">                ? resolve(promise, value)</span><br><span class="line">                : reject(promise, value)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>æˆ‘ä¸€å¼€å§‹æ˜¯å…ˆçœ‹çš„<strong>å‰–æ Promise ä¹‹åŸºç¡€ç¯‡</strong>, å‰åŠéƒ¨åˆ†ç¡®å®å¾ˆäº²æ°‘, ä½†æ˜¯åˆ°åŠ å…¥ <code>hanlde</code> å’Œæ”¹é€  <code>resolve</code> å‡½æ•° å°±å¼€å§‹æ‡µäº†, ç„¶åæ‡µæ‡µæ‡‚æ‡‚çš„å»çœ‹<strong>JS Promise çš„åŸç†å®ç°</strong>, ä¸è¿‡åœ¨æœ€å¤æ‚çš„ <code>makeCallback</code> å‡½æ•°ä¸­è§£é‡Šæœ‰ç‚¹ä¸€ç¬”å¸¦è¿‡çš„æ„æ€. ä¸è¿‡çœ‹äº†è¿™ç¯‡å¸®åŠ©æˆ‘ç†è§£ä¹‹å‰çš„<strong>å‰–æ Promise ä¹‹åŸºç¡€ç¯‡</strong>, å°±è¿”å›å»çœ‹åŸºç¡€ç¯‡ç”»äº†ä¸€éæµç¨‹å›¾æ‰ç®—çœ‹æ‡‚, é‡Œé¢çš„é—­åŒ…ç”¨çš„å¤ªç²¾å¦™äº†.</p><blockquote><p>å‚è€ƒæ–‡ç« <br><a href="https://tech.meituan.com/promise-insight.html" target="_blank" rel="noopener">å‰–æ Promise ä¹‹åŸºç¡€ç¯‡</a><br><a href="http://bruce-xu.github.io/blogs/js/promise" target="_blank" rel="noopener">JS Promise çš„åŸç†å®ç°</a><br><a href="https://github.com/xieranmaya/blog/issues/3" target="_blank" rel="noopener">å‰–æPromiseå†…éƒ¨ç»“æ„</a></p></blockquote><p>Created on 2017-12-26 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Promise æ˜¯ ES6ä¸­ä¸­æ”¶å½•çš„å¼‚æ­¥æ“ä½œå°è£…, é€šå¸¸åœ¨å›è°ƒ/ äº‹ä»¶/ æ¶ˆæ¯ç­‰å¼‚æ­¥æ“ä½œä¸­æœ‰æ˜¾è‘—çš„ä¼˜åŠ¿, è®©æˆ‘ä»¬åœ¨æ›´æ–¹ä¾¿çš„æ“ä½œå¼‚æ­¥ä¹Ÿè®©ä»£ç æ›´åŠ æ¸…æ™°.åŒ…æ‹¬ ES7ä¸­çš„ Async/Await ä¹Ÿæ˜¯å¯¹å¼‚æ­¥æ“ä½œçš„å°è£…, ä¸è¿‡ Async æ›´åƒæ˜¯ Generator çš„è¯­æ³•ç³–.&lt;/
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ã€Šå›¾è§£ HTTPã€‹(ä¸Š)</title>
    <link href="https://yoursite.com/2018/01/03/HTTP-%E4%B8%8A/"/>
    <id>https://yoursite.com/2018/01/03/HTTP-ä¸Š/</id>
    <published>2018-01-03T14:03:05.000Z</published>
    <updated>2022-08-23T09:37:40.689Z</updated>
    
    <content type="html"><![CDATA[<p>Webä½¿ç”¨HTTP(HyperText Transfer Protocal) è¶…æ–‡æœ¬ä¼ è¾“åè®®ä½œä¸ºè§„èŒƒ, å®Œæˆä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„ä¸€ç³»åˆ—æµç¨‹. å¯ä»¥è¯´ Web æ˜¯åœ¨ HTTP åè®®ä¸Šé€šä¿¡çš„.</p><h3 id="1-0-ç½‘ç»œåŸºç¡€TCP-IP"><a href="#1-0-ç½‘ç»œåŸºç¡€TCP-IP" class="headerlink" title="1.0 ç½‘ç»œåŸºç¡€TCP/IP"></a>1.0 ç½‘ç»œåŸºç¡€TCP/IP</h3><p>é€šå¸¸æˆ‘ä»¬ä½¿ç”¨çš„ç½‘ç»œæ˜¯åœ¨ TCP/IP åè®®æ—çš„åŸºç¡€ä¸Šè¿è¡Œçš„, è€Œ HTTP æ˜¯å±äº TCP/IP æ—ç¾¤ä¸­çš„ä¸€ç§åè®®. åœ¨è®¡ç®—æœºå’Œç½‘ç»œç›¸äº’é€šä¿¡çš„æ—¶å€™, ä¸¤è€…éƒ½å¿…é¡»è¦éµå®ˆåŒä¸€ç§åè®®.</p><h4 id="1-1-TCP-IPåˆ†å±‚ç®¡ç†"><a href="#1-1-TCP-IPåˆ†å±‚ç®¡ç†" class="headerlink" title="1.1 TCP/ IPåˆ†å±‚ç®¡ç†"></a>1.1 TCP/ IPåˆ†å±‚ç®¡ç†</h4><p>TCP/IPåè®®æ—é‡Œæœ€é‡è¦çš„ä¸€ç‚¹å°±æ˜¯åˆ†å±‚, æ¯ä¸€å±‚å°±åªéœ€è¦ä¸“æ³¨äºè‡ªå·±ä»»åŠ¡å°±è¡Œäº†, æŒ‰å±‚æ¬¡åˆ†åˆ«ä¸ºä»¥ä¸‹å››å±‚:</p><ol><li><p>åº”ç”¨å±‚<br>å†³å®šå‘ç”¨æˆ·æä¾›åº”ç”¨æœåŠ¡æ—¶çš„é€šä¿¡æ´»åŠ¨, åœ¨ TCP/IP ä¸­é¢„å­˜äº†å„ç±»é€šç”¨çš„åº”ç”¨æœåŠ¡. æ¯”å¦‚: FTP(File Transfer Protocol, æ–‡ä»¶ä¼ è¾“åè®®)å’Œ DNS(Domain Name System, åŸŸåç³»ç»Ÿ), HTTP åè®®ä¹Ÿå±äºè¿™å±‚.</p></li><li><p>ä¼ è¾“å±‚<br>ç»™ä¸¤ä¸ªè®¡ç®—æœºåœ¨ç½‘ç»œä¸­æä¾›æ•°æ®ä¼ è¾“. TCP(ä¼ è¾“æ§åˆ¶åè®®)å’Œ UDP(ç”¨æˆ·æ•°æ®æŠ¥åè®®)</p></li><li><p>ç½‘ç»œå±‚<br>å¤„ç†ç½‘ä¸ŠæµåŠ¨çš„æ•°æ®åŒ…, å†³å®šæ•°æ®é€šè¿‡å“ªæ¡ä¼ è¾“è·¯çº¿åˆ°å¯¹æ–¹è®¡ç®—æœºå¹¶æŠŠæ•°æ®ä¼ è¾“ç»™å¯¹æ–¹.</p></li><li><p>é“¾è·¯å±‚<br>å¤„ç†è¿æ¥ç½‘ç»œçš„ç¡¬ä»¶éƒ¨åˆ†. ç½‘å¡/ é©±åŠ¨/ å…‰çº¤ä»€ä¹ˆçš„</p></li></ol><h4 id="1-2-TCP-IP-ä¼ è¾“æµç¨‹"><a href="#1-2-TCP-IP-ä¼ è¾“æµç¨‹" class="headerlink" title="1.2 TCP/IP ä¼ è¾“æµç¨‹"></a>1.2 TCP/IP ä¼ è¾“æµç¨‹</h4><p>TCP/IP åœ¨ç½‘ç»œé€šä¿¡æ—¶, ä¼šæŒ‰ç…§åˆ†å±‚é¡ºåºä¸å¯¹æ–¹é€šä¿¡. å‘é€ç«¯ä»åº”ç”¨å±‚å¾€ä¸‹, æ¥æ”¶ç«¯ä»åº”ç”¨ç«¯ç½‘ä¸Š.</p><p><img src="/img/http.jpg" alt="TCP/IPä¼ è¾“æµç¨‹"></p><h3 id="2-0-ä¸-HTTP-å…³ç³»å¯†åˆ‡çš„åè®®-IP-TCP-å’Œ-DNS"><a href="#2-0-ä¸-HTTP-å…³ç³»å¯†åˆ‡çš„åè®®-IP-TCP-å’Œ-DNS" class="headerlink" title="2.0 ä¸ HTTP å…³ç³»å¯†åˆ‡çš„åè®®: IP/TCP å’Œ DNS"></a>2.0 ä¸ HTTP å…³ç³»å¯†åˆ‡çš„åè®®: IP/TCP å’Œ DNS</h3><ul><li>è´Ÿè´£ä¼ è¾“çš„ IP åè®®<br>å°†æ•°æ®åŒ…ä¼ é€’ç»™å¯¹æ–¹å¹¶ç¡®è®¤åˆ°è¾¾, ç¡®è®¤åˆ°è¾¾çš„é‡è¦æ¡ä»¶åŒ…æ‹¬: IP åœ°å€å’Œ MAC åœ°å€.<br><img src="/img/ip.jpg" alt="IP"></li><li>ç¡®ä¿å¯é æ€§çš„ TCP åè®®<br>ä¸ºäº†æ–¹ä¾¿ä¼ è¾“å°†å¤§æ•°æ®åŒ…åˆ†å‰²æˆä»¥æŠ¥æ–‡æ®µä¸ºå•ä½çš„æ•°æ®åŒ…è¿›è¡Œç®¡ç†, å†å°†æ•°æ®å‡†ç¡®å¯é çš„ä¼ é€’ç»™å¯¹æ–¹. é‚£ä¹ˆå¦‚ä½•å‡†ç¡®å¯é çš„ä¼ é€’ç»™å¯¹æ–¹å‘¢, æ‰€ä»¥å°±æœ‰äº†TCP çš„ä¸‰æ¬¡æ¡æ‰‹ç­–ç•¥: å‘é€ç«¯å…ˆå‘é€ä¸€ä¸ªå¸¦æœ‰ <code>SYN</code>æ ‡å¿—çš„æ•°æ®åŒ…ç»™å¯¹æ–¹, æ¥æ”¶ç«¯å›ä¼ ä¸€ä¸ªå¸¦æœ‰<code>SYN/ACK</code>æ ‡å¿—çš„æ•°æ®åŒ…ä¼ è¾¾ç¡®è®¤ä¿¡æ¯, æœ€åå‘é€ç«¯å†å›ä¼ ä¸€ä¸ªå¸¦æœ‰<code>ACK</code>æ ‡å¿—çš„æ•°æ®åŒ…, ä»£è¡¨æ¡æ‰‹ç»“æŸ.<br><img src="/img/tcp.jpg" alt="TCP"></li><li>è´Ÿè´£åŸŸååè®®çš„ DNS æœåŠ¡<br>æä¾›åŸŸååˆ° IP åœ°å€ä¹‹é—´è§£ææœåŠ¡.<br><img src="/img/dns.jpg" alt="DNS"></li></ul><h4 id="2-1-HTTP-åè®®çš„é€šä¿¡è¿‡ç¨‹"><a href="#2-1-HTTP-åè®®çš„é€šä¿¡è¿‡ç¨‹" class="headerlink" title="2.1 HTTP åè®®çš„é€šä¿¡è¿‡ç¨‹"></a>2.1 HTTP åè®®çš„é€šä¿¡è¿‡ç¨‹</h4><p>é€šè¿‡ä¸€æ•´å¥—æµç¨‹æ¥çœ‹ä¸€ä¸‹, IPåè®®/ TCPåè®® å’Œ DNSæœåŠ¡åœ¨ HTTPåè®®çš„é€šä¿¡è¿‡ç¨‹ä¸­å„è‡ªå‘æŒ¥äº†ä»€ä¹ˆä½œç”¨.<br><img src="/img/HTTP_IP_TCP_DNS.jpg" alt="HTTPåè®®é€šä¿¡è¿‡ç¨‹"></p><p><strong>ä»ä¸Šå›¾æ¥çœ‹, ä»è¾“å…¥ä¸€ä¸ªç½‘å€åˆ°é¡µé¢çš„å±•ç¤ºè¿‡ç¨‹å¤§è‡´å¦‚ä¸‹:</strong></p><ol><li>åŸŸåè§£æ(DNS æœåŠ¡)</li><li>å»ºç«‹TCP, å‘é€ HTTP è¯·æ±‚(ä¸‰æ¬¡æ¡æ‰‹)<ol><li>å®¢æˆ·ç«¯å‘æœåŠ¡å™¨å‘é€è¯·æ±‚(SYN)</li><li>æœåŠ¡å™¨åº”ç­”å¹¶è¦æ±‚ç¡®è®¤(SYN/ACK)</li><li>å®¢æˆ·ç«¯ç¡®è®¤(ACK)</li></ol></li><li>IP æœç´¢å¯¹æ–¹åœ°å€, ä¸€è¾¹ä¸­è½¬ä¸€è¾¹ä¼ è¾“æ•°æ®åŒ…</li><li>æœåŠ¡å™¨å¤„ç†è¯·æ±‚è¿”å› HTTP å“åº”æŠ¥æ–‡</li><li>è¿æ¥ç»“æŸ(å››æ¬¡æŒ¥æ‰‹)<ol><li>å®¢æˆ·ç«¯å‘é€ä¸€ä¸ª FIN æ¥å‘Šè¯‰æœåŠ¡å™¨æ•°æ®å‘é€å®Œæ¯•</li><li>æœåŠ¡å™¨æ”¶åˆ°è¿™ä¸ª FIN ä¹‹åå›å‘ä¸€ä¸ª ACK(è¿™ä¸ªæ—¶å€™æœåŠ¡å™¨è¿˜å¯ä»¥å‘å®¢æˆ·ç«¯å‘é€æ•°æ®)</li><li>æœåŠ¡å™¨å‘é€ä¸€ä¸ª FIN å‘Šè¯‰å®¢æˆ·ç«¯æœåŠ¡å™¨çš„æ•°æ®å‘é€å®Œæ¯•, è¯·æ±‚å…³é—­è¿æ¥</li><li>å®¢æˆ·ç«¯å›å‘ ACK ç¡®è®¤, å…³é—­è¿æ¥</li></ol></li><li>æµè§ˆå™¨è§£ææ¸²æŸ“é¡µé¢</li></ol><h4 id="2-2-HTTP-æ˜¯å¦ä¿å­˜çŠ¶æ€"><a href="#2-2-HTTP-æ˜¯å¦ä¿å­˜çŠ¶æ€" class="headerlink" title="2.2 HTTP æ˜¯å¦ä¿å­˜çŠ¶æ€"></a>2.2 HTTP æ˜¯å¦ä¿å­˜çŠ¶æ€</h4><p>HTTP æ˜¯ä¸€ç§ä¸ä¿å­˜çŠ¶æ€(æ— çŠ¶æ€)åè®®, åè®®æœ¬èº«ä¸ä¼šä¿ç•™ä¹‹å‰çš„è¯·æ±‚æˆ–å“åº”æŠ¥æ–‡çš„ä¿¡æ¯. è¿™æ˜¯ä¸ºäº†æ›´å¿«çš„å¤„ç†å¤§é‡è¯·æ±‚, ä½†æ˜¯éšç€ Web å‘å±•<br>å¾ˆå¤šä¸šåŠ¡éƒ½éœ€è¦ä¿å­˜ç”¨æˆ·çš„çŠ¶æ€, å› æ­¤å¼•å…¥ Cookie æ¥ç®¡ç†çŠ¶æ€.</p><h3 id="3-0-HTTP-è¿”å›çŠ¶æ€ç "><a href="#3-0-HTTP-è¿”å›çŠ¶æ€ç " class="headerlink" title="3.0 HTTP è¿”å›çŠ¶æ€ç "></a>3.0 HTTP è¿”å›çŠ¶æ€ç </h3><p>çŠ¶æ€ç æ˜¯ç”¨æ¥å‘Šè¯‰å®¢æˆ·ç«¯ä»æœåŠ¡å™¨å“åº”çš„è¯·æ±‚ç»“æœ, å¯ä»¥é€šè¿‡çŠ¶æ€ç çŸ¥é“è¯¥æ¬¡è¯·æ±‚æ˜¯æ­£å¸¸å¤„ç†äº†è¿˜æ˜¯å‘ç”Ÿäº†é”™è¯¯.</p><h4 id="3-1-çŠ¶æ€ç çš„ç±»åˆ«"><a href="#3-1-çŠ¶æ€ç çš„ç±»åˆ«" class="headerlink" title="3.1 çŠ¶æ€ç çš„ç±»åˆ«"></a>3.1 çŠ¶æ€ç çš„ç±»åˆ«</h4><table><thead><tr><th></th><th style="text-align:left">ç±»åˆ«</th><th style="text-align:left">åŸå› çŸ­å¥</th></tr></thead><tbody><tr><td>1XX</td><td style="text-align:left">ä¿¡æ¯ç±»</td><td style="text-align:left">æ¥æ”¶çš„è¯·æ±‚æ­£åœ¨å¤„ç†</td></tr><tr><td>2XX</td><td style="text-align:left">æˆåŠŸç±»</td><td style="text-align:left">è¯·æ±‚æ­£å¸¸å¤„ç†å®Œæ¯•</td></tr><tr><td>3XX</td><td style="text-align:left">é‡å®šå‘ç±»</td><td style="text-align:left">éœ€è¦é™„åŠ æ“ä½œå®Œæˆè¯·æ±‚</td></tr><tr><td>4XX</td><td style="text-align:left">å®¢æˆ·ç«¯é”™è¯¯ç±»</td><td style="text-align:left">æœåŠ¡å™¨æ— æ³•å¤„ç†è¯·æ±‚</td></tr><tr><td>5XX</td><td style="text-align:left">æœåŠ¡å™¨é”™è¯¯ç±»</td><td style="text-align:left">æœåŠ¡å™¨å‘ç”Ÿé”™è¯¯</td></tr></tbody></table><h4 id="3-2-å…·æœ‰ä»£è¡¨æ€§çš„14ç§çŠ¶æ€ç "><a href="#3-2-å…·æœ‰ä»£è¡¨æ€§çš„14ç§çŠ¶æ€ç " class="headerlink" title="3.2 å…·æœ‰ä»£è¡¨æ€§çš„14ç§çŠ¶æ€ç "></a>3.2 å…·æœ‰ä»£è¡¨æ€§çš„14ç§çŠ¶æ€ç </h4><ul><li>2XX æˆåŠŸç±»<ol><li>200 OK<br>è¡¨ç¤ºè¯·æ±‚åœ¨æœåŠ¡ç«¯è¢«æ­£å¸¸å¤„ç†äº†</li><li>204  No Content<br>è¡¨ç¤ºè¯·æ±‚å¤„ç†æˆåŠŸä½†æ˜¯å“åº”æŠ¥æ–‡ä¸åŒ…å«å®ä½“çš„ä¸»ä½“(æœ¬èº«ä¹Ÿä¸å…è®¸è¿”å›å®ä½“çš„ä¸»ä½“)</li><li>206  Partial Content<br>æœåŠ¡ç«¯æˆåŠŸå¤„ç†äº†å®¢æˆ·ç«¯å‘å‡ºçš„èŒƒå›´è¯·æ±‚</li></ol></li><li>3XX é‡å®šå‘<ol><li>301 Moved Permanently<br>æ°¸ä¹…æ€§é‡å®šå‘. è¯·æ±‚çš„èµ„æºå·²ç»è¢«åˆ†é…äº†æ–°çš„ URI åº”è¯¥ä½¿ç”¨æ–°çš„ URI</li><li>302 Found<br>ä¸´æ—¶æ€§é‡å®šå‘. è¯·æ±‚çš„èµ„æºè¢«åˆ†é…äº†æ–°çš„ URI, å¸Œæœ›æœ¬æ¬¡è¯·æ±‚ç”¨æ–°çš„ URI</li><li>303 See Other<br>è¯·æ±‚çš„èµ„æºå­˜åœ¨å¦ä¸€ä¸ª URI, åº”ä½¿ç”¨ GET æ–¹æ³•å®šå‘è·å–è¯·æ±‚çš„èµ„æº(è·Ÿ302çš„åŠŸèƒ½ç›¸åŒ)</li><li>304 Not Modified<br>è¡¨ç¤ºè¯·æ±‚æ—¶é™„å¸¦äº†æ¡ä»¶, æœåŠ¡ç«¯å…è®¸è¯·æ±‚èµ„æºä½†ä¸ºæ»¡è¶³æ¡ä»¶. æ‰€ä»¥è¿”å›æ—¶, ä¸åŒ…å«ä»»ä½•å“åº”çš„ä¸»ä½“éƒ¨åˆ†(è·Ÿé‡å®šå‘å¹¶æ²¡æœ‰åŠæ¯›é’±å…³ç³»).</li><li>307 Temporary Redirect<br>ä¸´æ—¶é‡å®šå‘, è·Ÿ302æœ‰ç€åŒæ ·çš„ä¸€æ ·. å°½ç®¡302æ ‡å‡†ä¸å…è®¸ POST å˜ä¸º GET, ä½†æ˜¯å¹¶æ²¡æœ‰äººéµå®ˆ; 307ä¼šéµå®ˆæ ‡å‡†ä½†æ˜¯å¤„ç†å“åº”æ—¶, æ¯ä¸ªæµè§ˆå™¨æœ‰å¯èƒ½å‡ºç°ä¸åŒçš„æƒ…å†µ</li></ol></li><li>4XX å®¢æˆ·ç«¯é”™è¯¯<ol><li>400 Bad Request<br>è¯·æ±‚æŠ¥æ–‡ä¸­æœ‰è¯­æ³•é”™è¯¯</li><li>401 Unauthorized<br>è¯·æ±‚éœ€è¦é€šè¿‡ HTTP è®¤è¯</li><li>403 Forbidden<br>è¯·æ±‚èµ„æºè®¿é—®è¢«æœåŠ¡ç«¯æ‹’ç»(ä¸€èˆ¬éƒ½æ˜¯æƒé™é—®é¢˜)</li><li>404 Not Found<br>æœåŠ¡ç«¯ä¸Šæ— æ³•æ‰¾åˆ°è¯·æ±‚çš„èµ„æº</li><li>405 Not Allow<br>å¯¹äºè¯·æ±‚çš„èµ„æº, æœåŠ¡ç«¯ä¸å…è®¸ä½¿ç”¨è¯·æ±‚ä¸­ä½¿ç”¨çš„æ–¹æ³•</li></ol></li><li>5XX æœåŠ¡å™¨é”™è¯¯<ol><li>500 Internal Server Error<br>æœåŠ¡ç«¯åœ¨æ‰§è¡Œè¯·æ±‚ä»»åŠ¡æ—¶å‘ç”Ÿé”™è¯¯</li><li>503 Service Unavailable<br>æœåŠ¡ç«¯æš‚æ—¶å¤„äºè¶…è´Ÿè½½æˆ–è€…åœæœºç»´æŠ¤, æ— æ³•å¤„ç†è¯·æ±‚(ä¸€èˆ¬å°±æ˜¯æœåŠ¡å™¨æŒ‚äº†)</li></ol></li></ul><h4 id="æ€»ç»“"><a href="#æ€»ç»“" class="headerlink" title="æ€»ç»“"></a>æ€»ç»“</h4><p>ä¸»è¦ä¸ºäº†å¤§è‡´äº†è§£ä¸€ä¸‹ HTTP çš„åŸºç¡€/å¤§æ¦‚çš„æ‰§è¡Œæµç¨‹å’Œå¸¸è§çš„HTTP çŠ¶æ€ç . å¯¹äºçŠ¶æ€ç ä¹‹å‰ä¸€ç›´åˆ†ä¸å¤ªæ¸…301å’Œ302çš„åŒºåˆ«, ç®€å•çš„æ¥è¯´: 301 æ”¹å˜èµ„æºçš„URI å, å¦‚æœè¿™ä¸ªèµ„æºæ˜¯è¢«ä¿å­˜åœ¨ä¹¦ç­¾ä¸­çš„, é‚£ä¹ˆè¿™æ—¶è¦æ ¹æ®æ–°çš„ URI ä¿å­˜; 302 è¡¨ç¤ºè¿™ä¸ªèµ„æºåªæ˜¯ä¸´æ—¶æ€§çš„ç§»åŠ¨, ä¹‹åè¿™ä¸ª URI å¯èƒ½è¿˜ä¼šå˜åŒ–. é‚£ä¹ˆå¦‚æœä¹Ÿè¢«ä¿å­˜åœ¨äº†ä¹¦ç­¾ä¸­, ä»ç„¶ä¼šä¿ç•™åŸæ¥çš„ URI. çŠ¶æ€ç ä¸­çš„ 304 æ”¾åœ¨ä¸‹æ¬¡æ”¾åœ¨ç¼“å­˜ç­–ç•¥ä¸­å†æ‹ä¸€æ‹å§.</p><p>Create on 2018-1-3 By Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Webä½¿ç”¨HTTP(HyperText Transfer Protocal) è¶…æ–‡æœ¬ä¼ è¾“åè®®ä½œä¸ºè§„èŒƒ, å®Œæˆä»å®¢æˆ·ç«¯åˆ°æœåŠ¡ç«¯çš„ä¸€ç³»åˆ—æµç¨‹. å¯ä»¥è¯´ Web æ˜¯åœ¨ HTTP åè®®ä¸Šé€šä¿¡çš„.&lt;/p&gt;
&lt;h3 id=&quot;1-0-ç½‘ç»œåŸºç¡€TCP-IP&quot;&gt;&lt;a href=&quot;#1-0-ç½‘
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="ç½‘ç»œ" scheme="https://yoursite.com/tags/%E7%BD%91%E7%BB%9C/"/>
    
  </entry>
  
  <entry>
    <title>å£°æ˜æå‡</title>
    <link href="https://yoursite.com/2017/12/20/%E5%A3%B0%E6%98%8E%E6%8F%90%E5%8D%87/"/>
    <id>https://yoursite.com/2017/12/20/å£°æ˜æå‡/</id>
    <published>2017-12-20T13:54:07.000Z</published>
    <updated>2022-08-23T09:37:40.692Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨è¯´å£°æ˜æå‡ä¹‹å‰, é¦–å…ˆåº”è¯¥äº†è§£ä¸‰ä¸ªæ¦‚å¿µæ€§çš„ä¸œè¥¿, æ‰§è¡Œä¸Šä¸‹æ–‡(Execution Context)/ å˜é‡å¯¹è±¡(Variable Object)å’Œæ´»åŠ¨å¯¹è±¡(Activation Object), è¿™ä¸‰ä¸ªæ¦‚å¿µæ˜¯åœ¨ ES3 ä¸­å‡ºç°çš„.</p><ul><li><p>æ‰§è¡Œä¸Šä¸‹æ–‡(Execution Context)<br>æ‰§è¡Œä¸Šä¸‹æ–‡ä¹Ÿå¯ä»¥è¯´æ˜¯ js ä»£ç çš„è¿è¡Œç¯å¢ƒ, ä»£ç ä¸€æ—¦è¢«åŠ è½½ js çš„è§£é‡Šå™¨é¦–å…ˆè¿›å…¥çš„å°±æ˜¯è¿™ä¸ªç¯å¢ƒ. ä»–æœ‰å…¨å±€çš„æ‰§è¡Œä¸Šä¸‹æ–‡å’Œå‡½æ•°çš„æ‰§è¡Œä¸Šä¸‹æ–‡(eval ä¸è¯´, å®ƒå†…éƒ¨ä¹Ÿæœ‰), js çš„è§£é‡Šå™¨é»˜è®¤å…ˆè¿›å…¥çš„æ˜¯å…¨å±€ä¸Šä¸‹æ–‡æ‰€ä»¥æˆ‘ä»¬ä¸€å¼€å§‹å°±èƒ½ç›´æ¥ä½¿ç”¨ä¸€äº›çš„å†…ç½®æ–¹æ³•, æ¯”å¦‚: Array/ Numberâ€¦ æ¯å½“ä¸€ä¸ªå‡½æ•°è¢«è°ƒç”¨æ—¶, å°±ä¼šåˆ›å»ºä»–è‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡, æ¯ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡éƒ½æœ‰ä¸€ä¸ªä¸ä¹‹å…³è”çš„å˜é‡å¯¹è±¡.</p></li><li><p>ä½œç”¨åŸŸé“¾(ä¹Ÿç§°è°ƒç”¨æ ˆ)<br>çŸ¥é“äº†æ¯å½“ä¸€ä¸ªå‡½æ•°è°ƒç”¨æ—¶ä¼šåˆ›å»ºè‡ªå·±çš„æ‰§è¡Œä¸Šä¸‹æ–‡, è¿™ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡å°±ä¼šè¢«æ·»åŠ åˆ°ä½œç”¨åŸŸé“¾çš„é¡¶ç«¯. è€Œè§£é‡Šå™¨æ€»æ˜¯å…ˆè¿è¡Œä½œç”¨åŸŸé“¾é¡¶ç«¯çš„æ‰§è¡Œä¸Šä¸‹æ–‡, ä¸€æ—¦å‡½æ•°è°ƒç”¨å®Œæ¯•, å®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡å°±ä¼šä»ä½œç”¨åŸŸé“¾çš„é¡¶ç«¯ç§»é™¤å¹¶å°†æ§åˆ¶æƒäº¤ç”±ä¸Šä¸€ä¸ªæ‰§è¡Œä¸Šä¸‹æ–‡, ç›´åˆ°å›åˆ°å…¨å±€ä¸Šä¸‹æ–‡. å¦‚ä¸‹å›¾æ‰€ç¤º:<br><img src="/img/event-loop.gif" alt="æ‰§è¡Œç¯å¢ƒ"></p></li></ul><ul><li>å˜é‡å¯¹è±¡(Variable Object)<br>å½“æ‰§è¡Œä¸Šä¸‹æ–‡åˆ›å»ºå, è¿›å…¥å»ºç«‹é˜¶æ®µ(å‡½æ•°è°ƒç”¨, å…·ä½“ä»£ç æ‰§è¡Œä¹‹å‰), åœ¨è¿™ä¸ªé˜¶æ®µå˜é‡å¯¹è±¡/ ä½œç”¨åŸŸé“¾/ <code>this</code>çš„æŒ‡å‘éƒ½ä¼šè¢«ç¡®å®š. å˜é‡å¯¹åƒä¼šæŒ‰é¡ºåºå¡«å……:</li></ul><ol><li>å‡½æ•°å‚æ•°(æ²¡æœ‰å°±æ˜¯ undefined)</li><li>å‡½æ•°å£°æ˜(å‘½åå†²çª, ä¼šè¦†ç›–ä¹‹å‰çš„)</li><li>å˜é‡å£°æ˜(å€¼ä¸º undefined, å‘½åå†²çª, ä¼šè¢«å¿½ç•¥)</li></ol><ul><li>æ´»åŠ¨å¯¹è±¡(ä¹Ÿç§°æ¿€æ´»å¯¹è±¡)<br>å‡½æ•°è°ƒç”¨æ´»åŠ¨å¯¹è±¡å°±ä½œä¸ºå˜é‡å¯¹è±¡, æ‰€ä»¥åœ¨å‡½æ•°è°ƒç”¨æ—¶<code>å˜é‡å¯¹è±¡ === æ´»åŠ¨å¯¹è±¡</code>, æ´»åŠ¨å¯¹è±¡ä¼šå…ˆåŒ…å«<code>arguments</code>å¯¹è±¡åŠæ–¹æ³•.</li></ul><p>è¿˜æ˜¯çœ‹ä¸ªä»£ç æ¥è¯´å§:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">foo</span> (<span class="params">i</span>) </span>&#123;</span><br><span class="line"><span class="keyword">var</span> a = <span class="string">'hello'</span></span><br><span class="line"><span class="keyword">var</span> b = <span class="function"><span class="keyword">function</span> <span class="title">bar</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line"><span class="function"><span class="keyword">function</span> <span class="title">c</span> (<span class="params"></span>) </span>&#123;&#125;</span><br><span class="line">&#125;</span><br><span class="line">foo(<span class="number">11</span>)</span><br><span class="line"><span class="comment">// å»ºç«‹é˜¶æ®µ</span></span><br><span class="line">fooExecutionContext = &#123;</span><br><span class="line">variableObject: &#123;</span><br><span class="line"><span class="built_in">arguments</span>: &#123;</span><br><span class="line"><span class="number">0</span>: <span class="number">11</span>,</span><br><span class="line">length: <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line">i: <span class="number">11</span>, <span class="comment">// åªæœ‰å‚æ•°è¢«èµ‹å€¼</span></span><br><span class="line">c: pointer to <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function"><span class="title">a</span>: <span class="title">undefined</span>,</span></span><br><span class="line"><span class="function"><span class="title">b</span>: <span class="title">undefined</span>,</span></span><br><span class="line"><span class="function">&#125;,</span></span><br><span class="line"><span class="function"><span class="title">scopeChain</span>: </span>&#123;...&#125;,</span><br><span class="line"><span class="keyword">this</span>: &#123;...&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œé˜¶æ®µ</span></span><br><span class="line">fooExecutionContext = &#123;</span><br><span class="line">variableObject: &#123;</span><br><span class="line"><span class="built_in">arguments</span>: &#123;</span><br><span class="line"><span class="number">0</span>: <span class="number">11</span>,</span><br><span class="line">length: <span class="number">1</span></span><br><span class="line">&#125;,</span><br><span class="line">i: <span class="number">11</span>,</span><br><span class="line">c: pointer to <span class="function"><span class="keyword">function</span> <span class="title">c</span>(<span class="params"></span>),</span></span><br><span class="line"><span class="function"><span class="title">a</span>: '<span class="title">hello</span>', // å˜é‡åœ¨è¿™ä¸ªæ—¶å€™æ‰è¢«èµ‹å€¼</span></span><br><span class="line"><span class="function"><span class="title">b</span>: <span class="title">pointer</span> <span class="title">to</span> <span class="title">function</span> <span class="title">bar</span>(<span class="params"></span>)</span></span><br><span class="line"><span class="function">&#125;,</span></span><br><span class="line"><span class="function"><span class="title">scopeChain</span>: </span>&#123;...&#125;,</span><br><span class="line"><span class="keyword">this</span>: &#123;...&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><p>ä»¥ä¸Šä¸‰ä¸ªæ¦‚å¿µéƒ½æ— æ³•ç”¨è¿‡ä»£ç è®¿é—®, æ˜¯è§£é‡Šå™¨åœ¨åå°ä½¿ç”¨.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨è¯´å£°æ˜æå‡ä¹‹å‰, é¦–å…ˆåº”è¯¥äº†è§£ä¸‰ä¸ªæ¦‚å¿µæ€§çš„ä¸œè¥¿, æ‰§è¡Œä¸Šä¸‹æ–‡(Execution Context)/ å˜é‡å¯¹è±¡(Variable Object)å’Œæ´»åŠ¨å¯¹è±¡(Activation Object), è¿™ä¸‰ä¸ªæ¦‚å¿µæ˜¯åœ¨ ES3 ä¸­å‡ºç°çš„.&lt;/p&gt;
&lt;ul&gt;
&lt;li&gt;&lt;p&gt;æ‰§è¡Œä¸Šä¸‹
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>äº‹ä»¶</title>
    <link href="https://yoursite.com/2017/12/10/%E4%BA%8B%E4%BB%B6%E4%BB%A3%E7%90%86-%E5%A7%94%E6%89%98/"/>
    <id>https://yoursite.com/2017/12/10/äº‹ä»¶ä»£ç†-å§”æ‰˜/</id>
    <published>2017-12-10T14:05:49.000Z</published>
    <updated>2022-08-23T09:37:40.691Z</updated>
    
    <content type="html"><![CDATA[<p>JavaScript å’Œ HTML äº¤äº’æ˜¯é€šè¿‡äº‹ä»¶å®ç°, è€Œäº‹ä»¶å¤„ç†ç¨‹åºè®¢é˜…äº‹ä»¶ä»è€Œæ‰§è¡Œç›¸åº”çš„æ“ä½œ.</p><h4 id="äº‹ä»¶æµ"><a href="#äº‹ä»¶æµ" class="headerlink" title="äº‹ä»¶æµ"></a>äº‹ä»¶æµ</h4><p>äº‹ä»¶æµæè¿°çš„æ˜¯ ä»é¡µé¢æ¥æ”¶äº‹ä»¶çš„é¡ºåº.<br>äº‹ä»¶å†’æ³¡: ä»æœ€å…·ä½“çš„å…ƒç´ åˆ°æœ€ä¸å…·ä½“çš„å…ƒç´ (ä»å†…åˆ°å¤–); â€” IE<br>äº‹ä»¶æ•è·: ä»æœ€ä¸å…·ä½“çš„å…ƒç´ åˆ°æœ€å…·ä½“çš„å…ƒç´ (ä»å¤–åˆ°å†…); â€” Netscape<br>DOM äº‹ä»¶æµ: å…ˆæ•è·åå†’æ³¡çš„æ–¹å¼.</p><p>DOMäº‹ä»¶æµåŒ…æ‹¬ä¸‰ä¸ªé˜¶æ®µ:</p><ol><li>æ•è·é˜¶æ®µ (IE ä½ç‰ˆæœ¬ä¸æ”¯æŒè¯¥é˜¶æ®µ)</li><li>ç›®æ ‡é˜¶æ®µ (è§¦å‘äº‹ä»¶)</li><li>å†’æ³¡é˜¶æ®µ (å›ä¼ æ–‡æ¡£)</li></ol><h4 id="äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#äº‹ä»¶å¤„ç†ç¨‹åº" class="headerlink" title="äº‹ä»¶å¤„ç†ç¨‹åº"></a>äº‹ä»¶å¤„ç†ç¨‹åº</h4><p>äº‹ä»¶æ˜¯ç”¨æˆ·æˆ–æµè§ˆå™¨è‡ªèº«æ‰§è¡Œçš„åŠ¨ä½œ, äº‹ä»¶å¤„ç†ç¨‹åº(äº‹ä»¶ç›‘å¬å™¨)æ˜¯å“åº”äº‹ä»¶çš„åŠ¨ä½œ. æ¯”å¦‚ click äº‹ä»¶çš„äº‹ä»¶å¤„ç†ç¨‹åºå°±æ˜¯ onclick, ä¸ºäº‹ä»¶æŒ‡å®šå¤„ç†ç¨‹åºçš„æ–¹å¼ä¹Ÿæœ‰å‡ ç§.</p><h5 id="HTML-äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#HTML-äº‹ä»¶å¤„ç†ç¨‹åº" class="headerlink" title="HTML äº‹ä»¶å¤„ç†ç¨‹åº"></a>HTML äº‹ä»¶å¤„ç†ç¨‹åº</h5><p>åœ¨æ ‡ç­¾ä¸Šç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åº, HTML å’Œ js ç´§å¯†è€¦åˆ<br><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">onclick</span>=<span class="string">'alert('</span><span class="attr">clicked</span>')'&gt;</span>click me<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure></p><h5 id="DOM-0çº§äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#DOM-0çº§äº‹ä»¶å¤„ç†ç¨‹åº" class="headerlink" title="DOM 0çº§äº‹ä»¶å¤„ç†ç¨‹åº"></a>DOM 0çº§äº‹ä»¶å¤„ç†ç¨‹åº</h5><p>å°†ä¸€ä¸ªå‡½æ•°èµ‹å€¼ç»™ä¸€ä¸ªäº‹ä»¶å¤„ç†ç¨‹åºå±æ€§<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">'#btn'</span>);</span><br><span class="line">btn.onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">alert(<span class="string">'clicked'</span>)</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></p><h5 id="DOM-2çº§äº‹ä»¶å¤„ç†ç¨‹åº"><a href="#DOM-2çº§äº‹ä»¶å¤„ç†ç¨‹åº" class="headerlink" title="DOM 2çº§äº‹ä»¶å¤„ç†ç¨‹åº"></a>DOM 2çº§äº‹ä»¶å¤„ç†ç¨‹åº</h5><p>å®šä¹‰äº†ä¸¤ä¸ªæ–¹æ³•, ç”¨äºç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åºå’Œåˆ é™¤äº‹ä»¶å¤„ç†ç¨‹åº: <code>addEventListener()</code>å’Œ<code>removeEventListener()</code>. æ‰€æœ‰çš„ DOM èŠ‚ç‚¹éƒ½åŒ…å«è¿™ä¸¤ä¸ªæ–¹æ³•, æ–¹æ³•æœ‰ä¸‰ä¸ªå‚æ•°: éœ€è¦å¤„ç†çš„äº‹ä»¶å/ å¤„ç†å‡½æ•°/ å¸ƒå°”å€¼(true ä¸ºåœ¨æ•è·é˜¶æ®µè°ƒç”¨; false ä¸ºåœ¨å†’æ³¡é˜¶æ®µè°ƒç”¨)<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = <span class="built_in">document</span>.querySelector(<span class="string">'#btn'</span>);</span><br><span class="line"><span class="comment">// ç»‘å®šå¤„ç†ç¨‹åº</span></span><br><span class="line">btn.addEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">alert(<span class="string">'clicked'</span>)</span><br><span class="line">&#125;, <span class="literal">false</span>);</span><br><span class="line"><span class="comment">// ç§»é™¤å¤„ç†ç¨‹åº(ç§»é™¤å¤„ç†ç¨‹åºæ—¶, ç¬¬äºŒä¸ªå‚æ•°å¿…é¡»å’Œç»‘å®šæ—¶ä¸€æ ·)</span></span><br><span class="line">btn.removeEventListener(<span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">alert(<span class="string">'remove'</span>)</span><br><span class="line">&#125;, <span class="literal">false</span>)</span><br></pre></td></tr></table></figure></p><h4 id="IE-å’Œ-DOM2çº§äº‹ä»¶å¤„ç†ç¨‹åºçš„åŒºåˆ«"><a href="#IE-å’Œ-DOM2çº§äº‹ä»¶å¤„ç†ç¨‹åºçš„åŒºåˆ«" class="headerlink" title="IE å’Œ  DOM2çº§äº‹ä»¶å¤„ç†ç¨‹åºçš„åŒºåˆ«"></a>IE å’Œ  DOM2çº§äº‹ä»¶å¤„ç†ç¨‹åºçš„åŒºåˆ«</h4><ul><li>IE äº‹ä»¶å¤„ç†ç¨‹åº<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> btn = docuemnt.querySelector(<span class="string">'#btn'</span>);</span><br><span class="line"><span class="comment">// ç»‘å®šäº‹ä»¶</span></span><br><span class="line">btn.attachEvent(<span class="string">'onclick'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// this === window</span></span><br><span class="line">alert(<span class="string">'click on IE'</span>)</span><br><span class="line">&#125;)</span><br><span class="line"><span class="comment">// ç§»é™¤äº‹ä»¶</span></span><br><span class="line">btn.detachEvent(<span class="string">'onclick'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">alert(<span class="string">'remove on IE'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure></li></ul><p><strong>ä»¥ä¸Šä¸¤ç§äº‹ä»¶å¤„ç†ç¨‹åºéƒ½æ”¯æŒç»‘å®šå¤šä¸ªäº‹ä»¶, DOM2çº§æŒ‰ç…§é¡ºåº</strong></p><ul><li>è·¨æµè§ˆå™¨äº‹ä»¶å¤„ç†<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> EventUtil = &#123;</span><br><span class="line"><span class="comment">// ç»‘å®šäº‹ä»¶å¤„ç†ç¨‹åº</span></span><br><span class="line">addHanlder: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (element.addEventListener) &#123;</span><br><span class="line">element.addEventListener(type, handler, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (element.attachEvent) &#123;</span><br><span class="line">element.attachEvent(<span class="string">'on'</span> + type, handler)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">element[<span class="string">'on'</span> + type] = handler;</span><br><span class="line">&#125;</span><br><span class="line">&#125;,</span><br><span class="line"><span class="comment">// ç§»é™¤äº‹ä»¶å¤„ç†ç¨‹åº</span></span><br><span class="line">removeHandler: <span class="function"><span class="keyword">function</span> (<span class="params">element, type, handler</span>) </span>&#123;</span><br><span class="line"><span class="keyword">if</span> (element.removeEventListener) &#123;</span><br><span class="line">element.removeEventListener(type, handler, <span class="literal">false</span>)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> <span class="keyword">if</span> (element.detachEvent) &#123;</span><br><span class="line">element.detachEvent(<span class="string">'on'</span> + type, handler)</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">else</span> &#123;</span><br><span class="line">element[<span class="string">'on'</span> + type] = <span class="literal">null</span>;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><h4 id="äº‹ä»¶ä»£ç†-å§”æ‰˜"><a href="#äº‹ä»¶ä»£ç†-å§”æ‰˜" class="headerlink" title="äº‹ä»¶ä»£ç†/ å§”æ‰˜"></a>äº‹ä»¶ä»£ç†/ å§”æ‰˜</h4><p>ç”±äºäº‹ä»¶å¤„ç†ç¨‹åºè¶Šå¤š, æ€§èƒ½è¶Šå·®, æ‰€ä»¥æœ‰äº†äº‹ä»¶å¤„ç†ç¨‹åº. äº‹ä»¶ä»£ç†çš„åŸç†æ˜¯åŸºäºäº‹ä»¶çš„å†’æ³¡æœºåˆ¶å®ç°çš„, ç”±ä¸Šçº§èŠ‚ç‚¹ä»£ç†å®Œæˆäº‹ä»¶ç»‘å®š, ä¼˜ç‚¹æ˜¯: </p><blockquote><p>èŠ‚çœå†…å­˜å ç”¨, å‡å°‘äº‹ä»¶æ³¨å†Œ. æ¯”å¦‚åœ¨<code>ul</code>ä»£ç†æ‰€æœ‰<code>li</code>çš„ç‚¹å‡»äº‹ä»¶<br>åŠ¨æ€æ–°å¢å­çº§æ—¶, æ— éœ€å†æ¬¡ç»‘å®šäº‹ä»¶.</p></blockquote><p>å¯èƒ½ä¼šæåˆ°<code>currentTarget</code>å’Œ<code>target</code>çš„åŒºåˆ«: currentTarget æ˜¯æ³¨å†Œäº‹ä»¶æ—¶çš„ç›®æ ‡(åœ¨äº‹ä»¶å¤„ç†ç¨‹åºä¸­<code>this</code>å§‹ç»ˆæŒ‡å‘ currentTarget), target æ˜¯çœŸæ­£è§¦å‘äº‹ä»¶çš„ç›®æ ‡.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">document</span>.body.onclick = <span class="function"><span class="keyword">function</span> (<span class="params">event</span>) </span>&#123;</span><br><span class="line"><span class="comment">// äº‹ä»¶æ³¨å†Œæ—¶çš„å…ƒç´ </span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">document</span>.body === event.currentTarget); <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="keyword">this</span> === <span class="built_in">document</span>.body); <span class="comment">// true</span></span><br><span class="line"><span class="comment">// çœŸæ­£ç‚¹å‡»çš„å…ƒç´ </span></span><br><span class="line"><span class="built_in">console</span>.log(event.target === <span class="built_in">document</span>.querySelector(<span class="string">'#btn'</span>)); <span class="comment">// true</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><h4 id="äº‹ä»¶å¯¹è±¡"><a href="#äº‹ä»¶å¯¹è±¡" class="headerlink" title="äº‹ä»¶å¯¹è±¡"></a>äº‹ä»¶å¯¹è±¡</h4><p>äº‹ä»¶å†…ç½®çš„ event å¯¹è±¡, ä¸‹é¢åˆ—ä¸¾å¸¸ç”¨çš„å‡ ä¸ªäº‹ä»¶å¯¹è±¡å±æ€§:</p><ul><li>event || window.event</li><li>event.preventDefault() || window.event.cancelBubble(Boolean)<br>é˜»æ­¢æµè§ˆå™¨é»˜è®¤äº‹ä»¶</li><li>event.stopPropagation() || window.event.returnValue(Boolean)<br>é˜»æ­¢å†’æ³¡äº‹ä»¶</li><li>event.target || winow.event.srcElement</li></ul><p>Created on 2017-12-10 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;JavaScript å’Œ HTML äº¤äº’æ˜¯é€šè¿‡äº‹ä»¶å®ç°, è€Œäº‹ä»¶å¤„ç†ç¨‹åºè®¢é˜…äº‹ä»¶ä»è€Œæ‰§è¡Œç›¸åº”çš„æ“ä½œ.&lt;/p&gt;
&lt;h4 id=&quot;äº‹ä»¶æµ&quot;&gt;&lt;a href=&quot;#äº‹ä»¶æµ&quot; class=&quot;headerlink&quot; title=&quot;äº‹ä»¶æµ&quot;&gt;&lt;/a&gt;äº‹ä»¶æµ&lt;/h4&gt;&lt;p&gt;äº‹ä»¶æµæè¿°çš„æ˜¯ 
      
    
    </summary>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Flex å¼¹æ€§ç›’å­</title>
    <link href="https://yoursite.com/2017/11/23/Flex-%E5%BC%B9%E6%80%A7%E7%9B%92%E5%AD%90/"/>
    <id>https://yoursite.com/2017/11/23/Flex-å¼¹æ€§ç›’å­/</id>
    <published>2017-11-23T11:15:28.000Z</published>
    <updated>2022-08-23T09:37:40.688Z</updated>
    
    <content type="html"><![CDATA[<p>Flex æ˜¯ Flexible box çš„ç¼©å†™(å¼¹æ€§å¸ƒå±€), ç”¨æ¥ä¸ºç›’æ¨¡å‹æä¾›æœ€å¤§çµæ´»æ€§çš„å¸ƒå±€, æ›´ä¸ºæ–¹ä¾¿çš„å®ç°å“åº”å¼å¸ƒå±€.</p><blockquote><p>å¦‚ä½•ä½¿ç”¨ Flex<br>ä»»ä½•ä¸€ä¸ªå®¹å™¨éƒ½å¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ª Flex å¸ƒå±€.  </p></blockquote><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* è¡Œå†…å…ƒç´  */</span></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line"><span class="attribute">display</span>: inline-flex;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">/* å†…æ ¸ä¸º webkit çš„æµè§ˆå™¨ */</span></span><br><span class="line"><span class="selector-class">.box</span>&#123;</span><br><span class="line"><span class="comment">/* Safari */</span></span><br><span class="line"><span class="attribute">display</span>: -webkit-flex;</span><br><span class="line"><span class="attribute">display</span>: flex;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è®¾å®š Flexå¸ƒå±€ä¹‹åçš„å­å…ƒç´ <code>float</code>/ <code>clear</code>/ <code>vertical-align</code>éƒ½å°†å¤±æ•ˆ.</p><h4 id="åŸºæœ¬æ¦‚å¿µ"><a href="#åŸºæœ¬æ¦‚å¿µ" class="headerlink" title="åŸºæœ¬æ¦‚å¿µ"></a>åŸºæœ¬æ¦‚å¿µ</h4><p>æ‰€æœ‰é‡‡ç”¨ Flex å¸ƒå±€çš„çš„å…ƒç´ éƒ½ç§°ä¸º Flex å®¹å™¨, å®ƒçš„æ‰€æœ‰èµ„æºéƒ½ä¸º Flex å®¹å™¨çš„å®¹å™¨æˆå‘˜, æˆä¸º Flex é¡¹ç›®.<br>Flex å®¹å™¨éƒ½å­˜åœ¨ä¸¤æ ¹è½´: æ°´å¹³çš„ä¸»è½´(main axis)å’Œå‚ç›´çš„äº¤å‰è½´(cross axis), é¡¹ç›®é»˜è®¤æ²¿ä¸»è½´æ’åˆ—. æ¯ä¸ªé¡¹ç›®å ä¸»è½´çš„ç©ºé—´ç§°ä¸º<code>main size</code>, å äº¤å‰è½´çš„ç©ºé—´ç§°ä¸º<code>cross size</code>.</p><h4 id="Flex-å®¹å™¨çš„å±æ€§"><a href="#Flex-å®¹å™¨çš„å±æ€§" class="headerlink" title="Flex å®¹å™¨çš„å±æ€§"></a>Flex å®¹å™¨çš„å±æ€§</h4><ul><li><p>flex-direction<br>é¡¹ç›®æ’åˆ—åœ¨ä¸»è½´çš„æ–¹å‘ </p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">flex-direction</span>: row | row-reverse | column | column-reverse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>row: é»˜è®¤å€¼, ä¸»è½´ä¸ºæ°´å¹³æ–¹å‘, èµ·ç‚¹ä¸ºå·¦è¾¹</li><li>row-reverse: ä¸»è½´ä¸ºæ°´å¹³æ–¹å‘, èµ·ç‚¹ä¸ºå³è¾¹</li><li>column: ä¸»è½´ä¸ºäº¤å‰è½´æ–¹å‘, èµ·ç‚¹åœ¨é¡¶éƒ¨</li><li>column-reverse: ä¸»è½´ä¸ºäº¤å‰è½´æ–¹å‘, èµ·ç‚¹åœ¨åº•éƒ¨</li></ul></li><li><p>flex-wrap<br>é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„æ¢è¡Œæ–¹å¼</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">flex-wrap</span>: nowrap | wrap | wrap-reverse;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>nowrap: é»˜è®¤å€¼, ä¸æ¢è¡Œ</li><li>wrap: æ¢è¡Œ, ç¬¬ä¸€è¡Œåœ¨ä¸Šé¢</li><li>wrap-reverse: æ¢è¡Œ, ç¬¬ä¸€è¡Œåœ¨ä¸‹é¢</li></ul></li><li><p>flex-flow<br>è¯¥å±æ€§ä¸º<code>flex-direction</code>å’Œ<code>flex-wrap</code>çš„ç¼©å†™, é»˜è®¤å€¼ä¸º<code>row nowrap</code></p></li></ul><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">flex-flow</span>: flex-direction || flex-wrap;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li><p>justify-content<br>é¡¹ç›®åœ¨ä¸»è½´ä¸Šçš„å¯¹é½æ–¹å¼, æ‰€ä»¥å®ƒçš„å¯¹é½æ–¹å¼è·Ÿè½´çš„æ–¹å‘æœ‰å…³</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">justify-content</span>: flex-start | center | space-around | space-between | flex-end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>flex-start: é»˜è®¤å€¼, å·¦å¯¹é½</li><li>center: å±…ä¸­</li><li>space-around: å·¦å³å±…ä¸­å¯¹é½, é¡¹ç›®ä¹‹é—´é—´éš”ä¸ºé¡¹ç›®ä¸è¾¹æ¡†çš„é—´éš”å¤§ä¸€å€</li><li>space-between: ä¸¤ç«¯å¯¹é½</li><li>flex-end: å³å¯¹é½ </li></ul></li><li><p>align-items<br>é¡¹ç›®åœ¨äº¤å‰è½´åœ¨çš„å¯¹é½æ–¹å¼, ä¸äº¤å‰è½´æ–¹å‘æœ‰å…³</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">align-items</span>: flex-start | center | baseline | stretch | flex-end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>flex-start: äº¤å‰è½´èµ·ç‚¹å¯¹é½</li><li>center: å±…ä¸­</li><li>baseline: é¡¹ç›®ç¬¬ä¸€è¡Œæ–‡å­—åŸºçº¿å¯¹é½, ç±»ä¼¼åœ¨æ–‡å­—çš„ä¸‹åˆ’çº¿ä½ç½®</li><li>stretch: é»˜è®¤å€¼, é¡¹ç›®æ²¡æœ‰é«˜åº¦æˆ–ä¸º<code>auto</code>æ—¶, å æ»¡æ•´ä¸ªå®¹å™¨</li><li>flex-end: ç»ˆç‚¹å¯¹é½</li></ul></li><li><p>align-content<br>å¤šæ ¹è½´çº¿å¯¹é½æ–¹å¼. å¦‚æœé¡¹ç›®åªæœ‰ä¸€æ ¹è½´çº¿, è¯¥å±æ€§åˆ™ä¸èµ·ä½œç”¨. è·Ÿ<code>align-items</code>å®¹æ˜“æ··æ·†, åŒºåˆ«åœ¨äº <code>align-content</code>é¡¹ç›®æœ‰å¤šè¡Œæ—¶èµ·ä½œç”¨, è€Œ<code>align-items</code>é¡¹ç›®å•è¡Œå°±å¯èµ·ä½œç”¨.</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.box</span> &#123;</span><br><span class="line"><span class="attribute">align-content</span>: flex-start | center | space-around | space-between | stretch | flex-end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>flex-start: äº¤å‰è½´å¯¹é½æ–¹å¼</li><li>center: å±…ä¸­</li><li>space-around: å·¦å³å±…ä¸­å¯¹é½</li><li>space-between: ä¸¤ç«¯å¯¹é½</li><li>stretch: é»˜è®¤å€¼, é¡¹ç›®è½´çº¿å æ»¡æ•´ä¸ªäº¤å‰è½´</li></ul></li></ul><h4 id="Flex-é¡¹ç›®å±æ€§"><a href="#Flex-é¡¹ç›®å±æ€§" class="headerlink" title="Flex é¡¹ç›®å±æ€§"></a>Flex é¡¹ç›®å±æ€§</h4><ul><li><p>order<br>å®šä¹‰é¡¹ç›®çš„æ’åˆ—é¡ºåº, æ•°å€¼è¶Šå°è¶Šé å‰, é»˜è®¤ä¸º0</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line"><span class="attribute">order</span>: &lt;number&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>flex-grow<br>å®šä¹‰é¡¹ç›®çš„æ”¾å¤§æ¯”ä¾‹, é»˜è®¤ä¸º0(æœ‰å‰©ä½™ç©ºé—´ä¹Ÿä¸æ”¾å¤§). å¦‚æœæ‰€æœ‰é¡¹ç›®éƒ½ä¸º1, å®ƒä»¬å°†ç­‰åˆ†å‰©ä½™ç©ºé—´; å¦‚æœå…¶ä¸­ä¸€ä¸ªé¡¹ç›®ä¸º2, å…¶å®ƒé¡¹ç›®ä¸º1, é‚£ä¹ˆå±æ€§ä¸º2çš„é¡¹ç›®å æ®çš„å‰©ä½™ç©ºé—´å°†æ¯”å±æ€§ä¸º1çš„é¡¹ç›®å¤§ä¸€å€</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line"><span class="attribute">flex-grow</span>: &lt;number&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>flex-shrink<br>å®šä¹‰é¡¹ç›®çš„ç¼©å°æ¯”ä¾‹, é»˜è®¤ä¸º1(å¦‚æœç©ºé—´ä¸è¶³, å°†ç¼©å°). å¦‚æœæ‰€æœ‰é¡¹ç›®éƒ½ä¸º1, å½“ç©ºé—´ä¸è¶³æ—¶, æ‰€æœ‰é¡¹ç›®éƒ½å°†ç­‰æ¯”ä¾‹ç¼©å°; å¦‚æœå…¶ä¸­ä¸€ä¸ªé¡¹ç›®ä¸º0, å…¶å®ƒé¡¹ç›®ä¸º1, é‚£ä¹ˆå½“ç©ºé—´ä¸è¶³æ—¶, å‰è€…å°†ä¸ç¼©å°</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line"><span class="attribute">flex-shrink</span>: &lt;number&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>flex-basis<br>å®šä¹‰å±æ€§åœ¨åˆ†é…å¤šä½™ç©ºé—´ä¹‹å‰é¡¹ç›®å æ®çš„ä¸»è½´ç©ºé—´(main size). æµè§ˆå™¨ä¼šæ ¹æ®è¿™ä¸ªå±æ€§è®¡ç®—æ˜¯å¦æœ‰å¤šäºç©ºé—´. é»˜è®¤å€¼ä¸º auto(é¡¹ç›®æœ¬èº«çš„å¤§å°). å¦‚æœä¸ä½¿ç”¨<code>box-sizing</code>æ¥æ”¹å˜ç›’æ¨¡å‹çš„è¯, è¯¥å±æ€§å°†å†³å®šé¡¹ç›®çš„å†…å®¹ç›’(content-box)çš„å®½æˆ–è€…é«˜(å®½æˆ–é«˜å–å†³äºä¸»è½´çš„æ–¹å‘).</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line"><span class="comment">/* size çš„å•ä½å¯ä»¥ä¸º px/ em/rem ç™¾åˆ†æ¯”éƒ½è¡Œ(è´Ÿå€¼æ— æ•ˆ) */</span></span><br><span class="line"><span class="attribute">flex-basis</span>: &lt;size&gt; | &lt;content&gt;;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><ul><li>size: è·Ÿå®½é«˜è®¾ç½®ä¸€æ ·, ä¸å¤šè¯´.</li><li>content: css3 çš„å‡ ä¸ª width æ–°å±æ€§. fill-available/ max-content/ min-content/ fit-content, å…¼å®¹æ€§ IE ä¸æ”¯æŒ.</li></ul></li><li><p>flex<br>è¯¥å±æ€§ä¸º<code>flex-grow</code>/<code>flex-shrink</code>å’Œ<code>flex-basis</code>çš„ç¼©å†™, é»˜è®¤å€¼ä¸º <code>0 1 auto</code>, åä¸¤ä¸ªå±æ€§å¯é€‰</p>  <figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.item</span> &#123;</span><br><span class="line"><span class="attribute">flex</span>: none | flex-grow flex-shrink flex-basis</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>align-self<br>å…è®¸å•ä¸ªé¡¹ç›®ä¸å…¶ä»–é¡¹ç›®æœ‰ä¸åŒçš„å¯¹é½æ–¹å¼, å¯è¦†ç›–<code>align-items</code>å±æ€§, é»˜è®¤å€¼ä¸º auto, ç»§æ‰¿çˆ¶çº§å…ƒç´ çš„<code>align-items</code>å±æ€§, æ²¡æœ‰çš„è¯ç­‰åŒäº<code>stretch</code></p>  <figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">.item &#123;</span><br><span class="line">align-self: auto | flex-start | center | stretch | baseline | flex-end;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ul><p>é™¤äº† <code>auto</code>ä»¥å¤–å…¶ä»–å±æ€§å€¼è·Ÿ<code>align-items</code>ä¸€æ ·å°±ä¸å†é‡å¤äº†.</p><blockquote><p>è¯´ä¸€ä¸‹ CSS3 width çš„å‡ ä¸ªæ–°å±æ€§<br>éœ€è¦å¸¦æœ‰ç§æœ‰å‰ç¼€  </p></blockquote><ul><li>fill-available<br>è®©å…ƒç´ è‡ªåŠ¨100%å¾—å¡«å……çˆ¶çº§å®½åº¦, è®©å…ƒç´ è¡¨ç°å¾—åƒå—çº§å…ƒç´ ä¸€æ ·, <code>inline-block</code>çš„å…ƒç´ ä¹Ÿå¯ä»¥è‡ªåŠ¨å¡«å……, é¡ºä¾¿å†çˆ¶çº§åŠ ä¸€ä¸ª<code>line-height</code>è®©å…ƒç´ å‚ç›´å±…ä¸­.</li><li>max-content<br>å®ƒçš„è¡¨ç°å°±åƒè®¾ç½®äº†<code>white-space:nowrap</code>ä¸€æ ·, å…ƒç´ çš„å®½åº¦å–å­å…ƒç´ ä¸­è¾ƒå¤§å®½åº¦çš„å®½åº¦</li><li>min-content<br>å®ƒè¡¨ç¤ºçš„ä¸æ˜¯å­å…ƒç´ ä¸­å®½åº¦å°çš„é‚£ä¸ªå®½åº¦, è€Œæ˜¯å†…éƒ¨å…ƒç´ æœ€å°å®½åº¦å€¼æœ€å¤§çš„é‚£ä¸ªå…ƒç´ ä½œä¸ºæœ€ç»ˆå®½åº¦. æ¯”å¦‚: ä¸€ä¸ª<code>div</code>ä¸­, æœ‰ä¸€å¼ <code>img</code>çš„å®½åº¦ä¸º200px, æœ‰ä¸€ä¸ª<code>p</code>é‡Œé¢çš„æ–‡å­—å¯å¤šå¯å°‘é‡Œé¢æœ‰è‹±æ–‡(å¦‚æœæ–‡æœ¬å…¨æ˜¯ä¸­æ–‡, æœ€å°å®½åº¦å€¼å°±æ˜¯ä¸€ä¸ªä¸­æ–‡çš„å®½åº¦, å¦‚æœå¤¹æ‚è‹±æ–‡, ç”±äºè‹±æ–‡é»˜è®¤ä¸æ¢è¡Œ, æ‰€ä»¥æœ€å°å®½åº¦å€¼æ˜¯æœ€é•¿å•è¯çš„å®½åº¦), æ‰€ä»¥å‡è®¾è¿™é‡Œè‹±æ–‡çš„æœ€é•¿å•è¯ä¸è¶³200px, é‚£ä¹ˆæœ€ç»ˆçš„å…ƒç´ å®½åº¦å°±ä¸º200px</li><li>fit-content<br>è®¾ç½®è¯¥å±æ€§å, ä¸éœ€è¦å›ºå®šå®½åº¦, åœ¨çˆ¶çº§å…ƒç´ <code>margin: 0 auto</code>å°±å¯ä»¥å®ç°æ°´å¹³å±…ä¸­äº†</li></ul><p>Created on 2017-11-23 By Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;Flex æ˜¯ Flexible box çš„ç¼©å†™(å¼¹æ€§å¸ƒå±€), ç”¨æ¥ä¸ºç›’æ¨¡å‹æä¾›æœ€å¤§çµæ´»æ€§çš„å¸ƒå±€, æ›´ä¸ºæ–¹ä¾¿çš„å®ç°å“åº”å¼å¸ƒå±€.&lt;/p&gt;
&lt;blockquote&gt;
&lt;p&gt;å¦‚ä½•ä½¿ç”¨ Flex&lt;br&gt;ä»»ä½•ä¸€ä¸ªå®¹å™¨éƒ½å¯ä»¥æŒ‡å®šä¸ºä¸€ä¸ª Flex å¸ƒå±€.  &lt;/p&gt;
&lt;/blockquot
      
    
    </summary>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="CSS" scheme="https://yoursite.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>é—­åŒ…å’Œé«˜é˜¶å‡½æ•°</title>
    <link href="https://yoursite.com/2017/10/26/%E9%97%AD%E5%8C%85%E5%92%8C%E9%AB%98%E9%98%B6%E5%87%BD%E6%95%B0/"/>
    <id>https://yoursite.com/2017/10/26/é—­åŒ…å’Œé«˜é˜¶å‡½æ•°/</id>
    <published>2017-10-26T15:09:00.000Z</published>
    <updated>2022-08-23T09:37:40.693Z</updated>
    
    <content type="html"><![CDATA[<p>è¿™ä¸€ç¯‡ç¬”è®°æ˜¯ä¸ºæ­£å¼å¼€å§‹å­¦ä¹  javadcript è®¾è®¡æ¨¡å¼åšé“ºå«ï¼Œç”±äºè®¸å¤šè®¾è®¡æ¨¡å¼éƒ½ç”¨åˆ°äº†é—­åŒ…å’Œé«˜é˜¶å‡½æ•°æ¥å®ç°, æ‰€ä»¥äº†è§£è¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹ä¹Ÿæ˜¯å¿…è¦çš„.</p><blockquote><h3 id="é—­åŒ…"><a href="#é—­åŒ…" class="headerlink" title="é—­åŒ…"></a>é—­åŒ…</h3><p>é—­åŒ…ç®€å•çš„æ¥è¯´æ˜¯å‡½æ•°ä¸å‡½æ•°ä¹‹é—´çš„æ¡¥æ¢, è®©ä¸€ä¸ªå‡½æ•°æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸé‡Œçš„å˜é‡. å®šä¹‰è¯´èµ·æ¥è¿˜æ˜¯å¾ˆç”Ÿæ¶©çš„, è¦ç†è§£é—­åŒ…æˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“å˜é‡çš„ä½œç”¨åŸŸä»¥åŠå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ‰è¡Œ.</p></blockquote><ul><li>å˜é‡çš„ä½œç”¨åŸŸ<br>å˜é‡çš„ä½œç”¨åŸŸæŒ‡çš„æ˜¯å˜é‡çš„æœ‰æ•ˆèŒƒå›´. åœ¨å‡½æ•°ä¸­ç”Ÿå‘½å˜é‡æ—¶, å¦‚æœæ²¡æœ‰å…³é”®å­— varã€letåŠconsté‚£ä¹ˆè¿™ä¸ªå˜é‡å°±ä¼šå˜æˆå…¨å±€å˜é‡; å¦‚æœæœ‰è¿™ä¸ªæ—¶å€™çš„å˜é‡å°±æ˜¯å±€éƒ¨å˜é‡, åªæœ‰åœ¨å‡½æ•°å†…éƒ¨æ‰èƒ½å¤Ÿè®¿é—®åˆ°.<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fun = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line">alert(a)</span><br><span class="line">&#125;</span><br><span class="line">fun()</span><br><span class="line">alert(a) <span class="comment">// a is not defined</span></span><br></pre></td></tr></table></figure></li></ul><p>å‡½æ•°è¿™ä¸ªæ—¶å€™å°±åƒä¸€å—å•é¢é•œ, é‡Œé¢å¯ä»¥çœ‹è§å¤–é¢, å¤–é¢ä¸èƒ½çœ‹åˆ°é‡Œé¢. å› ä¸ºå‡½æ•°åœ¨æœç´¢ä¸€ä¸ªå˜é‡çš„æ—¶å€™, å¦‚æœå‡½æ•°å†…æ²¡æœ‰è¿™ä¸ªå˜é‡, é‚£ä¹ˆè¿™ä¸ªæœç´¢è¿‡ç¨‹ä¼šéšç€ä»£ç çš„æ‰§è¡Œç¯å¢ƒåˆ›å»ºçš„ä½œç”¨åŸŸé“¾å‘å¤–æœç´¢ç›´è‡³å…¨å±€å¯¹è±¡.</p><ul><li>å˜é‡ç”Ÿå‘½å‘¨æœŸ<br>å¯¹äºå…¨å±€å˜é‡æ¥è¯´, å®ƒçš„ç”Ÿå‘½å‘¨æœŸè‡ªç„¶æ˜¯æ°¸ä¹…çš„é™¤éæˆ‘ä»¬æ‰‹åŠ¨é”€æ¯è¿™ä¸ªå˜é‡; å¯¹äºå±€éƒ¨å˜é‡, ä¸€èˆ¬æ¥è¯´å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åè¯¥å˜é‡å°±ä¼šè·Ÿç€è¢«é”€æ¯. è€Œé—­åŒ…åˆ™å¯ä»¥å»¶ç»­å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ, ä¸¾ä¸ªæ —å­:<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> func = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">0</span>;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">a++;</span><br><span class="line">alert(a);</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> fn = func();</span><br><span class="line">fn(); <span class="comment">// 1</span></span><br><span class="line">fn(); <span class="comment">// 2</span></span><br><span class="line">fn(); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure></li></ul><p>è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° a å˜é‡ä¸ä»…åœ¨å¤–éƒ¨å¯ä»¥è¢«è®¿é—®åˆ°è€Œä¸”è¿˜ä¸€ç›´åœ¨é€’å¢, è¿™æ˜¯å› ä¸º <code>fn = func()</code>æ‰§è¡Œæ—¶, fn ä¿å­˜äº† func è¿”å›çš„åŒ¿åå‡½æ•°, è€Œè¿™ä¸ªåŒ¿åå‡½æ•°æ˜¯æœ‰æƒ func() è¢«è°ƒç”¨æ—¶äº§ç”Ÿçš„ç¯å¢ƒ. a å˜é‡å°±åœ¨è¿™ä¸ªç¯å¢ƒä¸­, æ‰€ä»¥æ—¢ç„¶å±€éƒ¨å˜é‡æ‰€åœ¨æ¢çš„ç¯å¢ƒæ²¡æœ‰è¢«é”€æ¯é‚£ä¹ˆ a å˜é‡ä¹Ÿä¸ä¼šè¢«é”€æ¯æ‰, è¿™ä¸ªä¾‹å­å°±äº§ç”Ÿäº†ä¸€ä¸ªé—­åŒ…ç»“æ„.</p><blockquote><h4 id="é—­åŒ…çš„ä½œç”¨"><a href="#é—­åŒ…çš„ä½œç”¨" class="headerlink" title="é—­åŒ…çš„ä½œç”¨"></a>é—­åŒ…çš„ä½œç”¨</h4></blockquote><ul><li>å°è£…å˜é‡<br>ä¼—æ‰€å‘¨çŸ¥å…¨å±€å˜é‡æ˜¯éå¸¸å®¹æ˜“å¼•èµ·å‘½åå†²çªçš„, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨é—­åŒ…æŠŠä¸€äº›ä¸éœ€è¦æš´éœ²åœ¨å…¨å±€çš„å˜é‡å°è£…æˆç§æœ‰å˜é‡.</li></ul><p>å‡è®¾æœ‰ä¸€ä¸ªè®¡ç®—ä¹˜ç§¯çš„å‡½æ•°:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> mult = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line"><span class="comment">// ç¼“å­˜(å°è£…èµ·æ¥)</span></span><br><span class="line"><span class="keyword">let</span> cache = &#123;&#125;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> arg = [].join.call(<span class="built_in">arguments</span>, <span class="string">','</span>)</span><br><span class="line"><span class="comment">// å°è£…è®¡ç®—æ–¹æ³•</span></span><br><span class="line"><span class="keyword">let</span> calulate = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, len = <span class="built_in">arguments</span>.length; i &lt; len; i++) &#123;</span><br><span class="line">a = a * <span class="built_in">arguments</span>[i]</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å­˜åœ¨ç¼“å­˜åˆ™ä¸è®¡ç®—</span></span><br><span class="line"><span class="keyword">if</span> (arg <span class="keyword">in</span> cache) <span class="keyword">return</span> cache[arg]</span><br><span class="line"><span class="keyword">return</span> cache[arg] = calulate.apply(<span class="literal">null</span>, <span class="built_in">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(mult(<span class="number">2</span>,<span class="number">2</span>,<span class="number">1</span>)); <span class="comment">// 4</span></span><br></pre></td></tr></table></figure></p><p>å°†å˜é‡ cache å°è£…åœ¨ mult å‡½æ•°ä¸­æ¥ç¼“å­˜å·²ç»è®¡ç®—è¿‡çš„å‚æ•°, ä»¥å‡å°‘é‡å¤è®¡ç®—. è¿™ä¸ªç¼“å­˜æœºåˆ¶æœ¬æ¥æ˜¯å¯ä»¥æ‰”åœ¨å…¨å±€ç¯å¢ƒä¸­çš„.</p><ul><li>å»¶ç»­å±€éƒ¨å˜é‡ç”Ÿå‘½å‘¨æœŸ<br>å¹³å¸¸åšåŸ‹ç‚¹ä¼šç”¨åˆ°çš„ image å¯¹è±¡æ¥ä¸ŠæŠ¥æ•°æ®, å¦‚ä¸‹:</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> report = <span class="function"><span class="keyword">function</span> (<span class="params">src</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> img = <span class="keyword">new</span> Image()</span><br><span class="line">img.src = src</span><br><span class="line">&#125;</span><br><span class="line">report(<span class="string">'http://xxxxx.com/xxx'</span>)</span><br></pre></td></tr></table></figure><p>è¿™ç§å†™æ³•ä¼šé€ æˆæ•°æ®ä¸¢å¤±, å› ä¸ºåœ¨ HTTP è¿˜æœªç»“æŸæ—¶, report å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•è€Œ img ä¸º report å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡, åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åå°±ä¼šéšä¹‹é”€æ¯é€ æˆæ•°æ®ä¸¢å¤±çš„æƒ…å†µ. ä¸‹é¢ç”¨é—­åŒ…æŠŠå˜é‡å°è£…èµ·æ¥, æ¥è§£å†³è¿™ä¸€é—®é¢˜:<br><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> report = (<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> imgs = []</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params">src</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> img = <span class="keyword">new</span> Image();</span><br><span class="line">imgs.push(img);</span><br><span class="line">img.src = src</span><br><span class="line">&#125;</span><br><span class="line">&#125;)()</span><br><span class="line">report(<span class="string">'http://xxxxx.com/xxx'</span>)</span><br></pre></td></tr></table></figure></p><blockquote><h4 id="é—­åŒ…å®ç°å‘½ä»¤æ¨¡å¼"><a href="#é—­åŒ…å®ç°å‘½ä»¤æ¨¡å¼" class="headerlink" title="é—­åŒ…å®ç°å‘½ä»¤æ¨¡å¼"></a>é—­åŒ…å®ç°å‘½ä»¤æ¨¡å¼</h4><p>è¯´äº†è¿™ä¹ˆå¤šå°±æ¥çœ‹çœ‹å…³äºé—­åŒ…çš„è¿ç”¨å§, è¿™é‡Œç”¨é—­åŒ…ç®€å•å®ç°ä¸‹å‘½ä»¤æ¨¡å¼, é¡ºä¾¿é¢„å…ˆäº†è§£ä¸€ä¸‹å‘½ä»¤æ¨¡å¼.</p></blockquote><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">'open'</span> <span class="attr">onclick</span>=<span class="string">'execute'</span>&gt;</span>æ‰§è¡Œå‘½ä»¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">button</span> <span class="attr">id</span>=<span class="string">'close'</span> <span class="attr">onclick</span>=<span class="string">'undo'</span>&gt;</span>æ’¤é”€å‘½ä»¤<span class="tag">&lt;/<span class="name">button</span>&gt;</span></span><br></pre></td></tr></table></figure><ul><li>é¢å‘å¯¹è±¡ç‰ˆ<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TV = &#123;</span><br><span class="line">open () &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'TV is open!'</span>)</span><br><span class="line">&#125;,</span><br><span class="line">close () &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'TV is close!'</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ¥æ”¶å‘½ä»¤</span></span><br><span class="line"><span class="keyword">const</span> ReceiveCommand = <span class="function"><span class="params">receiver</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">this</span>.receiver = receiver</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰“å¼€ç”µè§†</span></span><br><span class="line">ReceiveCommand.prototype.execute = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.receiver.open()</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å…³ç”µè§†</span></span><br><span class="line">ReceiveCommand.prototype.undo = functon () &#123;</span><br><span class="line"><span class="keyword">this</span>.receiver.close()</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// è®¾ç½®å‘½ä»¤</span></span><br><span class="line"><span class="keyword">const</span> setCommand = <span class="function"><span class="keyword">function</span> (<span class="params">command</span>) </span>&#123;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'open'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">command.execute()</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'close'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">command.undo()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å°†å‘½ä»¤å‘Šè¯‰æ‰§è¡Œè€…, è®¾ç½®å‘½ä»¤ä¼ å…¥æ‰§è¡Œè€…</span></span><br><span class="line">setCommand(<span class="keyword">new</span> ReceiveCommand(TV))</span><br></pre></td></tr></table></figure></li></ul><p>å‘½ä»¤æ¨¡å¼æ˜¯æŠŠè¯·æ±‚å‘èµ·è€…å’Œæ‰§è¡Œå‘½ä»¤(æ‰§è¡Œè€…)åˆ†ç¦»å¼€æ¥, ä»¥è¾¾åˆ°è§£è€¦çš„ç›®çš„. åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰, æŠŠå‘½ä»¤æ”¾å…¥æ‰§è¡Œè€…æ¥å‘Šè¯‰æ‰§è¡Œè€…è¦æ‰§è¡Œä»€ä¹ˆæ ·çš„å‘½ä»¤, å‘½ä»¤æ¨¡å¼å¤§æ¦‚å°±æ˜¯è¿™æ ·å•¦.</p><ul><li>é—­åŒ…ç‰ˆ<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> TV = &#123;</span><br><span class="line">open () &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'TV is open!'</span>)</span><br><span class="line">&#125;,</span><br><span class="line">close () &#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="string">'TV is close!'</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ‰§è¡Œè€…</span></span><br><span class="line"><span class="keyword">const</span> receiveCommand = <span class="function"><span class="params">receiver</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> execute = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> receiver.open()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">let</span> undo = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">return</span> receiver.close()</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line">execute: execute,</span><br><span class="line">undo: undo</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// å‘èµ·è€…</span></span><br><span class="line"><span class="keyword">const</span> setCommand = <span class="function"><span class="params">command</span> =&gt;</span> &#123;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'open'</span>).onclick = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">execute.open()</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'close'</span>).onclick = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line">undo.close()</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">setCommand(receiveCommand(TV))</span><br></pre></td></tr></table></figure></li></ul><p>é—­åŒ…æ˜æ˜¾æ¸…æ™°æ›´å¤š, ä¹Ÿæ›´ç®€æ´.</p><blockquote><h3 id="é«˜é˜¶å‡½æ•°"><a href="#é«˜é˜¶å‡½æ•°" class="headerlink" title="é«˜é˜¶å‡½æ•°"></a>é«˜é˜¶å‡½æ•°</h3><p>å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’æˆ–è®©å‡½æ•°æ‰§è¡Œç»“æœè¿”å›å¦ä¸€ä¸ªå‡½æ•°, æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€çš„å‡½æ•°éƒ½å¯ä»¥ç§°ä½œä¸ºé«˜é˜¶å‡½æ•°.</p></blockquote><h4 id="å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’"><a href="#å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’" class="headerlink" title="å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’"></a>å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’</h4><p>å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’, å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†ä¸ä¸šåŠ¡ç›¸å…³çš„é€»è¾‘ä»£ç åˆ†ç¦»å‡ºæ¥, è§£é™¤ä¸šåŠ¡ä»£ç å’Œä¸å˜é€»è¾‘çš„è€¦åˆ, æœ€å¸¸è§çš„å°±æ˜¯æˆ‘ä»¬çš„å›è°ƒå‡½æ•°. å®é™…è¿ç”¨ä¸­ ajax å¼‚æ­¥è¯·æ±‚, å½“æˆ‘ä»¬ä¸çŸ¥é“è¿”å›å€¼åœ¨ä»€ä¹ˆæ—¶å€™è¿”å›å€¼åˆéœ€è¦åœ¨è¿”å›ååšä¸€äº›å¤„ç†, å°±è¦ç”¨åˆ°å›è°ƒå‡½æ•°äº†.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> getPersonInfo = <span class="function"><span class="keyword">function</span> (<span class="params">userId, callback</span>) </span>&#123;</span><br><span class="line">$.ajax(<span class="string">`http://xxx/getPersonInfo?<span class="subst">$&#123;userId&#125;</span>`</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line">callback &amp;&amp; callback(data)</span><br><span class="line">&#125;)</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™é‡Œçš„åŒ¿åå‡½æ•°å°±æ˜¯ä¸Šé¢çš„ callback</span></span><br><span class="line">getPersonInfo(<span class="string">"54332123"</span>, <span class="function"><span class="keyword">function</span> (<span class="params">data</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(data)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™ç§æ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸è§çš„å›è°ƒå‡½æ•°, åœ¨å…¶ä»–çš„æ–¹é¢, ä¹Ÿå¯ä»¥å°†ä¸€äº›è¯·æ±‚å§”æ‰˜ç»™å¦ä¸€ä¸ªå‡½æ•°ä»£ä¸ºæ‰§è¡Œ, å¦‚:<br>å‡å¦‚æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»º100çš„ div èŠ‚ç‚¹, ç„¶åæŠŠå®ƒä»¬éšè—æ‰</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// count é»˜è®¤å€¼ä¸º100</span></span><br><span class="line"><span class="keyword">const</span> appendDiv = count = <span class="number">100</span>, callback =&gt; &#123;</span><br><span class="line"><span class="keyword">if</span> (count &amp;&amp; <span class="keyword">typeof</span> count === <span class="string">'number'</span>) &#123;</span><br><span class="line"><span class="keyword">for</span>(<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; count; i++)&#123;</span><br><span class="line"><span class="keyword">let</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">div.innerHTML = i</span><br><span class="line"><span class="built_in">document</span>.body.appendChild(div)</span><br><span class="line"><span class="comment">// å°†ä¸šåŠ¡ä»£ç å§”æ‰˜æ‰§è¡Œ</span></span><br><span class="line">callback &amp;&amp; callback(div)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// æŠŠæ”¹å˜æ ·å¼çš„ä¸šåŠ¡é€»è¾‘åˆ†ç¦»å‡ºæ¥</span></span><br><span class="line">appendDiv(<span class="function"><span class="keyword">function</span> (<span class="params">el</span>) </span>&#123;</span><br><span class="line">el.style.cssText = <span class="string">`display: none`</span></span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>è¿™æ ·æˆ‘ä»¬å°±å°†ä¸šåŠ¡é€»è¾‘åˆ†ç¦»å‡ºæ¥äº†, ä»¥åå¯èƒ½æˆ‘ä»¬æƒ³æ”¹é¢œè‰²å•¦æˆ–è€…ä½ç½®ä»€ä¹ˆçš„ä¹Ÿæ–¹ä¾¿ç»´æŠ¤.</p><h4 id="å‡½æ•°ä½œä¸ºè¿”å›å€¼"><a href="#å‡½æ•°ä½œä¸ºè¿”å›å€¼" class="headerlink" title="å‡½æ•°ä½œä¸ºè¿”å›å€¼"></a>å‡½æ•°ä½œä¸ºè¿”å›å€¼</h4><p>ç›¸æ¯”æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’, å¯èƒ½å‡½æ•°å½“åšè¿”å›å€¼è¿”å›è¿ç”¨åœºæ™¯æ›´å¤šä¸€äº›, è®©å‡½æ•°è¿”å›å¦ä¸€ä¸ªå¯æ‰§è¡Œå‡½æ•°å°±æ„å‘³ç€è¿ç®—è¿‡ç¨‹å¯å»¶ç»­.ç›´æ¥æ¥çœ‹ä¸€äº›ä¾‹å­å§.</p><ul><li>æ£€æŸ¥ç±»å‹</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Type = &#123;&#125;</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>, type; type = [<span class="string">'Array'</span>, <span class="string">'String'</span>, <span class="string">'Number'</span>][i++];) &#123;</span><br><span class="line">Type[<span class="string">'is'</span> + type] = <span class="function"><span class="keyword">function</span> (<span class="params">obj</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">Object</span>.prototype.toString.call(obj) === <span class="string">'[object '</span>+ type +<span class="string">']'</span></span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(Type.isArray([])) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Type.isString(<span class="string">'123'</span>)) <span class="comment">// true</span></span><br><span class="line"><span class="built_in">console</span>.log(Type.isNumber(<span class="number">123</span>)) <span class="comment">// true</span></span><br></pre></td></tr></table></figure><ul><li>å•ä¾‹æ¨¡å¼<br>  è¿™é‡Œå…ˆä¸è®¨è®ºå•ä¾‹æ¨¡å¼, åªçœ‹ä»£ç å®ç°</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// fn å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’</span></span><br><span class="line"><span class="keyword">const</span> getSingle = <span class="function"><span class="keyword">function</span> (<span class="params">fn</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> ret;</span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// å¦‚æœ ret ä¸å­˜åœ¨, ret ç­‰äº fn å‡½æ•°</span></span><br><span class="line"><span class="keyword">return</span> ret || (ret = fn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>))</span><br><span class="line">&#125;</span><br><span class="line">&#125; </span><br><span class="line"><span class="comment">// è°ƒç”¨è¿™ä¸ªé«˜é˜¶å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> getDiv = getSingle(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="comment">// å‚æ•°ä¹Ÿä¼šä¸€èµ·ä¼ è¿‡æ¥, è¿™é‡Œè¿”å›['123']</span></span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">arguments</span>);</span><br><span class="line"><span class="keyword">return</span> <span class="built_in">document</span>.createElement(<span class="string">'div'</span>);</span><br><span class="line"></span><br><span class="line">&#125;)</span><br><span class="line">getDiv(<span class="string">'123'</span>)</span><br></pre></td></tr></table></figure><p>getSingle è¿™ä¸ªé«˜é˜¶å‡½æ•°æ—¢å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’, åˆè®©å‡½æ•°æ‰§è¡Œåè¿”å›å¦ä¸€ä¸ªå‡½æ•°.</p><blockquote><p>JavaScript è®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µè¿˜æœ‰ä¸ªä¾‹å­ä¹Ÿå¾ˆæœ‰æ„æ€<br>å«åš AOP(é¢å‘åˆ‡é¢ç¼–ç¨‹), ä½œç”¨æ˜¯æŠŠä¸ä¸šåŠ¡é€»è¾‘ä¸ç›¸å…³çš„éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥å†é€šè¿‡åŠ¨æ€æ¤å…¥çš„æ–¹å¼åŠ å…¥ä¸šåŠ¡é€»è¾‘çš„æ¨¡å—ä¸­.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åœ¨åŸå‡½æ•°ä¹‹å‰</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.before = <span class="function"><span class="keyword">function</span> (<span class="params">beforeFn</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> that = <span class="keyword">this</span>; <span class="comment">// ä¿å­˜åŸå‡½æ•°çš„å¼•ç”¨</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// A</span></span><br><span class="line"><span class="comment">// æ‰§è¡Œæ–°å‡½æ•°å¹¶ä¿®æ­£ this</span></span><br><span class="line">beforeFn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line"><span class="comment">// æ‰§è¡ŒåŸå‡½æ•°</span></span><br><span class="line"><span class="keyword">return</span> that.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åœ¨åŸå‡½æ•°ä¹‹å</span></span><br><span class="line"><span class="built_in">Function</span>.prototype.after = <span class="function"><span class="keyword">function</span> (<span class="params">afterFn</span>) </span>&#123;</span><br><span class="line"><span class="keyword">let</span> that = <span class="keyword">this</span></span><br><span class="line"><span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123; <span class="comment">// B</span></span><br><span class="line"><span class="comment">// å…ˆæ‰§è¡Œ before å‡½æ•°</span></span><br><span class="line">that.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line"><span class="comment">// å†æ‰§è¡Œæ–°å‡½æ•°</span></span><br><span class="line"><span class="keyword">return</span> afterFn.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">2</span>)</span><br><span class="line">&#125;</span><br><span class="line">fn = fn.before(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">&#125;).after(<span class="function"><span class="keyword">function</span>(<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(<span class="number">3</span>)</span><br><span class="line">&#125;)</span><br><span class="line"></span><br><span class="line">fn() <span class="comment">// æŒ‰é¡ºåºè¾“å‡º 1 2 3</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢çš„æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„:</p><ol><li>Afterä¸­çš„å›è°ƒå‡½æ•° B<br>å› ä¸ºåœ¨æœ€åæ‰§è¡Œ fn å‡½æ•°æ—¶, fn å·²ç»æ˜¯ after å‡½æ•°äº†, å› æ­¤åœ¨ fn() æ‰§è¡Œæ—¶è°ƒç”¨çš„æ˜¯ after ä¸­è¿”å›çš„åŒ¿åå‡½æ•°B.</li><li>B ä¸­çš„ that.apply(this, arguments)<br>æ­¤æ—¶çš„ that æŒ‡å‘ before å‡½æ•°</li><li>æ‰§è¡ŒBeforeä¸­çš„å›è°ƒå‡½æ•° A</li><li>A ä¸­çš„ beforeFn.apply(this, arguments)<br>æ‰§è¡Œ console.log(1)</li><li>return that.apply(this, arguments)<br>æ‰§è¡Œ console.log(2)</li><li>å›åˆ° after å‡½æ•°ä¸­æ‰§è¡Œreturn afterFn.apply(this, arguments)<br>æ‰§è¡Œ console.log(3)</li></ol><h4 id="å‡½æ•°æŸ¯é‡ŒåŒ–"><a href="#å‡½æ•°æŸ¯é‡ŒåŒ–" class="headerlink" title="å‡½æ•°æŸ¯é‡ŒåŒ–"></a>å‡½æ•°æŸ¯é‡ŒåŒ–</h4><p>å‡½æ•°æŸ¯é‡ŒåŒ–å¯ä»¥è¯´æ˜¯é«˜é˜¶å‡½æ•°ç»å…¸ä¸­çš„ç»å…¸äº†, è¯´åˆ°é«˜é˜¶å‡½æ•°åº”è¯¥å¾ˆå¿«å°±ä¼šæƒ³åˆ°ä»–äº†. æˆ‘ç†è§£çš„å‡½æ•°æŸ¯é‡ŒåŒ–æ˜¯: å…ˆå°†å‚æ•°ä¾æ¬¡ç¼“å­˜, åœ¨çœŸæ­£éœ€è¦è®¡ç®—ç»“æœæ—¶, æ‰è¿›è¡Œè®¡ç®—è¿™æ ·å¯ä»¥å‡å°‘è¿ç®—æ¬¡æ•°.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// é€šç”¨ curring</span></span><br><span class="line"><span class="keyword">const</span> curring = <span class="function"><span class="params">fn</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> argsArr = []</span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">return</span> [...args].length === <span class="number">0</span></span><br><span class="line">            ? fn.apply(<span class="literal">null</span>, argsArr)</span><br><span class="line">            : [].push.apply(argsArr, [...args])</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// éœ€è¦è®¡ç®—çš„å‡½æ•°</span></span><br><span class="line"><span class="keyword">let</span> calculate = <span class="function">(<span class="params">(</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> money = <span class="number">0</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...argsArr</span>) =&gt;</span> &#123;</span><br><span class="line">        argsArr.forEach(<span class="function"><span class="params">item</span> =&gt;</span> &#123;</span><br><span class="line">            money += item</span><br><span class="line">        &#125;)</span><br><span class="line">        <span class="keyword">return</span> money</span><br><span class="line">    &#125;</span><br><span class="line">&#125;)()</span><br><span class="line"></span><br><span class="line"><span class="comment">// æŸ¯é‡ŒåŒ–</span></span><br><span class="line">calculate = curring(calculate)</span><br><span class="line"></span><br><span class="line"><span class="comment">// ç¼“å­˜å‚æ•°, å…¶å®å¹¶æ²¡æœ‰è®¡ç®—</span></span><br><span class="line">calculate(<span class="number">20</span>)</span><br><span class="line">calculate(<span class="number">40</span>)</span><br><span class="line">calculate(<span class="number">20</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// çœŸæ­£è®¡ç®—çš„æ—¶å€™</span></span><br><span class="line">calculate()</span><br></pre></td></tr></table></figure><h4 id="å‡½æ•°èŠ‚æµ"><a href="#å‡½æ•°èŠ‚æµ" class="headerlink" title="å‡½æ•°èŠ‚æµ"></a>å‡½æ•°èŠ‚æµ</h4><p>åœ¨æŸäº›åœºæ™¯ä¸‹å‡½æ•°æœ‰å¯èƒ½ä¼šè¢«éå¸¸é¢‘ç¹åœ°è°ƒç”¨, ä»è€Œé€ æˆå¾ˆå¤§çš„æ€§èƒ½é—®é¢˜. ä¾‹å¦‚: window.resizeäº‹ä»¶ã€mousemove äº‹ä»¶, å®ƒä»¬è§¦å‘çš„é¢‘ç‡å¤ªé«˜äº†, è€Œç”¨æˆ·å¹¶ä¸éœ€è¦å¦‚æ­¤é«˜é¢‘ç‡çš„ä½¿ç”¨. å› æ­¤å‡½æ•°èŠ‚æµå°±æ˜¯ä¸ºäº†é™åˆ¶å‡½æ•°å‡ºå‘çš„é¢‘ç‡.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// èŠ‚æµ</span></span><br><span class="line"><span class="keyword">const</span> throttle = <span class="function">(<span class="params">fn, interval = <span class="number">800</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> isFirst = <span class="literal">true</span>, timer</span><br><span class="line">    <span class="comment">// ...args =&gt; event</span></span><br><span class="line">    <span class="keyword">return</span> <span class="function">(<span class="params">...args</span>) =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">let</span> that = <span class="keyword">this</span></span><br><span class="line">        <span class="keyword">if</span> (isFirst) &#123;</span><br><span class="line">            fn.apply(that, [...args])</span><br><span class="line">            <span class="keyword">return</span> isFirst = <span class="literal">false</span></span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (timer) <span class="keyword">return</span> <span class="literal">false</span></span><br><span class="line">        timer = setTimeout(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            clearTimeout(timer)</span><br><span class="line">            timer = <span class="literal">null</span></span><br><span class="line">            fn.apply(that, [...args])</span><br><span class="line">        &#125;, interval)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä¼ å…¥éœ€è¦èŠ‚æµçš„å‡½æ•°å’Œé—´éš”æ—¶é—´</span></span><br><span class="line"><span class="built_in">window</span>.onresize = throttle(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="number">1</span>)</span><br><span class="line">&#125;, <span class="number">800</span>)</span><br></pre></td></tr></table></figure><h4 id="åˆ†æ—¶å‡½æ•°"><a href="#åˆ†æ—¶å‡½æ•°" class="headerlink" title="åˆ†æ—¶å‡½æ•°"></a>åˆ†æ—¶å‡½æ•°</h4><p>ä¸Šé¢æˆ‘ä»¬æä¾›äº†ä¸€ç§é™åˆ¶å‡½æ•°è°ƒç”¨é¢‘ç‡çš„è§£å†³æ–¹æ¡ˆ, ç°åœ¨æ˜¯å¦ä¸€ä¸ªé—®é¢˜: æŸäº›å‡½æ•°æ˜¯ç”±ç”¨æˆ·ä¸»åŠ¨å”¤èµ·çš„, ä½†æ˜¯å› ä¸ºä¸€äº›åŸå› å¯¼è‡´å‡½æ•°ä¸¥é‡å½±å“é¡µé¢çš„æ€§èƒ½. åˆ†æ—¶å‡½æ•°å¯ä»¥ä¸ºæˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜, æˆ‘ç†è§£çš„åˆ†æ—¶å‡½æ•°: å°†è¯·æ±‚åˆ†æ‰¹å¤„ç†, åœ¨ä¸€å®šçš„æ—¶é—´å†…æ‰§è¡Œä¸€éƒ¨åˆ†è¯·æ±‚, ç›´åˆ°è¯·æ±‚å…¨éƒ¨å®Œæˆ.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// åˆ†æ—¶å‡½æ•°</span></span><br><span class="line"><span class="keyword">const</span> timeChunk = <span class="function">(<span class="params">data, fn, count = <span class="number">1</span></span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> timer, obj</span><br><span class="line">    <span class="keyword">const</span> start = <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="built_in">Math</span>.min(count, data.length); i++) &#123;</span><br><span class="line">            obj = data.shift()</span><br><span class="line">            fn.apply(<span class="literal">null</span>, obj)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> <span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">        <span class="keyword">if</span> (data.length === <span class="number">0</span>) &#123;</span><br><span class="line">            clearTimeout(timer)</span><br><span class="line">            <span class="keyword">return</span></span><br><span class="line">        &#125;</span><br><span class="line">        timer = setInterval(<span class="function"><span class="params">()</span> =&gt;</span> &#123;</span><br><span class="line">            start()</span><br><span class="line">        &#125;, <span class="number">200</span>)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¨¡æ‹Ÿæ•°æ®</span></span><br><span class="line"><span class="keyword">let</span> ary = []</span><br><span class="line"><span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; <span class="number">1000</span>; i++) &#123;</span><br><span class="line">    ary.push(i)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åˆ†æ—¶åŒ–</span></span><br><span class="line"><span class="keyword">let</span> renderfriendList = timeChunk(ary, <span class="function"><span class="keyword">function</span> (<span class="params">n</span>) </span>&#123;</span><br><span class="line">    <span class="keyword">let</span> div = <span class="built_in">document</span>.createElement(<span class="string">'div'</span>)</span><br><span class="line">    div.innerHTML = n</span><br><span class="line">    <span class="built_in">document</span>.body.appendChild(div)</span><br><span class="line">&#125;, <span class="number">10</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ¸²æŸ“</span></span><br><span class="line">renderfriendList()</span><br></pre></td></tr></table></figure><h4 id="æƒ°æ€§åŠ è½½"><a href="#æƒ°æ€§åŠ è½½" class="headerlink" title="æƒ°æ€§åŠ è½½"></a>æƒ°æ€§åŠ è½½</h4><p>ä¸¾ä¸ªä¾‹å­, åœ¨ web ä¸­ä¸ºäº†æ»¡è¶³å„æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚, æˆ‘ä»¬ä¼šåšä¸€äº›å—…æ¢å·¥ä½œ. å¼‚äºå¸¸è§„æ–¹æ¡ˆ, æƒ°æ€§åŠ è½½åœ¨çœŸæ­£éœ€è¦æ—¶æ‰ä½¿ç”¨ä¸”è¿›å…¥æ¡ä»¶åˆ†æ”¯ååœ¨å†…éƒ¨é‡å†™è¯¥å‡½æ•°, è¿™æ ·é‡å†™åçš„å‡½æ•°å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å‡½æ•°.</p><figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> addEvent = <span class="function">(<span class="params">el, type, handler</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (<span class="built_in">window</span>.addEventListener) &#123;</span><br><span class="line">        <span class="comment">// é‡å†™å‡½æ•°</span></span><br><span class="line">        addEvent = <span class="function">(<span class="params">el, type, handler</span>) =&gt;</span> &#123;</span><br><span class="line">            el.addEventListener(type, handler, <span class="literal">false</span>)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125; <span class="keyword">else</span> <span class="keyword">if</span> (<span class="built_in">window</span>.attachEvent) &#123;</span><br><span class="line">        addEvent = <span class="function">(<span class="params">el, type, handler</span>) =&gt;</span> &#123;</span><br><span class="line">            el.attachEvent(<span class="string">'on'</span> + type, handler)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    addEvent(el, type, handler)</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ä½¿ç”¨</span></span><br><span class="line">addEvent(btn, <span class="string">'click'</span>, <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="string">'click!'</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><p>Created on 2017-10-26 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;è¿™ä¸€ç¯‡ç¬”è®°æ˜¯ä¸ºæ­£å¼å¼€å§‹å­¦ä¹  javadcript è®¾è®¡æ¨¡å¼åšé“ºå«ï¼Œç”±äºè®¸å¤šè®¾è®¡æ¨¡å¼éƒ½ç”¨åˆ°äº†é—­åŒ…å’Œé«˜é˜¶å‡½æ•°æ¥å®ç°, æ‰€ä»¥äº†è§£è¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹ä¹Ÿæ˜¯å¿…è¦çš„.&lt;/p&gt;
&lt;blockquote&gt;
&lt;h3 id=&quot;é—­åŒ…&quot;&gt;&lt;a href=&quot;#é—­åŒ…&quot; class=&quot;headerlink&quot; t
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
      <category term="JavaScriptè®¾è®¡æ¨¡å¼" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>base64 è½¬ blob</title>
    <link href="https://yoursite.com/2017/10/22/base64-%E8%BD%AC-blob/"/>
    <id>https://yoursite.com/2017/10/22/base64-è½¬-blob/</id>
    <published>2017-10-22T13:44:12.000Z</published>
    <updated>2022-08-23T09:37:40.690Z</updated>
    
    <content type="html"><![CDATA[<figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = base64.split(<span class="string">','</span>), mime = arr[<span class="number">0</span>].match(<span class="regexp">/:(.*?);/</span>)[<span class="number">1</span>],</span><br><span class="line">    bstr = atob(arr[<span class="number">1</span>]), n = bstr.length, u8arr = <span class="keyword">new</span> <span class="built_in">Uint8Array</span>(n);</span><br><span class="line">    <span class="keyword">while</span> (n--) &#123;</span><br><span class="line">        <span class="comment">// charCodeAt() æ–¹æ³•å¯è¿”å›æŒ‡å®šä½ç½®çš„å­—ç¬¦çš„ Unicode ç¼–ç </span></span><br><span class="line">        u8arr[n] = bstr.charCodeAt(n);</span><br><span class="line">    &#125;</span><br><span class="line"><span class="comment">// 'application/octet-binary' (é»˜è®¤å€¼)</span></span><br><span class="line"><span class="keyword">let</span> blob = <span class="keyword">new</span> Blob([u8arr], &#123; <span class="attr">type</span>: mime &#125;)</span><br></pre></td></tr></table></figure><h4 id="Base64-çš„ç¼–ç ç å’Œè§£ç "><a href="#Base64-çš„ç¼–ç ç å’Œè§£ç " class="headerlink" title="Base64 çš„ç¼–ç ç å’Œè§£ç "></a>Base64 çš„ç¼–ç ç å’Œè§£ç </h4><p>ä½¿ç”¨atob å’Œ btoa æ–¹æ³•.</p><ul><li>atob() è§£ç </li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">atob(<span class="string">"amF2YXNjcmlwdA=="</span>)</span><br><span class="line"><span class="comment">// è§£ç ç»“æœ "javascript"</span></span><br></pre></td></tr></table></figure><ul><li>btoa() ç¼–ç </li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.btoa(javascript)</span><br><span class="line"><span class="comment">// è½¬ç ç»“æœ "amF2YXNjcmlwdA=="</span></span><br></pre></td></tr></table></figure><p>ä»¥ä¸Šä¸¤ç§æ–¹æ³•å¯¹äºä¸­æ–‡æ˜¯æœ‰å±€é™æ€§çš„, è§£å†³å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> str = <span class="string">"Chinaï¼Œä¸­å›½"</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// å…ˆç”¨ encodeURI() ç¼–ç </span></span><br><span class="line"><span class="built_in">window</span>.btoa(<span class="built_in">window</span>.encodeURIComponent(str))</span><br><span class="line"><span class="comment">// "Q2hpbmElRUYlQkMlOEMlRTQlQjglQUQlRTUlOUIlQkQ="</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// atob è§£ç  Base64 å†ç”¨ decodeURI() è§£ç </span></span><br><span class="line"><span class="built_in">window</span>.decodeURIComponent(<span class="built_in">window</span>.atob(<span class="string">'Q2hpbmElRUYlQkMlOEMlRTQlQjglQUQlRTUlOUIlQkQ='</span>))</span><br><span class="line"><span class="comment">// "Chinaï¼Œä¸­å›½"</span></span><br></pre></td></tr></table></figure><p>Created on 2017-9-4 by Cara*</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;figure class=&quot;highlight javascript&quot;&gt;&lt;table&gt;&lt;tr&gt;&lt;td class=&quot;gutter&quot;&gt;&lt;pre&gt;&lt;span class=&quot;line&quot;&gt;1&lt;/span&gt;&lt;br&gt;&lt;span class=&quot;line&quot;&gt;2&lt;/span&gt;&lt;br&gt;&lt;span 
      
    
    </summary>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>ç›’æ¨¡å‹</title>
    <link href="https://yoursite.com/2017/10/21/%E7%9B%92%E6%A8%A1%E5%9E%8B/"/>
    <id>https://yoursite.com/2017/10/21/ç›’æ¨¡å‹/</id>
    <published>2017-10-21T15:58:06.000Z</published>
    <updated>2022-08-23T09:37:40.692Z</updated>
    
    <content type="html"><![CDATA[<p><code>CSS</code> ç›’æ¨¡å‹ (Box Model), åŒ…å«çš„è¦ç´ åˆ†åˆ«ä¸º: content/padding/border/margin.</p><h3 id="æ ‡å‡†ç›’æ¨¡å‹-amp-æ€ªå¼‚ç›’æ¨¡å‹"><a href="#æ ‡å‡†ç›’æ¨¡å‹-amp-æ€ªå¼‚ç›’æ¨¡å‹" class="headerlink" title="æ ‡å‡†ç›’æ¨¡å‹ &amp; æ€ªå¼‚ç›’æ¨¡å‹"></a>æ ‡å‡†ç›’æ¨¡å‹ &amp; æ€ªå¼‚ç›’æ¨¡å‹</h3><p>ç›’æ¨¡å‹åˆ†ä¸ºW3Cçš„æ ‡å‡†ç›’æ¨¡å‹å’ŒIEçš„æ ‡å‡†ç›’æ¨¡å‹.</p><ul><li><p>æ ‡å‡†ç›’æ¨¡å‹<br><code>content + padding+ border + margin</code>  æ ‡å‡†ç›’æ¨¡å‹çš„ content æ˜¯ä¸åŒ…å«å…¶ä»–éƒ¨åˆ†çš„, å¦‚ä¸‹å›¾:<br><img src="http://orf90agxq.bkt.clouddn.com/GitHub/boxW3C_BOX.jpeg" alt="W3C-BOX"></p></li><li><p>IEæ ‡å‡†ç›’æ¨¡å‹<br><code>content(padding + border) + margin</code> è€ŒIEæ ‡å‡†ç›’æ¨¡å‹çš„ content å·²ç»åŒ…å«paddingå’Œborderçš„å€¼, å¦‚ä¸‹å›¾:<br><img src="http://orf90agxq.bkt.clouddn.com/GitHub/boxIE_BOX.jpeg" alt="IE-BOX"></p></li></ul><p>åœ¨æ–‡æ¡£é¡¶éƒ¨å£°æ˜ <code>DOCTYPE</code> å°±æ˜¯ä¸ºäº†è®©æµè§ˆå™¨ä½¿ç”¨ W3Cæ ‡å‡†ç›’æ¨¡å‹, ä½†æ˜¯åœ¨ IE5/ IE6 ä¸‹ä¾ç„¶æ˜¯ IE æ ‡å‡†ç›’æ¨¡å‹. å½“ç„¶é€šè¿‡<code>box-sizing</code>å±æ€§å¯ä»¥åœ¨ä¸¤è€…ä¹‹é—´è½¬æ¢.</p><h4 id="å¸¸è§é—®é¢˜"><a href="#å¸¸è§é—®é¢˜" class="headerlink" title="å¸¸è§é—®é¢˜"></a>å¸¸è§é—®é¢˜</h4><ol><li><p>ä¸¤ä¸ªå‚ç›´æ–¹å‘ç›¸é‚»çš„å—çº§å…ƒç´ ç›¸é‡æ—¶, å¤–è¾¹è·ä¼šåˆå¹¶ä¸”å–å€¼ä¸¤è€…è¾ƒå¤§å€¼çš„ <code>margin</code> ä½œä¸ºå¤–è¾¹è·.</p><figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">è§£å†³æ–¹æ¡ˆ:</span><br><span class="line"> *&#123;</span><br><span class="line">    <span class="attribute">margin</span>: <span class="number">0</span>; </span><br><span class="line">    <span class="attribute">padding</span>: <span class="number">0</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>margin å‡ºè½¨â€¦<br>å½“çˆ¶å…ƒç´ æ²¡æœ‰ <code>border</code> è¾¹æ¡†æ—¶, ç¬¬ä¸€ä¸ªå­å…ƒç´ æ·»åŠ  <code>margin-top</code> ä¼šè¶…å‡ºçˆ¶å…ƒç´ , ç›¸åŒæœ€åä¸€ä¸ªå­å…ƒç´ æ·»åŠ  <code>margin-bottom</code> ä¹ŸåŒæ ·ä¼šè¶…å‡ºçˆ¶å…ƒç´ , å¦‚ä¸‹å›¾: </p></li></ol><ul><li><p>ç¬¬ä¸€ä¸ªå­å…ƒç´ æ·»åŠ  margin-top<br><img src="http://orf90agxq.bkt.clouddn.com/box_modelmargin.png" alt="marginTop"></p></li><li><p>æœ€åä¸€ä¸ªå­å…ƒç´ æ·»åŠ  margin-bottom<br><img src="http://orf90agxq.bkt.clouddn.com/box_modelmarginBottom.png" alt="marginBottom"></p></li><li><p>å‰ä¸¤è€…åŒæ—¶å­˜åœ¨æ—¶, çˆ¶å…ƒç´ æ·»åŠ  border<br><img src="http://orf90agxq.bkt.clouddn.com/box_modelborder.png" alt="marginBottom"></p></li></ul><p>è§£å†³æ–¹æ¡ˆæœ‰å››ç§: </p><blockquote><ol><li>ç»™çˆ¶å…ƒç´ æ·»åŠ  border.</li></ol></blockquote><blockquote><ol start="2"><li>ç»™çˆ¶å…ƒç´ æ·»åŠ  padding.</li></ol></blockquote><blockquote><ol start="3"><li>ç»™çˆ¶å…ƒç´ æ·»åŠ  overflow: hidden.</li></ol></blockquote><blockquote><ol start="4"><li>ç»™çˆ¶å…ƒç´ æ·»åŠ ä¼ªç±». (æœ€ä½³)<figure class="highlight css"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="selector-class">.parent</span> &#123;</span><br><span class="line">    <span class="attribute">content</span>: <span class="string">''</span>;</span><br><span class="line">    <span class="attribute">display</span>: table;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li></ol></blockquote><p>Created on 2017-8-15 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;&lt;code&gt;CSS&lt;/code&gt; ç›’æ¨¡å‹ (Box Model), åŒ…å«çš„è¦ç´ åˆ†åˆ«ä¸º: content/padding/border/margin.&lt;/p&gt;
&lt;h3 id=&quot;æ ‡å‡†ç›’æ¨¡å‹-amp-æ€ªå¼‚ç›’æ¨¡å‹&quot;&gt;&lt;a href=&quot;#æ ‡å‡†ç›’æ¨¡å‹-amp-æ€ªå¼‚ç›’æ¨¡å‹&quot; class=
      
    
    </summary>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="CSS" scheme="https://yoursite.com/tags/CSS/"/>
    
  </entry>
  
  <entry>
    <title>ä½è¿ç®—ç¬¦</title>
    <link href="https://yoursite.com/2017/10/18/%E4%BD%8D%E8%BF%90%E7%AE%97%E7%AC%A6/"/>
    <id>https://yoursite.com/2017/10/18/ä½è¿ç®—ç¬¦/</id>
    <published>2017-10-18T15:06:59.000Z</published>
    <updated>2022-08-23T09:37:40.691Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨Cæˆ–è€…å…¶ä»–è¯­è¨€æ•°å€¼çš„è¿ç®—å…¶å®éƒ½æ˜¯å…ˆå°†æ•°å€¼è½¬æ¢ä¸ºäºŒè¿›åˆ¶åœ¨åšè¿ç®—çš„,<br>è€Œä½è¿ç®—ç¬¦å°±æ˜¯ç›´æ¥è¿›è¡ŒäºŒè¿›åˆ¶è¿ç®—, å› æ­¤é€Ÿåº¦ä¼šéå¸¸å¿«. ä½†æ˜¯å¯¹äºJavaScript<br>æ¥è¯´, æ‰§è¡Œç¯å¢ƒä¸€èˆ¬æ¥è§¦ä¸åˆ°ç¡¬ä»¶, æ‰€ä»¥æ€§èƒ½å®Œå…¨ä¸èƒ½å’Œå…¶ä»–è¯­è¨€ç›¸æ¯”. ä¸è¿‡ä½œä¸º<br>äº†è§£è¿˜æ˜¯éœ€è¦çš„, åªå¯¹è¾ƒä¸ºå¸¸è§çš„ä½è¿ç®—ç¬¦ä½œè®°å½•.</p><h3 id="ä½è¿ç®—-NOT"><a href="#ä½è¿ç®—-NOT" class="headerlink" title="ä½è¿ç®— NOT"></a>ä½è¿ç®— NOT</h3><p>ä½è¿ç®— NOT ç”± ( ~ ) ç¬¦å·è¡¨ç¤º, å…¶å®å°±æ˜¯å¯¹æ•°å€¼æ±‚è´Ÿä¹‹åå†å‡ä¸€, å¦‚:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="number">10</span>;</span><br><span class="line"><span class="keyword">let</span> num2 = ~num;</span><br><span class="line"></span><br><span class="line"><span class="comment">// ~num æ•ˆæœåŒä¸‹</span></span><br><span class="line">num2 = -num - <span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(num2); <span class="comment">// -11</span></span><br></pre></td></tr></table></figure><h3 id="å·¦ä½ç§»è¿ç®—"><a href="#å·¦ä½ç§»è¿ç®—" class="headerlink" title="å·¦ä½ç§»è¿ç®—"></a>å·¦ä½ç§»è¿ç®—</h3><p>å·¦ä½ç§»è¿ç®—ç”± ( &lt;&lt; ) ç¬¦å·è¡¨ç¤º. å°†æ•°å€¼çš„æ‰€æœ‰ä½å‘å·¦ç§»åŠ¨æŒ‡å®šæ•°é‡.ä¾‹å¦‚:<br>å·¦ç§»ä¸€ä½ä¹˜2, å·¦ç§»2ä½ä¹˜4, ä»¥æ­¤ç±»æ¨.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="number">2</span>;</span><br><span class="line"><span class="keyword">let</span> num2 = num &lt;&lt; <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•ˆæœåŒä¸‹</span></span><br><span class="line"> num2 = num * <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(num2); <span class="comment">// 8</span></span><br></pre></td></tr></table></figure><h3 id="æœ‰ç¬¦å·å³ç§»è¿ç®—"><a href="#æœ‰ç¬¦å·å³ç§»è¿ç®—" class="headerlink" title="æœ‰ç¬¦å·å³ç§»è¿ç®—"></a>æœ‰ç¬¦å·å³ç§»è¿ç®—</h3><p>æœ‰ç¬¦å·å³ç§»è¿ç®—ç¬¦ç”± ( &gt;&gt; ) ç¬¦å·è¡¨ç¤º, å°†æ•°å€¼çš„æ‰€æœ‰ä¸ºå‘å³ç§»åŠ¨æŒ‡å®šä½æ•°,<br>åŒæ—¶ä¿ç•™è¯¥æ•°çš„ç¬¦å· (æ­£å·æˆ–è€…è´Ÿå·) . æœ‰ç¬¦å·å³ç§»è¿ç®—ç¬¦è·Ÿå·¦ä½ç§»è¿ç®—ç¬¦æ­£å¥½<br>ç›¸å.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> num = <span class="number">12</span>;</span><br><span class="line"><span class="keyword">let</span> num2 = num &gt;&gt; <span class="number">2</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// æ•ˆæœåŒä¸‹</span></span><br><span class="line">num2 = num / <span class="number">4</span>;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(num2) <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><h3 id="æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦"><a href="#æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦" class="headerlink" title="æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦"></a>æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦</h3><p>æ— ç¬¦å·è¿ç®—ç¬¦ç”± ( &gt;&gt;&gt; ) ç¬¦å·è¡¨ç¤º, å¯¹äºæ­£æ•°æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦è·Ÿæ— ç¬¦å·å³ä½ç§»<br>è¿ç®—ç¬¦è§„åˆ™ç›¸åŒ; è´Ÿæ•°æ—¶ä¼šå‡ºç°æ— é™å¤§çš„æ•°å€¼, æ‰€ä»¥å†³å®šä½¿ç”¨æ— ç¬¦å·å³ä½ç§»è¿ç®—ç¬¦<br>æ—¶ä¸€å®šè¦å°å¿ƒ.</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨Cæˆ–è€…å…¶ä»–è¯­è¨€æ•°å€¼çš„è¿ç®—å…¶å®éƒ½æ˜¯å…ˆå°†æ•°å€¼è½¬æ¢ä¸ºäºŒè¿›åˆ¶åœ¨åšè¿ç®—çš„,&lt;br&gt;è€Œä½è¿ç®—ç¬¦å°±æ˜¯ç›´æ¥è¿›è¡ŒäºŒè¿›åˆ¶è¿ç®—, å› æ­¤é€Ÿåº¦ä¼šéå¸¸å¿«. ä½†æ˜¯å¯¹äºJavaScript&lt;br&gt;æ¥è¯´, æ‰§è¡Œç¯å¢ƒä¸€èˆ¬æ¥è§¦ä¸åˆ°ç¡¬ä»¶, æ‰€ä»¥æ€§èƒ½å®Œå…¨ä¸èƒ½å’Œå…¶ä»–è¯­è¨€ç›¸æ¯”. ä¸è¿‡ä½œä¸º&lt;br&gt;äº†è§£è¿˜æ˜¯éœ€è¦çš„, åªå¯¹
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>this/ call and apply</title>
    <link href="https://yoursite.com/2017/10/17/this-call-and-apply/"/>
    <id>https://yoursite.com/2017/10/17/this-call-and-apply/</id>
    <published>2017-10-17T15:01:38.000Z</published>
    <updated>2022-08-23T09:37:40.691Z</updated>
    
    <content type="html"><![CDATA[<p>åœ¨ JavaScript ä¸­, <code>this</code>å…³é”®å­—å¾ˆå®¹æ˜“ä½¿å¤§å®¶ç–‘æƒ‘, å†åŠ ä¸Š <code>Function.prototype.call</code>å’Œ<code>Function.prototype.apply</code>è¿™ä¸¤ä¸ªæ–¹æ³•çš„å¹¿æ³›è¿ç”¨, æ‰€ä»¥å¾ˆæœ‰å¿…è¦å¼„æ¸…<code>this</code>çš„ä½¿ç”¨.</p><blockquote><h3 id="this"><a href="#this" class="headerlink" title="this"></a>this</h3><p>é¦–å…ˆå…ˆè¯´ä¸€ä¸‹<code>this</code>çš„æ¦‚å¿µ: <code>this</code>æ€»æ˜¯æŒ‡å‘ä¸€ä¸ªå¯¹è±¡, è€Œè¿™ä¸ªå¯¹è±¡å…·ä½“æ˜¯è°, æ˜¯æ ¹æ®è¿è¡Œæ—¶çš„å‡½æ•°æ‰§è¡Œçš„ç¯å¢ƒåŠ¨æ€ç»‘å®šçš„, è€Œéå‡½æ•°è¢«å£°æ˜æ—¶çš„ç¯å¢ƒ. å½“ç„¶åˆ°ç°åœ¨ç®­å¤´å‡½æ•°çš„å‡ºç°, <code>this</code>å¯¹ä¸äº†è§£çš„åŒå­¦ä»¬æ¥è¯´, æ— ç–‘æ˜¯æ·»äº†ä¸€æŠŠä¹±â€¦ æ¥ä¸‹æ¥æˆ‘ä»¬ä¸€ä¸ªä¸€ä¸ªçš„æ¥è¯´å§.</p></blockquote><h4 id="1-thisçš„æŒ‡å‘"><a href="#1-thisçš„æŒ‡å‘" class="headerlink" title="1. thisçš„æŒ‡å‘"></a>1. <code>this</code>çš„æŒ‡å‘</h4><p>æˆ‘ä»¬é™¤å¼€ä¸å¸¸ç”¨çš„ with å’Œ eval çš„æƒ…å†µ, å…·ä½“åˆ°å®é™…åº”ç”¨ä¸­, <code>this</code>çš„æŒ‡å‘å¤§è‡´å¯ä»¥åˆ†ä¸ºä»¥ä¸‹å››ç§æƒ…å†µ.</p><ul><li>ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨</li><li>ä½œä¸ºæ™®é€šå‡½æ•°è¢«è°ƒç”¨</li><li>æ„é€ å™¨è°ƒç”¨</li><li><p>è¢« call å’Œ apply æ–¹æ³•è°ƒç”¨<br>ä¸‹é¢æ¥ç”¨ &lt; JavaScript è®¾è®¡æ¨¡å¼ &gt; ä¸­çš„ä¾‹å­è¯´æ˜è¿™å››ç§æƒ…å†µ.</p><ol><li><p>ä½œä¸ºå¯¹è±¡æ–¹æ³•è°ƒç”¨<br>å½“å‡½æ•°ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶, <code>this</code>æŒ‡å‘è¯¥å¯¹è±¡:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'window'</span>;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'cara'</span>,</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span> === obj)</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line">obj.getName() <span class="comment">// true 'cara'</span></span><br></pre></td></tr></table></figure></li><li><p>ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨<br>å½“å‡½æ•°ä¸ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨æ—¶, ä¹Ÿå°±æ˜¯æˆ‘ä»¬å¹³å¸¸è¯´çš„æ™®é€šå‡½æ•°çš„æ–¹å¼, æ­¤æ—¶çš„<code>this</code>æ€»æ˜¯æŒ‡å‘å…¨å±€å¯¹è±¡.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.name = <span class="string">'window'</span>;</span><br><span class="line"><span class="keyword">let</span> getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(getName()) <span class="comment">// 'window'</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// æˆ–è€…</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">window</span>.name = <span class="string">'window'</span>;</span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'obj'</span>,</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// è¿™é‡Œ obj çš„ getNameæ–¹æ³•èµ‹å€¼ç»™äº†ä¸€ä¸ªå˜é‡</span></span><br><span class="line"><span class="comment">// è°ƒç”¨çš„æ—¶å€™å°±åªä¼šä½œä¸ºä¸€ä¸ªæ™®é€šå‡½æ•°è°ƒç”¨</span></span><br><span class="line"><span class="keyword">let</span> getName = obj.gatName;</span><br><span class="line"><span class="built_in">console</span>.log(getName()) <span class="comment">// 'window'</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸­ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨çš„æ–¹å¼å¸¸å¸¸ä¼šå¸¦æ¥ä¸€äº›å›°æ‰°, æ¯”å¦‚åœ¨æŸä¸ª div èŠ‚ç‚¹çš„äº‹ä»¶å‡½æ•°ä¸­, å®šä¹‰äº†ä¸€ä¸ªå±€éƒ¨çš„ callback æ–¹æ³•. è€Œè¿™ä¸ª callback æ–¹æ³•æˆ‘ä»¬å¾€å¾€æ˜¯æƒ³è®©å®ƒçš„ <code>this</code>æŒ‡å‘ div èŠ‚ç‚¹, ä½†å®ƒå†…éƒ¨å´æŒ‡å‘<code>window</code>. å¦‚:</p><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">div</span> <span class="attr">id</span>=<span class="string">'div1'</span>&gt;</span>æˆ‘æ˜¯ä¸€ä¸ª div<span class="tag">&lt;/<span class="name">div</span>&gt;</span></span><br></pre></td></tr></table></figure><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.id = <span class="string">'window'</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'div1'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.id); <span class="comment">// 'div1'</span></span><br><span class="line">    <span class="keyword">let</span> callback = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.id); <span class="comment">// 'window'</span></span><br><span class="line">    &#125;</span><br><span class="line">    callback() <span class="comment">// ä½œä¸ºæ™®é€šå‡½æ•°è¢«è°ƒç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>è¦è§£å†³ä»¥ä¸Šé—®é¢˜å…¶å®ä¹Ÿå¾ˆç®€å•, å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">window</span>.id = <span class="string">'window'</span>;</span><br><span class="line"><span class="built_in">document</span>.getElementById(<span class="string">'div1'</span>).onclick = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="built_in">console</span>.log(<span class="keyword">this</span>.id);</span><br><span class="line">    <span class="keyword">let</span> that = <span class="keyword">this</span>; <span class="comment">// ç”¨ä¸€ä¸ªå˜é‡æ¥å‚¨å­˜èŠ‚ç‚¹çš„å¼•ç”¨</span></span><br><span class="line">    <span class="keyword">let</span> callback = <span class="function"><span class="keyword">function</span> (<span class="params"></span>)</span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(that.id); <span class="comment">// 'div1'</span></span><br><span class="line">    &#125;</span><br><span class="line">    callback() <span class="comment">// ä½œä¸ºæ™®é€šå‡½æ•°è¢«è°ƒç”¨</span></span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li><li><p>æ„é€ å™¨è°ƒç”¨<br>å…ˆè¯´è¯´æ„é€ å™¨å§, js ä¸­æ²¡æœ‰ç±»çš„æ¦‚å¿µ, ä½†æ˜¯å¯ä»¥ä»æ„é€ å™¨ä¸­åˆ›å»ºå¯¹è±¡, åŒæ—¶æä¾› <code>new</code> è¿ç®—ç¬¦, è®©æ„é€ å™¨çœ‹èµ·æ¥æ›´åƒä¸€ä¸ªç±». Js ä¸­å¤§éƒ¨åˆ†å‡½æ•°éƒ½å¯ä»¥å½“åšæ„é€ å™¨æ¥ä½¿ç”¨, æ‰€ä»¥å®ƒçš„å¤–è¡¨çœ‹èµ·æ¥è·Ÿæ™®é€šå‡½æ•°ä¸€æ ·, åŒºåˆ«åœ¨äºè¢«è°ƒç”¨çš„æ–¹å¼. å½“ç”¨ <code>new</code> è¿ç®—ç¬¦è°ƒç”¨æ—¶, è¯¥å‡½æ•°ä¼šè¿”å›ä¸€ä¸ªå¯¹è±¡. é€šå¸¸æƒ…å†µä¸‹, æ„é€ å™¨é‡Œçš„ <code>this</code> å°±æŒ‡å‘è¿”å›çš„è¿™ä¸ªå¯¹è±¡, å¦‚ä¸‹:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Myobj = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'cara'</span>;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> Myobj();</span><br><span class="line"><span class="built_in">console</span>.log(obj.name); <span class="comment">// 'cara'</span></span><br></pre></td></tr></table></figure><p>ä½†æ˜¯ä½¿ç”¨ <code>new</code>è°ƒç”¨æ„é€ å™¨æ—¶, è¦æ³¨æ„ä¸€ä¸ªé—®é¢˜. å¦‚æœæ„é€ å™¨æ˜¾å¼åœ°è¿”å›äº†ä¸€ä¸ªå¯¹è±¡, é‚£ä¹ˆæœ€ç»ˆå°±ä¼šè¿”å›è¿™ä¸ªå¯¹è±¡, è€Œä¸æ˜¯æˆ‘ä»¬çš„æœŸæœ›çš„ <code>this</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> Myobj = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">    <span class="keyword">this</span>.name = <span class="string">'cara'</span>;</span><br><span class="line">    <span class="keyword">return</span> &#123;</span><br><span class="line">        name: <span class="string">'somebody'</span></span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = <span class="keyword">new</span> Myobj();</span><br><span class="line"><span class="built_in">console</span>.log(obj.name); <span class="comment">// 'somebody'</span></span><br></pre></td></tr></table></figure><p>å¦‚æœæ„é€ å™¨ä¸æ˜¾å¼åœ°è¿”å›ä»»ä½•æ•°æ®æˆ–æ˜¯è¿”å›ä¸€ä¸ªéå¯¹è±¡ç±»å‹çš„æ•°æ®, å°±ä¸ä¼šå‡ºç°ä¸Šè¿°æƒ…å†µ</p></li><li><p>call æˆ– apply æ–¹æ³•è°ƒç”¨<br>è·Ÿæ™®é€šçš„å‡½æ•°è°ƒç”¨ç›¸æ¯”, ç”¨ call æˆ–è€… apply æ–¹æ³•è°ƒç”¨å¯ä»¥åŠ¨æ€åœ°æ”¹å˜ä¼ å…¥å‡½æ•°çš„ <code>this</code>:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> obj1 = &#123;</span><br><span class="line">    name: <span class="string">'cara'</span>,</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj2 = &#123;</span><br><span class="line">    name: <span class="string">'ben'</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj1.name); <span class="comment">// 'cara'</span></span><br><span class="line"><span class="built_in">console</span>.log(obj1.name.call(obj2)); <span class="comment">// 'ben'</span></span><br></pre></td></tr></table></figure><p>call å’Œ apply æ–¹æ³•èƒ½å¤Ÿå¾ˆå¥½çš„ä½“ç° js çš„å‡½æ•°å¼è¯­è¨€ç‰¹æ€§. åœ¨ js ä¸­å‡ ä¹æ¯ä¸€æ¬¡ç¼–å†™å‡½æ•°å¼è¯­è¨€é£æ ¼çš„ä»£ç éƒ½ç¦»ä¸å¼€ call å’Œ apply.</p></li></ol></li></ul><h4 id="2-ä¸¢å¤±çš„-this"><a href="#2-ä¸¢å¤±çš„-this" class="headerlink" title="2. ä¸¢å¤±çš„ this"></a>2. ä¸¢å¤±çš„ this</h4><p>è¿™æ˜¯ä¸€ä¸ªç»å¸¸é‡åˆ°çš„é—®é¢˜, åœ¨åˆšåˆšå¼€å§‹å­¦ä¹  js æ—¶,<code>this</code>çš„æŒ‡å‘å¸¸å¸¸ä»¤æˆ‘ç–‘æƒ‘, å°¤å…¶æ˜¯çœ‹åˆ°ç½‘ä¸Šå…³äº<code>this</code>æŒ‡å‘çš„é¢˜ç›®, ç®€ç›´äº‘é‡Œé›¾é‡Œ. ä¸‹é¢å°±æ¥çœ‹ä¸€äº›ä¾‹å­å§!</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'apple'</span>,</span><br><span class="line">    getName: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="keyword">this</span>.name;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(obj.getName()); <span class="comment">// 'apple'</span></span><br><span class="line"><span class="keyword">let</span> getMyName = obj.getName;</span><br><span class="line"><span class="built_in">console</span>.log(getMyName()); <span class="comment">// undefined</span></span><br></pre></td></tr></table></figure><p>ä¸Šé¢è¿™ä¸ªä¾‹å­å¥½ç†è§£, å°±æ˜¯é€šè¿‡ä¸€ä¸ªå˜é‡æ¥å¼•ç”¨<code>obj.getName</code>æ–¹æ³•, å¹¶ä¸”è°ƒç”¨ getMyName æ—¶, å°±æ˜¯ç”¨çš„æ™®é€šå‡½æ•°è°ƒç”¨æ–¹å¼, <code>this</code>æ˜¯æŒ‡å‘å…¨å±€ window çš„.</p><pre><code>æ¥ä¸‹æ¥å†æ¥çœ‹ä¸€ä¸ªç¨å¾®å¤æ‚ä¸€ç‚¹çš„ä¾‹å­å§:</code></pre><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'window'</span>;</span><br><span class="line"><span class="keyword">const</span> person = &#123;</span><br><span class="line">    name: <span class="string">'person'</span>,</span><br><span class="line">    showName1: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;,</span><br><span class="line">    showName2: <span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">this</span>.name),</span><br><span class="line">    showName3: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">            <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;,</span><br><span class="line">    showName4: <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">        <span class="keyword">return</span> <span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">    &#125;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">const</span> person2 = &#123;<span class="attr">name</span>: <span class="string">'person2'</span>&#125;;</span><br><span class="line"></span><br><span class="line">person.showName1();</span><br><span class="line">person.showName1().call(person2);</span><br><span class="line"></span><br><span class="line">person.showName2();</span><br><span class="line">person.showName2().call(person2);</span><br><span class="line"></span><br><span class="line">person.showName3()();</span><br><span class="line">person.showName3().call(person2);</span><br><span class="line">person.showName3.call(person2)();</span><br><span class="line"></span><br><span class="line">person.showName4()();</span><br><span class="line">person.showName4().call(person2);</span><br><span class="line">person.showName4.call(person2)();</span><br></pre></td></tr></table></figure><p>è¿™ä¸ªä¾‹å­å¯èƒ½å¤§å®¶å·²ç»å¾ˆçœ¼ç†Ÿäº†, ä¸è¿‡å½“æ—¶æˆ‘ç¬¬ä¸€æ¬¡åšçš„æ—¶å€™å‡ ä¹é”™äº†ä¸€å¤§åŠğŸ˜’â€¦. ç°åœ¨å†æ‹¿å‡ºæ¥çœ‹çœ‹å…¶å®è¿˜æ˜¯å¾ˆç»å…¸çš„: åœ¨ person å’Œ person2 ä¹‹é—´ç–¯ç‹‚ç© showName æ–¹æ³•. åœ¨ç»™å‡ºç­”æ¡ˆä¹‹å‰æˆ‘ä»¬å…ˆçœ‹çœ‹ç®­å¤´å‡½æ•°çš„ä¸€äº›ç‰¹ç‚¹:</p><ul><li>ç®­å¤´å‡½æ•°ä¸å¯ç”¨ä½œæ„é€ å‡½æ•°.</li><li>ä¸å¯ä»¥ä½¿ç”¨ <code>arguments</code>å¯¹è±¡, å¦‚æœè¦ç”¨å¯ä»¥ä½¿ç”¨ rest å‚æ•°ä»£æ›¿.</li><li>ä¸èƒ½ä½¿ç”¨<code>yield</code>å‘½ä»¤, æ‰€ä»¥ç®­å¤´å‡½æ•°ä¹Ÿä¸èƒ½ä½œä¸º Generator å‡½æ•°.</li><li><p>ç®­å¤´å‡½æ•°çš„<code>this</code>æ˜¯å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡, è€Œä¸æ˜¯æ‰§è¡Œæ—¶æ‰€åœ¨çš„å¯¹è±¡.</p><p>  åœ¨æœ€åä¸€ç‚¹çš„<code>this</code>æŒ‡å‘ä¸Š, æˆ‘ä¸ªäººè§‰å¾—æœ‰ç‚¹è¯¯å¯¼(ä¹Ÿå¯èƒ½æ˜¯æˆ‘æ²¡ç†è§£åˆ°ä½)â€¦ å› ä¸ºå¦‚æœåœ¨å¯¹è±¡å­—é¢é‡ä¸­çš„æ–¹æ³•æ˜¯é€šè¿‡ç®­å¤´å‡½æ•°å®šä¹‰çš„è¯, <code>this</code>çš„æŒ‡å‘å°±ä¼šå’Œä½ æœŸæœ›çš„ä¸ä¸€æ ·äº†. </p></li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> name = <span class="string">'window'</span></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">    name: <span class="string">'obj'</span>,</span><br><span class="line">    getName: <span class="function"><span class="params">_</span> =&gt;</span> <span class="built_in">console</span>.log(<span class="keyword">this</span>.name)</span><br><span class="line">&#125;</span><br><span class="line">obj.getName(); <span class="comment">// 'window'</span></span><br></pre></td></tr></table></figure><p>æ‰€ä»¥æˆ‘è§‰å¾—å…³äºç†è§£ç®­å¤´å‡½æ•°<code>this</code>åœ¨å®šä¹‰æ—¶æ‰€åœ¨çš„å¯¹è±¡æ˜¯è¿™æ ·: <code>this</code>ç»§æ‰¿è‡ªçˆ¶çº§çš„æ‰§è¡Œä¸Šä¸‹æ–‡(ç®€å•å¯¹è±¡å³éå‡½æ•°, æ˜¯æ²¡æœ‰æ‰§è¡Œä¸Šä¸‹æ–‡çš„), æ‰€ä»¥ä¸Šé¢ä¾‹å­å°±æ˜¯ getName æ–¹æ³•çš„çˆ¶çº§æ˜¯ obj, è€Œ obj çš„æ‰§è¡Œä¸Šä¸‹æ–‡æ˜¯<code>window</code>, å› æ­¤è¾“å‡ºå…¨å±€å¯¹è±¡çš„ name. ç†è§£äº†å…³äºç®­å¤´å‡½æ•°<code>this</code>çš„æŒ‡å‘, ç°åœ¨å†æ¥çœ‹çœ‹ç­”æ¡ˆå§:</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line">person.showName1(); <span class="comment">// 'person'</span></span><br><span class="line">person.showName1().call(person2); <span class="comment">//  'person2'</span></span><br><span class="line"></span><br><span class="line">person.showName2(); <span class="comment">// 'window'</span></span><br><span class="line">person.showName2().call(person2); <span class="comment">// 'window'</span></span><br><span class="line"></span><br><span class="line">person.showName3()(); <span class="comment">// 'window'</span></span><br><span class="line">person.showName3().call(person2); <span class="comment">// 'person2'</span></span><br><span class="line">person.showName3.call(person2)(); <span class="comment">// 'window'</span></span><br><span class="line"></span><br><span class="line">person.showName4()(); <span class="comment">// 'person'</span></span><br><span class="line">person.showName4().call(person2); <span class="comment">// 'person'</span></span><br><span class="line">person.showName4.call(person2)(); <span class="comment">// 'perons2'</span></span><br></pre></td></tr></table></figure><p>ç„¶åæ¥åˆ†æä¸€ä¸‹ç­”æ¡ˆå§:</p><ul><li><p>è°ƒç”¨ showName1()<br>è¿™ä¸¤ä¸ªæ–¹å¼å¥½ç†è§£, ç¬¬ä¸€ç§æ˜¯é€šè¿‡ person å¯¹è±¡æ¥è°ƒç”¨çš„ showName1 æ–¹æ³•, ä¹Ÿå°±æ˜¯ä¸Šé¢æˆ‘ä»¬è¯´è¿‡çš„<strong>ä½œä¸ºå¯¹è±¡çš„æ–¹æ³•è¢«è°ƒç”¨</strong>, æ‰€ä»¥<code>this</code>è‡ªç„¶æŒ‡å‘çš„æ˜¯person å¯¹è±¡; ç¬¬äºŒç§æ˜¯<strong>è¢« call å’Œ apply æ–¹æ³•è°ƒç”¨</strong>, æ‰€ä»¥<code>this</code>æŒ‡å‘çš„æ˜¯è¢« call æ–¹æ³•çŸ«æ­£çš„ person2.</p></li><li><p>è°ƒç”¨ showName2()<br>showName2 æ–¹æ³•æ˜¯ä¸€ä¸ªç®­å¤´å‡½æ•°, æ ¹æ®æˆ‘ä»¬ä¹‹å‰è¯´è¿‡çš„ç®­å¤´å‡½æ•°æŒ‡å‘é—®é¢˜æ¥çœ‹. ç¬¬ä¸€ç§é€šè¿‡ person å¯¹è±¡æ¥è°ƒç”¨, ç”±äº person æ˜¯ä¸€ä¸ªç®€å•å¯¹è±¡æ‰€ä»¥è¿™é‡Œå®ƒçš„æ‰§è¡Œä¸Šä¸‹æ–‡å°±æ˜¯<code>window</code>, é‚£ä¹ˆå°±æ˜¯ä½œä¸ºæ™®é€šå‡½æ•°è°ƒç”¨, <code>this</code>æŒ‡å‘ <code>window</code>; ç¬¬äºŒç§è·Ÿç¬¬ä¸€ç§æ˜¯ç›¸åŒçš„è°ƒç”¨æ–¹å¼, åªæ˜¯æŠŠ person å¯¹è±¡æ¢ä¸º person2.</p></li><li><p>è°ƒç”¨ showName3()<br>Person.showName3 æ˜¯ä¸€ä¸ªé«˜é˜¶å‡½æ•°, è¿”å›äº†ä¸€ä¸ªåŒ¿åå‡½æ•°. ç¬¬ä¸€ç§æ–¹å¼ç›¸å½“äºç›´æ¥è°ƒç”¨é‚£ä¸ªåŒ¿åå‡½æ•°æ‰§è¡Œç¯å¢ƒå°±æ˜¯<code>window</code>, æ‰€ä»¥<code>this</code>æŒ‡å‘<code>window</code>; ç¬¬äºŒç§æ–¹å¼é€šè¿‡ person2 æ¥è°ƒç”¨ person çš„é«˜é˜¶å‡½æ•°, è¾“å‡º person2; ç¬¬ä¸‰ç§å…ˆé€šè¿‡ person2 è°ƒç”¨ person çš„é«˜é˜¶å‡½æ•°, ç„¶ååœ¨å…¨å±€ä½œç”¨åŸŸä¸‹æ‰§è¡Œ, å› æ­¤<code>this</code>æŒ‡å‘<code>window</code>.</p></li><li><p>è°ƒç”¨ showName4()<br>æœ€åè¿™ä¸‰ç»„è°ƒç”¨ä¹Ÿæ˜¯é«˜é˜¶å‡½æ•°, ä¸è¿‡è¿”å›çš„åŒ¿åå‡½æ•°ç”¨çš„ç®­å¤´å‡½æ•°. å‰ä¸¤ç§æ–¹å¼ä¹Ÿå°±å°è¯äº†æˆ‘ä»¬ä¹‹å‰æ‰€è¯´çš„<strong>ç®­å¤´å‡½æ•°çš„ this ç»§æ‰¿è‡ªçˆ¶çº§æ‰§è¡Œä¸Šä¸‹æ–‡</strong>, æ‰€ä»¥å‰ä¸¤ç§éƒ½è¾“å‡º person, å°±ç®—ç¬¬äºŒç§æ–¹å¼åé¢ç”¨ call æ–¹æ³•æ¥çŸ«æ­£ä¹Ÿæ˜¯ä¸è¡Œçš„; ç¬¬ä¸‰ç§ä¹Ÿå°±æ˜¯é€šè¿‡ person2 æ¥è°ƒç”¨æ‰§è¡Œçš„ showName4 æ–¹æ³•, è‡ªç„¶ä¹Ÿå°±è¾“å‡º person2 å•¦.</p></li></ul><blockquote><h3 id="call-å’Œ-apply"><a href="#call-å’Œ-apply" class="headerlink" title="call å’Œ apply"></a>call å’Œ apply</h3><p>Function.prototype.call() å’Œ Function.prototype.apply() éƒ½æ˜¯éå¸¸å¸¸ç”¨çš„æ–¹æ³•, åœ¨å®é™…å¼€å‘ä¸­å’Œ JavaScript çš„è®¾è®¡æ¨¡å¼ä¸­è¿™ä¸¤ä¸ªæ–¹æ³•åº”ç”¨å¹¿æ³›. å…¶å®å®ƒä»¬çš„ä½œç”¨æ˜¯ä¸€æ ·çš„, åªæ˜¯æœ‰ä¼ å…¥å‚æ•°å½¢å¼ä¸åŒçš„åŒºåˆ«.</p></blockquote><ul><li><p>apply<br>apply æ–¹æ³•æ¥æ”¶ä¸¤ä¸ªå‚æ•°: ç¬¬ä¸€ä¸ªå‚æ•°æŒ‡å®šå‡½æ•°ä½“ä¸­ <code>this</code>çš„æŒ‡å‘; ç¬¬äºŒä¸ªå‚æ•°ä¸ºä¸€ä¸ªå¸¦ä¸‹æ ‡çš„åˆé›†(å¯ä»¥æ˜¯æ•°ç»„æˆ–è€…ç±»æ•°ç»„), è¿™ä¸ªå‚æ•°å°†ä¼šä¼ é€’ç»™è¢«è°ƒç”¨çš„å‡½æ•°.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c); <span class="comment">// 1 2 3</span></span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// ç¬¬ä¸€ä¸ªå‚æ•°ä¸º null çš„è¯, è¡¨ç¤ºä¸æ”¹å˜ this çš„æŒ‡å‘</span></span><br><span class="line">fn.apply(<span class="literal">null</span>, [<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>]);</span><br></pre></td></tr></table></figure></li><li><p>call<br>call æ–¹æ³•çš„ç¬¬ä¸€ä¸ªå‚æ•°å’Œ apply æ–¹æ³•ä¸€æ ·, æŒ‡å®š<code>this</code>çš„æŒ‡å‘; ç¬¬äºŒä¸ªå‚æ•°ä¸åŒ, call æ–¹æ³•çš„ç¬¬äºŒä¸ªå‚æ•°çš„æ•°é‡ä¸å›ºå®š, ä»ç¬¬äºŒå‚æ•°å¼€å§‹ä¸€æ¬¡æŒ‰é¡ºåºä¼ é€’ç»™è¢«è°ƒç”¨çš„å‡½æ•°.</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> fn = <span class="function"><span class="keyword">function</span> (<span class="params">a, b, c</span>) </span>&#123;</span><br><span class="line"><span class="built_in">console</span>.log(a, b, c); <span class="comment">// 1 2 3</span></span><br><span class="line">&#125;</span><br><span class="line">fn.call(<span class="literal">null</span>, <span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>)</span><br></pre></td></tr></table></figure></li></ul><p>åœ¨æˆ‘ä»¬ä¸å…³å¿ƒå…·ä½“æœ‰å¤šå°‘å‚æ•°è¢«ä¼ å…¥å‡½æ•°æ—¶, å°±å¯ä»¥ä½¿ç”¨ apply æ–¹æ³•ä¸€è‚¡è„‘æ¨è¿‡å»å°±è¡Œäº†; å½“æˆ‘ä»¬æ˜ç¡®çš„çŸ¥é“æœ‰å¤šå°‘å‚æ•°, æƒ³ä¸€ç›®äº†ç„¶çš„è¡¨è¾¾å½¢å‚å’Œå®å‚çš„å¯¹åº”å…³ç³»æ—¶, é‚£ä¹ˆå°±å¯ä»¥ç”¨ call æ–¹æ³•.</p><ul><li><p>å€Ÿç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•<br>call å’Œ apply ç»å¸¸è¢«ç”¨æ¥å€Ÿç”¨å…¶ä»–å¯¹è±¡çš„æ–¹æ³•, å¸¸ç”¨çš„å°±æœ‰å€Ÿç”¨<code>Array</code>çš„æ–¹æ³•æ¥æ“ä½œ<code>arguments</code>æˆ–è€…å€Ÿç”¨æ„é€ å‡½æ•°æ¥å®ç°ä¸€äº›ç±»ä¼¼ç»§æ‰¿çš„æ•ˆæœ.</p><ol><li><p>å€Ÿç”¨æ„é€ å‡½æ•°</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> A = <span class="function"><span class="keyword">function</span> (<span class="params">name</span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.name = name</span><br><span class="line">&#125;;</span><br><span class="line"><span class="comment">// å€Ÿç”¨æ„é€ å‡½æ•° A</span></span><br><span class="line"><span class="keyword">let</span> B = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line">A.apply(<span class="keyword">this</span>, <span class="built_in">arguments</span>)</span><br><span class="line">&#125;;</span><br><span class="line">B.prototype.getName = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.name</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> b = <span class="keyword">new</span> B(<span class="string">'cara'</span>);</span><br><span class="line"><span class="built_in">console</span>.log(b.getName); <span class="comment">// 'cara'</span></span><br></pre></td></tr></table></figure></li><li><p>å€Ÿç”¨ Array çš„æ–¹æ³•</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">(<span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="built_in">Array</span>.prototype.push.call(<span class="built_in">arguments</span>, <span class="number">3</span>);</span><br><span class="line"><span class="built_in">console</span>.log(<span class="built_in">arguments</span>); <span class="comment">// &#123;'0': 1, '1': 2, '2': 3&#125;</span></span><br><span class="line">&#125;)(<span class="number">1</span>, <span class="number">2</span>)</span><br></pre></td></tr></table></figure></li></ol></li></ul><p>å€Ÿç”¨çš„æ—¶å€™è¦ä¿è¯ä¸¤ä¸ªå¿…è¦æ¡ä»¶: 1. å¯¹è±¡æœ¬èº«è¦å¯ä»¥å­˜å–å±æ€§; 2. å¯¹è±¡çš„ length å±æ€§å¯è¯»å†™.</p><blockquote><h3 id="Function-prototype-bind"><a href="#Function-prototype-bind" class="headerlink" title="Function.prototype.bind"></a>Function.prototype.bind</h3><p>ç»‘å®šå‡½æ•° bind ä¹Ÿæ˜¯å¯ä»¥ç”¨ä½œçŸ«æ­£ <code>this</code>çš„æŒ‡å‘, bind å‡½æ•°ä¼šåˆ›å»ºä¸€ä¸ªæ–°çš„å‡½æ•°(ç»‘å®šå‡½æ•°), æ–°å‡½æ•°å’Œç›®æ ‡å‡½æ•°å°†æ‹¥æœ‰ç›¸åŒçš„å‡½æ•°ä½“. ç¬¬ä¸€ä¸ªå‚æ•°ç»‘å®š<code>this</code>çš„æŒ‡å‘, ä»ç¬¬äºŒå‚æ•°èµ·åé¢çš„å‚æ•°å°†ä½œä¸ºå®å‚ç»‘å®šåˆ°ç›®æ ‡å‡½æ•°çš„å½¢å‚.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> sum = <span class="function"><span class="keyword">function</span> (<span class="params">a, b</span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> a + b;</span><br><span class="line">&#125;;</span><br><span class="line"><span class="keyword">let</span> result = sum.bind(<span class="literal">null</span>, <span class="number">1</span>); <span class="comment">// 1 å°†ä½œä¸ºå®å‚ä¼ å…¥ sum</span></span><br><span class="line"><span class="built_in">console</span>.log(result(<span class="number">2</span>)); <span class="comment">// 3</span></span><br></pre></td></tr></table></figure><blockquote><p>å¦å¤–å½“ bind è¿”å›çš„å‡½æ•°ä½œä¸ºæ„é€ å‡½æ•°ä½¿ç”¨çš„è¯, ç»‘å®šçš„<code>this</code>å°†è¢«å¿½ç•¥, å®å‚ä¼ å…¥ç›®æ ‡å‡½æ•°.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">let</span> original = <span class="function"><span class="keyword">function</span> (<span class="params">x</span>) </span>&#123;</span><br><span class="line"><span class="keyword">this</span>.a = <span class="number">1</span>;</span><br><span class="line"><span class="keyword">this</span>.b = <span class="function"><span class="keyword">function</span> (<span class="params"></span>) </span>&#123;</span><br><span class="line"><span class="keyword">return</span> <span class="keyword">this</span>.a + x</span><br><span class="line">&#125;</span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> obj = &#123;</span><br><span class="line">a: <span class="number">2</span></span><br><span class="line">&#125;;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> newObj = <span class="keyword">new</span> (original.bind(obj, <span class="number">2</span>));</span><br><span class="line"><span class="built_in">console</span>.log(newObj.a); <span class="comment">// 1 =&gt; this çš„æŒ‡å‘è¢«å¿½ç•¥</span></span><br><span class="line"><span class="built_in">console</span>.log(newObj.b()); <span class="comment">// 3 =&gt; 2 è¢«ä¼ å…¥ original</span></span><br></pre></td></tr></table></figure><p>call å’Œ apply æ–¹æ³•éƒ½æ˜¯æ”¹å˜<code>this</code>æŒ‡å‘åç«‹å³æ‰§è¡Œè€Œ bind å¯ä»¥åœ¨ä½ æƒ³æ‰§è¡Œçš„<br>æ—¶å€™å†æ‰§è¡Œ.</p><p>å·®ä¸å¤šå°±åˆ°è¿™å„¿å§, è¦æ˜¯æœ‰è¡¥å……å†æ¥ç€å†™â€¦</p><p>Created on 2017-10-17 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;åœ¨ JavaScript ä¸­, &lt;code&gt;this&lt;/code&gt;å…³é”®å­—å¾ˆå®¹æ˜“ä½¿å¤§å®¶ç–‘æƒ‘, å†åŠ ä¸Š &lt;code&gt;Function.prototype.call&lt;/code&gt;å’Œ&lt;code&gt;Function.prototype.apply&lt;/code&gt;è¿™ä¸¤ä¸ªæ–¹æ³•çš„å¹¿æ³›è¿ç”¨, æ‰€
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
      <category term="JavaScriptè®¾è®¡æ¨¡å¼" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/JavaScript%E8%AE%BE%E8%AE%A1%E6%A8%A1%E5%BC%8F/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>JavaScript å…³äºè¿ç®—çš„å°æŠ€å·§</title>
    <link href="https://yoursite.com/2017/10/17/JavaScript-%E5%85%B3%E4%BA%8E%E8%BF%90%E7%AE%97%E7%9A%84%E5%B0%8F%E6%8A%80%E5%B7%A7/"/>
    <id>https://yoursite.com/2017/10/17/JavaScript-å…³äºè¿ç®—çš„å°æŠ€å·§/</id>
    <published>2017-10-17T14:10:33.000Z</published>
    <updated>2022-08-23T09:37:40.689Z</updated>
    
    <content type="html"><![CDATA[<blockquote><h4 id="1-ä½¿ç”¨-æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼"><a href="#1-ä½¿ç”¨-æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼" class="headerlink" title="1. ä½¿ç”¨ !! æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼"></a>1. ä½¿ç”¨ <code>!!</code> æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼</h4><p>ç”¨äºæ£€æŸ¥ä¸€ä¸ªå˜é‡æ˜¯å¦å­˜åœ¨æˆ–è€…æ˜¯æœ‰æ•ˆå€¼, å¯¹å˜é‡ä½¿ç”¨ <code>!!variable</code> æ¥éªŒè¯,<br>åªè¦å˜é‡çš„å€¼ä¸º: 0, null, undefined, NaNéƒ½å°†è¿”å› false, åä¹‹è¿”å› true. å¦‚: </p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"> <span class="class"><span class="keyword">class</span> <span class="title">Foo</span> </span>&#123;</span><br><span class="line">    <span class="keyword">constructor</span> ( count ) &#123;</span><br><span class="line">        <span class="keyword">this</span>.cash = count;</span><br><span class="line">        <span class="keyword">this</span>.myCash = !!count;</span><br><span class="line">    &#125;</span><br><span class="line">&#125;</span><br><span class="line"><span class="keyword">var</span> emptyFoo = <span class="keyword">new</span> Foo(<span class="number">0</span>);</span><br><span class="line"><span class="built_in">console</span>.log(foo.cash); <span class="comment">// 0</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.myCash); <span class="comment">// false</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">var</span> foo = <span class="keyword">new</span> Foo(<span class="number">100</span>);</span><br><span class="line"><span class="built_in">console</span>.log(foo.cash); <span class="comment">// 100</span></span><br><span class="line"><span class="built_in">console</span>.log(foo.myCash); <span class="comment">// true</span></span><br></pre></td></tr></table></figure><blockquote><h4 id="2-ä½¿ç”¨-å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—"><a href="#2-ä½¿ç”¨-å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—" class="headerlink" title="2. ä½¿ç”¨ + å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—"></a>2. ä½¿ç”¨ <code>+</code> å°†å­—ç¬¦ä¸²è½¬æ¢ä¸ºæ•°å­—</h4><p>åªé€‚åˆå°†å­—ç¬¦ä¸²æ•°æ®è½¬æ¢ä¸ºæ•°å­—, ç»™åå°ä¼ æ•°æ®çš„æ—¶å€™ç»å¸¸ç”¨åˆ°,<br>å¦‚æœä¸æ˜¯å­—ç¬¦ä¸²æ•°æ®ä¼šè¿”å› NaN.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> toNumber = <span class="function"><span class="params">strNumber</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> +strNumber;</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log( toNumber(<span class="string">"123"</span>) ); <span class="comment">// 123</span></span><br><span class="line"><span class="built_in">console</span>.log( toNumber(<span class="string">" abc"</span>)); <span class="comment">// NaN</span></span><br><span class="line"></span><br><span class="line"><span class="comment">// Dateä¹Ÿå¯ä»¥ä½¿ç”¨</span></span><br><span class="line"><span class="built_in">console</span>.log( +<span class="keyword">new</span> <span class="built_in">Date</span>() ); <span class="comment">// è¿”å›æ—¶é—´æˆ³</span></span><br></pre></td></tr></table></figure><blockquote><h4 id="3-å¹¶ç¬¦æ¡ä»¶"><a href="#3-å¹¶ç¬¦æ¡ä»¶" class="headerlink" title="3. å¹¶ç¬¦æ¡ä»¶"></a>3. å¹¶ç¬¦æ¡ä»¶</h4><p>ç»å¸¸ç”¨åˆ°è¿™æ ·çš„æ¡ä»¶åˆ¤æ–­.</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">if</span> (isConcat) &#123;</span><br><span class="line">    Login()</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure><p>å¯ä»¥ç®€å†™æˆè¿™æ · <code>isConact &amp;&amp; Login()</code></p><h3 id="4-è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ "><a href="#4-è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ " class="headerlink" title="4. è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ "></a>4. è·å–æ•°ç»„ä¸­çš„æœ€åä¸€ä¸ªå…ƒç´ </h3><p><code>Array.prototype.slice (begin, end)</code> ç»å¸¸ç”¨è¿™æ ·çš„æ–¹å¼æ¥æˆªå–æ•°ç»„çš„å…ƒç´ ,<br>å¦‚æœä¸è®¾ç½® end çš„å€¼, é‚£ä¹ˆé»˜è®¤ä¼šå°†æ•°ç»„çš„é•¿åº¦ä½œä¸º end å€¼.<br>å¦‚æœå°†è´Ÿæ•°ä½œä¸ºå‚æ•°çš„ begin å€¼, å°±å¯ä»¥è·å–æ•°ç»„çš„æœ€åä¸€ä¸ªå…ƒç´ .</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="built_in">console</span>.log( arr.slice(<span class="number">-1</span>) ); <span class="comment">// [5]</span></span><br><span class="line">conosle.log( arr.slice(<span class="number">-2</span>) ); <span class="comment">// [4,5]</span></span><br><span class="line">ä»¥æ­¤ç±»æ¨</span><br></pre></td></tr></table></figure><blockquote><h4 id="5-æˆªæ–­æ•°ç»„"><a href="#5-æˆªæ–­æ•°ç»„" class="headerlink" title="5. æˆªæ–­æ•°ç»„"></a>5. æˆªæ–­æ•°ç»„</h4><p>ç”¨æ¥é”å®šæ•°ç»„çš„é•¿åº¦, åˆ é™¤æ•°ç»„ä¸­çš„ä¸€äº›å…ƒç´ . æ¯”å¦‚æ•°ç»„ä¸€å…±æœ‰10ä¸ªå…ƒç´ ,<br>ä½†æˆ‘åªéœ€è¦å‰5ä¸ªå…ƒç´ , å°±å¯ä»¥é€šè¿‡ <code>array.length = 5</code> æ¥æˆªæ–­æ•°ç»„, å¦‚: </p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> arr = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>,<span class="number">5</span>];</span><br><span class="line"><span class="built_in">console</span>.log( arr.length); <span class="comment">// 5</span></span><br><span class="line">arr.length = <span class="number">3</span>;</span><br><span class="line"><span class="built_in">console</span>.log( arr.length ); <span class="comment">// 3</span></span><br><span class="line"><span class="built_in">console</span>.log( arr ); <span class="comment">// [1,2,3]</span></span><br></pre></td></tr></table></figure><blockquote><h4 id="6-å°†NodeListè½¬æ¢ä¸ºæ•°ç»„"><a href="#6-å°†NodeListè½¬æ¢ä¸ºæ•°ç»„" class="headerlink" title="6. å°†NodeListè½¬æ¢ä¸ºæ•°ç»„"></a>6. å°†NodeListè½¬æ¢ä¸ºæ•°ç»„</h4><p>å¦‚æœé€šè¿‡ <code>doucment.querySelectorAll(&#39;p&#39;)</code> è·å–å…ƒç´ , å®ƒè¿”å›çš„æ˜¯ä¸€ä¸ªDOMå…ƒç´ çš„<br>æ•°ç»„ ( NodeList ) å¯¹è±¡, ä½†æ˜¯è¿™ä¸ªæ•°ç»„ä¸å…·æœ‰æ•°ç»„çš„åŠŸèƒ½,<br>æ¯”å¦‚ <code>push() / sort()</code> ç­‰. è¿™å°±éœ€è¦å°†è¿™ä¸ª NodeList è½¬æ¢ä¸ºçœŸæ­£çš„æ•°ç»„.<br>å¯ä»¥ä½¿ç”¨ <code>[].slice.call( NodeList )</code> æ¥å®ç°. å¦‚:</p></blockquote><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> els = <span class="built_in">document</span>.querySelectorAll( <span class="string">'p'</span> );</span><br><span class="line">[].slice.call( els );</span><br><span class="line">OR:</span><br><span class="line"><span class="keyword">var</span> arrElement = <span class="built_in">Array</span>.from( els );</span><br><span class="line">ES6:</span><br><span class="line"><span class="keyword">var</span> arr = [...els]</span><br></pre></td></tr></table></figure><blockquote><h4 id="7-æ•°ç»„å…ƒç´ é‡æ’"><a href="#7-æ•°ç»„å…ƒç´ é‡æ’" class="headerlink" title="7. æ•°ç»„å…ƒç´ é‡æ’"></a>7. æ•°ç»„å…ƒç´ é‡æ’</h4><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> list = [<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>];</span><br><span class="line"><span class="built_in">console</span>.log(list.sort(<span class="function"><span class="params">()</span>=&gt;</span>&#123; <span class="built_in">Math</span>.random() - <span class="number">0.5</span>&#125;))</span><br></pre></td></tr></table></figure></blockquote><p>Created on 2017-6-14 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;blockquote&gt;
&lt;h4 id=&quot;1-ä½¿ç”¨-æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼&quot;&gt;&lt;a href=&quot;#1-ä½¿ç”¨-æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼&quot; class=&quot;headerlink&quot; title=&quot;1. ä½¿ç”¨ !! æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼&quot;&gt;&lt;/a&gt;1. ä½¿ç”¨ &lt;code&gt;!!&lt;/code&gt; æ“ä½œç¬¦è½¬æ¢å¸ƒå°”å€¼
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title> JavaScript æ¨¡å—åŒ–</title>
    <link href="https://yoursite.com/2017/10/17/JavaScript-%E6%A8%A1%E5%9D%97%E5%8C%96/"/>
    <id>https://yoursite.com/2017/10/17/JavaScript-æ¨¡å—åŒ–/</id>
    <published>2017-10-17T13:49:59.000Z</published>
    <updated>2022-08-23T09:37:40.689Z</updated>
    
    <content type="html"><![CDATA[<p>ä½¿ç”¨å‡½æ•°å’Œé—­åŒ…æ¥æ„é€ æ¨¡å—. æ¨¡å—æ˜¯ä¸€ä¸ªæä¾›æ¥å£å´éšè—çŠ¶æ€ä¸ç°å®çš„å‡½æ•°æˆ–å¯¹è±¡.<br>é€šè¿‡æ¨¡å—å¯ä»¥æ‘’å¼ƒå…¨å±€å˜é‡çš„ä½¿ç”¨, æ¨¡å—æ¨¡å¼çš„ä¸€èˆ¬å½¢å¼æ˜¯: ä¸€ä¸ªå®šä¹‰ç§æœ‰å˜é‡å’Œå‡½æ•°çš„å‡½æ•°;<br>åˆ©ç”¨é—­åŒ…åˆ›å»ºå¯ä»¥è®¿é—®ç§æœ‰å˜é‡å’Œå‡½æ•°çš„ç‰¹æƒå‡½æ•°.<br>â€”â€” &lt;&lt; JavaScriptè¯­è¨€ç²¾ç²¹ &gt;&gt;</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">const</span> serial_maker = <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line"><span class="comment">// ç§æœ‰å˜é‡</span></span><br><span class="line"><span class="keyword">let</span> prefix = <span class="string">''</span>;</span><br><span class="line"><span class="keyword">let</span> num = <span class="number">0</span>;</span><br><span class="line"></span><br><span class="line"><span class="keyword">return</span> &#123;</span><br><span class="line"><span class="comment">// ç‰¹æƒæ–¹æ³•</span></span><br><span class="line">set_prefix: <span class="function"><span class="params">str</span> =&gt;</span> &#123;</span><br><span class="line">prefix = <span class="built_in">String</span>(str);</span><br><span class="line">&#125;,</span><br><span class="line">set_num: <span class="function"><span class="params">n</span> =&gt;</span> &#123;</span><br><span class="line">num = +n;</span><br><span class="line">&#125;,</span><br><span class="line">get_sum: <span class="function"><span class="params">_</span> =&gt;</span> &#123;</span><br><span class="line"><span class="keyword">let</span> result = prefix + num;</span><br><span class="line">num++;</span><br><span class="line"><span class="keyword">return</span> result;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="keyword">let</span> seqer = serial_maker();</span><br><span class="line">seqer.set_prefix(<span class="string">'Hi'</span>);</span><br><span class="line">seqer.set_num(<span class="number">0101</span>);</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(seqer.get_sum()) <span class="comment">// 'Hi0101'</span></span><br></pre></td></tr></table></figure><h3 id="CommonJs-ä¸-AMD"><a href="#CommonJs-ä¸-AMD" class="headerlink" title="CommonJs ä¸ AMD"></a>CommonJs ä¸ AMD</h3><p>å› ä¸ºæœ‰äº†æ¨¡å—çš„æ¦‚å¿µ, æ‰€ä»¥æˆ‘ä»¬èƒ½å°†å¾ˆå¤šé‡å¤æ€§çš„ä»£ç å°è£…æˆä¸€ä¸ªæ¨¡å—, æƒ³ç”¨ä»€ä¹ˆ<br>åŠŸèƒ½å°±åŠ è½½ä»€ä¹ˆæ¨¡å—, ä¹Ÿèƒ½æ›´æ–¹ä¾¿æ˜¯ä½¿ç”¨åˆ«äººçš„ä»£ç . ä½†æ˜¯è¿™æ ·å°±ä¼šè¦æ±‚å¤§å®¶éƒ½ç”¨<br>åŒæ ·çš„æ–¹å¼å°è£…æ¨¡å—, æ‰€ä»¥å°±æœ‰äº† CommonJs å’Œ AMD æ¥è§„èŒƒå¤§å®¶çš„å†™æ³•.</p><ul><li>CommonJs<br>Node.jsçš„æ¨¡å—å°±æ˜¯å‚ç…§ CommonJs æ¥å®ç°çš„, åœ¨æœåŠ¡å™¨ç«¯æ˜¯ä¸€å®šä¼šç”¨åˆ°æ¨¡å—çš„. CommonJs<br>æ˜¯åŒæ­¥åŠ è½½, ä¹Ÿå°±æ˜¯è¯´å½“å¼•å…¥ä¸€ä¸ªæ¨¡å—å¿…é¡»ç­‰å¾…è¯¥æ¨¡å—åŠ è½½å®Œæˆä¹‹å, æ‰ä¼šæ‰§è¡Œæ¥ä¸‹æ¥çš„ä»£ç .<br>å¯¹äºæœåŠ¡å™¨æ¥è¯´æ‰€æœ‰çš„æ¨¡å—éƒ½æ”¾åœ¨æœ¬åœ°, æ‰€ä»¥ç­‰å¾…çš„æ—¶é—´å¾ˆçŸ­; ä½†å¯¹äºæµè§ˆå™¨æ¥è¯´, æ‰€æœ‰çš„æ¨¡å—<br>éƒ½æ”¾åœ¨æœåŠ¡å™¨, æ‰€ä»¥ç­‰å¾…çš„æ—¶é—´å®Œå…¨å–å†³äºç½‘é€Ÿ, å°±å¾ˆå®¹æ˜“å‡ºç°å‡æ­»çš„çŠ¶æ€.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> math = <span class="built_in">require</span>(<span class="string">'math'</span>);</span><br><span class="line"></span><br><span class="line">math.add(<span class="number">2</span>, <span class="number">3</span>);</span><br></pre></td></tr></table></figure><ul><li>AMD<br>AMDæ˜¯â€Asynchronous Module Definitionâ€çš„ç¼©å†™, æ„æ€å°±æ˜¯â€å¼‚æ­¥æ¨¡å—å®šä¹‰â€. å®ƒå°±æ˜¯é‡‡ç”¨å¼‚æ­¥<br>åŠ è½½, å› æ­¤æ¨¡å—çš„åŠ è½½å¹¶ä¸å½±å“åé¢çš„è¯­å¥æ‰§è¡Œ. å°†æ‰€æœ‰ä¾èµ–äºè¿™ä¸ªæ¨¡å—çš„è¯­å¥éƒ½æ”¾åœ¨ä¸€ä¸ªå®šä¹‰çš„å›è°ƒ<br>å‡½æ•°ä¸­æ‰§è¡Œ, è¿™æ ·ç­‰å¾…æ¨¡å—åŠ è½½å®Œæˆä¹‹åå°±ä¼šå»æ‰§è¡Œè¿™ä¸ªå›è°ƒå‡½æ•°.</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">require</span>([<span class="built_in">module</span>], callback);</span><br><span class="line"></span><br><span class="line"><span class="built_in">require</span>([<span class="string">'module'</span>], <span class="built_in">module</span> =&gt; &#123;</span><br><span class="line"><span class="built_in">module</span>.increment(<span class="number">1</span>, <span class="number">2</span>)</span><br><span class="line">&#125;)</span><br></pre></td></tr></table></figure><h3 id="export-export-default"><a href="#export-export-default" class="headerlink" title="export / export default"></a>export / export default</h3><p>åœ¨JavaScript ES6ä¸­ï¼Œexportä¸export defaultå‡å¯ç”¨äºå¯¼å‡ºå¸¸é‡/å‡½æ•°/æ–‡ä»¶/æ¨¡å—ç­‰,<br>ä»¥ä¾¿åœ¨å…¶å®ƒæ–‡ä»¶æˆ–æ¨¡å—ä¸­é€šè¿‡importå°†å…¶å¯¼å…¥ä½¿ç”¨.</p><ul><li>export<br>export å¯ä»¥å¯¼å‡ºå¤šä¸ª</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// types.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> foo = <span class="string">'foo'</span>;</span><br><span class="line"><span class="keyword">export</span> <span class="keyword">const</span> fn = <span class="function"><span class="params">n</span> =&gt;</span> n+<span class="number">1</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ index.html å¼•å…¥</span></span><br><span class="line"><span class="keyword">import</span> &#123;foo, fn&#125; <span class="keyword">from</span> <span class="string">'types.js'</span></span><br></pre></td></tr></table></figure><ul><li>export default<br>åªèƒ½å¯¼å‡ºä¸€ä¸ª</li></ul><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment">// types.js</span></span><br><span class="line"><span class="keyword">export</span> <span class="keyword">default</span> <span class="keyword">const</span> foo = <span class="string">'foo'</span>;</span><br><span class="line"></span><br><span class="line"><span class="comment">// åœ¨ index.html å¼•å…¥</span></span><br><span class="line"><span class="keyword">import</span> foo <span class="keyword">from</span> <span class="string">'types.js'</span></span><br><span class="line"><span class="comment">// ç­‰ä»·äº</span></span><br><span class="line"><span class="keyword">import</span> &#123;<span class="keyword">default</span> <span class="keyword">as</span> foo&#125; <span class="keyword">from</span> <span class="string">'types.js'</span></span><br></pre></td></tr></table></figure><p>Created on 2017-9-15 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;ä½¿ç”¨å‡½æ•°å’Œé—­åŒ…æ¥æ„é€ æ¨¡å—. æ¨¡å—æ˜¯ä¸€ä¸ªæä¾›æ¥å£å´éšè—çŠ¶æ€ä¸ç°å®çš„å‡½æ•°æˆ–å¯¹è±¡.&lt;br&gt;é€šè¿‡æ¨¡å—å¯ä»¥æ‘’å¼ƒå…¨å±€å˜é‡çš„ä½¿ç”¨, æ¨¡å—æ¨¡å¼çš„ä¸€èˆ¬å½¢å¼æ˜¯: ä¸€ä¸ªå®šä¹‰ç§æœ‰å˜é‡å’Œå‡½æ•°çš„å‡½æ•°;&lt;br&gt;åˆ©ç”¨é—­åŒ…åˆ›å»ºå¯ä»¥è®¿é—®ç§æœ‰å˜é‡å’Œå‡½æ•°çš„ç‰¹æƒå‡½æ•°.&lt;br&gt;â€”â€” &amp;lt;&amp;lt; JavaScri
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
      <category term="å¤ä¹ " scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/%E5%A4%8D%E4%B9%A0/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
  <entry>
    <title>Quick Sort</title>
    <link href="https://yoursite.com/2017/10/17/Quick-Sort/"/>
    <id>https://yoursite.com/2017/10/17/Quick-Sort/</id>
    <published>2017-10-17T13:42:33.000Z</published>
    <updated>2022-08-23T09:37:40.690Z</updated>
    
    <content type="html"><![CDATA[<p>å¿«é€Ÿæ’åºçš„å®ç°, å‚è€ƒèµ„æ–™<a href="http://www.ruanyifeng.com/blog/2011/04/quicksort_in_javascript.html" target="_blank" rel="noopener">é˜®ä¸€å³°</a></p><blockquote><h2 id="æ€è·¯"><a href="#æ€è·¯" class="headerlink" title="æ€è·¯"></a>æ€è·¯</h2><p>å¿«æ’æ³•çš„æ€æƒ³ï¼Œ åˆ†ä¸ºä»¥ä¸‹ä¸‰æ­¥</p><ol><li>åœ¨æ•°æ®é›†ä¸­ï¼Œ é€‰æ‹©ä»»æ„ä¸€ä¸ªæ•°æ®ä½œä¸ºå‚ç…§ç‰©ï¼ˆä¸€èˆ¬å–ä¸­é—´ä½ç½®çš„å…ƒç´ ï¼‰ã€‚</li><li>æ‰€æœ‰å°äºå‚ç…§ç‰©çš„å…ƒç´ éƒ½æ”¾åœ¨å·¦è¾¹ï¼Œå¤§äºå‚ç…§ç‰©çš„å…ƒç´ éƒ½æ”¾åœ¨å³è¾¹ã€‚</li><li>å¯¹å·¦å³ä¸¤è¾¹çš„å­é›†é€’å½’ï¼Œ è‡³åˆ°æ’åºå®Œæˆã€‚</li></ol></blockquote><h2 id="ä¾‹å­"><a href="#ä¾‹å­" class="headerlink" title="ä¾‹å­"></a>ä¾‹å­</h2><ul><li><p>éåŸåœ°å¿«é€Ÿæ’åº</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">var</span> array = [<span class="number">11</span>, <span class="number">65</span>, <span class="number">23</span>, <span class="number">108</span>, <span class="number">99</span>, <span class="number">11</span>, <span class="number">55</span>, <span class="number">11</span>, <span class="number">33</span>, <span class="number">100</span>, <span class="number">108</span>, <span class="number">100</span>];</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.time(<span class="string">'å¿«æ’'</span>);</span><br><span class="line"><span class="keyword">const</span> quickSort = <span class="function"><span class="params">array</span> =&gt;</span> &#123;</span><br><span class="line">    <span class="comment">// æ•°ç»„åªå‰©ä¸€ä¸ªå…ƒç´ æ—¶åœæ­¢</span></span><br><span class="line">    <span class="keyword">if</span> (array.length &lt;= <span class="number">1</span>) <span class="keyword">return</span> array;</span><br><span class="line">    <span class="comment">// å–å‚ç…§ç‰©</span></span><br><span class="line">    <span class="keyword">let</span> pivotIndex = <span class="built_in">Math</span>.floor(array.length / <span class="number">2</span>),</span><br><span class="line">        <span class="comment">// è¿™é‡Œç”¨spliceåˆ é™¤å‚ç…§ç‰©é¿å…é‡å¤å¾ªç¯</span></span><br><span class="line">        pivot = array.splice(pivotIndex, <span class="number">1</span>),</span><br><span class="line">        leftArr = [],</span><br><span class="line">        rightArr = [];</span><br><span class="line">    <span class="comment">// åˆ†åŒº</span></span><br><span class="line">    <span class="keyword">for</span> (<span class="keyword">let</span> i = <span class="number">0</span>; i &lt; array.length; i++) &#123;</span><br><span class="line">        <span class="keyword">if</span> (array[i] &lt; pivot) &#123;</span><br><span class="line">            leftArr.push(array[i]);</span><br><span class="line">        &#125; <span class="keyword">else</span> &#123;</span><br><span class="line">            rightArr.push(array[i]);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> quickSort(leftArr).concat(pivot, quickSort(rightArr));</span><br><span class="line">&#125;</span><br><span class="line"><span class="built_in">console</span>.log(quickSort(array)); <span class="comment">// [ 11, 11, 11, 23, 33, 55, 65, 99, 100, 100, 108, 108 ]</span></span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'å¿«æ’'</span>); <span class="comment">// 4ms å·¦å³</span></span><br></pre></td></tr></table></figure></li><li><p>åŸåœ°å¿«é€Ÿæ’åº</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.time(<span class="string">'å¿«æ’2'</span>);</span><br><span class="line"><span class="comment">// äº’æ¢</span></span><br><span class="line"><span class="keyword">const</span> swap = <span class="function">(<span class="params">items, firstIndex, secondIndex</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> temp = items[firstIndex];</span><br><span class="line">    items[firstIndex] = items[secondIndex];</span><br><span class="line">    items[secondIndex] = temp;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// åˆ†åŒº</span></span><br><span class="line"><span class="keyword">const</span> partition = <span class="function">(<span class="params">items, left, right</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> pivot = items[<span class="built_in">Math</span>.floor((right + left) / <span class="number">2</span>)],</span><br><span class="line">        i = left,</span><br><span class="line">        j = right;</span><br><span class="line"></span><br><span class="line">    <span class="keyword">while</span> (i &lt;= j) &#123;</span><br><span class="line">        <span class="keyword">while</span> (items[i] &lt; pivot) &#123;</span><br><span class="line">            i++;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">while</span> (items[j] &gt; pivot) &#123;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">        <span class="keyword">if</span> (i &lt;= j) &#123;   </span><br><span class="line">            swap(items, i, j);</span><br><span class="line">            i++;</span><br><span class="line">            j--;</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> i;</span><br><span class="line">&#125;</span><br><span class="line"><span class="comment">// æ’åº</span></span><br><span class="line"><span class="keyword">const</span> quickSortTwo = <span class="function">(<span class="params">items, left, right</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">let</span> index;</span><br><span class="line">    <span class="keyword">if</span> (items.length &gt; <span class="number">1</span>) &#123;</span><br><span class="line">        left = <span class="keyword">typeof</span> left != <span class="string">"number"</span> ? <span class="number">0</span> : left;</span><br><span class="line">        right = <span class="keyword">typeof</span> right != <span class="string">"number"</span> ? items.length - <span class="number">1</span> : right;</span><br><span class="line"></span><br><span class="line">        index = partition(items, left, right);</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (left &lt; index - <span class="number">1</span>) &#123;</span><br><span class="line">            quickSortTwo(items, left, index - <span class="number">1</span>);</span><br><span class="line">        &#125;</span><br><span class="line"></span><br><span class="line">        <span class="keyword">if</span> (index &lt; right) &#123;</span><br><span class="line">            quickSortTwo(items, index, right);</span><br><span class="line">        &#125;</span><br><span class="line">    &#125;</span><br><span class="line">    <span class="keyword">return</span> items;</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"><span class="built_in">console</span>.log(quickSortTwo(array));</span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'å¿«æ’2'</span>);</span><br></pre></td></tr></table></figure></li><li><p>åŸç”Ÿsort</p><figure class="highlight javascript"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="built_in">console</span>.time(<span class="string">'åŸç”Ÿ'</span>);</span><br><span class="line">array.sort(<span class="function">(<span class="params">a, b</span>) =&gt;</span> &#123;</span><br><span class="line">    <span class="keyword">if</span> (a &gt; b) <span class="keyword">return</span> <span class="number">1</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">if</span> (a &lt; b) <span class="keyword">return</span> <span class="number">-1</span></span><br><span class="line">    <span class="keyword">else</span> <span class="keyword">return</span> <span class="number">0</span></span><br><span class="line">&#125;);</span><br><span class="line"><span class="built_in">console</span>.log(array);</span><br><span class="line"><span class="comment">// 5ms å·¦å³</span></span><br><span class="line"><span class="built_in">console</span>.timeEnd(<span class="string">'åŸç”Ÿ'</span>)</span><br></pre></td></tr></table></figure></li></ul><p>ä¸‰ç§æ–¹æ³•ï¼Œ å½“æ•°ç»„è¾¾åˆ°1Wæ—¶å·®è·å°±æ¯”è¾ƒå¤§äº†ï¼ŒåŸç”Ÿéœ€è¦17mså·¦å³ï¼ŒåŸåœ°å¿«æ’éœ€è¦13mså·¦å³ï¼Œè€ŒéåŸåœ°å¿«æ’åˆ™éœ€è¦88mså·¦å³ã€‚</p><p>Created on 2017-9-7 by Cara</p>]]></content>
    
    <summary type="html">
    
      
      
        &lt;p&gt;å¿«é€Ÿæ’åºçš„å®ç°, å‚è€ƒèµ„æ–™&lt;a href=&quot;http://www.ruanyifeng.com/blog/2011/04/quicksort_in_javascript.html&quot; target=&quot;_blank&quot; rel=&quot;noopener&quot;&gt;é˜®ä¸€å³°&lt;/a&gt;&lt;/p&gt;
&lt;bl
      
    
    </summary>
    
      <category term="ç¬”è®°ğŸ“’" scheme="https://yoursite.com/categories/%E7%AC%94%E8%AE%B0%F0%9F%93%92/"/>
    
    
      <category term="JavaScript" scheme="https://yoursite.com/tags/JavaScript/"/>
    
  </entry>
  
</feed>
