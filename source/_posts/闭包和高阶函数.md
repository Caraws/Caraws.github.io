---
title: 'é—­åŒ…å’Œé«˜é˜¶å‡½æ•°'
date: 2017-10-26 23:09:00
tags:
- JavaScript
categories:
- ç¬”è®°ğŸ“’
- JavaScriptè®¾è®¡æ¨¡å¼
---
è¿™ä¸€ç¯‡ç¬”è®°æ˜¯ä¸ºæ­£å¼å¼€å§‹å­¦ä¹  javadcript è®¾è®¡æ¨¡å¼åšé“ºå«ï¼Œç”±äºè®¸å¤šè®¾è®¡æ¨¡å¼éƒ½ç”¨åˆ°äº†é—­åŒ…å’Œé«˜é˜¶å‡½æ•°æ¥å®ç°, æ‰€ä»¥äº†è§£è¿™ä¸¤ä¸ªçŸ¥è¯†ç‚¹ä¹Ÿæ˜¯å¿…è¦çš„.

> ### é—­åŒ…
é—­åŒ…ç®€å•çš„æ¥è¯´æ˜¯å‡½æ•°ä¸å‡½æ•°ä¹‹é—´çš„æ¡¥æ¢, è®©ä¸€ä¸ªå‡½æ•°æœ‰æƒè®¿é—®å¦ä¸€ä¸ªå‡½æ•°ä½œç”¨åŸŸé‡Œçš„å˜é‡. å®šä¹‰è¯´èµ·æ¥è¿˜æ˜¯å¾ˆç”Ÿæ¶©çš„, è¦ç†è§£é—­åŒ…æˆ‘ä»¬éœ€è¦å…ˆçŸ¥é“å˜é‡çš„ä½œç”¨åŸŸä»¥åŠå˜é‡çš„ç”Ÿå‘½å‘¨æœŸæ‰è¡Œ.

* å˜é‡çš„ä½œç”¨åŸŸ
å˜é‡çš„ä½œç”¨åŸŸæŒ‡çš„æ˜¯å˜é‡çš„æœ‰æ•ˆèŒƒå›´. åœ¨å‡½æ•°ä¸­ç”Ÿå‘½å˜é‡æ—¶, å¦‚æœæ²¡æœ‰å…³é”®å­— varã€letåŠconsté‚£ä¹ˆè¿™ä¸ªå˜é‡å°±ä¼šå˜æˆå…¨å±€å˜é‡; å¦‚æœæœ‰è¿™ä¸ªæ—¶å€™çš„å˜é‡å°±æ˜¯å±€éƒ¨å˜é‡, åªæœ‰åœ¨å‡½æ•°å†…éƒ¨æ‰èƒ½å¤Ÿè®¿é—®åˆ°.
```javascript
let fun = function () {
	let a = 1;
	alert(a)
}
fun()
alert(a) // a is not defined 
```
å‡½æ•°è¿™ä¸ªæ—¶å€™å°±åƒä¸€å—å•é¢é•œ, é‡Œé¢å¯ä»¥çœ‹è§å¤–é¢, å¤–é¢ä¸èƒ½çœ‹åˆ°é‡Œé¢. å› ä¸ºå‡½æ•°åœ¨æœç´¢ä¸€ä¸ªå˜é‡çš„æ—¶å€™, å¦‚æœå‡½æ•°å†…æ²¡æœ‰è¿™ä¸ªå˜é‡, é‚£ä¹ˆè¿™ä¸ªæœç´¢è¿‡ç¨‹ä¼šéšç€ä»£ç çš„æ‰§è¡Œç¯å¢ƒåˆ›å»ºçš„ä½œç”¨åŸŸé“¾å‘å¤–æœç´¢ç›´è‡³å…¨å±€å¯¹è±¡.

- å˜é‡ç”Ÿå‘½å‘¨æœŸ
å¯¹äºå…¨å±€å˜é‡æ¥è¯´, å®ƒçš„ç”Ÿå‘½å‘¨æœŸè‡ªç„¶æ˜¯æ°¸ä¹…çš„é™¤éæˆ‘ä»¬æ‰‹åŠ¨é”€æ¯è¿™ä¸ªå˜é‡; å¯¹äºå±€éƒ¨å˜é‡, ä¸€èˆ¬æ¥è¯´å½“å‡½æ•°æ‰§è¡Œå®Œæ¯•ä¹‹åè¯¥å˜é‡å°±ä¼šè·Ÿç€è¢«é”€æ¯. è€Œé—­åŒ…åˆ™å¯ä»¥å»¶ç»­å±€éƒ¨å˜é‡çš„ç”Ÿå‘½å‘¨æœŸ, ä¸¾ä¸ªæ —å­:
```javascript
let func = function () {
	let a = 0;
	return function () {
		a++;
		alert(a);
	}
}
let fn = func();
fn(); // 1
fn(); // 2
fn(); // 3
```
è¿™é‡Œæˆ‘ä»¬å¯ä»¥çœ‹åˆ° a å˜é‡ä¸ä»…åœ¨å¤–éƒ¨å¯ä»¥è¢«è®¿é—®åˆ°è€Œä¸”è¿˜ä¸€ç›´åœ¨é€’å¢, è¿™æ˜¯å› ä¸º `fn = func()`æ‰§è¡Œæ—¶, fn ä¿å­˜äº† func è¿”å›çš„åŒ¿åå‡½æ•°, è€Œè¿™ä¸ªåŒ¿åå‡½æ•°æ˜¯æœ‰æƒ func() è¢«è°ƒç”¨æ—¶äº§ç”Ÿçš„ç¯å¢ƒ. a å˜é‡å°±åœ¨è¿™ä¸ªç¯å¢ƒä¸­, æ‰€ä»¥æ—¢ç„¶å±€éƒ¨å˜é‡æ‰€åœ¨æ¢çš„ç¯å¢ƒæ²¡æœ‰è¢«é”€æ¯é‚£ä¹ˆ a å˜é‡ä¹Ÿä¸ä¼šè¢«é”€æ¯æ‰, è¿™ä¸ªä¾‹å­å°±äº§ç”Ÿäº†ä¸€ä¸ªé—­åŒ…ç»“æ„.

> #### é—­åŒ…çš„ä½œç”¨

- å°è£…å˜é‡
ä¼—æ‰€å‘¨çŸ¥å…¨å±€å˜é‡æ˜¯éå¸¸å®¹æ˜“å¼•èµ·å‘½åå†²çªçš„, æ‰€ä»¥æˆ‘ä»¬å¯ä»¥åˆ©ç”¨é—­åŒ…æŠŠä¸€äº›ä¸éœ€è¦æš´éœ²åœ¨å…¨å±€çš„å˜é‡å°è£…æˆç§æœ‰å˜é‡.

å‡è®¾æœ‰ä¸€ä¸ªè®¡ç®—ä¹˜ç§¯çš„å‡½æ•°:
```javascript
const mult = (function (){
	// ç¼“å­˜(å°è£…èµ·æ¥)
	let cache = {}
	return function () {
		let arg = [].join.call(arguments, ',')
		// å°è£…è®¡ç®—æ–¹æ³•
		let calulate = function () {
			let a = 1;
			for (let i = 0, len = arguments.length; i < len; i++) {
				a = a * arguments[i]
			}
		}
		// å­˜åœ¨ç¼“å­˜åˆ™ä¸è®¡ç®—
		if (arg in cache) return cache[arg]
		return cache[arg] = calulate.apply(null, arguments)
	}
})()

console.log(mult(2,2,1)); // 4
```
å°†å˜é‡ cache å°è£…åœ¨ mult å‡½æ•°ä¸­æ¥ç¼“å­˜å·²ç»è®¡ç®—è¿‡çš„å‚æ•°, ä»¥å‡å°‘é‡å¤è®¡ç®—. è¿™ä¸ªç¼“å­˜æœºåˆ¶æœ¬æ¥æ˜¯å¯ä»¥æ‰”åœ¨å…¨å±€ç¯å¢ƒä¸­çš„.

- å»¶ç»­å±€éƒ¨å˜é‡ç”Ÿå‘½å‘¨æœŸ
å¹³å¸¸åšåŸ‹ç‚¹ä¼šç”¨åˆ°çš„ image å¯¹è±¡æ¥ä¸ŠæŠ¥æ•°æ®, å¦‚ä¸‹:

```javascript
const report = function (src) {
	let img = new Image()
	img.src = src
}
report('http://xxxxx.com/xxx')
```
è¿™ç§å†™æ³•ä¼šé€ æˆæ•°æ®ä¸¢å¤±, å› ä¸ºåœ¨ HTTP è¿˜æœªç»“æŸæ—¶, report å‡½æ•°å·²ç»æ‰§è¡Œå®Œæ¯•è€Œ img ä¸º report å‡½æ•°ä¸­çš„å±€éƒ¨å˜é‡, åœ¨å‡½æ•°æ‰§è¡Œå®Œæ¯•åå°±ä¼šéšä¹‹é”€æ¯é€ æˆæ•°æ®ä¸¢å¤±çš„æƒ…å†µ. ä¸‹é¢ç”¨é—­åŒ…æŠŠå˜é‡å°è£…èµ·æ¥, æ¥è§£å†³è¿™ä¸€é—®é¢˜:
```javascript
const report = (function () {
	let imgs = []
	return function (src) {
		let img = new Image();
		imgs.push(img);
		img.src = src
	}
})()
report('http://xxxxx.com/xxx')
```

> #### é—­åŒ…å®ç°å‘½ä»¤æ¨¡å¼
> è¯´äº†è¿™ä¹ˆå¤šå°±æ¥çœ‹çœ‹å…³äºé—­åŒ…çš„è¿ç”¨å§, è¿™é‡Œç”¨é—­åŒ…ç®€å•å®ç°ä¸‹å‘½ä»¤æ¨¡å¼, é¡ºä¾¿é¢„å…ˆäº†è§£ä¸€ä¸‹å‘½ä»¤æ¨¡å¼.

```html
<button id='open' onclick='execute'>æ‰§è¡Œå‘½ä»¤</button>
<button id='close' onclick='undo'>æ’¤é”€å‘½ä»¤</button>
```
- é¢å‘å¯¹è±¡ç‰ˆ
```javascript
const TV = {
	open () {
		console.log('TV is open!')
	},
	close () {
		console.log('TV is close!')
	}
}
// æ¥æ”¶å‘½ä»¤
const ReceiveCommand = receiver => {
	this.receiver = receiver
}
// æ‰“å¼€ç”µè§†
ReceiveCommand.prototype.execute = function () {
	this.receiver.open()
}
// å…³ç”µè§†
ReceiveCommand.prototype.undo = functon () {
	this.receiver.close()
}

// è®¾ç½®å‘½ä»¤
const setCommand = function (command) {
	document.getElementById('open').onclick = function () {
		command.execute()
	}
	document.getElementById('close').onclick = function () {
		command.undo()
	}
}
// å°†å‘½ä»¤å‘Šè¯‰æ‰§è¡Œè€…, è®¾ç½®å‘½ä»¤ä¼ å…¥æ‰§è¡Œè€…
setCommand(new ReceiveCommand(TV))
```
å‘½ä»¤æ¨¡å¼æ˜¯æŠŠè¯·æ±‚å‘èµ·è€…å’Œæ‰§è¡Œå‘½ä»¤(æ‰§è¡Œè€…)åˆ†ç¦»å¼€æ¥, ä»¥è¾¾åˆ°è§£è€¦çš„ç›®çš„. åœ¨æ‰§è¡Œå‘½ä»¤ä¹‹å‰, æŠŠå‘½ä»¤æ”¾å…¥æ‰§è¡Œè€…æ¥å‘Šè¯‰æ‰§è¡Œè€…è¦æ‰§è¡Œä»€ä¹ˆæ ·çš„å‘½ä»¤, å‘½ä»¤æ¨¡å¼å¤§æ¦‚å°±æ˜¯è¿™æ ·å•¦.

- é—­åŒ…ç‰ˆ
```javascript
const TV = {
	open () {
		console.log('TV is open!')
	},
	close () {
		console.log('TV is close!')
	}
}
// æ‰§è¡Œè€…
const receiveCommand = receiver => {
	let execute = _ => {
		return receiver.open()
	}
	let undo = _ => {
		return receiver.close()
	}
	return {
		execute: execute,
		undo: undo
	}
}
// å‘èµ·è€…
const setCommand = command => {
	document.getElementById('open').onclick = _ => {
		execute.open()
	}
	document.getElementById('close').onclick = _ => {
		undo.close()
	}
}
setCommand(receiveCommand(TV))
```
é—­åŒ…æ˜æ˜¾æ¸…æ™°æ›´å¤š, ä¹Ÿæ›´ç®€æ´.

> ### é«˜é˜¶å‡½æ•°
å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’æˆ–è®©å‡½æ•°æ‰§è¡Œç»“æœè¿”å›å¦ä¸€ä¸ªå‡½æ•°, æ»¡è¶³è¿™ä¸¤ä¸ªæ¡ä»¶ä¹‹ä¸€çš„å‡½æ•°éƒ½å¯ä»¥ç§°ä½œä¸ºé«˜é˜¶å‡½æ•°.

#### å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’
å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’, å°±æ„å‘³ç€æˆ‘ä»¬å¯ä»¥å°†ä¸ä¸šåŠ¡ç›¸å…³çš„é€»è¾‘ä»£ç åˆ†ç¦»å‡ºæ¥, è§£é™¤ä¸šåŠ¡ä»£ç å’Œä¸å˜é€»è¾‘çš„è€¦åˆ, æœ€å¸¸è§çš„å°±æ˜¯æˆ‘ä»¬çš„å›è°ƒå‡½æ•°. å®é™…è¿ç”¨ä¸­ ajax å¼‚æ­¥è¯·æ±‚, å½“æˆ‘ä»¬ä¸çŸ¥é“è¿”å›å€¼åœ¨ä»€ä¹ˆæ—¶å€™è¿”å›å€¼åˆéœ€è¦åœ¨è¿”å›ååšä¸€äº›å¤„ç†, å°±è¦ç”¨åˆ°å›è°ƒå‡½æ•°äº†.

```javascript
let getPersonInfo = function (userId, callback) {
	$.ajax(`http://xxx/getPersonInfo?${userId}`, function (data) {
		callback && callback(data)
	})
}
// è¿™é‡Œçš„åŒ¿åå‡½æ•°å°±æ˜¯ä¸Šé¢çš„ callback
getPersonInfo("54332123", function (data) {
	console.log(data)
})
```
è¿™ç§æ˜¯æˆ‘ä»¬æ¯”è¾ƒå¸¸è§çš„å›è°ƒå‡½æ•°, åœ¨å…¶ä»–çš„æ–¹é¢, ä¹Ÿå¯ä»¥å°†ä¸€äº›è¯·æ±‚å§”æ‰˜ç»™å¦ä¸€ä¸ªå‡½æ•°ä»£ä¸ºæ‰§è¡Œ, å¦‚:
å‡å¦‚æˆ‘ä»¬éœ€è¦å…ˆåˆ›å»º100çš„ div èŠ‚ç‚¹, ç„¶åæŠŠå®ƒä»¬éšè—æ‰

```javascript
// count é»˜è®¤å€¼ä¸º100
const appendDiv = count = 100, callback => {
	if (count && typeof count === 'number') {
		for(let i = 0; i < count; i++){
			let div = document.createElement('div')
			div.innerHTML = i
			document.body.appendChild(div)
			// å°†ä¸šåŠ¡ä»£ç å§”æ‰˜æ‰§è¡Œ
			callback && callback(div)
		}
	}
} 
// æŠŠæ”¹å˜æ ·å¼çš„ä¸šåŠ¡é€»è¾‘åˆ†ç¦»å‡ºæ¥
appendDiv(function (el) {
	el.style.cssText = `display: none`
})
```
è¿™æ ·æˆ‘ä»¬å°±å°†ä¸šåŠ¡é€»è¾‘åˆ†ç¦»å‡ºæ¥äº†, ä»¥åå¯èƒ½æˆ‘ä»¬æƒ³æ”¹é¢œè‰²å•¦æˆ–è€…ä½ç½®ä»€ä¹ˆçš„ä¹Ÿæ–¹ä¾¿ç»´æŠ¤.

#### å‡½æ•°ä½œä¸ºè¿”å›å€¼ 
ç›¸æ¯”æŠŠå‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’, å¯èƒ½å‡½æ•°å½“åšè¿”å›å€¼è¿”å›è¿ç”¨åœºæ™¯æ›´å¤šä¸€äº›, è®©å‡½æ•°è¿”å›å¦ä¸€ä¸ªå¯æ‰§è¡Œå‡½æ•°å°±æ„å‘³ç€è¿ç®—è¿‡ç¨‹å¯å»¶ç»­.ç›´æ¥æ¥çœ‹ä¸€äº›ä¾‹å­å§.

- æ£€æŸ¥ç±»å‹

```javascript
const Type = {}
for (let i = 0, type; type = ['Array', 'String', 'Number'][i++];) {
	Type['is' + type] = function (obj) {
		return Object.prototype.toString.call(obj) === '[object '+ type +']'
	}
}

console.log(Type.isArray([])) // true
console.log(Type.isString('123')) // true
console.log(Type.isNumber(123)) // true
```

- å•ä¾‹æ¨¡å¼
	è¿™é‡Œå…ˆä¸è®¨è®ºå•ä¾‹æ¨¡å¼, åªçœ‹ä»£ç å®ç°

```javascript
// fn å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’
const getSingle = function (fn) {
	let ret;
	return function () {
		// å¦‚æœ ret ä¸å­˜åœ¨, ret ç­‰äº fn å‡½æ•°
		return ret || (ret = fn.apply(this, arguments))
	}
} 
// è°ƒç”¨è¿™ä¸ªé«˜é˜¶å‡½æ•°
let getDiv = getSingle(function () {
	// å‚æ•°ä¹Ÿä¼šä¸€èµ·ä¼ è¿‡æ¥, è¿™é‡Œè¿”å›['123']
	console.log(arguments);
	return document.createElement('div');
	
})
getDiv('123')
```
getSingle è¿™ä¸ªé«˜é˜¶å‡½æ•°æ—¢å°†å‡½æ•°ä½œä¸ºå‚æ•°ä¼ é€’, åˆè®©å‡½æ•°æ‰§è¡Œåè¿”å›å¦ä¸€ä¸ªå‡½æ•°.

> JavaScript è®¾è®¡æ¨¡å¼ä¸å¼€å‘å®è·µè¿˜æœ‰ä¸ªä¾‹å­ä¹Ÿå¾ˆæœ‰æ„æ€
> å«åš AOP(é¢å‘åˆ‡é¢ç¼–ç¨‹), ä½œç”¨æ˜¯æŠŠä¸ä¸šåŠ¡é€»è¾‘ä¸ç›¸å…³çš„éƒ¨åˆ†æŠ½ç¦»å‡ºæ¥å†é€šè¿‡åŠ¨æ€æ¤å…¥çš„æ–¹å¼åŠ å…¥ä¸šåŠ¡é€»è¾‘çš„æ¨¡å—ä¸­.

```javascript
// åœ¨åŸå‡½æ•°ä¹‹å‰
Function.prototype.before = function (beforeFn) {
	let that = this; // ä¿å­˜åŸå‡½æ•°çš„å¼•ç”¨
	return function () { // A
		// æ‰§è¡Œæ–°å‡½æ•°å¹¶ä¿®æ­£ this
		beforeFn.apply(this, arguments)
		// æ‰§è¡ŒåŸå‡½æ•°
		return that.apply(this, arguments)
	}
}
// åœ¨åŸå‡½æ•°ä¹‹å
Function.prototype.after = function (afterFn) {
	let that = this
	return function () { // B
		// å…ˆæ‰§è¡Œ before å‡½æ•°
		that.apply(this, arguments)
		// å†æ‰§è¡Œæ–°å‡½æ•°
		return afterFn.apply(this, arguments)
	}
}

let fn = function () {
	console.log(2)
}
fn = fn.before(function() {
	console.log(1)
}).after(function() {
	console.log(3)
})

fn() // æŒ‰é¡ºåºè¾“å‡º 1 2 3
```
ä¸Šé¢çš„æ‰§è¡Œé¡ºåºæ˜¯è¿™æ ·çš„:

1. Afterä¸­çš„å›è°ƒå‡½æ•° B
å› ä¸ºåœ¨æœ€åæ‰§è¡Œ fn å‡½æ•°æ—¶, fn å·²ç»æ˜¯ after å‡½æ•°äº†, å› æ­¤åœ¨ fn() æ‰§è¡Œæ—¶è°ƒç”¨çš„æ˜¯ after ä¸­è¿”å›çš„åŒ¿åå‡½æ•°B.
2. B ä¸­çš„ that.apply(this, arguments)
æ­¤æ—¶çš„ that æŒ‡å‘ before å‡½æ•°
3.  æ‰§è¡ŒBeforeä¸­çš„å›è°ƒå‡½æ•° A
4. A ä¸­çš„ beforeFn.apply(this, arguments)
æ‰§è¡Œ console.log(1)
5. return that.apply(this, arguments)
æ‰§è¡Œ console.log(2)
6. å›åˆ° after å‡½æ•°ä¸­æ‰§è¡Œreturn afterFn.apply(this, arguments)
æ‰§è¡Œ console.log(3)


#### å‡½æ•°æŸ¯é‡ŒåŒ–
å‡½æ•°æŸ¯é‡ŒåŒ–å¯ä»¥è¯´æ˜¯é«˜é˜¶å‡½æ•°ç»å…¸ä¸­çš„ç»å…¸äº†, è¯´åˆ°é«˜é˜¶å‡½æ•°åº”è¯¥å¾ˆå¿«å°±ä¼šæƒ³åˆ°ä»–äº†. æˆ‘ç†è§£çš„å‡½æ•°æŸ¯é‡ŒåŒ–æ˜¯: å…ˆå°†å‚æ•°ä¾æ¬¡ç¼“å­˜, åœ¨çœŸæ­£éœ€è¦è®¡ç®—ç»“æœæ—¶, æ‰è¿›è¡Œè®¡ç®—è¿™æ ·å¯ä»¥å‡å°‘è¿ç®—æ¬¡æ•°.

```js
// é€šç”¨ curring
const curring = fn => {
    let argsArr = []
    return (...args) => {
        return [...args].length === 0
            ? fn.apply(null, argsArr)
            : [].push.apply(argsArr, [...args])
    }
}

// éœ€è¦è®¡ç®—çš„å‡½æ•°
let calculate = (() => {
    let money = 0
    return (...argsArr) => {
        argsArr.forEach(item => {
            money += item
        })
        return money
    }
})()

// æŸ¯é‡ŒåŒ–
calculate = curring(calculate)

// ç¼“å­˜å‚æ•°, å…¶å®å¹¶æ²¡æœ‰è®¡ç®—
calculate(20)
calculate(40)
calculate(20)

// çœŸæ­£è®¡ç®—çš„æ—¶å€™
calculate()
```

#### å‡½æ•°èŠ‚æµ
åœ¨æŸäº›åœºæ™¯ä¸‹å‡½æ•°æœ‰å¯èƒ½ä¼šè¢«éå¸¸é¢‘ç¹åœ°è°ƒç”¨, ä»è€Œé€ æˆå¾ˆå¤§çš„æ€§èƒ½é—®é¢˜. ä¾‹å¦‚: window.resizeäº‹ä»¶ã€mousemove äº‹ä»¶, å®ƒä»¬è§¦å‘çš„é¢‘ç‡å¤ªé«˜äº†, è€Œç”¨æˆ·å¹¶ä¸éœ€è¦å¦‚æ­¤é«˜é¢‘ç‡çš„ä½¿ç”¨. å› æ­¤å‡½æ•°èŠ‚æµå°±æ˜¯ä¸ºäº†é™åˆ¶å‡½æ•°å‡ºå‘çš„é¢‘ç‡.

```js
// èŠ‚æµ
const throttle = (fn, interval = 800) => {
    let isFirst = true, timer
    // ...args => event
    return (...args) => {
        let that = this
        if (isFirst) {
            fn.apply(that, [...args])
            return isFirst = false
        }
        if (timer) return false
        timer = setTimeout(() => {
            clearTimeout(timer)
            timer = null
            fn.apply(that, [...args])
        }, interval)
    }
}

// ä¼ å…¥éœ€è¦èŠ‚æµçš„å‡½æ•°å’Œé—´éš”æ—¶é—´
window.onresize = throttle(function () {
    console.log(1)
}, 800)
```
#### åˆ†æ—¶å‡½æ•°
ä¸Šé¢æˆ‘ä»¬æä¾›äº†ä¸€ç§é™åˆ¶å‡½æ•°è°ƒç”¨é¢‘ç‡çš„è§£å†³æ–¹æ¡ˆ, ç°åœ¨æ˜¯å¦ä¸€ä¸ªé—®é¢˜: æŸäº›å‡½æ•°æ˜¯ç”±ç”¨æˆ·ä¸»åŠ¨å”¤èµ·çš„, ä½†æ˜¯å› ä¸ºä¸€äº›åŸå› å¯¼è‡´å‡½æ•°ä¸¥é‡å½±å“é¡µé¢çš„æ€§èƒ½. åˆ†æ—¶å‡½æ•°å¯ä»¥ä¸ºæˆ‘ä»¬è§£å†³è¿™ä¸ªé—®é¢˜, æˆ‘ç†è§£çš„åˆ†æ—¶å‡½æ•°: å°†è¯·æ±‚åˆ†æ‰¹å¤„ç†, åœ¨ä¸€å®šçš„æ—¶é—´å†…æ‰§è¡Œä¸€éƒ¨åˆ†è¯·æ±‚, ç›´åˆ°è¯·æ±‚å…¨éƒ¨å®Œæˆ.

```js
// åˆ†æ—¶å‡½æ•°
const timeChunk = (data, fn, count = 1) => {
    let timer, obj
    const start = () => {
        for (let i = 0; i < Math.min(count, data.length); i++) {
            obj = data.shift()
            fn.apply(null, obj)
        }
    }
    return () => {
        if (data.length === 0) {
            clearTimeout(timer)
            return
        }
        timer = setInterval(() => {
            start()
        }, 200)
    }
}

// æ¨¡æ‹Ÿæ•°æ®
let ary = []
for (let i = 0; i < 1000; i++) {
    ary.push(i)
}

// åˆ†æ—¶åŒ–
let renderfriendList = timeChunk(ary, function (n) {
    let div = document.createElement('div')
    div.innerHTML = n
    document.body.appendChild(div)
}, 10)

// æ¸²æŸ“
renderfriendList()
```

#### æƒ°æ€§åŠ è½½
ä¸¾ä¸ªä¾‹å­, åœ¨ web ä¸­ä¸ºäº†æ»¡è¶³å„æµè§ˆå™¨ä¹‹é—´çš„å·®å¼‚, æˆ‘ä»¬ä¼šåšä¸€äº›å—…æ¢å·¥ä½œ. å¼‚äºå¸¸è§„æ–¹æ¡ˆ, æƒ°æ€§åŠ è½½åœ¨çœŸæ­£éœ€è¦æ—¶æ‰ä½¿ç”¨ä¸”è¿›å…¥æ¡ä»¶åˆ†æ”¯ååœ¨å†…éƒ¨é‡å†™è¯¥å‡½æ•°, è¿™æ ·é‡å†™åçš„å‡½æ•°å°±æ˜¯æˆ‘ä»¬éœ€è¦çš„å‡½æ•°.

```js
let addEvent = (el, type, handler) => {
    if (window.addEventListener) {
        // é‡å†™å‡½æ•°
        addEvent = (el, type, handler) => {
            el.addEventListener(type, handler, false)
        }
    } else if (window.attachEvent) {
        addEvent = (el, type, handler) => {
            el.attachEvent('on' + type, handler)
        }
    }
    addEvent(el, type, handler)
}

// ä½¿ç”¨
addEvent(btn, 'click', function () {
    console.log('click!')
})
```

Created on 2017-10-26 by Cara